/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var kp=Object.create;var bi=Object.defineProperty;var Op=Object.getOwnPropertyDescriptor;var Np=Object.getOwnPropertyNames;var Gp=Object.getPrototypeOf,Vp=Object.prototype.hasOwnProperty;var _p=(B,e,t)=>e in B?bi(B,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):B[e]=t;var Je=(B,e)=>()=>(B&&(e=B(B=0)),e);var Wp=(B,e)=>()=>(e||B((e={exports:{}}).exports,e),e.exports),aA=(B,e)=>{for(var t in e)bi(B,t,{get:e[t],enumerable:!0})},Kl=(B,e,t,A)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Np(e))!Vp.call(B,i)&&i!==t&&bi(B,i,{get:()=>e[i],enumerable:!(A=Op(e,i))||A.enumerable});return B};var kl=(B,e,t)=>(t=B!=null?kp(Gp(B)):{},Kl(e||!B||!B.__esModule?bi(t,"default",{value:B,enumerable:!0}):t,B)),Xp=B=>Kl(bi({},"__esModule",{value:!0}),B);var Ee=(B,e,t)=>_p(B,typeof e!="symbol"?e+"":e,t);var Ol,Nl=Je(()=>{Ol={"Ollama (Local)":"Ollama (local)",Model:"Model",Save:"Save",Cancel:"Cancel",Edit:"Edit",Delete:"Delete","Custom Model":"Custom model","Checking...":"Checking...","Cloze card":"Cloze card","Cloze card content":"Cloze card content","Cloze card answer":"Cloze card answer","Select the AI service provider":"Select the AI service provider.","API Key":"API key","Please enter your API Key.":"Please enter your API key.","API Key is valid!":"API Key is valid!","API Key and model available.":"API Key and model available.","Invalid API Key or server error. Please verify your API Key.":"Invalid API Key or server error. Please verify your API Key.","Select a model or enter a custom one.":"Select a model or enter a custom one.","Provider URL":"Provider URL","Leave it blank, unless you are using a proxy.":"Leave it blank, unless you are using a proxy.","Please enter an API Key first":"Please enter an API Key first.","Custom model unavailable. Please check the model ID and your access permissions.":"Custom model unavailable. Please check the model ID and your access permissions.","OpenAI service":"OpenAI service","No models available. Please check your API Key.":"No models available. Please check your API Key.","Anthropic service":"Anthropic service","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"Model ID can only contain letters, numbers, underscores, dots and hyphens.","Unable to create model selection dropdown menu.":"Unable to create model selection dropdown menu.","Gemini service":"Gemini service","Deepseek service":"Deepseek service","Custom AI Service":"Custom AI Service","Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.":"Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.","The API type will be automatically detected based on your URL.":"The API type will be automatically detected based on your URL.","Service Name":"Service Name","Give your custom AI service a name":"Give your custom AI service a name","e.g., My AI Service":"e.g., My AI Service","API Endpoint URL":"API Endpoint URL","The base URL of your AI service API":"The base URL of your AI service API","Your API key for authentication":"Your API key for authentication","Test Connection":"Test Connection","Testing...":"Testing...","Please fill in all required fields first":"Please fill in all required fields first","Connection successful! Detected API type: ":"Connection successful! Detected API type: ","Connection successful!":"Connection successful!","Connection failed. Please check your settings.":"Connection failed. Please check your settings.","Connection failed: ":"Connection failed: ","The model identifier to use":"The model identifier to use","gpt-4, claude-3-opus, gemini-pro, etc.":"gpt-4, claude-3-opus, gemini-pro, etc.","Detected API Type: ":"Detected API Type: ","Advanced Options":"Advanced Options","Optional custom headers (JSON format)":"Optional custom headers (JSON format)",'Example: {"X-Custom-Header": "value"}':'Example: {"X-Custom-Header": "value"}',"Invalid JSON format. Headers must be an object.":"Invalid JSON format. Headers must be an object.","Invalid JSON format":"Invalid JSON format",Expand:"Expand",Collapse:"Collapse","Ollama service":"Ollama service","Ollama server URL (default: http://localhost:11434)":"Ollama server URL (default: http://localhost:11434)",Check:"Check","Server URL":"Server URL","Successfully connected to Ollama service":"Successfully connected to Ollama service.","No models found. Please download models using ollama":"No models found. Please download models using ollama.","Could not connect to Ollama service":"Could not connect to Ollama service","Failed to connect to Ollama service. Please check the server URL.":"Failed to connect to Ollama service. Please check the server URL.","Currently selected model (Test connection to see all available models)":"Currently selected model (Test connection to see all available models)","Select a Ollama model.":"Select a Ollama model.","No models available. Please load an available model first.":"No models available. Please load an available model first.","No models available":"No models available","Prompt settings":"Custom prompt","Add Prompt":"Add prompt","Input Prompt Name":"Input prompt name","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`Input prompt content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`,"Prompt added":"Prompt added","Prompt updated":"Prompt updated","Shift + Enter Wrap, Enter Save":"Shift + Enter Wrap, Enter Save","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI, Shift + Enter Wrap, Enter Save","Please enter AI instruction":"Please enter AI instruction","AI response generated":"AI response generated","AI generation failed":"AI generation failed","Delete comment":"Delete","Add Comment":"Add comment","Export as Image":"Export as image","Select Prompt":"Select prompt","Please add Prompt in the settings first":"Please add prompt in the settings first","AI comments have been added":"AI comments have been added","AI comments failed:":"AI comments failed:",Chat:"Chat","Failed to process dropped highlight:":"Failed to process dropped highlight:","highlighted notes":" highlighted notes","Input message...":"Input message...","Unable to access the Ollama model, please check the service.":"Unable to access the Ollama model, please check the service.","Unable to get Gemini model list, please check API Key and network connection.":"Unable to get Gemini model list, please check API key and network connection.",Download:"Download","Export successful!":"Export successful!","Export failed, please try again.":"Export failed, please try again.","Loading...":"Loading...","Search...":"Search...","No matching content found.":"No matching content found.","The current document has no highlighted content.":"The current document has no highlighted content.","No corresponding file found.":"No corresponding file found.","Export failed: Failed to load necessary components.":"Export failed: Failed to load necessary components.","All Highlight":"All highlight","Export as notes":"Export as notes","Add File Comment":"Add file comment","File Comment":"File comment","Successfully exported highlights to: ":"Successfully exported highlights to: ","Failed to export highlights: ":"Failed to export highlights: ","Default Template":"Default template","Modern minimalist knowledge card style":"Modern minimalist knowledge card style","Academic Template":"Academic template","Formal style suitable for academic citations":"Formal style suitable for academic citations","Social Template":"Social template","Modern style suitable for social media sharing":"Modern style suitable for social media sharing","Open AI chat window":"Open AI chat window","Open HiNote window":"Open HiNote window",General:"Highlight","Export Path":"Export path","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.",Exclusions:"Exclusions","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"Custom text extraction","Use Custom Pattern":"Use custom pattern","Enable to use a custom regular expression for extracting text.":"Enable to use a custom regular expression for extracting text.","Custom Pattern":"Custom pattern","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.","Default Color":"Default color","Set the default color for decorators when no color is specified. Leave empty to use system default.":"Set the default color for decorators when no color is specified. Leave empty to use system default.","Show Comment Widget":"Show comment widget","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.","Export template":"Export template","Clean orphaned data":"Clean orphaned data","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.","Flashcard learning":"Flashcard learning","New cards per day":"New cards per day","Maximum number of new cards to learn each day":"Maximum number of new cards to learn each day.","Reviews per day":"Reviews per day","Maximum number of cards to review each day":"Maximum number of cards to review each day.","Target retention":"Target retention","Target memory retention rate (0.8 = 80%)":"Target memory retention rate (0.8 = 80%).","Maximum interval":"Maximum interval","Maximum interval in days between reviews":"Maximum interval in days between reviews.","Reset daily stats":"Reset daily stats","Reset today's learning statistics":"Reset today's learning statistics.",Reset:"Reset","Daily statistics have been reset":"Daily statistics have been reset","No statistics to reset for today":"No statistics to reset for today",Advanced:"Advanced","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.","Reset algorithm parameters":"Reset algorithm parameters","Reset the FSRS algorithm parameters to default values":"Reset the FSRS algorithm parameters to default values.","Reset to Default":"Reset to default","FSRS parameters have been reset to default values":"FSRS parameters have been reset to default values.",days:"days","Activate HiCard":"Activate HiCard","Enter your license key to activate HiCard feature.":"Enter your license key to activate HiCard feature.","Get your license key from":"Get your license key from","HiNote official website":"HiNote official website","Enter license key":"Enter license key",Activate:"Activate","Please enter a license key":"Please enter a license key","HiCard activated successfully!":"HiCard activated successfully!","Invalid license key":"Invalid license key","Use global settings":"Use global settings","New cards per day:":"New cards per day:","Reviews per day:":"Reviews per day:","Create Group":"Create group",Create:"Create",Again:"Again",Hard:"Hard",Good:"Good",Easy:"Easy",Card:"Card",of:"of",Settings:"Settings","Are you sure you want to delete this group?":"Are you sure you want to delete this group?",Yes:"Yes",No:"No","You've completed All cards for today!":"You've completed All cards for today!","No cards available.":"No cards available.","Return to First Card":"Return to First Card","Edit Group":"Edit group","Create New Group":"Create new group","Please fill in all fields":"Please fill in all fields","Saving...":"Saving...","Creating...":"Creating...","Group updated successfully":"Group updated successfully","Failed to update group":"Failed to update group","Group created successfully":"Group created successfully","Failed to create or update group":"Failed to create or update group",Retention:"Retention","Limits:":"Limits:","Learning completed!":"Learning completed!","Group deleted":"Group deleted","search-prefix-all":"match all file highlights","search-prefix-hicard":"match flashcards only","search-prefix-comment":"match with comments only","search-prefix-path":"match path of the file","Open (DoubleClick)":"Open (double-click)",Testing:"Testing",connection:"connection","connection successful!":"connection successful!","connection failed. Please check your configuration.":"connection failed. Please check your configuration.","test failed":"test failed","Please enter your":"Please enter your","API Key first.":"API Key first.","host address first.":"host address first.","Invalid API Key":"Invalid API Key","Access denied":"Access denied","Rate limit exceeded":"Rate limit exceeded","Connection timeout":"Connection timeout","Service unavailable":"Service unavailable","Service not found":"Service not found","Server error":"Server error","Detected API type":"Detected API type"}});var Gl,Vl=Je(()=>{Gl={"Ollama (Local)":"Ollama (\u672C\u5730)",Model:"\u6A21\u578B",Save:"\u4FDD\u5B58",Cancel:"\u53D6\u6D88",Edit:"\u7F16\u8F91",Delete:"\u5220\u9664","Custom Model":"\u81EA\u5B9A\u4E49\u6A21\u578B","Checking...":"\u68C0\u67E5\u4E2D...","Cloze card":"\u6316\u7A7A\u5361\u7247","Cloze card content":"\u6316\u7A7A\u5361\u7247\u5185\u5BB9","Cloze card answer":"\u6316\u7A7A\u5361\u7247\u7B54\u6848","Select the AI service provider":"\u9009\u62E9 AI \u670D\u52A1\u63D0\u4F9B\u5546\u3002","API Key":"API \u5BC6\u94A5","Please enter your API Key.":"\u8BF7\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5\u3002","API Key is valid!":"API \u5BC6\u94A5\u6709\u6548\uFF01","API Key and model available.":"API \u5BC6\u94A5\u548C\u6A21\u578B\u53EF\u7528\uFF01","Invalid API Key or server error. Please verify your API Key.":"API\u5BC6\u94A5\u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u5BC6\u94A5\u3002","Select a model or enter a custom one.":"\u9009\u62E9\u6A21\u578B\u6216\u8F93\u5165\u81EA\u5B9A\u4E49\u6A21\u578B\u3002","Provider URL":"\u670D\u52A1\u5730\u5740","Leave it blank, unless you are using a proxy.":"\u7559\u7A7A\uFF0C\u9664\u975E\u60A8\u4F7F\u7528\u4EE3\u7406\u3002","Please enter an API Key first":"\u8BF7\u5148\u8F93\u5165 API \u5BC6\u94A5\u3002","Custom model unavailable. Please check the model ID and your access permissions.":"\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C\u60A8\u7684\u8BBF\u95EE\u6743\u9650\u3002","OpenAI service":"OpenAI \u670D\u52A1","No models available. Please check your API Key.":"\u6CA1\u6709\u53EF\u7528\u7684\u6A21\u578B\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u5BC6\u94A5\u3002","Anthropic service":"Anthropic \u670D\u52A1","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"\u6A21\u578B ID \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u70B9\u548C\u8FDE\u5B57\u7B26","Unable to create model selection dropdown menu.":"\u65E0\u6CD5\u521B\u5EFA\u6A21\u578B\u9009\u62E9\u4E0B\u62C9\u83DC\u5355\u3002","Gemini service":"Gemini \u670D\u52A1","Deepseek service":"Deepseek \u670D\u52A1","Custom AI Service":"\u81EA\u5B9A\u4E49 AI \u670D\u52A1","Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.":"\u914D\u7F6E\u60A8\u81EA\u5DF1\u7684 AI \u670D\u52A1\u5546\u3002\u652F\u6301 OpenAI\u3001Anthropic \u548C Gemini \u517C\u5BB9\u7684 API\u3002","The API type will be automatically detected based on your URL.":"API \u7C7B\u578B\u5C06\u6839\u636E\u60A8\u7684 URL \u81EA\u52A8\u68C0\u6D4B\u3002","Service Name":"\u670D\u52A1\u540D\u79F0","Give your custom AI service a name":"\u4E3A\u60A8\u7684\u81EA\u5B9A\u4E49 AI \u670D\u52A1\u547D\u540D","e.g., My AI Service":"\u4F8B\u5982\uFF1A\u6211\u7684 AI \u670D\u52A1","API Endpoint URL":"API \u7AEF\u70B9 URL","The base URL of your AI service API":"\u60A8\u7684 AI \u670D\u52A1 API \u7684\u57FA\u7840 URL","Your API key for authentication":"\u7528\u4E8E\u8EAB\u4EFD\u9A8C\u8BC1\u7684 API \u5BC6\u94A5","Test Connection":"\u6D4B\u8BD5\u8FDE\u63A5","Testing...":"\u6D4B\u8BD5\u4E2D...","Please fill in all required fields first":"\u8BF7\u5148\u586B\u5199\u6240\u6709\u5FC5\u586B\u5B57\u6BB5","Connection successful! Detected API type: ":"\u8FDE\u63A5\u6210\u529F\uFF01\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B\uFF1A","Connection successful!":"\u8FDE\u63A5\u6210\u529F\uFF01","Connection failed. Please check your settings.":"\u8FDE\u63A5\u5931\u8D25\u3002\u8BF7\u68C0\u67E5\u60A8\u7684\u8BBE\u7F6E\u3002","Connection failed: ":"\u8FDE\u63A5\u5931\u8D25\uFF1A","The model identifier to use":"\u8981\u4F7F\u7528\u7684\u6A21\u578B\u6807\u8BC6\u7B26","gpt-4, claude-3-opus, gemini-pro, etc.":"gpt-4\u3001claude-3-opus\u3001gemini-pro \u7B49","Detected API Type: ":"\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B\uFF1A","Advanced Options":"\u9AD8\u7EA7\u9009\u9879","Optional custom headers (JSON format)":"\u53EF\u9009\u7684\u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF08JSON \u683C\u5F0F\uFF09",'Example: {"X-Custom-Header": "value"}':'\u793A\u4F8B\uFF1A{"X-Custom-Header": "value"}',"Invalid JSON format. Headers must be an object.":"\u65E0\u6548\u7684 JSON \u683C\u5F0F\u3002\u8BF7\u6C42\u5934\u5FC5\u987B\u662F\u4E00\u4E2A\u5BF9\u8C61\u3002","Invalid JSON format":"\u65E0\u6548\u7684 JSON \u683C\u5F0F",Expand:"\u5C55\u5F00",Collapse:"\u6536\u8D77","Ollama service":"Ollama \u670D\u52A1","Ollama server URL (default: http://localhost:11434)":"Ollama server URL\uFF08\u9ED8\u8BA4\uFF1Ahttp://localhost:11434\uFF09",Check:"\u9A8C\u8BC1","Server URL":"\u670D\u52A1\u5668 URL","Successfully connected to Ollama service":"\u6210\u529F\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","No models found. Please download models using ollama":"\u672A\u627E\u5230\u6A21\u578B\u3002\u8BF7\u4F7F\u7528 ollama \u4E0B\u8F7D\u6A21\u578B","Could not connect to Ollama service":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","Failed to connect to Ollama service. Please check the server URL.":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1\uFF0C\u8BF7\u68C0\u67E5 server URL\u3002","Currently selected model (Test connection to see all available models)":"\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\uFF08\u6D4B\u8BD5\u8FDE\u63A5\u4EE5\u67E5\u770B\u53EF\u7528\u6A21\u578B\uFF09","Select a Ollama model.":"\u9009\u62E9\u4E00\u4E2A Ollama \u6A21\u578B","No models available. Please load an available model first.":"\u65E0\u53EF\u7528\u6A21\u578B\uFF0C\u8BF7\u5148\u52A0\u8F7D\u53EF\u7528\u6A21\u578B\u3002","No models available":"\u65E0\u53EF\u7528\u6A21\u578B","Prompt settings":"\u81EA\u5B9A\u4E49 Prompt","Add Prompt":"\u6DFB\u52A0 Prompt","Input Prompt Name":"\u8F93\u5165 Prompt \u540D\u79F0","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`\u8F93\u5165 Prompt \u5185\u5BB9
\u53EF\u7528\u53C2\u6570:
{{highlight}} - \u5F53\u524D\u9AD8\u4EAE\u6587\u672C
{{comment}} - \u5DF2\u5B58\u5728\u7684\u6CE8\u91CA`,"Prompt added":"Prompt \u5DF2\u6DFB\u52A0","Prompt updated":"Prompt \u5DF2\u66F4\u65B0","Shift + Enter Wrap, Enter Save":"Shift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI\uFF0CShift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Please enter AI instruction":"\u8BF7\u8F93\u5165AI\u6307\u4EE4","AI response generated":"AI\u54CD\u5E94\u5DF2\u751F\u6210","AI generation failed":"AI\u751F\u6210\u5931\u8D25","Delete comment":"\u5220\u9664\u8BC4\u8BBA","Add Comment":"\u6DFB\u52A0\u8BC4\u8BBA","Export as Image":"\u5BFC\u51FA\u4E3A\u56FE\u7247","Select Prompt":"\u9009\u62E9 Prompt","Please add Prompt in the settings first":"\u8BF7\u5148\u5728\u8BBE\u7F6E\u4E2D\u6DFB\u52A0 Prompt","AI comments added ":"AI \u8BC4\u8BBA\u5DF2\u6DFB\u52A0","AI comments failed:":"AI \u8BC4\u8BBA\u5931\u8D25\uFF1A",Chat:"\u5BF9\u8BDD","Failed to process dropped highlight:":"\u65E0\u6CD5\u5904\u7406\u5220\u9664\u7684\u9AD8\u4EAE\uFF1A","highlighted notes":" \u6761\u9AD8\u4EAE\u7B14\u8BB0","Input message...":"\u8F93\u5165\u6D88\u606F...","Unable to access the Ollama model, please check the service.":"\u65E0\u6CD5\u8BBF\u95EE Ollama \u6A21\u578B\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C","Unable to get Gemini model list, please check API Key and network connection.":"\u65E0\u6CD5\u83B7\u53D6 Gemini \u6A21\u578B\u5217\u8868\uFF0C\u8BF7\u68C0\u67E5 API Key \u548C\u7F51\u7EDC\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Export successful!":"\u5BFC\u51FA\u6210\u529F\uFF01","Export failed, please try again.":"\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5","Loading...":"\u52A0\u8F7D\u4E2D...","Search...":"\u641C\u7D22\u9AD8\u4EAE\u6216\u8BC4\u8BBA...","No matching content found.":"\u672A\u627E\u5230\u5339\u914D\u7684\u5185\u5BB9\u3002","The current document has no highlighted content.":"\u5F53\u524D\u6587\u6863\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u3002","No corresponding file found.":"\u672A\u627E\u5230\u76F8\u5E94\u7684\u6587\u4EF6\u3002","Export failed: Failed to load necessary components.":"\u5BFC\u51FA\u5931\u8D25\uFF1A\u52A0\u8F7D\u5FC5\u8981\u7EC4\u4EF6\u5931\u8D25\u3002","All Highlight":"\u5168\u90E8\u9AD8\u4EAE","Export as notes":"\u5BFC\u51FA\u4E3A\u7B14\u8BB0","Add File Comment":"\u6DFB\u52A0\u6587\u4EF6\u8BC4\u8BBA","File Comment":"\u6587\u4EF6\u8BC4\u8BBA","Successfully exported highlights to: ":"\u6210\u529F\u5BFC\u51FA\u9AD8\u4EAE\u5230\uFF1A","Failed to export highlights: ":"\u65E0\u6CD5\u5BFC\u51FA\u9AD8\u4EAE\uFF1A","Default Template":"\u9ED8\u8BA4\u6A21\u677F","Modern minimalist knowledge card style":"\u73B0\u4EE3\u6781\u7B80\u77E5\u8BC6\u5361\u7247\u98CE\u683C","Academic Template":"\u5B66\u672F\u6A21\u677F","Formal style suitable for academic citations":"\u9002\u7528\u4E8E\u5B66\u672F\u5F15\u7528\u7684\u6B63\u5F0F\u98CE\u683C","Social Template":"\u793E\u4EA4\u6A21\u677F","Modern style suitable for social media sharing":"\u9002\u7528\u4E8E\u793E\u4EA4\u5A92\u4F53\u5206\u4EAB\u7684\u73B0\u4EE3\u98CE\u683C","Open AI chat window":"\u6253\u5F00 AI \u5BF9\u8BDD\u7A97\u53E3","Open HiNote window":"\u6253\u5F00 HiNote \u7A97\u53E3","General Settings":"\u901A\u7528\u8BBE\u7F6E","Export Path":"\u5BFC\u51FA\u8DEF\u5F84","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"\u8BBE\u7F6E\u9AD8\u4EAE\u7B14\u8BB0\u7684\u5BFC\u51FA\u8DEF\u5F84\u3002\u7559\u7A7A\u5219\u4F7F\u7528 vault \u6839\u76EE\u5F55\u3002\u8DEF\u5F84\u5E94\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\u3002",Exclusions:"\u6392\u9664","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"\u9017\u53F7\u5206\u9694\u7684\u8DEF\u5F84\uFF0C\u6807\u7B7E\uFF0C\u7B14\u8BB0\u6807\u9898\u6216\u6587\u4EF6\u6269\u5C55\u540D\uFF0C\u5C06\u4ECE\u9AD8\u4EAE\u4E2D\u6392\u9664\u3002\u4F8B\u5982\uFF1Afolder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"\u81EA\u5B9A\u4E49\u6587\u672C\u63D0\u53D6","Use Custom Pattern":"\u4F7F\u7528\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enable to use a custom regular expression for extracting text.":"\u542F\u7528\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002","Custom Pattern":"\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"\u8F93\u5165\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002\u4F7F\u7528\u6355\u83B7\u7EC4 () \u6307\u5B9A\u8981\u63D0\u53D6\u7684\u6587\u672C\u3002\u7B2C\u4E00\u4E2A\u975E\u7A7A\u6355\u83B7\u7EC4\u5C06\u7528\u4F5C\u63D0\u53D6\u7684\u6587\u672C\u3002","Default Color":"\u9ED8\u8BA4\u989C\u8272","Set the default color for decorators when no color is specified. Leave empty to use system default.":"\u8BBE\u7F6E\u5F53\u672A\u6307\u5B9A\u989C\u8272\u65F6\u7684\u88C5\u9970\u5668\u7684\u9ED8\u8BA4\u989C\u8272\u3002\u7559\u7A7A\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4\u989C\u8272\u3002","Show Comment Widget":"\u663E\u793A\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"\u663E\u793A\u6216\u9690\u85CF\u9AD8\u4EAE\u65C1\u8FB9\u7684\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6\u3002\u7981\u7528\u6B64\u9009\u9879\u53EF\u4EE5\u51CF\u5C11\u9605\u8BFB\u65F6\u7684\u89C6\u89C9\u5E72\u6270\u3002","Export template":"\u5BFC\u51FA\u6A21\u677F","Clean orphaned data":"\u6E05\u7406\u5B64\u7ACB\u6570\u636E","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"\u5220\u9664\u4E0D\u518D\u5B58\u5728\u4E8E\u60A8\u7684\u6587\u6863\u4E2D\u7684\u9AD8\u4EAE\u548C\u6CE8\u91CA\u3002\u8FD9\u5728\u60A8\u5220\u9664\u9AD8\u4EAE\u4F46\u6CE8\u91CA\u4ECD\u7136\u5B58\u50A8\u5728\u6570\u636E\u6587\u4EF6\u4E2D\u65F6\u5F88\u6709\u7528\u3002","Flashcard learning":"\u95EA\u5361\u5B66\u4E60\u8BBE\u7F6E","New cards per day":"\u6BCF\u65E5\u65B0\u5361\u7247\u6570\u91CF","Maximum number of new cards to learn each day":"\u6BCF\u5929\u5B66\u4E60\u7684\u65B0\u5361\u7247\u6700\u5927\u6570\u91CF","Reviews per day":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF","Maximum number of cards to review each day":"\u6BCF\u5929\u590D\u4E60\u7684\u5361\u7247\u6700\u5927\u6570\u91CF","Target retention":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387","Target memory retention rate (0.8 = 80%)":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387\uFF080.8 = 80%\uFF09","Maximum interval":"\u6700\u5927\u95F4\u9694","Maximum interval in days between reviews":"\u590D\u4E60\u4E4B\u95F4\u7684\u6700\u5927\u95F4\u9694\u5929\u6570","Reset daily stats":"\u91CD\u7F6E\u4ECA\u65E5\u7EDF\u8BA1","Reset today's learning statistics":"\u91CD\u7F6E\u4ECA\u5929\u7684\u5B66\u4E60\u7EDF\u8BA1\u6570\u636E",Reset:"\u91CD\u7F6E","Daily statistics have been reset":"\u4ECA\u65E5\u7EDF\u8BA1\u5DF2\u91CD\u7F6E","No statistics to reset for today":"\u4ECA\u5929\u6CA1\u6709\u53EF\u91CD\u7F6E\u7684\u7EDF\u8BA1\u6570\u636E",Advanced:"\u9AD8\u7EA7\u8BBE\u7F6E","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"\u8FD9\u4E9B\u8BBE\u7F6E\u63A7\u5236FSRS\u7B97\u6CD5\u53C2\u6570\u3002\u4EC5\u5728\u7406\u89E3\u7B97\u6CD5\u7684\u60C5\u51B5\u4E0B\u66F4\u6539\u5B83\u4EEC\u3002","Reset algorithm parameters":"\u91CD\u7F6E\u7B97\u6CD5\u53C2\u6570","Reset the FSRS algorithm parameters to default values":"\u5C06FSRS\u7B97\u6CD5\u53C2\u6570\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","Reset to default":"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","FSRS parameters have been reset to default values":"FSRS\u53C2\u6570\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",days:"\u5929","FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation.":"\u7B97\u6CD5\u6743\u91CD\u53C2\u6570\u3002\u9ED8\u8BA4\u503C\u4E3A\u8F83\u5C0F\u6837\u672C\u83B7\u5F97\uFF0C\u5982\u679C\u9700\u8981\u8C03\u6574\u8BF7\u4F7F\u7528 FSRS \u4F18\u5316\u5668\u8BA1\u7B97","FSRS parameters":"FSRS \u53C2\u6570","Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.":"\u7F16\u8F91 17 \u4E2A FSRS \u7B97\u6CD5\u6743\u91CD\u3002\u683C\u5F0F\uFF1A\u6570\u5B57\u6570\u7EC4\u7684 JSON \u683C\u5F0F\u3002","FSRS parameters updated successfully":"FSRS \u53C2\u6570\u66F4\u65B0\u6210\u529F","Activate HiCard":"\u6FC0\u6D3B HiCard","Enter your license key to activate HiCard feature.":"\u8F93\u5165\u60A8\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5\u4EE5\u6FC0\u6D3B HiCard \u529F\u80FD\u3002","Get your license key from":"\u4ECE\u4EE5\u4E0B\u7F51\u7AD9\u83B7\u53D6\u8BB8\u53EF\u8BC1\u5BC6\u94A5\uFF1A","HiNote official website":"HiNote \u5B98\u65B9\u7F51\u7AD9","Enter license key":"\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5",Activate:"\u6FC0\u6D3B","Please enter a license key":"\u8BF7\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5","HiCard activated successfully!":"HiCard \u6FC0\u6D3B\u6210\u529F\uFF01","Invalid license key":"\u65E0\u6548\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5","Use global settings":"\u4F7F\u7528\u5168\u5C40\u8BBE\u7F6E","New cards per day:":"\u6BCF\u65E5\u65B0\u5361\u6570\u91CF:","Reviews per day:":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF:","Create group":"\u521B\u5EFA\u5206\u7EC4",Create:"\u521B\u5EFA",Again:"\u91CD\u6765",Hard:"\u56F0\u96BE",Good:"\u826F\u597D",Easy:"\u7B80\u5355",Card:"\u5361\u7247",of:"\u5171",Settings:"\u8BBE\u7F6E","Are you sure you want to delete this group?":"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5206\u7EC4\u5417\uFF1F",Yes:"\u662F",No:"\u5426","You've completed All cards for today!":"\u60A8\u4ECA\u5929\u5DF2\u5B8C\u6210\u6240\u6709\u5361\u7247\uFF01","No cards available.":"\u6CA1\u6709\u53EF\u7528\u7684\u5361\u7247\u3002","Return to First Card":"\u8FD4\u56DE\u7B2C\u4E00\u5F20\u5361\u7247","Edit Group":"\u7F16\u8F91\u5206\u7EC4","Create New Group":"\u521B\u5EFA\u65B0\u5206\u7EC4","Please fill in all fields":"\u8BF7\u586B\u5199\u6240\u6709\u5B57\u6BB5","Saving...":"\u4FDD\u5B58\u4E2D...","Creating...":"\u521B\u5EFA\u4E2D...","Group updated successfully":"\u5206\u7EC4\u66F4\u65B0\u6210\u529F","Failed to update group":"\u5206\u7EC4\u66F4\u65B0\u5931\u8D25","Group created successfully":"\u5206\u7EC4\u521B\u5EFA\u6210\u529F","Failed to create or update group":"\u521B\u5EFA\u6216\u66F4\u65B0\u5206\u7EC4\u5931\u8D25",Retention:"\u4FDD\u7559\u7387","Limits:":"\u9650\u5236\uFF1A","Learning completed!":"\u5B66\u4E60\u5B8C\u6210\uFF01","Group deleted":"\u5206\u7EC4\u5DF2\u5220\u9664","search-prefix-all":"\u8DE8\u6587\u4EF6\u641C\u7D22\u6240\u6709\u9AD8\u4EAE","search-prefix-hicard":"\u53EA\u641C\u7D22\u95EA\u5361\u9AD8\u4EAE","search-prefix-comment":"\u53EA\u641C\u7D22\u5E26\u6279\u6CE8\u7684\u9AD8\u4EAE","search-prefix-path":"\u6309\u6587\u4EF6\u8DEF\u5F84\u641C\u7D22\u9AD8\u4EAE","Open (double-click)":"\u53CC\u51FB\u6253\u5F00",Testing:"\u6B63\u5728\u6D4B\u8BD5",connection:"\u8FDE\u63A5","connection successful!":"\u8FDE\u63A5\u6210\u529F\uFF01","connection failed. Please check your configuration.":"\u8FDE\u63A5\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u914D\u7F6E\u3002","test failed":"\u6D4B\u8BD5\u5931\u8D25","Please enter your":"\u8BF7\u5148\u8F93\u5165","API Key first.":"API Key\u3002","host address first.":"\u670D\u52A1\u5730\u5740\u3002","Invalid API Key":"\u65E0\u6548\u7684 API Key","Access denied":"\u8BBF\u95EE\u88AB\u62D2\u7EDD","Rate limit exceeded":"\u8D85\u51FA\u901F\u7387\u9650\u5236","Connection timeout":"\u8FDE\u63A5\u8D85\u65F6","Service unavailable":"\u670D\u52A1\u4E0D\u53EF\u7528","Service not found":"\u670D\u52A1\u672A\u627E\u5230","Server error":"\u670D\u52A1\u5668\u9519\u8BEF","Detected API type":"\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B"}});function m(B){let A=(Wl.moment.locale().startsWith("zh")?_l.zh:_l.en)[B];return A||B}var Wl,_l,W=Je(()=>{Wl=require("obsidian");Nl();Vl();_l={en:Ol,zh:Gl}});var va,kt,As=Je(()=>{va=require("obsidian"),kt=class{async request(e){try{let t={url:e.url,method:e.method,headers:e.headers||{},body:e.body,throw:!1},A=await(0,va.requestUrl)(t);if(A.status<200||A.status>=300)throw this.createHTTPError(A);return A.json}catch(t){throw this.handleError(t)}}async testConnection(e){try{let t=await(0,va.requestUrl)({url:e.url,method:e.method,headers:e.headers||{},body:e.body,throw:!1});return t.status>=200&&t.status<300}catch(t){return!1}}createHTTPError(e){let t=`HTTP ${e.status}`;try{let A=e.json;A!=null&&A.error?typeof A.error=="string"?t=A.error:A.error.message&&(t=A.error.message):e.text&&(t=e.text)}catch(A){e.text&&(t=e.text)}return new Error(t)}handleError(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new Error("Unknown error occurred")}static buildJSONHeaders(e){return{"Content-Type":"application/json",...e}}static buildAuthHeaders(e,t="Bearer"){return t==="Bearer"?{"Content-Type":"application/json",Authorization:`Bearer ${e}`}:{"Content-Type":"application/json","x-api-key":e}}}});var xe,Yl=Je(()=>{xe=class B extends Error{constructor(t,A,i,n){super(t);this.provider=A;this.code=i;this.originalError=n;this.name="AIServiceError",Error.captureStackTrace&&Error.captureStackTrace(this,B)}static notConfigured(t,A){let i=A?`${t} service not configured: ${A}`:`${t} service not configured`;return new B(i,t,"NOT_CONFIGURED")}static connectionFailed(t,A){return new B(`Failed to connect to ${t} service`,t,"CONNECTION_FAILED",A)}static invalidResponse(t,A){let i=A?`Invalid response from ${t}: ${A}`:`Invalid response from ${t}`;return new B(i,t,"INVALID_RESPONSE")}static apiError(t,A,i){return new B(A,t,"API_ERROR",i)}}});var ot,pt=Je(()=>{As();Yl();ot=class{constructor(e){var t,A;this.httpClient=new kt,this.apiKey=e.apiKey,this.model=e.model,this.baseUrl=e.baseUrl||this.getDefaultBaseUrl(),this.temperature=(t=e.temperature)!=null?t:.7,this.maxTokens=(A=e.maxTokens)!=null?A:2048}buildHeaders(){return kt.buildAuthHeaders(this.apiKey)}updateModel(e){this.model=e}isConfigured(){return!!(this.apiKey&&this.model)}async generateResponse(e){let t=[{role:"user",content:e}];return await this.chat(t)}async chat(e){try{let t=this.buildUrl(),A=this.formatRequestBody(e),i=await this.httpClient.request({url:t,method:"POST",headers:this.buildHeaders(),body:JSON.stringify(A)});return this.parseResponse(i)}catch(t){throw this.handleError(t)}}async testConnection(){try{let e=this.buildUrl(),t=[{role:"user",content:"test"}],A=this.formatRequestBody(t);return await this.httpClient.testConnection({url:e,method:"POST",headers:this.buildHeaders(),body:JSON.stringify(A)})}catch(e){return!1}}buildUrl(){return`${this.baseUrl}${this.getEndpoint()}`}handleError(e){if(e instanceof xe)return e;let t="API_ERROR",A=e.message||"Unknown error";return A.includes("connect")||A.includes("ECONNREFUSED")?t="CONNECTION_FAILED":A.includes("rate limit")||A.includes("429")?t="RATE_LIMIT":A.includes("401")||A.includes("403")||A.includes("API key")?t="INVALID_API_KEY":(A.includes("404")||A.includes("model"))&&(t="MODEL_NOT_FOUND"),new xe(A,this.getProviderType(),t,e instanceof Error?e:void 0)}validateResponse(e,t){let A=e;for(let i of t){if(!A||typeof A!="object"||!(i in A))return!1;A=A[i]}return!0}}});var ql={};aA(ql,{AnthropicService:()=>_A});var _A,is=Je(()=>{pt();_A=class extends ot{constructor(e,t,A){let i={apiKey:e,model:A||"claude-opus-4-1-20250805",baseUrl:t,temperature:.7,maxTokens:4096};super(i),this.apiAddress=t||"https://api.anthropic.com"}getDefaultBaseUrl(){return"https://api.anthropic.com"}getEndpoint(){return"/v1/messages"}buildHeaders(){return{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"}}formatRequestBody(e){return{model:this.model,max_tokens:this.maxTokens,messages:e}}parseResponse(e){var t,A;if(!((A=(t=e.content)==null?void 0:t[0])!=null&&A.text))throw new Error("Invalid response format from Anthropic API");return e.content[0].text}getProviderType(){return"anthropic"}async listModels(){return[{id:"claude-opus-4-1-20250805",name:"Claude Opus 4.1"},{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude 3.7 Sonnet"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku"}]}}});var zl={};aA(zl,{GeminiService:()=>WA});var WA,rs=Je(()=>{pt();WA=class extends ot{constructor(e,t="gemini-2.5-flash",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:2048};super(i)}getDefaultBaseUrl(){return"https://generativelanguage.googleapis.com"}getEndpoint(){return`/v1/models/${this.model}:generateContent?key=${this.apiKey}`}buildHeaders(){return{"Content-Type":"application/json"}}formatRequestBody(e){var A,i,n,l;return{contents:e.map(c=>({role:c.role==="assistant"?"model":"user",parts:[{text:c.content}]})),generationConfig:{maxOutputTokens:((A=this.generationConfig)==null?void 0:A.maxOutputTokens)||this.maxTokens,temperature:((i=this.generationConfig)==null?void 0:i.temperature)||this.temperature,...((n=this.generationConfig)==null?void 0:n.responseMimeType)&&{responseMimeType:this.generationConfig.responseMimeType},...((l=this.generationConfig)==null?void 0:l.responseSchema)&&{responseSchema:this.generationConfig.responseSchema}}}}parseResponse(e){var t,A,i,n,l;if(!((l=(n=(i=(A=(t=e.candidates)==null?void 0:t[0])==null?void 0:A.content)==null?void 0:i.parts)==null?void 0:n[0])!=null&&l.text))throw new Error("Invalid response format from Gemini API");return e.candidates[0].content.parts[0].text}getProviderType(){return"gemini"}async listModels(){return[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash (Legacy)"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro (Legacy)"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash (Legacy)"}]}setGenerationConfig(e){this.generationConfig=e}async generateResponse(e,t){return t&&this.setGenerationConfig(t),super.generateResponse(e)}async chat(e,t){return t&&this.setGenerationConfig(t),super.chat(e)}async generateJSONResponse(e,t){return this.generateResponse(e,{responseMimeType:"application/json",responseSchema:t})}async chatJSON(e,t){return this.chat(e,{responseMimeType:"application/json",responseSchema:t})}async testConnection(){let e=`${this.baseUrl}/v1/models/${this.model}?key=${this.apiKey}`;return await this.httpClient.testConnection({url:e,method:"GET",headers:this.buildHeaders()})}}});var Zl={};aA(Zl,{DeepseekService:()=>XA});var XA,ss=Je(()=>{pt();XA=class extends ot{constructor(e,t="deepseek-chat",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:4096};super(i)}getDefaultBaseUrl(){return"https://api.deepseek.com/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,temperature:this.temperature,max_tokens:this.maxTokens,frequency_penalty:0,presence_penalty:0}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Invalid response format from Deepseek API");return e.choices[0].message.content}getProviderType(){return"deepseek"}async listModels(){return[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}]}}});var jl={};aA(jl,{SiliconFlowService:()=>JA});var JA,ns=Je(()=>{pt();JA=class extends ot{constructor(e){var A;if(!((A=e.siliconflow)!=null&&A.apiKey))throw new Error("SiliconFlow API key is required");let t={apiKey:e.siliconflow.apiKey,model:e.siliconflow.model||"deepseek-ai/DeepSeek-V3",baseUrl:e.siliconflow.baseUrl,temperature:.7,maxTokens:2048};super(t)}getDefaultBaseUrl(){return"https://api.siliconflow.cn/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,stream:!1}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Unexpected API response format from SiliconFlow");return e.choices[0].message.content}getProviderType(){return"siliconflow"}async listModels(){try{return(await this.httpClient.request({url:`${this.baseUrl}/models`,method:"GET",headers:this.buildHeaders()})).data.map(t=>({id:t.id,name:t.id.split("/").pop()||t.id,isCustom:!1}))}catch(e){throw this.handleError(e)}}}});var ec={};aA(ec,{CustomAIService:()=>YA});var YA,as=Je(()=>{As();pt();YA=class{constructor(e,t,A,i,n){this.apiKey=e;this.detectedApiType=null;this.baseUrl=t.replace(/\/$/,""),this.model=A,this.customHeaders=i,this.httpClient=new kt,this.detectedApiType=n||null}async detectAPIType(){if(this.detectedApiType)return this.detectedApiType;let e=this.baseUrl.toLowerCase();if(e.includes("openai")||e.includes("/v1/chat/completions")||e.includes("/chat/completions"))return this.detectedApiType="openai","openai";if(e.includes("anthropic")||e.includes("claude"))return this.detectedApiType="anthropic","anthropic";if(e.includes("gemini")||e.includes("generativelanguage.googleapis.com"))return this.detectedApiType="gemini","gemini";try{return await this.testOpenAIFormat(),this.detectedApiType="openai","openai"}catch(t){}try{return await this.testAnthropicFormat(),this.detectedApiType="anthropic","anthropic"}catch(t){}try{return await this.testGeminiFormat(),this.detectedApiType="gemini","gemini"}catch(t){}return this.detectedApiType="openai","openai"}async testOpenAIFormat(){var A,i,n;let e=this.baseUrl.includes("/chat/completions")?this.baseUrl:`${this.baseUrl}/chat/completions`;return!!((n=(i=(A=(await this.httpClient.request({url:e,method:"POST",headers:this.buildHeaders(),body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:5})})).choices)==null?void 0:A[0])==null?void 0:i.message)!=null&&n.content)}async testAnthropicFormat(){var A,i;let e=this.baseUrl.includes("/messages")?this.baseUrl:`${this.baseUrl}/messages`;return!!((i=(A=(await this.httpClient.request({url:e,method:"POST",headers:{...this.buildHeaders("ApiKey"),"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:5})})).content)==null?void 0:A[0])!=null&&i.text)}async testGeminiFormat(){var A,i,n,l,c;let e=`${this.baseUrl}/${this.model}:generateContent`;return!!((c=(l=(n=(i=(A=(await this.httpClient.request({url:`${e}?key=${this.apiKey}`,method:"POST",headers:{"Content-Type":"application/json",...this.customHeaders},body:JSON.stringify({contents:[{parts:[{text:"test"}]}]})})).candidates)==null?void 0:A[0])==null?void 0:i.content)==null?void 0:n.parts)==null?void 0:l[0])!=null&&c.text)}async generateResponse(e){return await this.chat([{role:"user",content:e}])}async chat(e){switch(await this.detectAPIType()){case"openai":return await this.chatOpenAICompatible(e);case"anthropic":return await this.chatAnthropicCompatible(e);case"gemini":return await this.chatGeminiCompatible(e);default:throw new Error("Unsupported API type")}}async chatOpenAICompatible(e){var A,i,n;let t=this.baseUrl.includes("/chat/completions")?this.baseUrl:`${this.baseUrl}/chat/completions`;try{let l=await this.httpClient.request({url:t,method:"POST",headers:this.buildHeaders(),body:JSON.stringify({model:this.model,messages:e,temperature:.7})});if(!((n=(i=(A=l.choices)==null?void 0:A[0])==null?void 0:i.message)!=null&&n.content))throw new Error("Invalid response format from custom AI API");return l.choices[0].message.content}catch(l){throw l instanceof Error?l:new Error("Failed to generate response from custom AI API")}}async chatAnthropicCompatible(e){var A,i;let t=this.baseUrl.includes("/messages")?this.baseUrl:`${this.baseUrl}/messages`;try{let n=await this.httpClient.request({url:t,method:"POST",headers:{...this.buildHeaders("ApiKey"),"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.model,messages:e,max_tokens:4096})});if(!((i=(A=n.content)==null?void 0:A[0])!=null&&i.text))throw new Error("Invalid response format from custom AI API");return n.content[0].text}catch(n){throw n instanceof Error?n:new Error("Failed to generate response from custom AI API")}}async chatGeminiCompatible(e){var A,i,n,l,c;let t=`${this.baseUrl}/${this.model}:generateContent`;try{let d=e.map(p=>({role:p.role==="assistant"?"model":"user",parts:[{text:p.content}]})),g=await this.httpClient.request({url:`${t}?key=${this.apiKey}`,method:"POST",headers:{"Content-Type":"application/json",...this.customHeaders},body:JSON.stringify({contents:d})});if(!((c=(l=(n=(i=(A=g.candidates)==null?void 0:A[0])==null?void 0:i.content)==null?void 0:n.parts)==null?void 0:l[0])!=null&&c.text))throw new Error("Invalid response format from custom AI API");return g.candidates[0].content.parts[0].text}catch(d){throw d instanceof Error?d:new Error("Failed to generate response from custom AI API")}}updateModel(e){this.model=e}getDetectedAPIType(){return this.detectedApiType}getProviderType(){return"custom"}async listModels(){return[{id:this.model,name:this.model,isCustom:!0}]}isConfigured(){return!!(this.apiKey&&this.baseUrl&&this.model)}async testConnection(){try{switch(await this.detectAPIType()){case"openai":return await this.testOpenAIFormat(),!0;case"anthropic":return await this.testAnthropicFormat(),!0;case"gemini":return await this.testGeminiFormat(),!0;default:return!1}}catch(e){return!1}}buildHeaders(e="Bearer"){let t=kt.buildAuthHeaders(this.apiKey,e);return this.customHeaders?{...t,...this.customHeaders}:t}}});var tc={};aA(tc,{IdGenerator:()=>it});var it,FA=Je(()=>{it=class{static generateHighlightId(e,t,A){let i=`${e}:${t}:${A}`,n=this.hashCode(i);return`highlight-${Math.abs(n)}-${t}`}static generateCommentId(){let e=Date.now(),t=Math.random().toString(36).substr(2,9);return`comment-${e}-${t}`}static generateCardId(){let e=Date.now(),t=Math.random().toString(36).substr(2,9);return`card-${e}-${t}`}static generateGroupId(){let e=Date.now(),t=Math.random().toString(36).substr(2,7);return`group-${e}-${t}`}static hashCode(e){let t=0;if(e.length===0)return t;for(let A=0;A<e.length;A++){let i=e.charCodeAt(A);t=(t<<5)-t+i,t=t&t}return t}static isValidHighlightId(e){return/^highlight-\d+-\d+$/.test(e)}static isValidCommentId(e){return/^comment-\d+-[a-z0-9]+$/.test(e)}static isValidCardId(e){return/^card-\d+-[a-z0-9]+$/.test(e)}static extractPositionFromHighlightId(e){let t=e.match(/^highlight-\d+-(\d+)$/);return t?parseInt(t[1],10):null}}});var Qa=Wp((Ia,Ha)=>{(function(B,e){typeof Ia=="object"&&typeof Ha!="undefined"?Ha.exports=e():typeof define=="function"&&define.amd?define(e):(B=typeof globalThis!="undefined"?globalThis:B||self,B.html2canvas=e())})(Ia,function(){"use strict";var B=function(s,r){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(o[h]=a[h])},B(s,r)};function e(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");B(s,r);function o(){this.constructor=s}s.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}var t=function(){return t=Object.assign||function(r){for(var o,a=1,h=arguments.length;a<h;a++){o=arguments[a];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])}return r},t.apply(this,arguments)};function A(s,r,o,a){function h(u){return u instanceof o?u:new o(function(f){f(u)})}return new(o||(o=Promise))(function(u,f){function v(I){try{E(a.next(I))}catch(H){f(H)}}function w(I){try{E(a.throw(I))}catch(H){f(H)}}function E(I){I.done?u(I.value):h(I.value).then(v,w)}E((a=a.apply(s,r||[])).next())})}function i(s,r){var o={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},a,h,u,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(E){return function(I){return w([E,I])}}function w(E){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,h&&(u=E[0]&2?h.return:E[0]?h.throw||((u=h.return)&&u.call(h),0):h.next)&&!(u=u.call(h,E[1])).done)return u;switch(h=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return o.label++,{value:E[1],done:!1};case 5:o.label++,h=E[1],E=[0];continue;case 7:E=o.ops.pop(),o.trys.pop();continue;default:if(u=o.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){o=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){o.label=E[1];break}if(E[0]===6&&o.label<u[1]){o.label=u[1],u=E;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(E);break}u[2]&&o.ops.pop(),o.trys.pop();continue}E=r.call(s,o)}catch(I){E=[6,I],h=0}finally{a=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function n(s,r,o){if(o||arguments.length===2)for(var a=0,h=r.length,u;a<h;a++)(u||!(a in r))&&(u||(u=Array.prototype.slice.call(r,0,a)),u[a]=r[a]);return s.concat(u||r)}for(var l=function(){function s(r,o,a,h){this.left=r,this.top=o,this.width=a,this.height=h}return s.prototype.add=function(r,o,a,h){return new s(this.left+r,this.top+o,this.width+a,this.height+h)},s.fromClientRect=function(r,o){return new s(o.left+r.windowBounds.left,o.top+r.windowBounds.top,o.width,o.height)},s.fromDOMRectList=function(r,o){var a=Array.from(o).find(function(h){return h.width!==0});return a?new s(a.left+r.windowBounds.left,a.top+r.windowBounds.top,a.width,a.height):s.EMPTY},s.EMPTY=new s(0,0,0,0),s}(),c=function(s,r){return l.fromClientRect(s,r.getBoundingClientRect())},d=function(s){var r=s.body,o=s.documentElement;if(!r||!o)throw new Error("Unable to get document size");var a=Math.max(Math.max(r.scrollWidth,o.scrollWidth),Math.max(r.offsetWidth,o.offsetWidth),Math.max(r.clientWidth,o.clientWidth)),h=Math.max(Math.max(r.scrollHeight,o.scrollHeight),Math.max(r.offsetHeight,o.offsetHeight),Math.max(r.clientHeight,o.clientHeight));return new l(0,0,a,h)},g=function(s){for(var r=[],o=0,a=s.length;o<a;){var h=s.charCodeAt(o++);if(h>=55296&&h<=56319&&o<a){var u=s.charCodeAt(o++);(u&64512)===56320?r.push(((h&1023)<<10)+(u&1023)+65536):(r.push(h),o--)}else r.push(h)}return r},p=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];if(String.fromCodePoint)return String.fromCodePoint.apply(String,s);var o=s.length;if(!o)return"";for(var a=[],h=-1,u="";++h<o;){var f=s[h];f<=65535?a.push(f):(f-=65536,a.push((f>>10)+55296,f%1024+56320)),(h+1===o||a.length>16384)&&(u+=String.fromCharCode.apply(String,a),a.length=0)}return u},C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),F=0;F<C.length;F++)y[C.charCodeAt(F)]=F;for(var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),b=0;b<Q.length;b++)U[Q.charCodeAt(b)]=b;for(var k=function(s){var r=s.length*.75,o=s.length,a,h=0,u,f,v,w;s[s.length-1]==="="&&(r--,s[s.length-2]==="="&&r--);var E=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(r):new Array(r),I=Array.isArray(E)?E:new Uint8Array(E);for(a=0;a<o;a+=4)u=U[s.charCodeAt(a)],f=U[s.charCodeAt(a+1)],v=U[s.charCodeAt(a+2)],w=U[s.charCodeAt(a+3)],I[h++]=u<<2|f>>4,I[h++]=(f&15)<<4|v>>2,I[h++]=(v&3)<<6|w&63;return E},Ae=function(s){for(var r=s.length,o=[],a=0;a<r;a+=2)o.push(s[a+1]<<8|s[a]);return o},N=function(s){for(var r=s.length,o=[],a=0;a<r;a+=4)o.push(s[a+3]<<24|s[a+2]<<16|s[a+1]<<8|s[a]);return o},G=5,V=11,z=2,oe=V-G,Oe=65536>>G,Te=1<<G,qe=Te-1,se=1024>>G,ie=Oe+se,Ne=ie,Be=32,We=Ne+Be,ze=65536>>V,Xe=1<<oe,Tt=Xe-1,Jt=function(s,r,o){return s.slice?s.slice(r,o):new Uint16Array(Array.prototype.slice.call(s,r,o))},He=function(s,r,o){return s.slice?s.slice(r,o):new Uint32Array(Array.prototype.slice.call(s,r,o))},$t=function(s,r){var o=k(s),a=Array.isArray(o)?N(o):new Uint32Array(o),h=Array.isArray(o)?Ae(o):new Uint16Array(o),u=24,f=Jt(h,u/2,a[4]/2),v=a[5]===2?Jt(h,(u+a[4])/2):He(a,Math.ceil((u+a[4])/4));return new Yt(a[0],a[1],a[2],a[3],f,v)},Yt=function(){function s(r,o,a,h,u,f){this.initialValue=r,this.errorValue=o,this.highStart=a,this.highValueIndex=h,this.index=u,this.data=f}return s.prototype.get=function(r){var o;if(r>=0){if(r<55296||r>56319&&r<=65535)return o=this.index[r>>G],o=(o<<z)+(r&qe),this.data[o];if(r<=65535)return o=this.index[Oe+(r-55296>>G)],o=(o<<z)+(r&qe),this.data[o];if(r<this.highStart)return o=We-ze+(r>>V),o=this.index[o],o+=r>>G&Tt,o=this.index[o],o=(o<<z)+(r&qe),this.data[o];if(r<=1114111)return this.data[this.highValueIndex]}return this.errorValue},s}(),Qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",st=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),de=0;de<Qe.length;de++)st[Qe.charCodeAt(de)]=de;var Le="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Me=50,Ze=1,we=2,Pe=3,li=4,Ce=5,Bt=7,Se=8,Wa=9,qt=10,Sn=11,Xa=12,Un=13,Rc=14,ci=15,Mn=16,ar=17,hi=18,Kc=19,Ja=20,bn=21,di=22,xn=23,MA=24,nt=25,gi=26,ui=27,bA=28,kc=29,gA=30,Oc=31,or=32,lr=33,Tn=34,Ln=35,Pn=36,pi=37,Dn=38,cr=39,hr=40,Rn=41,$a=42,Nc=43,Gc=[9001,65288],Ya="!",Z="\xD7",dr="\xF7",Kn=$t(Le),Lt=[gA,Pn],kn=[Ze,we,Pe,Ce],qa=[qt,Se],za=[ui,gi],Vc=kn.concat(qa),Za=[Dn,cr,hr,Tn,Ln],_c=[ci,Un],Wc=function(s,r){r===void 0&&(r="strict");var o=[],a=[],h=[];return s.forEach(function(u,f){var v=Kn.get(u);if(v>Me?(h.push(!0),v-=Me):h.push(!1),["normal","auto","loose"].indexOf(r)!==-1&&[8208,8211,12316,12448].indexOf(u)!==-1)return a.push(f),o.push(Mn);if(v===li||v===Sn){if(f===0)return a.push(f),o.push(gA);var w=o[f-1];return Vc.indexOf(w)===-1?(a.push(a[f-1]),o.push(w)):(a.push(f),o.push(gA))}if(a.push(f),v===Oc)return o.push(r==="strict"?bn:pi);if(v===$a||v===kc)return o.push(gA);if(v===Nc)return u>=131072&&u<=196605||u>=196608&&u<=262141?o.push(pi):o.push(gA);o.push(v)}),[a,o,h]},On=function(s,r,o,a){var h=a[o];if(Array.isArray(s)?s.indexOf(h)!==-1:s===h)for(var u=o;u<=a.length;){u++;var f=a[u];if(f===r)return!0;if(f!==qt)break}if(h===qt)for(var u=o;u>0;){u--;var v=a[u];if(Array.isArray(s)?s.indexOf(v)!==-1:s===v)for(var w=o;w<=a.length;){w++;var f=a[w];if(f===r)return!0;if(f!==qt)break}if(v!==qt)break}return!1},ja=function(s,r){for(var o=s;o>=0;){var a=r[o];if(a===qt)o--;else return a}return 0},Xc=function(s,r,o,a,h){if(o[a]===0)return Z;var u=a-1;if(Array.isArray(h)&&h[u]===!0)return Z;var f=u-1,v=u+1,w=r[u],E=f>=0?r[f]:0,I=r[v];if(w===we&&I===Pe)return Z;if(kn.indexOf(w)!==-1)return Ya;if(kn.indexOf(I)!==-1||qa.indexOf(I)!==-1)return Z;if(ja(u,r)===Se)return dr;if(Kn.get(s[u])===Sn||(w===or||w===lr)&&Kn.get(s[v])===Sn||w===Bt||I===Bt||w===Wa||[qt,Un,ci].indexOf(w)===-1&&I===Wa||[ar,hi,Kc,MA,bA].indexOf(I)!==-1||ja(u,r)===di||On(xn,di,u,r)||On([ar,hi],bn,u,r)||On(Xa,Xa,u,r))return Z;if(w===qt)return dr;if(w===xn||I===xn)return Z;if(I===Mn||w===Mn)return dr;if([Un,ci,bn].indexOf(I)!==-1||w===Rc||E===Pn&&_c.indexOf(w)!==-1||w===bA&&I===Pn||I===Ja||Lt.indexOf(I)!==-1&&w===nt||Lt.indexOf(w)!==-1&&I===nt||w===ui&&[pi,or,lr].indexOf(I)!==-1||[pi,or,lr].indexOf(w)!==-1&&I===gi||Lt.indexOf(w)!==-1&&za.indexOf(I)!==-1||za.indexOf(w)!==-1&&Lt.indexOf(I)!==-1||[ui,gi].indexOf(w)!==-1&&(I===nt||[di,ci].indexOf(I)!==-1&&r[v+1]===nt)||[di,ci].indexOf(w)!==-1&&I===nt||w===nt&&[nt,bA,MA].indexOf(I)!==-1)return Z;if([nt,bA,MA,ar,hi].indexOf(I)!==-1)for(var H=u;H>=0;){var S=r[H];if(S===nt)return Z;if([bA,MA].indexOf(S)!==-1)H--;else break}if([ui,gi].indexOf(I)!==-1)for(var H=[ar,hi].indexOf(w)!==-1?f:u;H>=0;){var S=r[H];if(S===nt)return Z;if([bA,MA].indexOf(S)!==-1)H--;else break}if(Dn===w&&[Dn,cr,Tn,Ln].indexOf(I)!==-1||[cr,Tn].indexOf(w)!==-1&&[cr,hr].indexOf(I)!==-1||[hr,Ln].indexOf(w)!==-1&&I===hr||Za.indexOf(w)!==-1&&[Ja,gi].indexOf(I)!==-1||Za.indexOf(I)!==-1&&w===ui||Lt.indexOf(w)!==-1&&Lt.indexOf(I)!==-1||w===MA&&Lt.indexOf(I)!==-1||Lt.concat(nt).indexOf(w)!==-1&&I===di&&Gc.indexOf(s[v])===-1||Lt.concat(nt).indexOf(I)!==-1&&w===hi)return Z;if(w===Rn&&I===Rn){for(var D=o[u],M=1;D>0&&(D--,r[D]===Rn);)M++;if(M%2!==0)return Z}return w===or&&I===lr?Z:dr},Jc=function(s,r){r||(r={lineBreak:"normal",wordBreak:"normal"});var o=Wc(s,r.lineBreak),a=o[0],h=o[1],u=o[2];(r.wordBreak==="break-all"||r.wordBreak==="break-word")&&(h=h.map(function(v){return[nt,gA,$a].indexOf(v)!==-1?pi:v}));var f=r.wordBreak==="keep-all"?u.map(function(v,w){return v&&s[w]>=19968&&s[w]<=40959}):void 0;return[a,h,f]},$c=function(){function s(r,o,a,h){this.codePoints=r,this.required=o===Ya,this.start=a,this.end=h}return s.prototype.slice=function(){return p.apply(void 0,this.codePoints.slice(this.start,this.end))},s}(),Yc=function(s,r){var o=g(s),a=Jc(o,r),h=a[0],u=a[1],f=a[2],v=o.length,w=0,E=0;return{next:function(){if(E>=v)return{done:!0,value:null};for(var I=Z;E<v&&(I=Xc(o,u,h,++E,f))===Z;);if(I!==Z||E===v){var H=new $c(o,I,w,E);return w=E,{value:H,done:!1}}return{done:!0,value:null}}}},qc=1,zc=2,mi=4,eo=8,gr=10,to=47,fi=92,Zc=9,jc=32,ur=34,Bi=61,eh=35,th=36,Ah=37,pr=39,mr=40,Ci=41,ih=95,je=45,rh=33,sh=60,nh=62,ah=64,oh=91,lh=93,ch=61,hh=123,fr=63,dh=125,Ao=124,gh=126,uh=128,io=65533,Nn=42,uA=43,ph=44,mh=58,fh=59,wi=46,Bh=0,Ch=8,wh=11,vh=14,yh=31,Fh=127,Ft=-1,ro=48,so=97,no=101,Eh=102,Ih=117,Hh=122,ao=65,oo=69,lo=70,Qh=85,Sh=90,Ge=function(s){return s>=ro&&s<=57},Uh=function(s){return s>=55296&&s<=57343},xA=function(s){return Ge(s)||s>=ao&&s<=lo||s>=so&&s<=Eh},Mh=function(s){return s>=so&&s<=Hh},bh=function(s){return s>=ao&&s<=Sh},xh=function(s){return Mh(s)||bh(s)},Th=function(s){return s>=uh},Br=function(s){return s===gr||s===Zc||s===jc},Cr=function(s){return xh(s)||Th(s)||s===ih},co=function(s){return Cr(s)||Ge(s)||s===je},Lh=function(s){return s>=Bh&&s<=Ch||s===wh||s>=vh&&s<=yh||s===Fh},zt=function(s,r){return s!==fi?!1:r!==gr},wr=function(s,r,o){return s===je?Cr(r)||zt(r,o):Cr(s)?!0:!!(s===fi&&zt(s,r))},Gn=function(s,r,o){return s===uA||s===je?Ge(r)?!0:r===wi&&Ge(o):Ge(s===wi?r:s)},Ph=function(s){var r=0,o=1;(s[r]===uA||s[r]===je)&&(s[r]===je&&(o=-1),r++);for(var a=[];Ge(s[r]);)a.push(s[r++]);var h=a.length?parseInt(p.apply(void 0,a),10):0;s[r]===wi&&r++;for(var u=[];Ge(s[r]);)u.push(s[r++]);var f=u.length,v=f?parseInt(p.apply(void 0,u),10):0;(s[r]===oo||s[r]===no)&&r++;var w=1;(s[r]===uA||s[r]===je)&&(s[r]===je&&(w=-1),r++);for(var E=[];Ge(s[r]);)E.push(s[r++]);var I=E.length?parseInt(p.apply(void 0,E),10):0;return o*(h+v*Math.pow(10,-f))*Math.pow(10,w*I)},Dh={type:2},Rh={type:3},Kh={type:4},kh={type:13},Oh={type:8},Nh={type:21},Gh={type:9},Vh={type:10},_h={type:11},Wh={type:12},Xh={type:14},vr={type:23},Jh={type:1},$h={type:25},Yh={type:24},qh={type:26},zh={type:27},Zh={type:28},jh={type:29},ed={type:31},Vn={type:32},ho=function(){function s(){this._value=[]}return s.prototype.write=function(r){this._value=this._value.concat(g(r))},s.prototype.read=function(){for(var r=[],o=this.consumeToken();o!==Vn;)r.push(o),o=this.consumeToken();return r},s.prototype.consumeToken=function(){var r=this.consumeCodePoint();switch(r){case ur:return this.consumeStringToken(ur);case eh:var o=this.peekCodePoint(0),a=this.peekCodePoint(1),h=this.peekCodePoint(2);if(co(o)||zt(a,h)){var u=wr(o,a,h)?zc:qc,f=this.consumeName();return{type:5,value:f,flags:u}}break;case th:if(this.peekCodePoint(0)===Bi)return this.consumeCodePoint(),kh;break;case pr:return this.consumeStringToken(pr);case mr:return Dh;case Ci:return Rh;case Nn:if(this.peekCodePoint(0)===Bi)return this.consumeCodePoint(),Xh;break;case uA:if(Gn(r,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(r),this.consumeNumericToken();break;case ph:return Kh;case je:var v=r,w=this.peekCodePoint(0),E=this.peekCodePoint(1);if(Gn(v,w,E))return this.reconsumeCodePoint(r),this.consumeNumericToken();if(wr(v,w,E))return this.reconsumeCodePoint(r),this.consumeIdentLikeToken();if(w===je&&E===nh)return this.consumeCodePoint(),this.consumeCodePoint(),Yh;break;case wi:if(Gn(r,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(r),this.consumeNumericToken();break;case to:if(this.peekCodePoint(0)===Nn)for(this.consumeCodePoint();;){var I=this.consumeCodePoint();if(I===Nn&&(I=this.consumeCodePoint(),I===to))return this.consumeToken();if(I===Ft)return this.consumeToken()}break;case mh:return qh;case fh:return zh;case sh:if(this.peekCodePoint(0)===rh&&this.peekCodePoint(1)===je&&this.peekCodePoint(2)===je)return this.consumeCodePoint(),this.consumeCodePoint(),$h;break;case ah:var H=this.peekCodePoint(0),S=this.peekCodePoint(1),D=this.peekCodePoint(2);if(wr(H,S,D)){var f=this.consumeName();return{type:7,value:f}}break;case oh:return Zh;case fi:if(zt(r,this.peekCodePoint(0)))return this.reconsumeCodePoint(r),this.consumeIdentLikeToken();break;case lh:return jh;case ch:if(this.peekCodePoint(0)===Bi)return this.consumeCodePoint(),Oh;break;case hh:return _h;case dh:return Wh;case Ih:case Qh:var M=this.peekCodePoint(0),T=this.peekCodePoint(1);return M===uA&&(xA(T)||T===fr)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(r),this.consumeIdentLikeToken();case Ao:if(this.peekCodePoint(0)===Bi)return this.consumeCodePoint(),Gh;if(this.peekCodePoint(0)===Ao)return this.consumeCodePoint(),Nh;break;case gh:if(this.peekCodePoint(0)===Bi)return this.consumeCodePoint(),Vh;break;case Ft:return Vn}return Br(r)?(this.consumeWhiteSpace(),ed):Ge(r)?(this.reconsumeCodePoint(r),this.consumeNumericToken()):Cr(r)?(this.reconsumeCodePoint(r),this.consumeIdentLikeToken()):{type:6,value:p(r)}},s.prototype.consumeCodePoint=function(){var r=this._value.shift();return typeof r=="undefined"?-1:r},s.prototype.reconsumeCodePoint=function(r){this._value.unshift(r)},s.prototype.peekCodePoint=function(r){return r>=this._value.length?-1:this._value[r]},s.prototype.consumeUnicodeRangeToken=function(){for(var r=[],o=this.consumeCodePoint();xA(o)&&r.length<6;)r.push(o),o=this.consumeCodePoint();for(var a=!1;o===fr&&r.length<6;)r.push(o),o=this.consumeCodePoint(),a=!0;if(a){var h=parseInt(p.apply(void 0,r.map(function(w){return w===fr?ro:w})),16),u=parseInt(p.apply(void 0,r.map(function(w){return w===fr?lo:w})),16);return{type:30,start:h,end:u}}var f=parseInt(p.apply(void 0,r),16);if(this.peekCodePoint(0)===je&&xA(this.peekCodePoint(1))){this.consumeCodePoint(),o=this.consumeCodePoint();for(var v=[];xA(o)&&v.length<6;)v.push(o),o=this.consumeCodePoint();var u=parseInt(p.apply(void 0,v),16);return{type:30,start:f,end:u}}else return{type:30,start:f,end:f}},s.prototype.consumeIdentLikeToken=function(){var r=this.consumeName();return r.toLowerCase()==="url"&&this.peekCodePoint(0)===mr?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===mr?(this.consumeCodePoint(),{type:19,value:r}):{type:20,value:r}},s.prototype.consumeUrlToken=function(){var r=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft)return{type:22,value:""};var o=this.peekCodePoint(0);if(o===pr||o===ur){var a=this.consumeStringToken(this.consumeCodePoint());return a.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===Ci)?(this.consumeCodePoint(),{type:22,value:a.value}):(this.consumeBadUrlRemnants(),vr)}for(;;){var h=this.consumeCodePoint();if(h===Ft||h===Ci)return{type:22,value:p.apply(void 0,r)};if(Br(h))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===Ci?(this.consumeCodePoint(),{type:22,value:p.apply(void 0,r)}):(this.consumeBadUrlRemnants(),vr);if(h===ur||h===pr||h===mr||Lh(h))return this.consumeBadUrlRemnants(),vr;if(h===fi)if(zt(h,this.peekCodePoint(0)))r.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),vr;else r.push(h)}},s.prototype.consumeWhiteSpace=function(){for(;Br(this.peekCodePoint(0));)this.consumeCodePoint()},s.prototype.consumeBadUrlRemnants=function(){for(;;){var r=this.consumeCodePoint();if(r===Ci||r===Ft)return;zt(r,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},s.prototype.consumeStringSlice=function(r){for(var o=5e4,a="";r>0;){var h=Math.min(o,r);a+=p.apply(void 0,this._value.splice(0,h)),r-=h}return this._value.shift(),a},s.prototype.consumeStringToken=function(r){var o="",a=0;do{var h=this._value[a];if(h===Ft||h===void 0||h===r)return o+=this.consumeStringSlice(a),{type:0,value:o};if(h===gr)return this._value.splice(0,a),Jh;if(h===fi){var u=this._value[a+1];u!==Ft&&u!==void 0&&(u===gr?(o+=this.consumeStringSlice(a),a=-1,this._value.shift()):zt(h,u)&&(o+=this.consumeStringSlice(a),o+=p(this.consumeEscapedCodePoint()),a=-1))}a++}while(!0)},s.prototype.consumeNumber=function(){var r=[],o=mi,a=this.peekCodePoint(0);for((a===uA||a===je)&&r.push(this.consumeCodePoint());Ge(this.peekCodePoint(0));)r.push(this.consumeCodePoint());a=this.peekCodePoint(0);var h=this.peekCodePoint(1);if(a===wi&&Ge(h))for(r.push(this.consumeCodePoint(),this.consumeCodePoint()),o=eo;Ge(this.peekCodePoint(0));)r.push(this.consumeCodePoint());a=this.peekCodePoint(0),h=this.peekCodePoint(1);var u=this.peekCodePoint(2);if((a===oo||a===no)&&((h===uA||h===je)&&Ge(u)||Ge(h)))for(r.push(this.consumeCodePoint(),this.consumeCodePoint()),o=eo;Ge(this.peekCodePoint(0));)r.push(this.consumeCodePoint());return[Ph(r),o]},s.prototype.consumeNumericToken=function(){var r=this.consumeNumber(),o=r[0],a=r[1],h=this.peekCodePoint(0),u=this.peekCodePoint(1),f=this.peekCodePoint(2);if(wr(h,u,f)){var v=this.consumeName();return{type:15,number:o,flags:a,unit:v}}return h===Ah?(this.consumeCodePoint(),{type:16,number:o,flags:a}):{type:17,number:o,flags:a}},s.prototype.consumeEscapedCodePoint=function(){var r=this.consumeCodePoint();if(xA(r)){for(var o=p(r);xA(this.peekCodePoint(0))&&o.length<6;)o+=p(this.consumeCodePoint());Br(this.peekCodePoint(0))&&this.consumeCodePoint();var a=parseInt(o,16);return a===0||Uh(a)||a>1114111?io:a}return r===Ft?io:r},s.prototype.consumeName=function(){for(var r="";;){var o=this.consumeCodePoint();if(co(o))r+=p(o);else if(zt(o,this.peekCodePoint(0)))r+=p(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(o),r}},s}(),go=function(){function s(r){this._tokens=r}return s.create=function(r){var o=new ho;return o.write(r),new s(o.read())},s.parseValue=function(r){return s.create(r).parseComponentValue()},s.parseValues=function(r){return s.create(r).parseComponentValues()},s.prototype.parseComponentValue=function(){for(var r=this.consumeToken();r.type===31;)r=this.consumeToken();if(r.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(r);var o=this.consumeComponentValue();do r=this.consumeToken();while(r.type===31);if(r.type===32)return o;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},s.prototype.parseComponentValues=function(){for(var r=[];;){var o=this.consumeComponentValue();if(o.type===32)return r;r.push(o),r.push()}},s.prototype.consumeComponentValue=function(){var r=this.consumeToken();switch(r.type){case 11:case 28:case 2:return this.consumeSimpleBlock(r.type);case 19:return this.consumeFunction(r)}return r},s.prototype.consumeSimpleBlock=function(r){for(var o={type:r,values:[]},a=this.consumeToken();;){if(a.type===32||Ad(a,r))return o;this.reconsumeToken(a),o.values.push(this.consumeComponentValue()),a=this.consumeToken()}},s.prototype.consumeFunction=function(r){for(var o={name:r.value,values:[],type:18};;){var a=this.consumeToken();if(a.type===32||a.type===3)return o;this.reconsumeToken(a),o.values.push(this.consumeComponentValue())}},s.prototype.consumeToken=function(){var r=this._tokens.shift();return typeof r=="undefined"?Vn:r},s.prototype.reconsumeToken=function(r){this._tokens.unshift(r)},s}(),vi=function(s){return s.type===15},TA=function(s){return s.type===17},ce=function(s){return s.type===20},td=function(s){return s.type===0},_n=function(s,r){return ce(s)&&s.value===r},uo=function(s){return s.type!==31},LA=function(s){return s.type!==31&&s.type!==4},Et=function(s){var r=[],o=[];return s.forEach(function(a){if(a.type===4){if(o.length===0)throw new Error("Error parsing function args, zero tokens for arg");r.push(o),o=[];return}a.type!==31&&o.push(a)}),o.length&&r.push(o),r},Ad=function(s,r){return r===11&&s.type===12||r===28&&s.type===29?!0:r===2&&s.type===3},Zt=function(s){return s.type===17||s.type===15},ye=function(s){return s.type===16||Zt(s)},po=function(s){return s.length>1?[s[0],s[1]]:[s[0]]},De={type:17,number:0,flags:mi},Wn={type:16,number:50,flags:mi},jt={type:16,number:100,flags:mi},yi=function(s,r,o){var a=s[0],h=s[1];return[ge(a,r),ge(typeof h!="undefined"?h:a,o)]},ge=function(s,r){if(s.type===16)return s.number/100*r;if(vi(s))switch(s.unit){case"rem":case"em":return 16*s.number;case"px":default:return s.number}return s.number},mo="deg",fo="grad",Bo="rad",Co="turn",yr={name:"angle",parse:function(s,r){if(r.type===15)switch(r.unit){case mo:return Math.PI*r.number/180;case fo:return Math.PI/200*r.number;case Bo:return r.number;case Co:return Math.PI*2*r.number}throw new Error("Unsupported angle type")}},wo=function(s){return s.type===15&&(s.unit===mo||s.unit===fo||s.unit===Bo||s.unit===Co)},vo=function(s){var r=s.filter(ce).map(function(o){return o.value}).join(" ");switch(r){case"to bottom right":case"to right bottom":case"left top":case"top left":return[De,De];case"to top":case"bottom":return ht(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[De,jt];case"to right":case"left":return ht(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[jt,jt];case"to bottom":case"top":return ht(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[jt,De];case"to left":case"right":return ht(270)}return 0},ht=function(s){return Math.PI*s/180},eA={name:"color",parse:function(s,r){if(r.type===18){var o=id[r.name];if(typeof o=="undefined")throw new Error('Attempting to parse an unsupported color function "'+r.name+'"');return o(s,r.values)}if(r.type===5){if(r.value.length===3){var a=r.value.substring(0,1),h=r.value.substring(1,2),u=r.value.substring(2,3);return AA(parseInt(a+a,16),parseInt(h+h,16),parseInt(u+u,16),1)}if(r.value.length===4){var a=r.value.substring(0,1),h=r.value.substring(1,2),u=r.value.substring(2,3),f=r.value.substring(3,4);return AA(parseInt(a+a,16),parseInt(h+h,16),parseInt(u+u,16),parseInt(f+f,16)/255)}if(r.value.length===6){var a=r.value.substring(0,2),h=r.value.substring(2,4),u=r.value.substring(4,6);return AA(parseInt(a,16),parseInt(h,16),parseInt(u,16),1)}if(r.value.length===8){var a=r.value.substring(0,2),h=r.value.substring(2,4),u=r.value.substring(4,6),f=r.value.substring(6,8);return AA(parseInt(a,16),parseInt(h,16),parseInt(u,16),parseInt(f,16)/255)}}if(r.type===20){var v=Pt[r.value.toUpperCase()];if(typeof v!="undefined")return v}return Pt.TRANSPARENT}},tA=function(s){return(255&s)===0},be=function(s){var r=255&s,o=255&s>>8,a=255&s>>16,h=255&s>>24;return r<255?"rgba("+h+","+a+","+o+","+r/255+")":"rgb("+h+","+a+","+o+")"},AA=function(s,r,o,a){return(s<<24|r<<16|o<<8|Math.round(a*255)<<0)>>>0},yo=function(s,r){if(s.type===17)return s.number;if(s.type===16){var o=r===3?1:255;return r===3?s.number/100*o:Math.round(s.number/100*o)}return 0},Fo=function(s,r){var o=r.filter(LA);if(o.length===3){var a=o.map(yo),h=a[0],u=a[1],f=a[2];return AA(h,u,f,1)}if(o.length===4){var v=o.map(yo),h=v[0],u=v[1],f=v[2],w=v[3];return AA(h,u,f,w)}return 0};function Xn(s,r,o){return o<0&&(o+=1),o>=1&&(o-=1),o<1/6?(r-s)*o*6+s:o<1/2?r:o<2/3?(r-s)*6*(2/3-o)+s:s}var Eo=function(s,r){var o=r.filter(LA),a=o[0],h=o[1],u=o[2],f=o[3],v=(a.type===17?ht(a.number):yr.parse(s,a))/(Math.PI*2),w=ye(h)?h.number/100:0,E=ye(u)?u.number/100:0,I=typeof f!="undefined"&&ye(f)?ge(f,1):1;if(w===0)return AA(E*255,E*255,E*255,1);var H=E<=.5?E*(w+1):E+w-E*w,S=E*2-H,D=Xn(S,H,v+1/3),M=Xn(S,H,v),T=Xn(S,H,v-1/3);return AA(D*255,M*255,T*255,I)},id={hsl:Eo,hsla:Eo,rgb:Fo,rgba:Fo},Fi=function(s,r){return eA.parse(s,go.create(r).parseComponentValue())},Pt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},rd={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(s,r){return r.map(function(o){if(ce(o))switch(o.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},sd={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Fr=function(s,r){var o=eA.parse(s,r[0]),a=r[1];return a&&ye(a)?{color:o,stop:a}:{color:o,stop:null}},Io=function(s,r){var o=s[0],a=s[s.length-1];o.stop===null&&(o.stop=De),a.stop===null&&(a.stop=jt);for(var h=[],u=0,f=0;f<s.length;f++){var v=s[f].stop;if(v!==null){var w=ge(v,r);w>u?h.push(w):h.push(u),u=w}else h.push(null)}for(var E=null,f=0;f<h.length;f++){var I=h[f];if(I===null)E===null&&(E=f);else if(E!==null){for(var H=f-E,S=h[E-1],D=(I-S)/(H+1),M=1;M<=H;M++)h[E+M-1]=D*M;E=null}}return s.map(function(T,J){var O=T.color;return{color:O,stop:Math.max(Math.min(1,h[J]/r),0)}})},nd=function(s,r,o){var a=r/2,h=o/2,u=ge(s[0],r)-a,f=h-ge(s[1],o);return(Math.atan2(f,u)+Math.PI*2)%(Math.PI*2)},ad=function(s,r,o){var a=typeof s=="number"?s:nd(s,r,o),h=Math.abs(r*Math.sin(a))+Math.abs(o*Math.cos(a)),u=r/2,f=o/2,v=h/2,w=Math.sin(a-Math.PI/2)*v,E=Math.cos(a-Math.PI/2)*v;return[h,u-E,u+E,f-w,f+w]},Ct=function(s,r){return Math.sqrt(s*s+r*r)},Ho=function(s,r,o,a,h){var u=[[0,0],[0,r],[s,0],[s,r]];return u.reduce(function(f,v){var w=v[0],E=v[1],I=Ct(o-w,a-E);return(h?I<f.optimumDistance:I>f.optimumDistance)?{optimumCorner:v,optimumDistance:I}:f},{optimumDistance:h?1/0:-1/0,optimumCorner:null}).optimumCorner},od=function(s,r,o,a,h){var u=0,f=0;switch(s.size){case 0:s.shape===0?u=f=Math.min(Math.abs(r),Math.abs(r-a),Math.abs(o),Math.abs(o-h)):s.shape===1&&(u=Math.min(Math.abs(r),Math.abs(r-a)),f=Math.min(Math.abs(o),Math.abs(o-h)));break;case 2:if(s.shape===0)u=f=Math.min(Ct(r,o),Ct(r,o-h),Ct(r-a,o),Ct(r-a,o-h));else if(s.shape===1){var v=Math.min(Math.abs(o),Math.abs(o-h))/Math.min(Math.abs(r),Math.abs(r-a)),w=Ho(a,h,r,o,!0),E=w[0],I=w[1];u=Ct(E-r,(I-o)/v),f=v*u}break;case 1:s.shape===0?u=f=Math.max(Math.abs(r),Math.abs(r-a),Math.abs(o),Math.abs(o-h)):s.shape===1&&(u=Math.max(Math.abs(r),Math.abs(r-a)),f=Math.max(Math.abs(o),Math.abs(o-h)));break;case 3:if(s.shape===0)u=f=Math.max(Ct(r,o),Ct(r,o-h),Ct(r-a,o),Ct(r-a,o-h));else if(s.shape===1){var v=Math.max(Math.abs(o),Math.abs(o-h))/Math.max(Math.abs(r),Math.abs(r-a)),H=Ho(a,h,r,o,!1),E=H[0],I=H[1];u=Ct(E-r,(I-o)/v),f=v*u}break}return Array.isArray(s.size)&&(u=ge(s.size[0],a),f=s.size.length===2?ge(s.size[1],h):u),[u,f]},ld=function(s,r){var o=ht(180),a=[];return Et(r).forEach(function(h,u){if(u===0){var f=h[0];if(f.type===20&&f.value==="to"){o=vo(h);return}else if(wo(f)){o=yr.parse(s,f);return}}var v=Fr(s,h);a.push(v)}),{angle:o,stops:a,type:1}},Er=function(s,r){var o=ht(180),a=[];return Et(r).forEach(function(h,u){if(u===0){var f=h[0];if(f.type===20&&["top","left","right","bottom"].indexOf(f.value)!==-1){o=vo(h);return}else if(wo(f)){o=(yr.parse(s,f)+ht(270))%ht(360);return}}var v=Fr(s,h);a.push(v)}),{angle:o,stops:a,type:1}},cd=function(s,r){var o=ht(180),a=[],h=1,u=0,f=3,v=[];return Et(r).forEach(function(w,E){var I=w[0];if(E===0){if(ce(I)&&I.value==="linear"){h=1;return}else if(ce(I)&&I.value==="radial"){h=2;return}}if(I.type===18){if(I.name==="from"){var H=eA.parse(s,I.values[0]);a.push({stop:De,color:H})}else if(I.name==="to"){var H=eA.parse(s,I.values[0]);a.push({stop:jt,color:H})}else if(I.name==="color-stop"){var S=I.values.filter(LA);if(S.length===2){var H=eA.parse(s,S[1]),D=S[0];TA(D)&&a.push({stop:{type:16,number:D.number*100,flags:D.flags},color:H})}}}}),h===1?{angle:(o+ht(180))%ht(360),stops:a,type:h}:{size:f,shape:u,stops:a,position:v,type:h}},Qo="closest-side",So="farthest-side",Uo="closest-corner",Mo="farthest-corner",bo="circle",xo="ellipse",To="cover",Lo="contain",hd=function(s,r){var o=0,a=3,h=[],u=[];return Et(r).forEach(function(f,v){var w=!0;if(v===0){var E=!1;w=f.reduce(function(H,S){if(E)if(ce(S))switch(S.value){case"center":return u.push(Wn),H;case"top":case"left":return u.push(De),H;case"right":case"bottom":return u.push(jt),H}else(ye(S)||Zt(S))&&u.push(S);else if(ce(S))switch(S.value){case bo:return o=0,!1;case xo:return o=1,!1;case"at":return E=!0,!1;case Qo:return a=0,!1;case To:case So:return a=1,!1;case Lo:case Uo:return a=2,!1;case Mo:return a=3,!1}else if(Zt(S)||ye(S))return Array.isArray(a)||(a=[]),a.push(S),!1;return H},w)}if(w){var I=Fr(s,f);h.push(I)}}),{size:a,shape:o,stops:h,position:u,type:2}},Ir=function(s,r){var o=0,a=3,h=[],u=[];return Et(r).forEach(function(f,v){var w=!0;if(v===0?w=f.reduce(function(I,H){if(ce(H))switch(H.value){case"center":return u.push(Wn),!1;case"top":case"left":return u.push(De),!1;case"right":case"bottom":return u.push(jt),!1}else if(ye(H)||Zt(H))return u.push(H),!1;return I},w):v===1&&(w=f.reduce(function(I,H){if(ce(H))switch(H.value){case bo:return o=0,!1;case xo:return o=1,!1;case Lo:case Qo:return a=0,!1;case So:return a=1,!1;case Uo:return a=2,!1;case To:case Mo:return a=3,!1}else if(Zt(H)||ye(H))return Array.isArray(a)||(a=[]),a.push(H),!1;return I},w)),w){var E=Fr(s,f);h.push(E)}}),{size:a,shape:o,stops:h,position:u,type:2}},dd=function(s){return s.type===1},gd=function(s){return s.type===2},Jn={name:"image",parse:function(s,r){if(r.type===22){var o={url:r.value,type:0};return s.cache.addImage(r.value),o}if(r.type===18){var a=Po[r.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported image function "'+r.name+'"');return a(s,r.values)}throw new Error("Unsupported image type "+r.type)}};function ud(s){return!(s.type===20&&s.value==="none")&&(s.type!==18||!!Po[s.name])}var Po={"linear-gradient":ld,"-moz-linear-gradient":Er,"-ms-linear-gradient":Er,"-o-linear-gradient":Er,"-webkit-linear-gradient":Er,"radial-gradient":hd,"-moz-radial-gradient":Ir,"-ms-radial-gradient":Ir,"-o-radial-gradient":Ir,"-webkit-radial-gradient":Ir,"-webkit-gradient":cd},pd={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(s,r){if(r.length===0)return[];var o=r[0];return o.type===20&&o.value==="none"?[]:r.filter(function(a){return LA(a)&&ud(a)}).map(function(a){return Jn.parse(s,a)})}},md={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(s,r){return r.map(function(o){if(ce(o))switch(o.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},fd={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(s,r){return Et(r).map(function(o){return o.filter(ye)}).map(po)}},Bd={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(s,r){return Et(r).map(function(o){return o.filter(ce).map(function(a){return a.value}).join(" ")}).map(Cd)}},Cd=function(s){switch(s){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},PA;(function(s){s.AUTO="auto",s.CONTAIN="contain",s.COVER="cover"})(PA||(PA={}));var wd={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(s,r){return Et(r).map(function(o){return o.filter(vd)})}},vd=function(s){return ce(s)||ye(s)},Hr=function(s){return{name:"border-"+s+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},yd=Hr("top"),Fd=Hr("right"),Ed=Hr("bottom"),Id=Hr("left"),Qr=function(s){return{name:"border-radius-"+s,initialValue:"0 0",prefix:!1,type:1,parse:function(r,o){return po(o.filter(ye))}}},Hd=Qr("top-left"),Qd=Qr("top-right"),Sd=Qr("bottom-right"),Ud=Qr("bottom-left"),Sr=function(s){return{name:"border-"+s+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(r,o){switch(o){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Md=Sr("top"),bd=Sr("right"),xd=Sr("bottom"),Td=Sr("left"),Ur=function(s){return{name:"border-"+s+"-width",initialValue:"0",type:0,prefix:!1,parse:function(r,o){return vi(o)?o.number:0}}},Ld=Ur("top"),Pd=Ur("right"),Dd=Ur("bottom"),Rd=Ur("left"),Kd={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},kd={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(s,r){switch(r){case"rtl":return 1;case"ltr":default:return 0}}},Od={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(s,r){return r.filter(ce).reduce(function(o,a){return o|Nd(a.value)},0)}},Nd=function(s){switch(s){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Gd={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Vd={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(s,r){return r.type===20&&r.value==="normal"?0:r.type===17||r.type===15?r.number:0}},Mr;(function(s){s.NORMAL="normal",s.STRICT="strict"})(Mr||(Mr={}));var _d={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"strict":return Mr.STRICT;case"normal":default:return Mr.NORMAL}}},Wd={name:"line-height",initialValue:"normal",prefix:!1,type:4},Do=function(s,r){return ce(s)&&s.value==="normal"?1.2*r:s.type===17?r*s.number:ye(s)?ge(s,r):r},Xd={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(s,r){return r.type===20&&r.value==="none"?null:Jn.parse(s,r)}},Jd={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(s,r){switch(r){case"inside":return 0;case"outside":default:return 1}}},$n={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},br=function(s){return{name:"margin-"+s,initialValue:"0",prefix:!1,type:4}},$d=br("top"),Yd=br("right"),qd=br("bottom"),zd=br("left"),Zd={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(s,r){return r.filter(ce).map(function(o){switch(o.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},jd={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"break-word":return"break-word";case"normal":default:return"normal"}}},xr=function(s){return{name:"padding-"+s,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},eg=xr("top"),tg=xr("right"),Ag=xr("bottom"),ig=xr("left"),rg={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(s,r){switch(r){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},sg={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(s,r){switch(r){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},ng={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.length===1&&_n(r[0],"none")?[]:Et(r).map(function(o){for(var a={color:Pt.TRANSPARENT,offsetX:De,offsetY:De,blur:De},h=0,u=0;u<o.length;u++){var f=o[u];Zt(f)?(h===0?a.offsetX=f:h===1?a.offsetY=f:a.blur=f,h++):a.color=eA.parse(s,f)}return a})}},ag={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},og={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(s,r){if(r.type===20&&r.value==="none")return null;if(r.type===18){var o=hg[r.name];if(typeof o=="undefined")throw new Error('Attempting to parse an unsupported transform function "'+r.name+'"');return o(r.values)}return null}},lg=function(s){var r=s.filter(function(o){return o.type===17}).map(function(o){return o.number});return r.length===6?r:null},cg=function(s){var r=s.filter(function(w){return w.type===17}).map(function(w){return w.number}),o=r[0],a=r[1];r[2],r[3];var h=r[4],u=r[5];r[6],r[7],r[8],r[9],r[10],r[11];var f=r[12],v=r[13];return r[14],r[15],r.length===16?[o,a,h,u,f,v]:null},hg={matrix:lg,matrix3d:cg},Ro={type:16,number:50,flags:mi},dg=[Ro,Ro],gg={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(s,r){var o=r.filter(ye);return o.length!==2?dg:[o[0],o[1]]}},ug={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Ei;(function(s){s.NORMAL="normal",s.BREAK_ALL="break-all",s.KEEP_ALL="keep-all"})(Ei||(Ei={}));for(var pg={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"break-all":return Ei.BREAK_ALL;case"keep-all":return Ei.KEEP_ALL;case"normal":default:return Ei.NORMAL}}},mg={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(s,r){if(r.type===20)return{auto:!0,order:0};if(TA(r))return{auto:!1,order:r.number};throw new Error("Invalid z-index number parsed")}},Ko={name:"time",parse:function(s,r){if(r.type===15)switch(r.unit.toLowerCase()){case"s":return 1e3*r.number;case"ms":return r.number}throw new Error("Unsupported time type")}},fg={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(s,r){return TA(r)?r.number:1}},Bg={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Cg={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(s,r){return r.filter(ce).map(function(o){switch(o.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(o){return o!==0})}},wg={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(s,r){var o=[],a=[];return r.forEach(function(h){switch(h.type){case 20:case 0:o.push(h.value);break;case 17:o.push(h.number.toString());break;case 4:a.push(o.join(" ")),o.length=0;break}}),o.length&&a.push(o.join(" ")),a.map(function(h){return h.indexOf(" ")===-1?h:"'"+h+"'"})}},vg={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},yg={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(s,r){if(TA(r))return r.number;if(ce(r))switch(r.value){case"bold":return 700;case"normal":default:return 400}return 400}},Fg={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.filter(ce).map(function(o){return o.value})}},Eg={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ue=function(s,r){return(s&r)!==0},Ig={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(s,r){if(r.length===0)return[];var o=r[0];return o.type===20&&o.value==="none"?[]:r}},Hg={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return null;var o=r[0];if(o.type===20&&o.value==="none")return null;for(var a=[],h=r.filter(uo),u=0;u<h.length;u++){var f=h[u],v=h[u+1];if(f.type===20){var w=v&&TA(v)?v.number:1;a.push({counter:f.value,increment:w})}}return a}},Qg={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return[];for(var o=[],a=r.filter(uo),h=0;h<a.length;h++){var u=a[h],f=a[h+1];if(ce(u)&&u.value!=="none"){var v=f&&TA(f)?f.number:0;o.push({counter:u.value,reset:v})}}return o}},Sg={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(s,r){return r.filter(vi).map(function(o){return Ko.parse(s,o)})}},Ug={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return null;var o=r[0];if(o.type===20&&o.value==="none")return null;var a=[],h=r.filter(td);if(h.length%2!==0)return null;for(var u=0;u<h.length;u+=2){var f=h[u].value,v=h[u+1].value;a.push({open:f,close:v})}return a}},ko=function(s,r,o){if(!s)return"";var a=s[Math.min(r,s.length-1)];return a?o?a.open:a.close:""},Mg={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.length===1&&_n(r[0],"none")?[]:Et(r).map(function(o){for(var a={color:255,offsetX:De,offsetY:De,blur:De,spread:De,inset:!1},h=0,u=0;u<o.length;u++){var f=o[u];_n(f,"inset")?a.inset=!0:Zt(f)?(h===0?a.offsetX=f:h===1?a.offsetY=f:h===2?a.blur=f:a.spread=f,h++):a.color=eA.parse(s,f)}return a})}},bg={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(s,r){var o=[0,1,2],a=[];return r.filter(ce).forEach(function(h){switch(h.value){case"stroke":a.push(1);break;case"fill":a.push(0);break;case"markers":a.push(2);break}}),o.forEach(function(h){a.indexOf(h)===-1&&a.push(h)}),a}},xg={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Tg={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(s,r){return vi(r)?r.number:0}},Lg=function(){function s(r,o){var a,h;this.animationDuration=R(r,Sg,o.animationDuration),this.backgroundClip=R(r,rd,o.backgroundClip),this.backgroundColor=R(r,sd,o.backgroundColor),this.backgroundImage=R(r,pd,o.backgroundImage),this.backgroundOrigin=R(r,md,o.backgroundOrigin),this.backgroundPosition=R(r,fd,o.backgroundPosition),this.backgroundRepeat=R(r,Bd,o.backgroundRepeat),this.backgroundSize=R(r,wd,o.backgroundSize),this.borderTopColor=R(r,yd,o.borderTopColor),this.borderRightColor=R(r,Fd,o.borderRightColor),this.borderBottomColor=R(r,Ed,o.borderBottomColor),this.borderLeftColor=R(r,Id,o.borderLeftColor),this.borderTopLeftRadius=R(r,Hd,o.borderTopLeftRadius),this.borderTopRightRadius=R(r,Qd,o.borderTopRightRadius),this.borderBottomRightRadius=R(r,Sd,o.borderBottomRightRadius),this.borderBottomLeftRadius=R(r,Ud,o.borderBottomLeftRadius),this.borderTopStyle=R(r,Md,o.borderTopStyle),this.borderRightStyle=R(r,bd,o.borderRightStyle),this.borderBottomStyle=R(r,xd,o.borderBottomStyle),this.borderLeftStyle=R(r,Td,o.borderLeftStyle),this.borderTopWidth=R(r,Ld,o.borderTopWidth),this.borderRightWidth=R(r,Pd,o.borderRightWidth),this.borderBottomWidth=R(r,Dd,o.borderBottomWidth),this.borderLeftWidth=R(r,Rd,o.borderLeftWidth),this.boxShadow=R(r,Mg,o.boxShadow),this.color=R(r,Kd,o.color),this.direction=R(r,kd,o.direction),this.display=R(r,Od,o.display),this.float=R(r,Gd,o.cssFloat),this.fontFamily=R(r,wg,o.fontFamily),this.fontSize=R(r,vg,o.fontSize),this.fontStyle=R(r,Eg,o.fontStyle),this.fontVariant=R(r,Fg,o.fontVariant),this.fontWeight=R(r,yg,o.fontWeight),this.letterSpacing=R(r,Vd,o.letterSpacing),this.lineBreak=R(r,_d,o.lineBreak),this.lineHeight=R(r,Wd,o.lineHeight),this.listStyleImage=R(r,Xd,o.listStyleImage),this.listStylePosition=R(r,Jd,o.listStylePosition),this.listStyleType=R(r,$n,o.listStyleType),this.marginTop=R(r,$d,o.marginTop),this.marginRight=R(r,Yd,o.marginRight),this.marginBottom=R(r,qd,o.marginBottom),this.marginLeft=R(r,zd,o.marginLeft),this.opacity=R(r,fg,o.opacity);var u=R(r,Zd,o.overflow);this.overflowX=u[0],this.overflowY=u[u.length>1?1:0],this.overflowWrap=R(r,jd,o.overflowWrap),this.paddingTop=R(r,eg,o.paddingTop),this.paddingRight=R(r,tg,o.paddingRight),this.paddingBottom=R(r,Ag,o.paddingBottom),this.paddingLeft=R(r,ig,o.paddingLeft),this.paintOrder=R(r,bg,o.paintOrder),this.position=R(r,sg,o.position),this.textAlign=R(r,rg,o.textAlign),this.textDecorationColor=R(r,Bg,(a=o.textDecorationColor)!==null&&a!==void 0?a:o.color),this.textDecorationLine=R(r,Cg,(h=o.textDecorationLine)!==null&&h!==void 0?h:o.textDecoration),this.textShadow=R(r,ng,o.textShadow),this.textTransform=R(r,ag,o.textTransform),this.transform=R(r,og,o.transform),this.transformOrigin=R(r,gg,o.transformOrigin),this.visibility=R(r,ug,o.visibility),this.webkitTextStrokeColor=R(r,xg,o.webkitTextStrokeColor),this.webkitTextStrokeWidth=R(r,Tg,o.webkitTextStrokeWidth),this.wordBreak=R(r,pg,o.wordBreak),this.zIndex=R(r,mg,o.zIndex)}return s.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},s.prototype.isTransparent=function(){return tA(this.backgroundColor)},s.prototype.isTransformed=function(){return this.transform!==null},s.prototype.isPositioned=function(){return this.position!==0},s.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},s.prototype.isFloating=function(){return this.float!==0},s.prototype.isInlineLevel=function(){return Ue(this.display,4)||Ue(this.display,33554432)||Ue(this.display,268435456)||Ue(this.display,536870912)||Ue(this.display,67108864)||Ue(this.display,134217728)},s}(),Pg=function(){function s(r,o){this.content=R(r,Ig,o.content),this.quotes=R(r,Ug,o.quotes)}return s}(),Oo=function(){function s(r,o){this.counterIncrement=R(r,Hg,o.counterIncrement),this.counterReset=R(r,Qg,o.counterReset)}return s}(),R=function(s,r,o){var a=new ho,h=o!==null&&typeof o!="undefined"?o.toString():r.initialValue;a.write(h);var u=new go(a.read());switch(r.type){case 2:var f=u.parseComponentValue();return r.parse(s,ce(f)?f.value:r.initialValue);case 0:return r.parse(s,u.parseComponentValue());case 1:return r.parse(s,u.parseComponentValues());case 4:return u.parseComponentValue();case 3:switch(r.format){case"angle":return yr.parse(s,u.parseComponentValue());case"color":return eA.parse(s,u.parseComponentValue());case"image":return Jn.parse(s,u.parseComponentValue());case"length":var v=u.parseComponentValue();return Zt(v)?v:De;case"length-percentage":var w=u.parseComponentValue();return ye(w)?w:De;case"time":return Ko.parse(s,u.parseComponentValue())}break}},Dg="data-html2canvas-debug",Rg=function(s){var r=s.getAttribute(Dg);switch(r){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Yn=function(s,r){var o=Rg(s);return o===1||r===o},It=function(){function s(r,o){if(this.context=r,this.textNodes=[],this.elements=[],this.flags=0,Yn(o,3))debugger;this.styles=new Lg(r,window.getComputedStyle(o,null)),la(o)&&(this.styles.animationDuration.some(function(a){return a>0})&&(o.style.animationDuration="0s"),this.styles.transform!==null&&(o.style.transform="none")),this.bounds=c(this.context,o),Yn(o,4)&&(this.flags|=16)}return s}(),Kg="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",No="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ii=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Tr=0;Tr<No.length;Tr++)Ii[No.charCodeAt(Tr)]=Tr;for(var kg=function(s){var r=s.length*.75,o=s.length,a,h=0,u,f,v,w;s[s.length-1]==="="&&(r--,s[s.length-2]==="="&&r--);var E=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(r):new Array(r),I=Array.isArray(E)?E:new Uint8Array(E);for(a=0;a<o;a+=4)u=Ii[s.charCodeAt(a)],f=Ii[s.charCodeAt(a+1)],v=Ii[s.charCodeAt(a+2)],w=Ii[s.charCodeAt(a+3)],I[h++]=u<<2|f>>4,I[h++]=(f&15)<<4|v>>2,I[h++]=(v&3)<<6|w&63;return E},Og=function(s){for(var r=s.length,o=[],a=0;a<r;a+=2)o.push(s[a+1]<<8|s[a]);return o},Ng=function(s){for(var r=s.length,o=[],a=0;a<r;a+=4)o.push(s[a+3]<<24|s[a+2]<<16|s[a+1]<<8|s[a]);return o},pA=5,qn=11,zn=2,Gg=qn-pA,Go=65536>>pA,Vg=1<<pA,Zn=Vg-1,_g=1024>>pA,Wg=Go+_g,Xg=Wg,Jg=32,$g=Xg+Jg,Yg=65536>>qn,qg=1<<Gg,zg=qg-1,Vo=function(s,r,o){return s.slice?s.slice(r,o):new Uint16Array(Array.prototype.slice.call(s,r,o))},Zg=function(s,r,o){return s.slice?s.slice(r,o):new Uint32Array(Array.prototype.slice.call(s,r,o))},jg=function(s,r){var o=kg(s),a=Array.isArray(o)?Ng(o):new Uint32Array(o),h=Array.isArray(o)?Og(o):new Uint16Array(o),u=24,f=Vo(h,u/2,a[4]/2),v=a[5]===2?Vo(h,(u+a[4])/2):Zg(a,Math.ceil((u+a[4])/4));return new eu(a[0],a[1],a[2],a[3],f,v)},eu=function(){function s(r,o,a,h,u,f){this.initialValue=r,this.errorValue=o,this.highStart=a,this.highValueIndex=h,this.index=u,this.data=f}return s.prototype.get=function(r){var o;if(r>=0){if(r<55296||r>56319&&r<=65535)return o=this.index[r>>pA],o=(o<<zn)+(r&Zn),this.data[o];if(r<=65535)return o=this.index[Go+(r-55296>>pA)],o=(o<<zn)+(r&Zn),this.data[o];if(r<this.highStart)return o=$g-Yg+(r>>qn),o=this.index[o],o+=r>>pA&zg,o=this.index[o],o=(o<<zn)+(r&Zn),this.data[o];if(r<=1114111)return this.data[this.highValueIndex]}return this.errorValue},s}(),_o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tu=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Lr=0;Lr<_o.length;Lr++)tu[_o.charCodeAt(Lr)]=Lr;var Au=1,jn=2,ea=3,Wo=4,Xo=5,iu=7,Jo=8,ta=9,Aa=10,$o=11,Yo=12,qo=13,zo=14,ia=15,ru=function(s){for(var r=[],o=0,a=s.length;o<a;){var h=s.charCodeAt(o++);if(h>=55296&&h<=56319&&o<a){var u=s.charCodeAt(o++);(u&64512)===56320?r.push(((h&1023)<<10)+(u&1023)+65536):(r.push(h),o--)}else r.push(h)}return r},su=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];if(String.fromCodePoint)return String.fromCodePoint.apply(String,s);var o=s.length;if(!o)return"";for(var a=[],h=-1,u="";++h<o;){var f=s[h];f<=65535?a.push(f):(f-=65536,a.push((f>>10)+55296,f%1024+56320)),(h+1===o||a.length>16384)&&(u+=String.fromCharCode.apply(String,a),a.length=0)}return u},nu=jg(Kg),dt="\xD7",ra="\xF7",au=function(s){return nu.get(s)},ou=function(s,r,o){var a=o-2,h=r[a],u=r[o-1],f=r[o];if(u===jn&&f===ea)return dt;if(u===jn||u===ea||u===Wo||f===jn||f===ea||f===Wo)return ra;if(u===Jo&&[Jo,ta,$o,Yo].indexOf(f)!==-1||(u===$o||u===ta)&&(f===ta||f===Aa)||(u===Yo||u===Aa)&&f===Aa||f===qo||f===Xo||f===iu||u===Au)return dt;if(u===qo&&f===zo){for(;h===Xo;)h=r[--a];if(h===zo)return dt}if(u===ia&&f===ia){for(var v=0;h===ia;)v++,h=r[--a];if(v%2===0)return dt}return ra},lu=function(s){var r=ru(s),o=r.length,a=0,h=0,u=r.map(au);return{next:function(){if(a>=o)return{done:!0,value:null};for(var f=dt;a<o&&(f=ou(r,u,++a))===dt;);if(f!==dt||a===o){var v=su.apply(null,r.slice(h,a));return h=a,{value:v,done:!1}}return{done:!0,value:null}}}},cu=function(s){for(var r=lu(s),o=[],a;!(a=r.next()).done;)a.value&&o.push(a.value.slice());return o},hu=function(s){var r=123;if(s.createRange){var o=s.createRange();if(o.getBoundingClientRect){var a=s.createElement("boundtest");a.style.height=r+"px",a.style.display="block",s.body.appendChild(a),o.selectNode(a);var h=o.getBoundingClientRect(),u=Math.round(h.height);if(s.body.removeChild(a),u===r)return!0}}return!1},du=function(s){var r=s.createElement("boundtest");r.style.width="50px",r.style.display="block",r.style.fontSize="12px",r.style.letterSpacing="0px",r.style.wordSpacing="0px",s.body.appendChild(r);var o=s.createRange();r.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var a=r.firstChild,h=g(a.data).map(function(w){return p(w)}),u=0,f={},v=h.every(function(w,E){o.setStart(a,u),o.setEnd(a,u+w.length);var I=o.getBoundingClientRect();u+=w.length;var H=I.x>f.x||I.y>f.y;return f=I,E===0?!0:H});return s.body.removeChild(r),v},gu=function(){return typeof new Image().crossOrigin!="undefined"},uu=function(){return typeof new XMLHttpRequest().responseType=="string"},pu=function(s){var r=new Image,o=s.createElement("canvas"),a=o.getContext("2d");if(!a)return!1;r.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{a.drawImage(r,0,0),o.toDataURL()}catch(h){return!1}return!0},Zo=function(s){return s[0]===0&&s[1]===255&&s[2]===0&&s[3]===255},mu=function(s){var r=s.createElement("canvas"),o=100;r.width=o,r.height=o;var a=r.getContext("2d");if(!a)return Promise.reject(!1);a.fillStyle="rgb(0, 255, 0)",a.fillRect(0,0,o,o);var h=new Image,u=r.toDataURL();h.src=u;var f=sa(o,o,0,0,h);return a.fillStyle="red",a.fillRect(0,0,o,o),jo(f).then(function(v){a.drawImage(v,0,0);var w=a.getImageData(0,0,o,o).data;a.fillStyle="red",a.fillRect(0,0,o,o);var E=s.createElement("div");return E.style.backgroundImage="url("+u+")",E.style.height=o+"px",Zo(w)?jo(sa(o,o,0,0,E)):Promise.reject(!1)}).then(function(v){return a.drawImage(v,0,0),Zo(a.getImageData(0,0,o,o).data)}).catch(function(){return!1})},sa=function(s,r,o,a,h){var u="http://www.w3.org/2000/svg",f=document.createElementNS(u,"svg"),v=document.createElementNS(u,"foreignObject");return f.setAttributeNS(null,"width",s.toString()),f.setAttributeNS(null,"height",r.toString()),v.setAttributeNS(null,"width","100%"),v.setAttributeNS(null,"height","100%"),v.setAttributeNS(null,"x",o.toString()),v.setAttributeNS(null,"y",a.toString()),v.setAttributeNS(null,"externalResourcesRequired","true"),f.appendChild(v),v.appendChild(h),f},jo=function(s){return new Promise(function(r,o){var a=new Image;a.onload=function(){return r(a)},a.onerror=o,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(s))})},Re={get SUPPORT_RANGE_BOUNDS(){var s=hu(document);return Object.defineProperty(Re,"SUPPORT_RANGE_BOUNDS",{value:s}),s},get SUPPORT_WORD_BREAKING(){var s=Re.SUPPORT_RANGE_BOUNDS&&du(document);return Object.defineProperty(Re,"SUPPORT_WORD_BREAKING",{value:s}),s},get SUPPORT_SVG_DRAWING(){var s=pu(document);return Object.defineProperty(Re,"SUPPORT_SVG_DRAWING",{value:s}),s},get SUPPORT_FOREIGNOBJECT_DRAWING(){var s=typeof Array.from=="function"&&typeof window.fetch=="function"?mu(document):Promise.resolve(!1);return Object.defineProperty(Re,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:s}),s},get SUPPORT_CORS_IMAGES(){var s=gu();return Object.defineProperty(Re,"SUPPORT_CORS_IMAGES",{value:s}),s},get SUPPORT_RESPONSE_TYPE(){var s=uu();return Object.defineProperty(Re,"SUPPORT_RESPONSE_TYPE",{value:s}),s},get SUPPORT_CORS_XHR(){var s="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Re,"SUPPORT_CORS_XHR",{value:s}),s},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var s=!!(typeof Intl!="undefined"&&Intl.Segmenter);return Object.defineProperty(Re,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:s}),s}},Hi=function(){function s(r,o){this.text=r,this.bounds=o}return s}(),fu=function(s,r,o,a){var h=wu(r,o),u=[],f=0;return h.forEach(function(v){if(o.textDecorationLine.length||v.trim().length>0)if(Re.SUPPORT_RANGE_BOUNDS){var w=el(a,f,v.length).getClientRects();if(w.length>1){var E=na(v),I=0;E.forEach(function(S){u.push(new Hi(S,l.fromDOMRectList(s,el(a,I+f,S.length).getClientRects()))),I+=S.length})}else u.push(new Hi(v,l.fromDOMRectList(s,w)))}else{var H=a.splitText(v.length);u.push(new Hi(v,Bu(s,a))),a=H}else Re.SUPPORT_RANGE_BOUNDS||(a=a.splitText(v.length));f+=v.length}),u},Bu=function(s,r){var o=r.ownerDocument;if(o){var a=o.createElement("html2canvaswrapper");a.appendChild(r.cloneNode(!0));var h=r.parentNode;if(h){h.replaceChild(a,r);var u=c(s,a);return a.firstChild&&h.replaceChild(a.firstChild,a),u}}return l.EMPTY},el=function(s,r,o){var a=s.ownerDocument;if(!a)throw new Error("Node has no owner document");var h=a.createRange();return h.setStart(s,r),h.setEnd(s,r+o),h},na=function(s){if(Re.SUPPORT_NATIVE_TEXT_SEGMENTATION){var r=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(r.segment(s)).map(function(o){return o.segment})}return cu(s)},Cu=function(s,r){if(Re.SUPPORT_NATIVE_TEXT_SEGMENTATION){var o=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(o.segment(s)).map(function(a){return a.segment})}return yu(s,r)},wu=function(s,r){return r.letterSpacing!==0?na(s):Cu(s,r)},vu=[32,160,4961,65792,65793,4153,4241],yu=function(s,r){for(var o=Yc(s,{lineBreak:r.lineBreak,wordBreak:r.overflowWrap==="break-word"?"break-word":r.wordBreak}),a=[],h,u=function(){if(h.value){var f=h.value.slice(),v=g(f),w="";v.forEach(function(E){vu.indexOf(E)===-1?w+=p(E):(w.length&&a.push(w),a.push(p(E)),w="")}),w.length&&a.push(w)}};!(h=o.next()).done;)u();return a},Fu=function(){function s(r,o,a){this.text=Eu(o.data,a.textTransform),this.textBounds=fu(r,this.text,a,o)}return s}(),Eu=function(s,r){switch(r){case 1:return s.toLowerCase();case 3:return s.replace(Iu,Hu);case 2:return s.toUpperCase();default:return s}},Iu=/(^|\s|:|-|\(|\))([a-z])/g,Hu=function(s,r,o){return s.length>0?r+o.toUpperCase():s},tl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.src=a.currentSrc||a.src,h.intrinsicWidth=a.naturalWidth,h.intrinsicHeight=a.naturalHeight,h.context.cache.addImage(h.src),h}return r}(It),Al=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.canvas=a,h.intrinsicWidth=a.width,h.intrinsicHeight=a.height,h}return r}(It),il=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this,u=new XMLSerializer,f=c(o,a);return a.setAttribute("width",f.width+"px"),a.setAttribute("height",f.height+"px"),h.svg="data:image/svg+xml,"+encodeURIComponent(u.serializeToString(a)),h.intrinsicWidth=a.width.baseVal.value,h.intrinsicHeight=a.height.baseVal.value,h.context.cache.addImage(h.svg),h}return r}(It),rl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.value=a.value,h}return r}(It),aa=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.start=a.start,h.reversed=typeof a.reversed=="boolean"&&a.reversed===!0,h}return r}(It),Qu=[{type:15,flags:0,unit:"px",number:3}],Su=[{type:16,flags:0,number:50}],Uu=function(s){return s.width>s.height?new l(s.left+(s.width-s.height)/2,s.top,s.height,s.height):s.width<s.height?new l(s.left,s.top+(s.height-s.width)/2,s.width,s.width):s},Mu=function(s){var r=s.type===bu?new Array(s.value.length+1).join("\u2022"):s.value;return r.length===0?s.placeholder||"":r},Pr="checkbox",Dr="radio",bu="password",sl=707406591,oa=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;switch(h.type=a.type.toLowerCase(),h.checked=a.checked,h.value=Mu(a),(h.type===Pr||h.type===Dr)&&(h.styles.backgroundColor=3739148031,h.styles.borderTopColor=h.styles.borderRightColor=h.styles.borderBottomColor=h.styles.borderLeftColor=2779096575,h.styles.borderTopWidth=h.styles.borderRightWidth=h.styles.borderBottomWidth=h.styles.borderLeftWidth=1,h.styles.borderTopStyle=h.styles.borderRightStyle=h.styles.borderBottomStyle=h.styles.borderLeftStyle=1,h.styles.backgroundClip=[0],h.styles.backgroundOrigin=[0],h.bounds=Uu(h.bounds)),h.type){case Pr:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=Qu;break;case Dr:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=Su;break}return h}return r}(It),nl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this,u=a.options[a.selectedIndex||0];return h.value=u&&u.text||"",h}return r}(It),al=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.value=a.value,h}return r}(It),ol=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;h.src=a.src,h.width=parseInt(a.width,10)||0,h.height=parseInt(a.height,10)||0,h.backgroundColor=h.styles.backgroundColor;try{if(a.contentWindow&&a.contentWindow.document&&a.contentWindow.document.documentElement){h.tree=cl(o,a.contentWindow.document.documentElement);var u=a.contentWindow.document.documentElement?Fi(o,getComputedStyle(a.contentWindow.document.documentElement).backgroundColor):Pt.TRANSPARENT,f=a.contentWindow.document.body?Fi(o,getComputedStyle(a.contentWindow.document.body).backgroundColor):Pt.TRANSPARENT;h.backgroundColor=tA(u)?tA(f)?h.styles.backgroundColor:f:u}}catch(v){}return h}return r}(It),xu=["OL","UL","MENU"],Rr=function(s,r,o,a){for(var h=r.firstChild,u=void 0;h;h=u)if(u=h.nextSibling,hl(h)&&h.data.trim().length>0)o.textNodes.push(new Fu(s,h,o.styles));else if(DA(h))if(fl(h)&&h.assignedNodes)h.assignedNodes().forEach(function(v){return Rr(s,v,o,a)});else{var f=ll(s,h);f.styles.isVisible()&&(Tu(h,f,a)?f.flags|=4:Lu(f.styles)&&(f.flags|=2),xu.indexOf(h.tagName)!==-1&&(f.flags|=8),o.elements.push(f),h.slot,h.shadowRoot?Rr(s,h.shadowRoot,f,a):!kr(h)&&!dl(h)&&!Or(h)&&Rr(s,h,f,a))}},ll=function(s,r){return ha(r)?new tl(s,r):gl(r)?new Al(s,r):dl(r)?new il(s,r):Pu(r)?new rl(s,r):Du(r)?new aa(s,r):Ru(r)?new oa(s,r):Or(r)?new nl(s,r):kr(r)?new al(s,r):pl(r)?new ol(s,r):new It(s,r)},cl=function(s,r){var o=ll(s,r);return o.flags|=4,Rr(s,r,o,o),o},Tu=function(s,r,o){return r.styles.isPositionedWithZIndex()||r.styles.opacity<1||r.styles.isTransformed()||ca(s)&&o.styles.isTransparent()},Lu=function(s){return s.isPositioned()||s.isFloating()},hl=function(s){return s.nodeType===Node.TEXT_NODE},DA=function(s){return s.nodeType===Node.ELEMENT_NODE},la=function(s){return DA(s)&&typeof s.style!="undefined"&&!Kr(s)},Kr=function(s){return typeof s.className=="object"},Pu=function(s){return s.tagName==="LI"},Du=function(s){return s.tagName==="OL"},Ru=function(s){return s.tagName==="INPUT"},Ku=function(s){return s.tagName==="HTML"},dl=function(s){return s.tagName==="svg"},ca=function(s){return s.tagName==="BODY"},gl=function(s){return s.tagName==="CANVAS"},ul=function(s){return s.tagName==="VIDEO"},ha=function(s){return s.tagName==="IMG"},pl=function(s){return s.tagName==="IFRAME"},ml=function(s){return s.tagName==="STYLE"},ku=function(s){return s.tagName==="SCRIPT"},kr=function(s){return s.tagName==="TEXTAREA"},Or=function(s){return s.tagName==="SELECT"},fl=function(s){return s.tagName==="SLOT"},Bl=function(s){return s.tagName.indexOf("-")>0},Ou=function(){function s(){this.counters={}}return s.prototype.getCounterValue=function(r){var o=this.counters[r];return o&&o.length?o[o.length-1]:1},s.prototype.getCounterValues=function(r){var o=this.counters[r];return o||[]},s.prototype.pop=function(r){var o=this;r.forEach(function(a){return o.counters[a].pop()})},s.prototype.parse=function(r){var o=this,a=r.counterIncrement,h=r.counterReset,u=!0;a!==null&&a.forEach(function(v){var w=o.counters[v.counter];w&&v.increment!==0&&(u=!1,w.length||w.push(1),w[Math.max(0,w.length-1)]+=v.increment)});var f=[];return u&&h.forEach(function(v){var w=o.counters[v.counter];f.push(v.counter),w||(w=o.counters[v.counter]=[]),w.push(v.reset)}),f},s}(),Cl={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},wl={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054F","\u054E","\u054D","\u054C","\u054B","\u054A","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053F","\u053E","\u053D","\u053C","\u053B","\u053A","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},Nu={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05D9\u05F3","\u05D8\u05F3","\u05D7\u05F3","\u05D6\u05F3","\u05D5\u05F3","\u05D4\u05F3","\u05D3\u05F3","\u05D2\u05F3","\u05D1\u05F3","\u05D0\u05F3","\u05EA","\u05E9","\u05E8","\u05E7","\u05E6","\u05E4","\u05E2","\u05E1","\u05E0","\u05DE","\u05DC","\u05DB","\u05D9\u05D8","\u05D9\u05D7","\u05D9\u05D6","\u05D8\u05D6","\u05D8\u05D5","\u05D9","\u05D8","\u05D7","\u05D6","\u05D5","\u05D4","\u05D3","\u05D2","\u05D1","\u05D0"]},Gu={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10F5","\u10F0","\u10EF","\u10F4","\u10EE","\u10ED","\u10EC","\u10EB","\u10EA","\u10E9","\u10E8","\u10E7","\u10E6","\u10E5","\u10E4","\u10F3","\u10E2","\u10E1","\u10E0","\u10DF","\u10DE","\u10DD","\u10F2","\u10DC","\u10DB","\u10DA","\u10D9","\u10D8","\u10D7","\u10F1","\u10D6","\u10D5","\u10D4","\u10D3","\u10D2","\u10D1","\u10D0"]},RA=function(s,r,o,a,h,u){return s<r||s>o?Si(s,h,u.length>0):a.integers.reduce(function(f,v,w){for(;s>=v;)s-=v,f+=a.values[w];return f},"")+u},vl=function(s,r,o,a){var h="";do o||s--,h=a(s)+h,s/=r;while(s*r>=r);return h},ve=function(s,r,o,a,h){var u=o-r+1;return(s<0?"-":"")+(vl(Math.abs(s),u,a,function(f){return p(Math.floor(f%u)+r)})+h)},mA=function(s,r,o){o===void 0&&(o=". ");var a=r.length;return vl(Math.abs(s),a,!1,function(h){return r[Math.floor(h%a)]})+o},KA=1,iA=2,rA=4,Qi=8,Dt=function(s,r,o,a,h,u){if(s<-9999||s>9999)return Si(s,4,h.length>0);var f=Math.abs(s),v=h;if(f===0)return r[0]+v;for(var w=0;f>0&&w<=4;w++){var E=f%10;E===0&&Ue(u,KA)&&v!==""?v=r[E]+v:E>1||E===1&&w===0||E===1&&w===1&&Ue(u,iA)||E===1&&w===1&&Ue(u,rA)&&s>100||E===1&&w>1&&Ue(u,Qi)?v=r[E]+(w>0?o[w-1]:"")+v:E===1&&w>0&&(v=o[w-1]+v),f=Math.floor(f/10)}return(s<0?a:"")+v},yl="\u5341\u767E\u5343\u842C",Fl="\u62FE\u4F70\u4EDF\u842C",El="\u30DE\u30A4\u30CA\u30B9",da="\uB9C8\uC774\uB108\uC2A4",Si=function(s,r,o){var a=o?". ":"",h=o?"\u3001":"",u=o?", ":"",f=o?" ":"";switch(r){case 0:return"\u2022"+f;case 1:return"\u25E6"+f;case 2:return"\u25FE"+f;case 5:var v=ve(s,48,57,!0,a);return v.length<4?"0"+v:v;case 4:return mA(s,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",h);case 6:return RA(s,1,3999,Cl,3,a).toLowerCase();case 7:return RA(s,1,3999,Cl,3,a);case 8:return ve(s,945,969,!1,a);case 9:return ve(s,97,122,!1,a);case 10:return ve(s,65,90,!1,a);case 11:return ve(s,1632,1641,!0,a);case 12:case 49:return RA(s,1,9999,wl,3,a);case 35:return RA(s,1,9999,wl,3,a).toLowerCase();case 13:return ve(s,2534,2543,!0,a);case 14:case 30:return ve(s,6112,6121,!0,a);case 15:return mA(s,"\u5B50\u4E11\u5BC5\u536F\u8FB0\u5DF3\u5348\u672A\u7533\u9149\u620C\u4EA5",h);case 16:return mA(s,"\u7532\u4E59\u4E19\u4E01\u620A\u5DF1\u5E9A\u8F9B\u58EC\u7678",h);case 17:case 48:return Dt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",yl,"\u8CA0",h,iA|rA|Qi);case 47:return Dt(s,"\u96F6\u58F9\u8CB3\u53C3\u8086\u4F0D\u9678\u67D2\u634C\u7396",Fl,"\u8CA0",h,KA|iA|rA|Qi);case 42:return Dt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",yl,"\u8D1F",h,iA|rA|Qi);case 41:return Dt(s,"\u96F6\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396",Fl,"\u8D1F",h,KA|iA|rA|Qi);case 26:return Dt(s,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u4E07",El,h,0);case 25:return Dt(s,"\u96F6\u58F1\u5F10\u53C2\u56DB\u4F0D\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343\u4E07",El,h,KA|iA|rA);case 31:return Dt(s,"\uC601\uC77C\uC774\uC0BC\uC0AC\uC624\uC721\uCE60\uD314\uAD6C","\uC2ED\uBC31\uCC9C\uB9CC",da,u,KA|iA|rA);case 33:return Dt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u842C",da,u,0);case 32:return Dt(s,"\u96F6\u58F9\u8CB3\u53C3\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343",da,u,KA|iA|rA);case 18:return ve(s,2406,2415,!0,a);case 20:return RA(s,1,19999,Gu,3,a);case 21:return ve(s,2790,2799,!0,a);case 22:return ve(s,2662,2671,!0,a);case 22:return RA(s,1,10999,Nu,3,a);case 23:return mA(s,"\u3042\u3044\u3046\u3048\u304A\u304B\u304D\u304F\u3051\u3053\u3055\u3057\u3059\u305B\u305D\u305F\u3061\u3064\u3066\u3068\u306A\u306B\u306C\u306D\u306E\u306F\u3072\u3075\u3078\u307B\u307E\u307F\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308A\u308B\u308C\u308D\u308F\u3090\u3091\u3092\u3093");case 24:return mA(s,"\u3044\u308D\u306F\u306B\u307B\u3078\u3068\u3061\u308A\u306C\u308B\u3092\u308F\u304B\u3088\u305F\u308C\u305D\u3064\u306D\u306A\u3089\u3080\u3046\u3090\u306E\u304A\u304F\u3084\u307E\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304D\u3086\u3081\u307F\u3057\u3091\u3072\u3082\u305B\u3059");case 27:return ve(s,3302,3311,!0,a);case 28:return mA(s,"\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD\u30BF\u30C1\u30C4\u30C6\u30C8\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D2\u30D5\u30D8\u30DB\u30DE\u30DF\u30E0\u30E1\u30E2\u30E4\u30E6\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EF\u30F0\u30F1\u30F2\u30F3",h);case 29:return mA(s,"\u30A4\u30ED\u30CF\u30CB\u30DB\u30D8\u30C8\u30C1\u30EA\u30CC\u30EB\u30F2\u30EF\u30AB\u30E8\u30BF\u30EC\u30BD\u30C4\u30CD\u30CA\u30E9\u30E0\u30A6\u30F0\u30CE\u30AA\u30AF\u30E4\u30DE\u30B1\u30D5\u30B3\u30A8\u30C6\u30A2\u30B5\u30AD\u30E6\u30E1\u30DF\u30B7\u30F1\u30D2\u30E2\u30BB\u30B9",h);case 34:return ve(s,3792,3801,!0,a);case 37:return ve(s,6160,6169,!0,a);case 38:return ve(s,4160,4169,!0,a);case 39:return ve(s,2918,2927,!0,a);case 40:return ve(s,1776,1785,!0,a);case 43:return ve(s,3046,3055,!0,a);case 44:return ve(s,3174,3183,!0,a);case 45:return ve(s,3664,3673,!0,a);case 46:return ve(s,3872,3881,!0,a);case 3:default:return ve(s,48,57,!0,a)}},Il="data-html2canvas-ignore",Hl=function(){function s(r,o,a){if(this.context=r,this.options=a,this.scrolledElements=[],this.referenceElement=o,this.counters=new Ou,this.quoteDepth=0,!o.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(o.ownerDocument.documentElement,!1)}return s.prototype.toIFrame=function(r,o){var a=this,h=Vu(r,o);if(!h.contentWindow)return Promise.reject("Unable to find iframe window");var u=r.defaultView.pageXOffset,f=r.defaultView.pageYOffset,v=h.contentWindow,w=v.document,E=Xu(h).then(function(){return A(a,void 0,void 0,function(){var I,H;return i(this,function(S){switch(S.label){case 0:return this.scrolledElements.forEach(qu),v&&(v.scrollTo(o.left,o.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(v.scrollY!==o.top||v.scrollX!==o.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(v.scrollX-o.left,v.scrollY-o.top,0,0))),I=this.options.onclone,H=this.clonedReferenceElement,typeof H=="undefined"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:w.fonts&&w.fonts.ready?[4,w.fonts.ready]:[3,2];case 1:S.sent(),S.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Wu(w)]:[3,4];case 3:S.sent(),S.label=4;case 4:return typeof I=="function"?[2,Promise.resolve().then(function(){return I(w,H)}).then(function(){return h})]:[2,h]}})})});return w.open(),w.write($u(document.doctype)+"<html></html>"),Yu(this.referenceElement.ownerDocument,u,f),w.replaceChild(w.adoptNode(this.documentElement),w.documentElement),w.close(),E},s.prototype.createElementClone=function(r){if(Yn(r,2))debugger;if(gl(r))return this.createCanvasClone(r);if(ul(r))return this.createVideoClone(r);if(ml(r))return this.createStyleClone(r);var o=r.cloneNode(!1);return ha(o)&&(ha(r)&&r.currentSrc&&r.currentSrc!==r.src&&(o.src=r.currentSrc,o.srcset=""),o.loading==="lazy"&&(o.loading="eager")),Bl(o)?this.createCustomElementClone(o):o},s.prototype.createCustomElementClone=function(r){var o=document.createElement("html2canvascustomelement");return ga(r.style,o),o},s.prototype.createStyleClone=function(r){try{var o=r.sheet;if(o&&o.cssRules){var a=[].slice.call(o.cssRules,0).reduce(function(u,f){return f&&typeof f.cssText=="string"?u+f.cssText:u},""),h=r.cloneNode(!1);return h.textContent=a,h}}catch(u){if(this.context.logger.error("Unable to access cssRules property",u),u.name!=="SecurityError")throw u}return r.cloneNode(!1)},s.prototype.createCanvasClone=function(r){var o;if(this.options.inlineImages&&r.ownerDocument){var a=r.ownerDocument.createElement("img");try{return a.src=r.toDataURL(),a}catch(E){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",r)}}var h=r.cloneNode(!1);try{h.width=r.width,h.height=r.height;var u=r.getContext("2d"),f=h.getContext("2d");if(f)if(!this.options.allowTaint&&u)f.putImageData(u.getImageData(0,0,r.width,r.height),0,0);else{var v=(o=r.getContext("webgl2"))!==null&&o!==void 0?o:r.getContext("webgl");if(v){var w=v.getContextAttributes();(w==null?void 0:w.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",r)}f.drawImage(r,0,0)}return h}catch(E){this.context.logger.info("Unable to clone canvas as it is tainted",r)}return h},s.prototype.createVideoClone=function(r){var o=r.ownerDocument.createElement("canvas");o.width=r.offsetWidth,o.height=r.offsetHeight;var a=o.getContext("2d");try{return a&&(a.drawImage(r,0,0,o.width,o.height),this.options.allowTaint||a.getImageData(0,0,o.width,o.height)),o}catch(u){this.context.logger.info("Unable to clone video as it is tainted",r)}var h=r.ownerDocument.createElement("canvas");return h.width=r.offsetWidth,h.height=r.offsetHeight,h},s.prototype.appendChildNode=function(r,o,a){(!DA(o)||!ku(o)&&!o.hasAttribute(Il)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(o)))&&(!this.options.copyStyles||!DA(o)||!ml(o))&&r.appendChild(this.cloneNode(o,a))},s.prototype.cloneChildNodes=function(r,o,a){for(var h=this,u=r.shadowRoot?r.shadowRoot.firstChild:r.firstChild;u;u=u.nextSibling)if(DA(u)&&fl(u)&&typeof u.assignedNodes=="function"){var f=u.assignedNodes();f.length&&f.forEach(function(v){return h.appendChildNode(o,v,a)})}else this.appendChildNode(o,u,a)},s.prototype.cloneNode=function(r,o){if(hl(r))return document.createTextNode(r.data);if(!r.ownerDocument)return r.cloneNode(!1);var a=r.ownerDocument.defaultView;if(a&&DA(r)&&(la(r)||Kr(r))){var h=this.createElementClone(r);h.style.transitionProperty="none";var u=a.getComputedStyle(r),f=a.getComputedStyle(r,":before"),v=a.getComputedStyle(r,":after");this.referenceElement===r&&la(h)&&(this.clonedReferenceElement=h),ca(h)&&ju(h);var w=this.counters.parse(new Oo(this.context,u)),E=this.resolvePseudoContent(r,h,f,Ui.BEFORE);Bl(r)&&(o=!0),ul(r)||this.cloneChildNodes(r,h,o),E&&h.insertBefore(E,h.firstChild);var I=this.resolvePseudoContent(r,h,v,Ui.AFTER);return I&&h.appendChild(I),this.counters.pop(w),(u&&(this.options.copyStyles||Kr(r))&&!pl(r)||o)&&ga(u,h),(r.scrollTop!==0||r.scrollLeft!==0)&&this.scrolledElements.push([h,r.scrollLeft,r.scrollTop]),(kr(r)||Or(r))&&(kr(h)||Or(h))&&(h.value=r.value),h}return r.cloneNode(!1)},s.prototype.resolvePseudoContent=function(r,o,a,h){var u=this;if(a){var f=a.content,v=o.ownerDocument;if(!(!v||!f||f==="none"||f==="-moz-alt-content"||a.display==="none")){this.counters.parse(new Oo(this.context,a));var w=new Pg(this.context,a),E=v.createElement("html2canvaspseudoelement");ga(a,E),w.content.forEach(function(H){if(H.type===0)E.appendChild(v.createTextNode(H.value));else if(H.type===22){var S=v.createElement("img");S.src=H.value,S.style.opacity="1",E.appendChild(S)}else if(H.type===18){if(H.name==="attr"){var D=H.values.filter(ce);D.length&&E.appendChild(v.createTextNode(r.getAttribute(D[0].value)||""))}else if(H.name==="counter"){var M=H.values.filter(LA),T=M[0],J=M[1];if(T&&ce(T)){var O=u.counters.getCounterValue(T.value),K=J&&ce(J)?$n.parse(u.context,J.value):3;E.appendChild(v.createTextNode(Si(O,K,!1)))}}else if(H.name==="counters"){var re=H.values.filter(LA),T=re[0],$=re[1],J=re[2];if(T&&ce(T)){var _=u.counters.getCounterValues(T.value),P=J&&ce(J)?$n.parse(u.context,J.value):3,j=$&&$.type===0?$.value:"",ee=_.map(function(et){return Si(et,P,!1)}).join(j);E.appendChild(v.createTextNode(ee))}}}else if(H.type===20)switch(H.value){case"open-quote":E.appendChild(v.createTextNode(ko(w.quotes,u.quoteDepth++,!0)));break;case"close-quote":E.appendChild(v.createTextNode(ko(w.quotes,--u.quoteDepth,!1)));break;default:E.appendChild(v.createTextNode(H.value))}}),E.className=ua+" "+pa;var I=h===Ui.BEFORE?" "+ua:" "+pa;return Kr(o)?o.className.baseValue+=I:o.className+=I,E}}},s.destroy=function(r){return r.parentNode?(r.parentNode.removeChild(r),!0):!1},s}(),Ui;(function(s){s[s.BEFORE=0]="BEFORE",s[s.AFTER=1]="AFTER"})(Ui||(Ui={}));var Vu=function(s,r){var o=s.createElement("iframe");return o.className="html2canvas-container",o.style.visibility="hidden",o.style.position="fixed",o.style.left="-10000px",o.style.top="0px",o.style.border="0",o.width=r.width.toString(),o.height=r.height.toString(),o.scrolling="no",o.setAttribute(Il,"true"),s.body.appendChild(o),o},_u=function(s){return new Promise(function(r){if(s.complete){r();return}if(!s.src){r();return}s.onload=r,s.onerror=r})},Wu=function(s){return Promise.all([].slice.call(s.images,0).map(_u))},Xu=function(s){return new Promise(function(r,o){var a=s.contentWindow;if(!a)return o("No window assigned for iframe");var h=a.document;a.onload=s.onload=function(){a.onload=s.onload=null;var u=setInterval(function(){h.body.childNodes.length>0&&h.readyState==="complete"&&(clearInterval(u),r(s))},50)}})},Ju=["all","d","content"],ga=function(s,r){for(var o=s.length-1;o>=0;o--){var a=s.item(o);Ju.indexOf(a)===-1&&r.style.setProperty(a,s.getPropertyValue(a))}return r},$u=function(s){var r="";return s&&(r+="<!DOCTYPE ",s.name&&(r+=s.name),s.internalSubset&&(r+=s.internalSubset),s.publicId&&(r+='"'+s.publicId+'"'),s.systemId&&(r+='"'+s.systemId+'"'),r+=">"),r},Yu=function(s,r,o){s&&s.defaultView&&(r!==s.defaultView.pageXOffset||o!==s.defaultView.pageYOffset)&&s.defaultView.scrollTo(r,o)},qu=function(s){var r=s[0],o=s[1],a=s[2];r.scrollLeft=o,r.scrollTop=a},zu=":before",Zu=":after",ua="___html2canvas___pseudoelement_before",pa="___html2canvas___pseudoelement_after",Ql=`{
    content: "" !important;
    display: none !important;
}`,ju=function(s){ep(s,"."+ua+zu+Ql+`
         .`+pa+Zu+Ql)},ep=function(s,r){var o=s.ownerDocument;if(o){var a=o.createElement("style");a.textContent=r,s.appendChild(a)}},Sl=function(){function s(){}return s.getOrigin=function(r){var o=s._link;return o?(o.href=r,o.href=o.href,o.protocol+o.hostname+o.port):"about:blank"},s.isSameOrigin=function(r){return s.getOrigin(r)===s._origin},s.setContext=function(r){s._link=r.document.createElement("a"),s._origin=s.getOrigin(r.location.href)},s._origin="about:blank",s}(),tp=function(){function s(r,o){this.context=r,this._options=o,this._cache={}}return s.prototype.addImage=function(r){var o=Promise.resolve();return this.has(r)||(fa(r)||sp(r))&&(this._cache[r]=this.loadImage(r)).catch(function(){}),o},s.prototype.match=function(r){return this._cache[r]},s.prototype.loadImage=function(r){return A(this,void 0,void 0,function(){var o,a,h,u,f=this;return i(this,function(v){switch(v.label){case 0:return o=Sl.isSameOrigin(r),a=!ma(r)&&this._options.useCORS===!0&&Re.SUPPORT_CORS_IMAGES&&!o,h=!ma(r)&&!o&&!fa(r)&&typeof this._options.proxy=="string"&&Re.SUPPORT_CORS_XHR&&!a,!o&&this._options.allowTaint===!1&&!ma(r)&&!fa(r)&&!h&&!a?[2]:(u=r,h?[4,this.proxy(u)]:[3,2]);case 1:u=v.sent(),v.label=2;case 2:return this.context.logger.debug("Added image "+r.substring(0,256)),[4,new Promise(function(w,E){var I=new Image;I.onload=function(){return w(I)},I.onerror=E,(np(u)||a)&&(I.crossOrigin="anonymous"),I.src=u,I.complete===!0&&setTimeout(function(){return w(I)},500),f._options.imageTimeout>0&&setTimeout(function(){return E("Timed out ("+f._options.imageTimeout+"ms) loading image")},f._options.imageTimeout)})];case 3:return[2,v.sent()]}})})},s.prototype.has=function(r){return typeof this._cache[r]!="undefined"},s.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},s.prototype.proxy=function(r){var o=this,a=this._options.proxy;if(!a)throw new Error("No proxy defined");var h=r.substring(0,256);return new Promise(function(u,f){var v=Re.SUPPORT_RESPONSE_TYPE?"blob":"text",w=new XMLHttpRequest;w.onload=function(){if(w.status===200)if(v==="text")u(w.response);else{var H=new FileReader;H.addEventListener("load",function(){return u(H.result)},!1),H.addEventListener("error",function(S){return f(S)},!1),H.readAsDataURL(w.response)}else f("Failed to proxy resource "+h+" with status code "+w.status)},w.onerror=f;var E=a.indexOf("?")>-1?"&":"?";if(w.open("GET",""+a+E+"url="+encodeURIComponent(r)+"&responseType="+v),v!=="text"&&w instanceof XMLHttpRequest&&(w.responseType=v),o._options.imageTimeout){var I=o._options.imageTimeout;w.timeout=I,w.ontimeout=function(){return f("Timed out ("+I+"ms) proxying "+h)}}w.send()})},s}(),Ap=/^data:image\/svg\+xml/i,ip=/^data:image\/.*;base64,/i,rp=/^data:image\/.*/i,sp=function(s){return Re.SUPPORT_SVG_DRAWING||!ap(s)},ma=function(s){return rp.test(s)},np=function(s){return ip.test(s)},fa=function(s){return s.substr(0,4)==="blob"},ap=function(s){return s.substr(-3).toLowerCase()==="svg"||Ap.test(s)},L=function(){function s(r,o){this.type=0,this.x=r,this.y=o}return s.prototype.add=function(r,o){return new s(this.x+r,this.y+o)},s}(),kA=function(s,r,o){return new L(s.x+(r.x-s.x)*o,s.y+(r.y-s.y)*o)},Nr=function(){function s(r,o,a,h){this.type=1,this.start=r,this.startControl=o,this.endControl=a,this.end=h}return s.prototype.subdivide=function(r,o){var a=kA(this.start,this.startControl,r),h=kA(this.startControl,this.endControl,r),u=kA(this.endControl,this.end,r),f=kA(a,h,r),v=kA(h,u,r),w=kA(f,v,r);return o?new s(this.start,a,f,w):new s(w,v,u,this.end)},s.prototype.add=function(r,o){return new s(this.start.add(r,o),this.startControl.add(r,o),this.endControl.add(r,o),this.end.add(r,o))},s.prototype.reverse=function(){return new s(this.end,this.endControl,this.startControl,this.start)},s}(),gt=function(s){return s.type===1},op=function(){function s(r){var o=r.styles,a=r.bounds,h=yi(o.borderTopLeftRadius,a.width,a.height),u=h[0],f=h[1],v=yi(o.borderTopRightRadius,a.width,a.height),w=v[0],E=v[1],I=yi(o.borderBottomRightRadius,a.width,a.height),H=I[0],S=I[1],D=yi(o.borderBottomLeftRadius,a.width,a.height),M=D[0],T=D[1],J=[];J.push((u+w)/a.width),J.push((M+H)/a.width),J.push((f+T)/a.height),J.push((E+S)/a.height);var O=Math.max.apply(Math,J);O>1&&(u/=O,f/=O,w/=O,E/=O,H/=O,S/=O,M/=O,T/=O);var K=a.width-w,re=a.height-S,$=a.width-H,_=a.height-T,P=o.borderTopWidth,j=o.borderRightWidth,ee=o.borderBottomWidth,X=o.borderLeftWidth,Fe=ge(o.paddingTop,r.bounds.width),et=ge(o.paddingRight,r.bounds.width),at=ge(o.paddingBottom,r.bounds.width),he=ge(o.paddingLeft,r.bounds.width);this.topLeftBorderDoubleOuterBox=u>0||f>0?me(a.left+X/3,a.top+P/3,u-X/3,f-P/3,ne.TOP_LEFT):new L(a.left+X/3,a.top+P/3),this.topRightBorderDoubleOuterBox=u>0||f>0?me(a.left+K,a.top+P/3,w-j/3,E-P/3,ne.TOP_RIGHT):new L(a.left+a.width-j/3,a.top+P/3),this.bottomRightBorderDoubleOuterBox=H>0||S>0?me(a.left+$,a.top+re,H-j/3,S-ee/3,ne.BOTTOM_RIGHT):new L(a.left+a.width-j/3,a.top+a.height-ee/3),this.bottomLeftBorderDoubleOuterBox=M>0||T>0?me(a.left+X/3,a.top+_,M-X/3,T-ee/3,ne.BOTTOM_LEFT):new L(a.left+X/3,a.top+a.height-ee/3),this.topLeftBorderDoubleInnerBox=u>0||f>0?me(a.left+X*2/3,a.top+P*2/3,u-X*2/3,f-P*2/3,ne.TOP_LEFT):new L(a.left+X*2/3,a.top+P*2/3),this.topRightBorderDoubleInnerBox=u>0||f>0?me(a.left+K,a.top+P*2/3,w-j*2/3,E-P*2/3,ne.TOP_RIGHT):new L(a.left+a.width-j*2/3,a.top+P*2/3),this.bottomRightBorderDoubleInnerBox=H>0||S>0?me(a.left+$,a.top+re,H-j*2/3,S-ee*2/3,ne.BOTTOM_RIGHT):new L(a.left+a.width-j*2/3,a.top+a.height-ee*2/3),this.bottomLeftBorderDoubleInnerBox=M>0||T>0?me(a.left+X*2/3,a.top+_,M-X*2/3,T-ee*2/3,ne.BOTTOM_LEFT):new L(a.left+X*2/3,a.top+a.height-ee*2/3),this.topLeftBorderStroke=u>0||f>0?me(a.left+X/2,a.top+P/2,u-X/2,f-P/2,ne.TOP_LEFT):new L(a.left+X/2,a.top+P/2),this.topRightBorderStroke=u>0||f>0?me(a.left+K,a.top+P/2,w-j/2,E-P/2,ne.TOP_RIGHT):new L(a.left+a.width-j/2,a.top+P/2),this.bottomRightBorderStroke=H>0||S>0?me(a.left+$,a.top+re,H-j/2,S-ee/2,ne.BOTTOM_RIGHT):new L(a.left+a.width-j/2,a.top+a.height-ee/2),this.bottomLeftBorderStroke=M>0||T>0?me(a.left+X/2,a.top+_,M-X/2,T-ee/2,ne.BOTTOM_LEFT):new L(a.left+X/2,a.top+a.height-ee/2),this.topLeftBorderBox=u>0||f>0?me(a.left,a.top,u,f,ne.TOP_LEFT):new L(a.left,a.top),this.topRightBorderBox=w>0||E>0?me(a.left+K,a.top,w,E,ne.TOP_RIGHT):new L(a.left+a.width,a.top),this.bottomRightBorderBox=H>0||S>0?me(a.left+$,a.top+re,H,S,ne.BOTTOM_RIGHT):new L(a.left+a.width,a.top+a.height),this.bottomLeftBorderBox=M>0||T>0?me(a.left,a.top+_,M,T,ne.BOTTOM_LEFT):new L(a.left,a.top+a.height),this.topLeftPaddingBox=u>0||f>0?me(a.left+X,a.top+P,Math.max(0,u-X),Math.max(0,f-P),ne.TOP_LEFT):new L(a.left+X,a.top+P),this.topRightPaddingBox=w>0||E>0?me(a.left+Math.min(K,a.width-j),a.top+P,K>a.width+j?0:Math.max(0,w-j),Math.max(0,E-P),ne.TOP_RIGHT):new L(a.left+a.width-j,a.top+P),this.bottomRightPaddingBox=H>0||S>0?me(a.left+Math.min($,a.width-X),a.top+Math.min(re,a.height-ee),Math.max(0,H-j),Math.max(0,S-ee),ne.BOTTOM_RIGHT):new L(a.left+a.width-j,a.top+a.height-ee),this.bottomLeftPaddingBox=M>0||T>0?me(a.left+X,a.top+Math.min(_,a.height-ee),Math.max(0,M-X),Math.max(0,T-ee),ne.BOTTOM_LEFT):new L(a.left+X,a.top+a.height-ee),this.topLeftContentBox=u>0||f>0?me(a.left+X+he,a.top+P+Fe,Math.max(0,u-(X+he)),Math.max(0,f-(P+Fe)),ne.TOP_LEFT):new L(a.left+X+he,a.top+P+Fe),this.topRightContentBox=w>0||E>0?me(a.left+Math.min(K,a.width+X+he),a.top+P+Fe,K>a.width+X+he?0:w-X+he,E-(P+Fe),ne.TOP_RIGHT):new L(a.left+a.width-(j+et),a.top+P+Fe),this.bottomRightContentBox=H>0||S>0?me(a.left+Math.min($,a.width-(X+he)),a.top+Math.min(re,a.height+P+Fe),Math.max(0,H-(j+et)),S-(ee+at),ne.BOTTOM_RIGHT):new L(a.left+a.width-(j+et),a.top+a.height-(ee+at)),this.bottomLeftContentBox=M>0||T>0?me(a.left+X+he,a.top+_,Math.max(0,M-(X+he)),T-(ee+at),ne.BOTTOM_LEFT):new L(a.left+X+he,a.top+a.height-(ee+at))}return s}(),ne;(function(s){s[s.TOP_LEFT=0]="TOP_LEFT",s[s.TOP_RIGHT=1]="TOP_RIGHT",s[s.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",s[s.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(ne||(ne={}));var me=function(s,r,o,a,h){var u=4*((Math.sqrt(2)-1)/3),f=o*u,v=a*u,w=s+o,E=r+a;switch(h){case ne.TOP_LEFT:return new Nr(new L(s,E),new L(s,E-v),new L(w-f,r),new L(w,r));case ne.TOP_RIGHT:return new Nr(new L(s,r),new L(s+f,r),new L(w,E-v),new L(w,E));case ne.BOTTOM_RIGHT:return new Nr(new L(w,r),new L(w,r+v),new L(s+f,E),new L(s,E));case ne.BOTTOM_LEFT:default:return new Nr(new L(w,E),new L(w-f,E),new L(s,r+v),new L(s,r))}},Gr=function(s){return[s.topLeftBorderBox,s.topRightBorderBox,s.bottomRightBorderBox,s.bottomLeftBorderBox]},lp=function(s){return[s.topLeftContentBox,s.topRightContentBox,s.bottomRightContentBox,s.bottomLeftContentBox]},Vr=function(s){return[s.topLeftPaddingBox,s.topRightPaddingBox,s.bottomRightPaddingBox,s.bottomLeftPaddingBox]},cp=function(){function s(r,o,a){this.offsetX=r,this.offsetY=o,this.matrix=a,this.type=0,this.target=6}return s}(),_r=function(){function s(r,o){this.path=r,this.target=o,this.type=1}return s}(),hp=function(){function s(r){this.opacity=r,this.type=2,this.target=6}return s}(),dp=function(s){return s.type===0},Ul=function(s){return s.type===1},gp=function(s){return s.type===2},Ml=function(s,r){return s.length===r.length?s.some(function(o,a){return o===r[a]}):!1},up=function(s,r,o,a,h){return s.map(function(u,f){switch(f){case 0:return u.add(r,o);case 1:return u.add(r+a,o);case 2:return u.add(r+a,o+h);case 3:return u.add(r,o+h)}return u})},bl=function(){function s(r){this.element=r,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return s}(),xl=function(){function s(r,o){if(this.container=r,this.parent=o,this.effects=[],this.curves=new op(this.container),this.container.styles.opacity<1&&this.effects.push(new hp(this.container.styles.opacity)),this.container.styles.transform!==null){var a=this.container.bounds.left+this.container.styles.transformOrigin[0].number,h=this.container.bounds.top+this.container.styles.transformOrigin[1].number,u=this.container.styles.transform;this.effects.push(new cp(a,h,u))}if(this.container.styles.overflowX!==0){var f=Gr(this.curves),v=Vr(this.curves);Ml(f,v)?this.effects.push(new _r(f,6)):(this.effects.push(new _r(f,2)),this.effects.push(new _r(v,4)))}}return s.prototype.getEffects=function(r){for(var o=[2,3].indexOf(this.container.styles.position)===-1,a=this.parent,h=this.effects.slice(0);a;){var u=a.effects.filter(function(w){return!Ul(w)});if(o||a.container.styles.position!==0||!a.parent){if(h.unshift.apply(h,u),o=[2,3].indexOf(a.container.styles.position)===-1,a.container.styles.overflowX!==0){var f=Gr(a.curves),v=Vr(a.curves);Ml(f,v)||h.unshift(new _r(v,6))}}else h.unshift.apply(h,u);a=a.parent}return h.filter(function(w){return Ue(w.target,r)})},s}(),Ba=function(s,r,o,a){s.container.elements.forEach(function(h){var u=Ue(h.flags,4),f=Ue(h.flags,2),v=new xl(h,s);Ue(h.styles.display,2048)&&a.push(v);var w=Ue(h.flags,8)?[]:a;if(u||f){var E=u||h.styles.isPositioned()?o:r,I=new bl(v);if(h.styles.isPositioned()||h.styles.opacity<1||h.styles.isTransformed()){var H=h.styles.zIndex.order;if(H<0){var S=0;E.negativeZIndex.some(function(M,T){return H>M.element.container.styles.zIndex.order?(S=T,!1):S>0}),E.negativeZIndex.splice(S,0,I)}else if(H>0){var D=0;E.positiveZIndex.some(function(M,T){return H>=M.element.container.styles.zIndex.order?(D=T+1,!1):D>0}),E.positiveZIndex.splice(D,0,I)}else E.zeroOrAutoZIndexOrTransformedOrOpacity.push(I)}else h.styles.isFloating()?E.nonPositionedFloats.push(I):E.nonPositionedInlineLevel.push(I);Ba(v,I,u?I:o,w)}else h.styles.isInlineLevel()?r.inlineLevel.push(v):r.nonInlineLevel.push(v),Ba(v,r,o,w);Ue(h.flags,8)&&Tl(h,w)})},Tl=function(s,r){for(var o=s instanceof aa?s.start:1,a=s instanceof aa?s.reversed:!1,h=0;h<r.length;h++){var u=r[h];u.container instanceof rl&&typeof u.container.value=="number"&&u.container.value!==0&&(o=u.container.value),u.listValue=Si(o,u.container.styles.listStyleType,!0),o+=a?-1:1}},pp=function(s){var r=new xl(s,null),o=new bl(r),a=[];return Ba(r,o,o,a),Tl(r.container,a),o},Ll=function(s,r){switch(r){case 0:return ut(s.topLeftBorderBox,s.topLeftPaddingBox,s.topRightBorderBox,s.topRightPaddingBox);case 1:return ut(s.topRightBorderBox,s.topRightPaddingBox,s.bottomRightBorderBox,s.bottomRightPaddingBox);case 2:return ut(s.bottomRightBorderBox,s.bottomRightPaddingBox,s.bottomLeftBorderBox,s.bottomLeftPaddingBox);case 3:default:return ut(s.bottomLeftBorderBox,s.bottomLeftPaddingBox,s.topLeftBorderBox,s.topLeftPaddingBox)}},mp=function(s,r){switch(r){case 0:return ut(s.topLeftBorderBox,s.topLeftBorderDoubleOuterBox,s.topRightBorderBox,s.topRightBorderDoubleOuterBox);case 1:return ut(s.topRightBorderBox,s.topRightBorderDoubleOuterBox,s.bottomRightBorderBox,s.bottomRightBorderDoubleOuterBox);case 2:return ut(s.bottomRightBorderBox,s.bottomRightBorderDoubleOuterBox,s.bottomLeftBorderBox,s.bottomLeftBorderDoubleOuterBox);case 3:default:return ut(s.bottomLeftBorderBox,s.bottomLeftBorderDoubleOuterBox,s.topLeftBorderBox,s.topLeftBorderDoubleOuterBox)}},fp=function(s,r){switch(r){case 0:return ut(s.topLeftBorderDoubleInnerBox,s.topLeftPaddingBox,s.topRightBorderDoubleInnerBox,s.topRightPaddingBox);case 1:return ut(s.topRightBorderDoubleInnerBox,s.topRightPaddingBox,s.bottomRightBorderDoubleInnerBox,s.bottomRightPaddingBox);case 2:return ut(s.bottomRightBorderDoubleInnerBox,s.bottomRightPaddingBox,s.bottomLeftBorderDoubleInnerBox,s.bottomLeftPaddingBox);case 3:default:return ut(s.bottomLeftBorderDoubleInnerBox,s.bottomLeftPaddingBox,s.topLeftBorderDoubleInnerBox,s.topLeftPaddingBox)}},Bp=function(s,r){switch(r){case 0:return Wr(s.topLeftBorderStroke,s.topRightBorderStroke);case 1:return Wr(s.topRightBorderStroke,s.bottomRightBorderStroke);case 2:return Wr(s.bottomRightBorderStroke,s.bottomLeftBorderStroke);case 3:default:return Wr(s.bottomLeftBorderStroke,s.topLeftBorderStroke)}},Wr=function(s,r){var o=[];return gt(s)?o.push(s.subdivide(.5,!1)):o.push(s),gt(r)?o.push(r.subdivide(.5,!0)):o.push(r),o},ut=function(s,r,o,a){var h=[];return gt(s)?h.push(s.subdivide(.5,!1)):h.push(s),gt(o)?h.push(o.subdivide(.5,!0)):h.push(o),gt(a)?h.push(a.subdivide(.5,!0).reverse()):h.push(a),gt(r)?h.push(r.subdivide(.5,!1).reverse()):h.push(r),h},Pl=function(s){var r=s.bounds,o=s.styles;return r.add(o.borderLeftWidth,o.borderTopWidth,-(o.borderRightWidth+o.borderLeftWidth),-(o.borderTopWidth+o.borderBottomWidth))},Xr=function(s){var r=s.styles,o=s.bounds,a=ge(r.paddingLeft,o.width),h=ge(r.paddingRight,o.width),u=ge(r.paddingTop,o.width),f=ge(r.paddingBottom,o.width);return o.add(a+r.borderLeftWidth,u+r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth+a+h),-(r.borderTopWidth+r.borderBottomWidth+u+f))},Cp=function(s,r){return s===0?r.bounds:s===2?Xr(r):Pl(r)},wp=function(s,r){return s===0?r.bounds:s===2?Xr(r):Pl(r)},Ca=function(s,r,o){var a=Cp(NA(s.styles.backgroundOrigin,r),s),h=wp(NA(s.styles.backgroundClip,r),s),u=vp(NA(s.styles.backgroundSize,r),o,a),f=u[0],v=u[1],w=yi(NA(s.styles.backgroundPosition,r),a.width-f,a.height-v),E=yp(NA(s.styles.backgroundRepeat,r),w,u,a,h),I=Math.round(a.left+w[0]),H=Math.round(a.top+w[1]);return[E,I,H,f,v]},OA=function(s){return ce(s)&&s.value===PA.AUTO},Jr=function(s){return typeof s=="number"},vp=function(s,r,o){var a=r[0],h=r[1],u=r[2],f=s[0],v=s[1];if(!f)return[0,0];if(ye(f)&&v&&ye(v))return[ge(f,o.width),ge(v,o.height)];var w=Jr(u);if(ce(f)&&(f.value===PA.CONTAIN||f.value===PA.COVER)){if(Jr(u)){var E=o.width/o.height;return E<u!=(f.value===PA.COVER)?[o.width,o.width/u]:[o.height*u,o.height]}return[o.width,o.height]}var I=Jr(a),H=Jr(h),S=I||H;if(OA(f)&&(!v||OA(v))){if(I&&H)return[a,h];if(!w&&!S)return[o.width,o.height];if(S&&w){var D=I?a:h*u,M=H?h:a/u;return[D,M]}var T=I?a:o.width,J=H?h:o.height;return[T,J]}if(w){var O=0,K=0;return ye(f)?O=ge(f,o.width):ye(v)&&(K=ge(v,o.height)),OA(f)?O=K*u:(!v||OA(v))&&(K=O/u),[O,K]}var re=null,$=null;if(ye(f)?re=ge(f,o.width):v&&ye(v)&&($=ge(v,o.height)),re!==null&&(!v||OA(v))&&($=I&&H?re/a*h:o.height),$!==null&&OA(f)&&(re=I&&H?$/h*a:o.width),re!==null&&$!==null)return[re,$];throw new Error("Unable to calculate background-size for element")},NA=function(s,r){var o=s[r];return typeof o=="undefined"?s[0]:o},yp=function(s,r,o,a,h){var u=r[0],f=r[1],v=o[0],w=o[1];switch(s){case 2:return[new L(Math.round(a.left),Math.round(a.top+f)),new L(Math.round(a.left+a.width),Math.round(a.top+f)),new L(Math.round(a.left+a.width),Math.round(w+a.top+f)),new L(Math.round(a.left),Math.round(w+a.top+f))];case 3:return[new L(Math.round(a.left+u),Math.round(a.top)),new L(Math.round(a.left+u+v),Math.round(a.top)),new L(Math.round(a.left+u+v),Math.round(a.height+a.top)),new L(Math.round(a.left+u),Math.round(a.height+a.top))];case 1:return[new L(Math.round(a.left+u),Math.round(a.top+f)),new L(Math.round(a.left+u+v),Math.round(a.top+f)),new L(Math.round(a.left+u+v),Math.round(a.top+f+w)),new L(Math.round(a.left+u),Math.round(a.top+f+w))];default:return[new L(Math.round(h.left),Math.round(h.top)),new L(Math.round(h.left+h.width),Math.round(h.top)),new L(Math.round(h.left+h.width),Math.round(h.height+h.top)),new L(Math.round(h.left),Math.round(h.height+h.top))]}},Fp="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Dl="Hidden Text",Ep=function(){function s(r){this._data={},this._document=r}return s.prototype.parseMetrics=function(r,o){var a=this._document.createElement("div"),h=this._document.createElement("img"),u=this._document.createElement("span"),f=this._document.body;a.style.visibility="hidden",a.style.fontFamily=r,a.style.fontSize=o,a.style.margin="0",a.style.padding="0",a.style.whiteSpace="nowrap",f.appendChild(a),h.src=Fp,h.width=1,h.height=1,h.style.margin="0",h.style.padding="0",h.style.verticalAlign="baseline",u.style.fontFamily=r,u.style.fontSize=o,u.style.margin="0",u.style.padding="0",u.appendChild(this._document.createTextNode(Dl)),a.appendChild(u),a.appendChild(h);var v=h.offsetTop-u.offsetTop+2;a.removeChild(u),a.appendChild(this._document.createTextNode(Dl)),a.style.lineHeight="normal",h.style.verticalAlign="super";var w=h.offsetTop-a.offsetTop+2;return f.removeChild(a),{baseline:v,middle:w}},s.prototype.getMetrics=function(r,o){var a=r+" "+o;return typeof this._data[a]=="undefined"&&(this._data[a]=this.parseMetrics(r,o)),this._data[a]},s}(),Rl=function(){function s(r,o){this.context=r,this.options=o}return s}(),Ip=1e4,Hp=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h._activeEffects=[],h.canvas=a.canvas?a.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),a.canvas||(h.canvas.width=Math.floor(a.width*a.scale),h.canvas.height=Math.floor(a.height*a.scale),h.canvas.style.width=a.width+"px",h.canvas.style.height=a.height+"px"),h.fontMetrics=new Ep(document),h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-a.x,-a.y),h.ctx.textBaseline="bottom",h._activeEffects=[],h.context.logger.debug("Canvas renderer initialized ("+a.width+"x"+a.height+") with scale "+a.scale),h}return r.prototype.applyEffects=function(o){for(var a=this;this._activeEffects.length;)this.popEffect();o.forEach(function(h){return a.applyEffect(h)})},r.prototype.applyEffect=function(o){this.ctx.save(),gp(o)&&(this.ctx.globalAlpha=o.opacity),dp(o)&&(this.ctx.translate(o.offsetX,o.offsetY),this.ctx.transform(o.matrix[0],o.matrix[1],o.matrix[2],o.matrix[3],o.matrix[4],o.matrix[5]),this.ctx.translate(-o.offsetX,-o.offsetY)),Ul(o)&&(this.path(o.path),this.ctx.clip()),this._activeEffects.push(o)},r.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},r.prototype.renderStack=function(o){return A(this,void 0,void 0,function(){var a;return i(this,function(h){switch(h.label){case 0:return a=o.element.container.styles,a.isVisible()?[4,this.renderStackContent(o)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},r.prototype.renderNode=function(o){return A(this,void 0,void 0,function(){return i(this,function(a){switch(a.label){case 0:if(Ue(o.container.flags,16))debugger;return o.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(o)]:[3,3];case 1:return a.sent(),[4,this.renderNodeContent(o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},r.prototype.renderTextWithLetterSpacing=function(o,a,h){var u=this;if(a===0)this.ctx.fillText(o.text,o.bounds.left,o.bounds.top+h);else{var f=na(o.text);f.reduce(function(v,w){return u.ctx.fillText(w,v,o.bounds.top+h),v+u.ctx.measureText(w).width},o.bounds.left)}},r.prototype.createFontStyle=function(o){var a=o.fontVariant.filter(function(f){return f==="normal"||f==="small-caps"}).join(""),h=bp(o.fontFamily).join(", "),u=vi(o.fontSize)?""+o.fontSize.number+o.fontSize.unit:o.fontSize.number+"px";return[[o.fontStyle,a,o.fontWeight,u,h].join(" "),h,u]},r.prototype.renderTextNode=function(o,a){return A(this,void 0,void 0,function(){var h,u,f,v,w,E,I,H,S=this;return i(this,function(D){return h=this.createFontStyle(a),u=h[0],f=h[1],v=h[2],this.ctx.font=u,this.ctx.direction=a.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",w=this.fontMetrics.getMetrics(f,v),E=w.baseline,I=w.middle,H=a.paintOrder,o.textBounds.forEach(function(M){H.forEach(function(T){switch(T){case 0:S.ctx.fillStyle=be(a.color),S.renderTextWithLetterSpacing(M,a.letterSpacing,E);var J=a.textShadow;J.length&&M.text.trim().length&&(J.slice(0).reverse().forEach(function(O){S.ctx.shadowColor=be(O.color),S.ctx.shadowOffsetX=O.offsetX.number*S.options.scale,S.ctx.shadowOffsetY=O.offsetY.number*S.options.scale,S.ctx.shadowBlur=O.blur.number,S.renderTextWithLetterSpacing(M,a.letterSpacing,E)}),S.ctx.shadowColor="",S.ctx.shadowOffsetX=0,S.ctx.shadowOffsetY=0,S.ctx.shadowBlur=0),a.textDecorationLine.length&&(S.ctx.fillStyle=be(a.textDecorationColor||a.color),a.textDecorationLine.forEach(function(O){switch(O){case 1:S.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top+E),M.bounds.width,1);break;case 2:S.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top),M.bounds.width,1);break;case 3:S.ctx.fillRect(M.bounds.left,Math.ceil(M.bounds.top+I),M.bounds.width,1);break}}));break;case 1:a.webkitTextStrokeWidth&&M.text.trim().length&&(S.ctx.strokeStyle=be(a.webkitTextStrokeColor),S.ctx.lineWidth=a.webkitTextStrokeWidth,S.ctx.lineJoin=window.chrome?"miter":"round",S.ctx.strokeText(M.text,M.bounds.left,M.bounds.top+E)),S.ctx.strokeStyle="",S.ctx.lineWidth=0,S.ctx.lineJoin="miter";break}})}),[2]})})},r.prototype.renderReplacedElement=function(o,a,h){if(h&&o.intrinsicWidth>0&&o.intrinsicHeight>0){var u=Xr(o),f=Vr(a);this.path(f),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(h,0,0,o.intrinsicWidth,o.intrinsicHeight,u.left,u.top,u.width,u.height),this.ctx.restore()}},r.prototype.renderNodeContent=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w,K,K,E,I,H,S,$,D,M,_,T,J,O,K,re,$,_;return i(this,function(P){switch(P.label){case 0:this.applyEffects(o.getEffects(4)),a=o.container,h=o.curves,u=a.styles,f=0,v=a.textNodes,P.label=1;case 1:return f<v.length?(w=v[f],[4,this.renderTextNode(w,u)]):[3,4];case 2:P.sent(),P.label=3;case 3:return f++,[3,1];case 4:if(!(a instanceof tl))return[3,8];P.label=5;case 5:return P.trys.push([5,7,,8]),[4,this.context.cache.match(a.src)];case 6:return K=P.sent(),this.renderReplacedElement(a,h,K),[3,8];case 7:return P.sent(),this.context.logger.error("Error loading image "+a.src),[3,8];case 8:if(a instanceof Al&&this.renderReplacedElement(a,h,a.canvas),!(a instanceof il))return[3,12];P.label=9;case 9:return P.trys.push([9,11,,12]),[4,this.context.cache.match(a.svg)];case 10:return K=P.sent(),this.renderReplacedElement(a,h,K),[3,12];case 11:return P.sent(),this.context.logger.error("Error loading svg "+a.svg.substring(0,255)),[3,12];case 12:return a instanceof ol&&a.tree?(E=new r(this.context,{scale:this.options.scale,backgroundColor:a.backgroundColor,x:0,y:0,width:a.width,height:a.height}),[4,E.render(a.tree)]):[3,14];case 13:I=P.sent(),a.width&&a.height&&this.ctx.drawImage(I,0,0,a.width,a.height,a.bounds.left,a.bounds.top,a.bounds.width,a.bounds.height),P.label=14;case 14:if(a instanceof oa&&(H=Math.min(a.bounds.width,a.bounds.height),a.type===Pr?a.checked&&(this.ctx.save(),this.path([new L(a.bounds.left+H*.39363,a.bounds.top+H*.79),new L(a.bounds.left+H*.16,a.bounds.top+H*.5549),new L(a.bounds.left+H*.27347,a.bounds.top+H*.44071),new L(a.bounds.left+H*.39694,a.bounds.top+H*.5649),new L(a.bounds.left+H*.72983,a.bounds.top+H*.23),new L(a.bounds.left+H*.84,a.bounds.top+H*.34085),new L(a.bounds.left+H*.39363,a.bounds.top+H*.79)]),this.ctx.fillStyle=be(sl),this.ctx.fill(),this.ctx.restore()):a.type===Dr&&a.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a.bounds.left+H/2,a.bounds.top+H/2,H/4,0,Math.PI*2,!0),this.ctx.fillStyle=be(sl),this.ctx.fill(),this.ctx.restore())),Qp(a)&&a.value.length){switch(S=this.createFontStyle(u),$=S[0],D=S[1],M=this.fontMetrics.getMetrics($,D).baseline,this.ctx.font=$,this.ctx.fillStyle=be(u.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Up(a.styles.textAlign),_=Xr(a),T=0,a.styles.textAlign){case 1:T+=_.width/2;break;case 2:T+=_.width;break}J=_.add(T,0,0,-_.height/2+1),this.ctx.save(),this.path([new L(_.left,_.top),new L(_.left+_.width,_.top),new L(_.left+_.width,_.top+_.height),new L(_.left,_.top+_.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Hi(a.value,J),u.letterSpacing,M),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ue(a.styles.display,2048))return[3,20];if(a.styles.listStyleImage===null)return[3,19];if(O=a.styles.listStyleImage,O.type!==0)return[3,18];K=void 0,re=O.url,P.label=15;case 15:return P.trys.push([15,17,,18]),[4,this.context.cache.match(re)];case 16:return K=P.sent(),this.ctx.drawImage(K,a.bounds.left-(K.width+10),a.bounds.top),[3,18];case 17:return P.sent(),this.context.logger.error("Error loading list-style-image "+re),[3,18];case 18:return[3,20];case 19:o.listValue&&a.styles.listStyleType!==-1&&($=this.createFontStyle(u)[0],this.ctx.font=$,this.ctx.fillStyle=be(u.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",_=new l(a.bounds.left,a.bounds.top+ge(a.styles.paddingTop,a.bounds.width),a.bounds.width,Do(u.lineHeight,u.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Hi(o.listValue,_),u.letterSpacing,Do(u.lineHeight,u.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),P.label=20;case 20:return[2]}})})},r.prototype.renderStackContent=function(o){return A(this,void 0,void 0,function(){var a,h,O,u,f,O,v,w,O,E,I,O,H,S,O,D,M,O,T,J,O;return i(this,function(K){switch(K.label){case 0:if(Ue(o.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(o.element)];case 1:K.sent(),a=0,h=o.negativeZIndex,K.label=2;case 2:return a<h.length?(O=h[a],[4,this.renderStack(O)]):[3,5];case 3:K.sent(),K.label=4;case 4:return a++,[3,2];case 5:return[4,this.renderNodeContent(o.element)];case 6:K.sent(),u=0,f=o.nonInlineLevel,K.label=7;case 7:return u<f.length?(O=f[u],[4,this.renderNode(O)]):[3,10];case 8:K.sent(),K.label=9;case 9:return u++,[3,7];case 10:v=0,w=o.nonPositionedFloats,K.label=11;case 11:return v<w.length?(O=w[v],[4,this.renderStack(O)]):[3,14];case 12:K.sent(),K.label=13;case 13:return v++,[3,11];case 14:E=0,I=o.nonPositionedInlineLevel,K.label=15;case 15:return E<I.length?(O=I[E],[4,this.renderStack(O)]):[3,18];case 16:K.sent(),K.label=17;case 17:return E++,[3,15];case 18:H=0,S=o.inlineLevel,K.label=19;case 19:return H<S.length?(O=S[H],[4,this.renderNode(O)]):[3,22];case 20:K.sent(),K.label=21;case 21:return H++,[3,19];case 22:D=0,M=o.zeroOrAutoZIndexOrTransformedOrOpacity,K.label=23;case 23:return D<M.length?(O=M[D],[4,this.renderStack(O)]):[3,26];case 24:K.sent(),K.label=25;case 25:return D++,[3,23];case 26:T=0,J=o.positiveZIndex,K.label=27;case 27:return T<J.length?(O=J[T],[4,this.renderStack(O)]):[3,30];case 28:K.sent(),K.label=29;case 29:return T++,[3,27];case 30:return[2]}})})},r.prototype.mask=function(o){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(o.slice(0).reverse()),this.ctx.closePath()},r.prototype.path=function(o){this.ctx.beginPath(),this.formatPath(o),this.ctx.closePath()},r.prototype.formatPath=function(o){var a=this;o.forEach(function(h,u){var f=gt(h)?h.start:h;u===0?a.ctx.moveTo(f.x,f.y):a.ctx.lineTo(f.x,f.y),gt(h)&&a.ctx.bezierCurveTo(h.startControl.x,h.startControl.y,h.endControl.x,h.endControl.y,h.end.x,h.end.y)})},r.prototype.renderRepeat=function(o,a,h,u){this.path(o),this.ctx.fillStyle=a,this.ctx.translate(h,u),this.ctx.fill(),this.ctx.translate(-h,-u)},r.prototype.resizeImage=function(o,a,h){var u;if(o.width===a&&o.height===h)return o;var f=(u=this.canvas.ownerDocument)!==null&&u!==void 0?u:document,v=f.createElement("canvas");v.width=Math.max(1,a),v.height=Math.max(1,h);var w=v.getContext("2d");return w.drawImage(o,0,0,o.width,o.height,0,0,a,h),v},r.prototype.renderBackgroundImage=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w;return i(this,function(E){switch(E.label){case 0:a=o.styles.backgroundImage.length-1,h=function(I){var H,S,D,Fe,tt,At,he,Ke,ee,M,Fe,tt,At,he,Ke,T,J,O,K,re,$,_,P,j,ee,X,Fe,et,at,he,Ke,sA,tt,At,fA,Ht,nA,BA,CA,Rt,wA,Kt;return i(this,function(GA){switch(GA.label){case 0:if(I.type!==0)return[3,5];H=void 0,S=I.url,GA.label=1;case 1:return GA.trys.push([1,3,,4]),[4,u.context.cache.match(S)];case 2:return H=GA.sent(),[3,4];case 3:return GA.sent(),u.context.logger.error("Error loading background-image "+S),[3,4];case 4:return H&&(D=Ca(o,a,[H.width,H.height,H.width/H.height]),Fe=D[0],tt=D[1],At=D[2],he=D[3],Ke=D[4],ee=u.ctx.createPattern(u.resizeImage(H,he,Ke),"repeat"),u.renderRepeat(Fe,ee,tt,At)),[3,6];case 5:dd(I)?(M=Ca(o,a,[null,null,null]),Fe=M[0],tt=M[1],At=M[2],he=M[3],Ke=M[4],T=ad(I.angle,he,Ke),J=T[0],O=T[1],K=T[2],re=T[3],$=T[4],_=document.createElement("canvas"),_.width=he,_.height=Ke,P=_.getContext("2d"),j=P.createLinearGradient(O,re,K,$),Io(I.stops,J).forEach(function(Mi){return j.addColorStop(Mi.stop,be(Mi.color))}),P.fillStyle=j,P.fillRect(0,0,he,Ke),he>0&&Ke>0&&(ee=u.ctx.createPattern(_,"repeat"),u.renderRepeat(Fe,ee,tt,At))):gd(I)&&(X=Ca(o,a,[null,null,null]),Fe=X[0],et=X[1],at=X[2],he=X[3],Ke=X[4],sA=I.position.length===0?[Wn]:I.position,tt=ge(sA[0],he),At=ge(sA[sA.length-1],Ke),fA=od(I,tt,At,he,Ke),Ht=fA[0],nA=fA[1],Ht>0&&nA>0&&(BA=u.ctx.createRadialGradient(et+tt,at+At,0,et+tt,at+At,Ht),Io(I.stops,Ht*2).forEach(function(Mi){return BA.addColorStop(Mi.stop,be(Mi.color))}),u.path(Fe),u.ctx.fillStyle=BA,Ht!==nA?(CA=o.bounds.left+.5*o.bounds.width,Rt=o.bounds.top+.5*o.bounds.height,wA=nA/Ht,Kt=1/wA,u.ctx.save(),u.ctx.translate(CA,Rt),u.ctx.transform(1,0,0,wA,0,0),u.ctx.translate(-CA,-Rt),u.ctx.fillRect(et,Kt*(at-Rt)+Rt,he,Ke*Kt),u.ctx.restore()):u.ctx.fill())),GA.label=6;case 6:return a--,[2]}})},u=this,f=0,v=o.styles.backgroundImage.slice(0).reverse(),E.label=1;case 1:return f<v.length?(w=v[f],[5,h(w)]):[3,4];case 2:E.sent(),E.label=3;case 3:return f++,[3,1];case 4:return[2]}})})},r.prototype.renderSolidBorder=function(o,a,h){return A(this,void 0,void 0,function(){return i(this,function(u){return this.path(Ll(h,a)),this.ctx.fillStyle=be(o),this.ctx.fill(),[2]})})},r.prototype.renderDoubleBorder=function(o,a,h,u){return A(this,void 0,void 0,function(){var f,v;return i(this,function(w){switch(w.label){case 0:return a<3?[4,this.renderSolidBorder(o,h,u)]:[3,2];case 1:return w.sent(),[2];case 2:return f=mp(u,h),this.path(f),this.ctx.fillStyle=be(o),this.ctx.fill(),v=fp(u,h),this.path(v),this.ctx.fill(),[2]}})})},r.prototype.renderNodeBackgroundAndBorders=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w,E,I,H=this;return i(this,function(S){switch(S.label){case 0:return this.applyEffects(o.getEffects(2)),a=o.container.styles,h=!tA(a.backgroundColor)||a.backgroundImage.length,u=[{style:a.borderTopStyle,color:a.borderTopColor,width:a.borderTopWidth},{style:a.borderRightStyle,color:a.borderRightColor,width:a.borderRightWidth},{style:a.borderBottomStyle,color:a.borderBottomColor,width:a.borderBottomWidth},{style:a.borderLeftStyle,color:a.borderLeftColor,width:a.borderLeftWidth}],f=Sp(NA(a.backgroundClip,0),o.curves),h||a.boxShadow.length?(this.ctx.save(),this.path(f),this.ctx.clip(),tA(a.backgroundColor)||(this.ctx.fillStyle=be(a.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(o.container)]):[3,2];case 1:S.sent(),this.ctx.restore(),a.boxShadow.slice(0).reverse().forEach(function(D){H.ctx.save();var M=Gr(o.curves),T=D.inset?0:Ip,J=up(M,-T+(D.inset?1:-1)*D.spread.number,(D.inset?1:-1)*D.spread.number,D.spread.number*(D.inset?-2:2),D.spread.number*(D.inset?-2:2));D.inset?(H.path(M),H.ctx.clip(),H.mask(J)):(H.mask(M),H.ctx.clip(),H.path(J)),H.ctx.shadowOffsetX=D.offsetX.number+T,H.ctx.shadowOffsetY=D.offsetY.number,H.ctx.shadowColor=be(D.color),H.ctx.shadowBlur=D.blur.number,H.ctx.fillStyle=D.inset?be(D.color):"rgba(0,0,0,1)",H.ctx.fill(),H.ctx.restore()}),S.label=2;case 2:v=0,w=0,E=u,S.label=3;case 3:return w<E.length?(I=E[w],I.style!==0&&!tA(I.color)&&I.width>0?I.style!==2?[3,5]:[4,this.renderDashedDottedBorder(I.color,I.width,v,o.curves,2)]:[3,11]):[3,13];case 4:return S.sent(),[3,11];case 5:return I.style!==3?[3,7]:[4,this.renderDashedDottedBorder(I.color,I.width,v,o.curves,3)];case 6:return S.sent(),[3,11];case 7:return I.style!==4?[3,9]:[4,this.renderDoubleBorder(I.color,I.width,v,o.curves)];case 8:return S.sent(),[3,11];case 9:return[4,this.renderSolidBorder(I.color,v,o.curves)];case 10:S.sent(),S.label=11;case 11:v++,S.label=12;case 12:return w++,[3,3];case 13:return[2]}})})},r.prototype.renderDashedDottedBorder=function(o,a,h,u,f){return A(this,void 0,void 0,function(){var v,w,E,I,H,S,D,M,T,J,O,K,re,$,_,P,_,P;return i(this,function(j){return this.ctx.save(),v=Bp(u,h),w=Ll(u,h),f===2&&(this.path(w),this.ctx.clip()),gt(w[0])?(E=w[0].start.x,I=w[0].start.y):(E=w[0].x,I=w[0].y),gt(w[1])?(H=w[1].end.x,S=w[1].end.y):(H=w[1].x,S=w[1].y),h===0||h===2?D=Math.abs(E-H):D=Math.abs(I-S),this.ctx.beginPath(),f===3?this.formatPath(v):this.formatPath(w.slice(0,2)),M=a<3?a*3:a*2,T=a<3?a*2:a,f===3&&(M=a,T=a),J=!0,D<=M*2?J=!1:D<=M*2+T?(O=D/(2*M+T),M*=O,T*=O):(K=Math.floor((D+T)/(M+T)),re=(D-K*M)/(K-1),$=(D-(K+1)*M)/K,T=$<=0||Math.abs(T-re)<Math.abs(T-$)?re:$),J&&(f===3?this.ctx.setLineDash([0,M+T]):this.ctx.setLineDash([M,T])),f===3?(this.ctx.lineCap="round",this.ctx.lineWidth=a):this.ctx.lineWidth=a*2+1.1,this.ctx.strokeStyle=be(o),this.ctx.stroke(),this.ctx.setLineDash([]),f===2&&(gt(w[0])&&(_=w[3],P=w[0],this.ctx.beginPath(),this.formatPath([new L(_.end.x,_.end.y),new L(P.start.x,P.start.y)]),this.ctx.stroke()),gt(w[1])&&(_=w[1],P=w[2],this.ctx.beginPath(),this.formatPath([new L(_.end.x,_.end.y),new L(P.start.x,P.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},r.prototype.render=function(o){return A(this,void 0,void 0,function(){var a;return i(this,function(h){switch(h.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=be(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),a=pp(o),[4,this.renderStack(a)];case 1:return h.sent(),this.applyEffects([]),[2,this.canvas]}})})},r}(Rl),Qp=function(s){return s instanceof al||s instanceof nl?!0:s instanceof oa&&s.type!==Dr&&s.type!==Pr},Sp=function(s,r){switch(s){case 0:return Gr(r);case 2:return lp(r);case 1:default:return Vr(r)}},Up=function(s){switch(s){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Mp=["-apple-system","system-ui"],bp=function(s){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?s.filter(function(r){return Mp.indexOf(r)===-1}):s},xp=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.canvas=a.canvas?a.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),h.options=a,h.canvas.width=Math.floor(a.width*a.scale),h.canvas.height=Math.floor(a.height*a.scale),h.canvas.style.width=a.width+"px",h.canvas.style.height=a.height+"px",h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-a.x,-a.y),h.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+a.width+"x"+a.height+" at "+a.x+","+a.y+") with scale "+a.scale),h}return r.prototype.render=function(o){return A(this,void 0,void 0,function(){var a,h;return i(this,function(u){switch(u.label){case 0:return a=sa(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,o),[4,Tp(a)];case 1:return h=u.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=be(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(h,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},r}(Rl),Tp=function(s){return new Promise(function(r,o){var a=new Image;a.onload=function(){r(a)},a.onerror=o,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(s))})},Lp=function(){function s(r){var o=r.id,a=r.enabled;this.id=o,this.enabled=a,this.start=Date.now()}return s.prototype.debug=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.prototype.getTime=function(){return Date.now()-this.start},s.prototype.info=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&typeof window!="undefined"&&window.console&&typeof console.info=="function"&&console.info.apply(console,n([this.id,this.getTime()+"ms"],r))},s.prototype.warn=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.prototype.error=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.error=="function"?console.error.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.instances={},s}(),Pp=function(){function s(r,o){var a;this.windowBounds=o,this.instanceName="#"+s.instanceCount++,this.logger=new Lp({id:this.instanceName,enabled:r.logging}),this.cache=(a=r.cache)!==null&&a!==void 0?a:new tp(this,r)}return s.instanceCount=1,s}(),Dp=function(s,r){return r===void 0&&(r={}),Rp(s,r)};typeof window!="undefined"&&Sl.setContext(window);var Rp=function(s,r){return A(void 0,void 0,void 0,function(){var o,a,h,u,f,v,w,E,I,H,S,D,M,T,J,O,K,re,$,_,j,P,j,ee,X,Fe,et,at,he,Ke,sA,tt,At,fA,Ht,nA,BA,CA,Rt,wA;return i(this,function(Kt){switch(Kt.label){case 0:if(!s||typeof s!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(o=s.ownerDocument,!o)throw new Error("Element is not attached to a Document");if(a=o.defaultView,!a)throw new Error("Document is not attached to a Window");return h={allowTaint:(ee=r.allowTaint)!==null&&ee!==void 0?ee:!1,imageTimeout:(X=r.imageTimeout)!==null&&X!==void 0?X:15e3,proxy:r.proxy,useCORS:(Fe=r.useCORS)!==null&&Fe!==void 0?Fe:!1},u=t({logging:(et=r.logging)!==null&&et!==void 0?et:!0,cache:r.cache},h),f={windowWidth:(at=r.windowWidth)!==null&&at!==void 0?at:a.innerWidth,windowHeight:(he=r.windowHeight)!==null&&he!==void 0?he:a.innerHeight,scrollX:(Ke=r.scrollX)!==null&&Ke!==void 0?Ke:a.pageXOffset,scrollY:(sA=r.scrollY)!==null&&sA!==void 0?sA:a.pageYOffset},v=new l(f.scrollX,f.scrollY,f.windowWidth,f.windowHeight),w=new Pp(u,v),E=(tt=r.foreignObjectRendering)!==null&&tt!==void 0?tt:!1,I={allowTaint:(At=r.allowTaint)!==null&&At!==void 0?At:!1,onclone:r.onclone,ignoreElements:r.ignoreElements,inlineImages:E,copyStyles:E},w.logger.debug("Starting document clone with size "+v.width+"x"+v.height+" scrolled to "+-v.left+","+-v.top),H=new Hl(w,s,I),S=H.clonedReferenceElement,S?[4,H.toIFrame(o,v)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return D=Kt.sent(),M=ca(S)||Ku(S)?d(S.ownerDocument):c(w,S),T=M.width,J=M.height,O=M.left,K=M.top,re=Kp(w,S,r.backgroundColor),$={canvas:r.canvas,backgroundColor:re,scale:(Ht=(fA=r.scale)!==null&&fA!==void 0?fA:a.devicePixelRatio)!==null&&Ht!==void 0?Ht:1,x:((nA=r.x)!==null&&nA!==void 0?nA:0)+O,y:((BA=r.y)!==null&&BA!==void 0?BA:0)+K,width:(CA=r.width)!==null&&CA!==void 0?CA:Math.ceil(T),height:(Rt=r.height)!==null&&Rt!==void 0?Rt:Math.ceil(J)},E?(w.logger.debug("Document cloned, using foreign object rendering"),j=new xp(w,$),[4,j.render(S)]):[3,3];case 2:return _=Kt.sent(),[3,5];case 3:return w.logger.debug("Document cloned, element located at "+O+","+K+" with size "+T+"x"+J+" using computed rendering"),w.logger.debug("Starting DOM parsing"),P=cl(w,S),re===P.styles.backgroundColor&&(P.styles.backgroundColor=Pt.TRANSPARENT),w.logger.debug("Starting renderer for element at "+$.x+","+$.y+" with size "+$.width+"x"+$.height),j=new Hp(w,$),[4,j.render(P)];case 4:_=Kt.sent(),Kt.label=5;case 5:return(!((wA=r.removeContainer)!==null&&wA!==void 0)||wA)&&(Hl.destroy(D)||w.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),w.logger.debug("Finished rendering"),[2,_]}})})},Kp=function(s,r,o){var a=r.ownerDocument,h=a.documentElement?Fi(s,getComputedStyle(a.documentElement).backgroundColor):Pt.TRANSPARENT,u=a.body?Fi(s,getComputedStyle(a.body).backgroundColor):Pt.TRANSPARENT,f=typeof o=="string"?Fi(s,o):o===null?Pt.TRANSPARENT:4294967295;return r===a.documentElement?tA(h)?tA(u)?f:u:h:f};return Dp})});function Ua(B){return Sa.find(e=>e.id===B)||sc}var sc,$p,Yp,Sa,nc=Je(()=>{W();sc={id:"default",name:m("Default Template"),description:m("Modern minimalist knowledge card style"),render:B=>{var F;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-modern";let t=document.createElement("div");t.className="highlight-export-quote-section";let A=document.createElement("div");A.className="highlight-export-quote-decoration";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 24 24"),i.setAttribute("width","48"),i.setAttribute("height","48"),i.setAttribute("fill","none"),i.setAttribute("stroke","currentColor"),i.setAttribute("stroke-width","1");let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"),i.appendChild(n),i.appendChild(l),A.appendChild(i),t.appendChild(A);let c=document.createElement("div");c.className="highlight-export-quote",c.textContent=B.text,t.appendChild(c),e.appendChild(t);let d=document.createElement("div");d.className="highlight-export-footer";let g=document.createElement("div");g.className="highlight-export-source",g.textContent=B.fileName||((F=B.filePath)==null?void 0:F.split("/").pop())||"Untitled",d.appendChild(g);let p=document.createElement("div");p.className="highlight-export-date";let C=new Date,y={year:"numeric",month:"long",day:"numeric"};return p.textContent=C.toLocaleDateString(void 0,y),d.appendChild(p),e.appendChild(d),e}},$p={id:"academic",name:m("Academic Template"),description:m("Formal style suitable for academic citations"),render:B=>{var l;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-academic";let t=document.createElement("div");t.className="highlight-export-quote",t.textContent=`"${B.text}"`,e.appendChild(t);let A=document.createElement("div");A.className="highlight-export-footer";let i=document.createElement("div");i.className="highlight-export-source",i.textContent=B.fileName||((l=B.filePath)==null?void 0:l.split("/").pop())||"Untitled",A.appendChild(i);let n=document.createElement("div");return n.className="highlight-export-date",n.textContent=`Retrieved: ${new Date().toLocaleDateString()}`,A.appendChild(n),e.appendChild(A),e}},Yp={id:"social",name:m("Social Template"),description:m("Modern style suitable for social media sharing"),render:B=>{var C;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-social";let t=document.createElement("div");t.className="highlight-export-header";let A=document.createElement("div");A.className="highlight-export-logo";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("viewBox","0 0 100 100"),i.setAttribute("fill","currentColor"),i.setAttribute("stroke","none");let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M50,9.4L14.8,37.1l12.6,38.8l22.6,14.7l22.6-14.7l12.6-38.8L50,9.4z M50,19.5l25.5,20l-9.4,28.9L50,80.6 L33.9,68.4l-9.4-28.9L50,19.5z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M50,19.5l-25.5,20l9.4,28.9L50,80.6V19.5z"),l.setAttribute("fill-opacity","0.3"),i.appendChild(n),i.appendChild(l),A.appendChild(i),t.appendChild(A);let c=document.createElement("div");c.className="highlight-export-app-name",c.textContent="HiNote",t.appendChild(c),e.appendChild(t);let d=document.createElement("div");d.className="highlight-export-quote",d.textContent=B.text,e.appendChild(d);let g=document.createElement("div");g.className="highlight-export-footer";let p=document.createElement("div");return p.className="highlight-export-source",p.textContent=B.fileName||((C=B.filePath)==null?void 0:C.split("/").pop())||"Untitled",g.appendChild(p),e.appendChild(g),e}},Sa=[sc,$p,Yp]});var ac,oc=Je(()=>{ac=`
    /* \u5BFC\u51FA\u5361\u7247\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card {
        transition: all 0.3s ease;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        
        /* \u6DFB\u52A0\u66F4\u4E25\u683C\u7684\u6587\u672C\u63A7\u5236 */
        font-size: 16px;
        line-height: 1.6;
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* \u73B0\u4EE3\u98CE\u683C\u6A21\u677F */
    .highlight-export-card-modern {
        padding: 24px;
        position: relative;
        overflow: hidden;
    }

    .highlight-export-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(to bottom right, #5871ef 0%, #4c63e6 100%);
    }

    .highlight-export-card-modern .highlight-export-quote-decoration {
        position: absolute;
        top: 24px;
        right: 24px;
        opacity: 0.06;
        transform: scale(2);
    }

    .highlight-export-card-modern .highlight-export-quote-section {
        position: relative;
        padding: 24px 0;
        /* \u786E\u4FDD\u5F15\u7528\u90E8\u5206\u7684\u6587\u672C\u6837\u5F0F\u4E00\u81F4\u6027 */
        font-size: inherit;
        line-height: inherit;
        letter-spacing: inherit;
        word-spacing: inherit;
    }

    .highlight-export-card-modern .highlight-export-quote {
        font-size: 1em;
        line-height: 1.7;
        color: #333333;
        font-weight: 400;
        margin: 0;
        position: relative;
        z-index: 1;
        /* \u786E\u4FDD\u5F15\u7528\u6587\u672C\u7684\u6837\u5F0F\u4E00\u81F4\u6027 */
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u786E\u4FDD\u6240\u6709\u6587\u672C\u5143\u7D20\u7EE7\u627F\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card * {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u5BFC\u51FA\u9884\u89C8\u5BB9\u5668 */
    .highlight-export-preview {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
    }

    /* \u5BFC\u51FA\u5BB9\u5668 */
    .highlight-export-container {
        padding: 20px;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        width: 480px;
    }
`});var lc={};aA(lc,{ExportPreviewModal:()=>Ma});var Zi,Ma,cc=Je(()=>{Zi=require("obsidian");nc();W();oc();Ma=class extends Zi.Modal{constructor(t,A,i){super(t);this.selectedTemplateId="default";this.includeComments=!1;this.highlight=A,this.html2canvasInstance=i}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("highlight-export-modal");let A=t.createEl("div",{cls:"highlight-export-main-container"}),i=A.createEl("select",{cls:"highlight-template-select"});Sa.forEach(l=>{let c=i.createEl("option",{text:l.name,value:l.id});this.selectedTemplateId===l.id&&(c.selected=!0)}),i.addEventListener("change",l=>{let c=l.target;this.selectedTemplateId=c.value,this.updatePreview()}),this.previewContainer=A.createEl("div",{cls:"highlight-export-preview-container"}),this.updatePreview();let n=t.createEl("div",{cls:"highlight-export-modal-buttons"});if(this.highlight.comments&&this.highlight.comments.length>0){let l=n.createEl("div",{cls:"highlight-export-checkbox-container"}),c=l.createEl("input",{attr:{type:"checkbox",id:"include-comments-checkbox"},cls:"highlight-export-checkbox"}),d=l.createEl("label",{text:m("Include Comments"),attr:{for:"include-comments-checkbox"},cls:"highlight-export-checkbox-label"});c.addEventListener("change",g=>{this.includeComments=g.target.checked,this.updatePreview()})}n.createEl("button",{cls:"highlight-btn",text:m("Cancel")}).addEventListener("click",()=>this.close()),n.createEl("button",{cls:"highlight-btn highlight-btn-primary",text:m("Download")}).addEventListener("click",async()=>{try{let l=document.createElement("div");l.className="highlight-export-container";let d=Ua(this.selectedTemplateId).render(this.highlight);l.appendChild(d),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(l),document.body.appendChild(l);let p=(await this.html2canvasInstance(l,{backgroundColor:null,scale:window.devicePixelRatio*2,useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:0,removeContainer:!0,onclone:async y=>{let F=y.createElement("style");F.textContent=this.getExportStyles(),y.head.appendChild(F),await new Promise(Q=>setTimeout(Q,100))}})).toDataURL("image/png",1),C=document.createElement("a");C.download=`highlight-${this.selectedTemplateId}-${Date.now()}.png`,C.href=p,C.click(),this.close(),new Zi.Notice(m("Export successful!"))}catch(l){new Zi.Notice(m("Export failed, please try again"))}})}updatePreview(){this.previewContainer.empty(),this.previewContainer.className="highlight-export-preview";let A=Ua(this.selectedTemplateId).render(this.highlight);this.previewContainer.appendChild(A),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(this.previewContainer)}addCommentsToContainer(t){let A=t.querySelector(".highlight-export-card");if(!A)return;let i=A.querySelector(".highlight-export-footer");if(!i)return;let n=document.createElement("div");n.className="highlight-export-comments-section";let l=document.createElement("div");l.className="highlight-export-comments-list",n.appendChild(l),this.highlight.comments&&this.highlight.comments.forEach(c=>{let d=document.createElement("div");d.className="highlight-export-comment-item";let g=document.createElement("div");if(g.className="highlight-export-comment-content",g.textContent=c.content,d.appendChild(g),c.createdAt){let p=document.createElement("div");p.className="highlight-export-comment-time",p.textContent=new Date(c.createdAt).toLocaleString(),d.appendChild(p)}l.appendChild(d)}),A.insertBefore(n,i)}getExportStyles(){return`
            body {
                margin: 0;
                background: none;
            }
            ${ac}
        `}onClose(){let{contentEl:t}=this;t.empty()}}});var wm={};aA(wm,{default:()=>Qn});module.exports=Xp(wm);var Pc=require("obsidian");var er=require("obsidian");var Jl=require("obsidian");var le={AGAIN:1,HARD:2,GOOD:3,EASY:4},wa={request_retention:.9,maximum_interval:36500,newCardsPerDay:20,reviewsPerDay:100,w:[.4872,1.4003,3.7145,13.8206,5.1618,1.2298,.8975,.031,1.6474,.1367,1.0461,2.1072,.0793,.3246,1.587,.2272,2.8755,0,0,0,0]};W();var ue=require("obsidian");W();var $r=class{constructor(e,t){this.containerEl=e,this.fsrsManager=t}render(){this.containerEl.empty(),this.containerEl.addClass("flashcard-stats-panel"),this.renderStatsArea(),this.renderHeatmap()}renderStatsArea(){let e=this.containerEl.createDiv("flashcard-stats-area"),t=this.fsrsManager.getProgress();this.createStatItem(e,t.newCards.toString(),"New","flashcard-stat-new"),this.createStatItem(e,t.learned.toString(),"Learning","flashcard-stat-learning"),this.createStatItem(e,t.due.toString(),"Review","flashcard-stat-due")}createStatItem(e,t,A,i){let n=e.createDiv(`flashcard-stat-item ${i}`),l=n.createDiv("flashcard-stat-value");l.textContent=t;let c=n.createDiv("flashcard-stat-label");c.textContent=A}renderHeatmap(){var e;this.createHeatmap(this.containerEl,((e=this.fsrsManager.storage)==null?void 0:e.dailyStats)||[])}createHeatmap(e,t){let A=e.createDiv("flashcard-heatmap-grid"),i=new Date;new Date(i).setDate(i.getDate()-83);let l=new Map,c=new Date(i);c.setHours(0,0,0,0);let d=c.getTime(),g=`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`,p=!1;[...t].forEach(G=>{let V=new Date(G.date),z=V.getFullYear(),oe=V.getMonth()+1,Oe=V.getDate(),Te=`${z}-${oe}-${Oe}`;Te===g&&(p=!0),l.set(Te,G)}),p||l.set(g,{date:d,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0});let y=7,F=12;A.style.display="grid",A.style.gridTemplateRows=`repeat(${y}, 1fr)`,A.style.gridTemplateColumns=`repeat(${F}, 1fr)`;let Q=i.getDay(),U=Q===0?6:Q-1,b=new Date(i);b.setDate(i.getDate()-((Q===0?7:Q)-1));let k=new Date(b);k.setDate(k.getDate()-11*7);let Ae=[],N=[];for(let G=0;G<F;G++){let V=new Date(k);V.setDate(V.getDate()+G*7),N.push(V)}for(let G=0;G<F;G++){let V=[];for(let z=0;z<y;z++){let oe=new Date(N[G]);oe.setDate(oe.getDate()+z),V.push(oe)}Ae.push(V)}for(let G=0;G<y;G++)for(let V=0;V<F;V++){let z=Ae[V][G],oe=z.getFullYear(),Oe=z.getMonth()+1,Te=z.getDate(),qe=`${oe}-${Oe}-${Te}`,se=l.get(qe),ie=A.createDiv("flashcard-heatmap-cell"),Ne=qe===g;if(se){let Be=se.newCardsLearned*1.5+se.cardsReviewed;if(se.reviewCount>0){let Xe=(se.againCount*1.5+se.hardCount*1.2+se.goodCount+se.easyCount*.8)/se.reviewCount;Be=Be*(Xe+.5)}Be=Math.min(Be,20);let We=Math.ceil(Be/4);ie.addClass(`flashcard-heatmap-level-${We}`);let ze=`${z.toLocaleDateString()}: Learned ${se.newCardsLearned} new cards, reviewed ${se.cardsReviewed} cards`;se.reviewCount>0&&(ze+=`
Rating distribution: Again(${se.againCount}), Hard(${se.hardCount}), Good(${se.goodCount}), Easy(${se.easyCount})`),ie.setAttribute("title",ze)}else Ne||z>i,ie.addClass("flashcard-heatmap-level-0")}}addZoomControl(e,t){}};var Yr=class{constructor(e){this.isMobileView=!1;this.isSmallScreen=!1;this.showingSidebar=!0;this.isInFlashcardMode=!1;this.component=e,this.isMobileView=ue.Platform.isMobile,this.isSmallScreen=window.innerWidth<768,this.showingSidebar=this.isMobileView,this.isInFlashcardMode=!0}renderActivation(){var C;if(!this.component.getIsActive())return;let e=this.component.getContainer();e.empty(),e.addClass("flashcard-mode");let t=e.createEl("div",{cls:"flashcard-activation-container"}),A=t.createEl("div",{cls:"flashcard-activation-header",text:m("Activate HiCard")}),i=t.createEl("div",{cls:"flashcard-activation-description"});i.createEl("span",{text:m("Enter your license key to activate HiCard feature.")+" "}),i.createEl("br"),i.createEl("span",{text:m("Get your license key from")+" "});let l=(((C=window.moment)==null?void 0:C.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",c=i.createEl("a",{text:m("HiNote official website"),cls:"external-link",href:l});c.setAttr("target","_blank"),c.setAttr("rel","noopener noreferrer");let d=t.createEl("div",{cls:"flashcard-activation-input-container"}),g=d.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:m("Enter license key")});d.createEl("button",{cls:"flashcard-activation-button",text:m("Activate")}).addEventListener("click",async()=>{let y=g.value.trim();if(!y){new ue.Notice(m("Please enter a license key"));return}await this.component.getLicenseManager().activateLicense(y)?(new ue.Notice(m("HiCard activated successfully!")),this.render()):new ue.Notice(m("Invalid license key"))})}toggleSidebar(){this.showingSidebar=!this.showingSidebar,this.render()}isShowingSidebar(){return this.showingSidebar}showSidebar(){this.showingSidebar=!0;let e=this.component.getContainer();this.isMobileView&&this.isSmallScreen&&(e.addClass("show-sidebar"),e.removeClass("show-content")),this.render()}goBack(){this.isMobileView&&this.isSmallScreen&&(this.showingSidebar?this.component&&this.component.commentView&&(this.component.commentView.isFlashcardMode=!1,this.component.commentView.isShowingFileList=!0,this.component.commentView.updateViewLayout()):(this.showingSidebar=!0,this.render()))}render(){if(!this.component.getIsActive())return;let e=this.component.getContainer();if(e.empty(),e.addClass("flashcard-mode"),this.isMobileView&&(e.addClass("is-mobile"),this.isSmallScreen&&e.addClass("is-small-screen"),this.showingSidebar?e.addClass("show-sidebar"):e.addClass("show-content")),!this.isMobileView||this.isMobileView&&!this.showingSidebar){let N=e.createEl("div",{cls:"flashcard-progress-container"});this.component.setProgressContainer(N),this.component.updateProgress()}let t=e.createEl("div",{cls:"flashcard-main-container"}),A=t.createEl("div",{cls:"flashcard-sidebar"}),i=A.createEl("div",{cls:"flashcard-stats-container"});new $r(i,this.component.getFsrsManager()).render();let l=A.createEl("div",{cls:"flashcard-groups"}),d=l.createEl("div",{cls:"flashcard-groups-header"}).createEl("div",{cls:"flashcard-add-group",attr:{"aria-label":m("Add Group")}});(0,ue.setIcon)(d,"plus"),d.addEventListener("click",()=>this.component.getGroupManager().showCreateGroupModal());let g=l.createEl("div",{cls:"flashcard-group-list"});(this.component.getFsrsManager().getCardGroups()||[]).forEach(N=>{let G=g.createEl("div",{cls:`flashcard-group-item ${N.name===this.component.getCurrentGroupName()?"active":""}`}),V=G.createEl("div",{cls:"flashcard-group-item-header"}),z=V.createEl("div",{cls:"flashcard-group-title"}),oe=z.createEl("span",{cls:"flashcard-group-icon"});(0,ue.setIcon)(oe,N.filter.startsWith("#")?"hash":"gallery-horizontal-end"),z.createEl("span",{cls:"flashcard-group-name",text:N.name});let Oe=V.createEl("div",{cls:"flashcard-group-actions"}),Te=Oe.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":m("Edit Group")}});(0,ue.setIcon)(Te,"edit"),Te.addEventListener("click",ie=>{ie.stopPropagation(),this.component.getGroupManager().showEditGroupModal(N)});let qe=Oe.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":m("Delete Group")}});(0,ue.setIcon)(qe,"trash"),qe.addEventListener("click",async ie=>{if(ie.stopPropagation(),confirm(m('Are you sure you want to delete group "')+N.name+m('"?')))try{if(await this.component.getFsrsManager().deleteCardGroup(N.id)){if(this.component.getCurrentGroupName()===N.name){let Be=this.component.getFsrsManager().getCardGroups()||[];Be.length>0?this.component.setCurrentGroupName(Be[0].name):this.component.setCurrentGroupName("")}new ue.Notice(m("Group deleted")),this.render()}else new ue.Notice(m("Delete group failed"))}catch(Ne){console.error("Delete group failed:",Ne),new ue.Notice(m("Delete group failed"))}});let se=this.component.getFsrsManager().getGroupProgress(N.id);if(se){let ie=G.createEl("div",{cls:"flashcard-group-stats"}),Ne=ie.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":m("Due Today")}}),Be=Ne.createEl("span",{cls:"flashcard-stat-icon"});(0,ue.setIcon)(Be,"calendar-clock"),Ne.createEl("span",{text:se.due.toString()});let We=ie.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":m("New Cards")}}),ze=We.createEl("span",{cls:"flashcard-stat-icon"});(0,ue.setIcon)(ze,"sparkle"),We.createEl("span",{text:se.newCards.toString()});let Xe=ie.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":m("Learned")}}),Tt=Xe.createEl("span",{cls:"flashcard-stat-icon"});(0,ue.setIcon)(Tt,"check-small"),Xe.createEl("span",{text:se.learned.toString()})}G.addEventListener("click",()=>{this.component.setGroupCompletionMessage(this.component.getCurrentGroupName(),this.component.getCompletionMessage());let ie={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()};this.component.setCurrentGroupName(N.name),e.querySelectorAll(".flashcard-group-item").forEach(We=>We.classList.remove("active")),G.classList.add("active"),this.component.setCompletionMessage(this.component.getGroupCompletionMessage(N.name)||null),this.component.refreshCardList();let Be=this.component.getGroupProgress(N.name);Be&&!this.component.getCompletionMessage()?(this.component.setCurrentIndex(Be.currentIndex),this.component.setCardFlipped(Be.isFlipped)):(this.component.setCurrentIndex(0),this.component.setCardFlipped(!1)),this.isMobileView&&(this.showingSidebar=!1),this.component.saveState(),this.render()})});let y=t.createEl("div",{cls:"flashcard-content-area"}).createEl("div",{cls:"flashcard-container"}),F=this.component.getCards(),Q=this.component.getCurrentIndex(),U=F.length>0&&Q<F.length?F[Q]:null,b=this.component.getCurrentGroupName(),k=this.component.getGroupCompletionMessage(b),Ae=this.component.getFsrsManager().getCardGroups().length>0;if(!Ae||F.length===0){let N=this.component.getFsrsManager().getCardGroups().find(V=>V.name===b),G=N&&N.cardIds.length===0;if(Ae)if(G){let V=y.createEl("div",{cls:"flashcard-completion-message flashcard-empty-group"}),z=V.createEl("div",{cls:"completion-icon"});(0,ue.setIcon)(z,"circle-slash-2"),V.createEl("h3",{text:m("No Cards in This Group")}),V.createEl("p",{text:m("This group doesn't contain any flashcards yet. Add some flashcards to this group to start learning.")})}else{let V=y.createEl("div",{cls:"flashcard-completion-message"}),z=V.createEl("div",{cls:"completion-icon"});(0,ue.setIcon)(z,"check-circle"),V.createEl("h3",{text:m("Learning Completed!")});let oe=k;oe||(N?oe=m("Group completed: ")+N.name+m(". All cards have been reviewed."):oe=m("All flashcards completed for today!"),this.component.setGroupCompletionMessage(b,oe)),V.createEl("p",{text:oe})}else{let V=y.createEl("div",{cls:"flashcard-completion-message flashcard-no-group"}),z=V.createEl("div",{cls:"completion-icon"});(0,ue.setIcon)(z,"folder-plus"),V.createEl("h3",{text:m("No Flashcard Groups")}),V.createEl("p",{text:m("You haven't created any flashcard groups yet. Create a group to get started with your flashcards.")}),V.createEl("button",{cls:"mod-cta",text:m("Create Flashcard Group")}).addEventListener("click",()=>{this.component&&this.component.groupManager?this.component.groupManager.showCreateGroupModal():console.error("Group manager is not available")})}return}if(U){let N=["flashcard"];this.component.isCardFlipped()&&N.push("is-flipped");let G=y.createEl("div",{cls:N.join(" ")}),oe=this.component.getFsrsManager().getCardGroups().filter(Qe=>this.component.getFsrsManager().getCardsInGroup(Qe).some(de=>de.id===(U==null?void 0:U.id))).some(Qe=>Qe.isReversed),Oe=oe?U.answer:U.text,Te=oe?U.text:U.answer,se=G.createEl("div",{cls:"flashcard-side flashcard-front"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(se,Oe,U.filePath);let Ne=G.createEl("div",{cls:"flashcard-side flashcard-back"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(Ne,Te,U.filePath),G.addEventListener("click",()=>this.component.flipCard());let Be=y.createEl("div",{cls:"flashcard-rating"}),We=U?this.component.getFsrsManager().getCardPredictions(U.id):null;this.component.getRatingButtons().forEach(Qe=>{let st=Be.createEl("button",{cls:"flashcard-rating-button",attr:{"data-rating":Qe.ratingText,title:`${Qe.label} (${Qe.key})`}});if(st.createSpan({text:Qe.label}),We&&We[Qe.rating]){let de=new Date(We[Qe.rating].nextReview),Le=new Date,Me=de.getTime()-Le.getTime(),Ze=st.createSpan({cls:"prediction-info"}),we="";if(Me<60*60*1e3)we=`${Math.max(1,Math.round(Me/6e4))}m`;else if(Me<24*60*60*1e3)we=`${Math.round(Me/36e5)}h`;else{let Pe=Math.round(Me/864e5);Pe<1?we=`${Math.round(Pe*24)}h`:Pe<30?we=`${Math.round(Pe)}d`:Pe<365?we=`${Math.round(Pe/30)}mo`:we=`${Math.round(Pe/365)}y`}Ze.createSpan({text:we,cls:"days"})}else{let de=0,Le=(U==null?void 0:U.reviews)===0,Me=(U==null?void 0:U.lapses)>0;switch(Qe.rating){case le.AGAIN:de=Le?.25:Me?.5:1;break;case le.HARD:de=Le?24:Me?36:48;break;case le.GOOD:de=Le?24*3:Me?24*5:24*7;break;case le.EASY:de=Le?24*5:Me?24*9:24*14;break}let Ze=de/24,we="";de<1?we=`${Math.round(de*60)}m`:de<24?we=`${Math.round(de)}h`:Ze<1?we=`${Math.round(Ze*24)}h`:Ze<30?we=`${Math.round(Ze)}d`:Ze<365?we=`${Math.round(Ze/30)}mo`:we=`${Math.round(Ze/365)}y`,st.createSpan({text:we,cls:"days"})}st.addEventListener("click",de=>{de.stopPropagation(),this.component.rateCard(Qe.rating)})}),this.component.isCardFlipped()&&G.classList.add("is-flipped");let ze=this.component.getCurrentGroupId(),Xe=F.length,Tt=this.component.getFsrsManager(),He=(ze?Tt.getCardsForStudy(ze):[]).length,$t=Math.max(He,Xe),Yt=$t-Xe+1;if(y.createEl("div",{cls:"flashcard-counter",text:`${Yt}/${$t}`}),U.filePath){let st=y.createEl("div",{cls:"flashcard-source"}).createEl("span",{text:U.filePath.split("/").pop()||""});this.component.getUtils().addPagePreview(st,U.filePath),st.addEventListener("click",de=>{de.stopPropagation();let Le=this.component.getApp().vault.getAbstractFileByPath(U.filePath);Le&&Le instanceof ue.TFile&&this.component.getApp().workspace.getLeaf().openFile(Le)})}}else y.createEl("div",{cls:"flashcard-empty-state",text:m("No cards available")})}async renderMarkdownContent(e,t,A){for(;e.firstChild;)e.removeChild(e.firstChild);if(!t){console.warn("renderMarkdownContent: content is empty or undefined"),e.textContent="Add answer";return}let i=e.closest(".flashcard-front")!==null,n=t;i?n=t.replace(/\{\{([^{}]+)\}\}/g,(l,c)=>{let g=c.split("").reduce((C,y)=>{let F=/[\u4e00-\u9fa5]/.test(y);return C+(F?3:1)},0);return c.length>5&&(g=Math.floor(g*1.2)),"_".repeat(Math.max(8,g))}):n=t.replace(/\{\{([^{}]+)\}\}/g,"$1");try{await ue.MarkdownRenderer.render(this.component.getApp(),n,e,A||"",new ue.Component),e.querySelectorAll("ul, ol").forEach(c=>{c.addClass("flashcard-markdown-list")}),i&&e.querySelectorAll("p").forEach(d=>{d.textContent&&d.textContent.includes("______")&&d.addClass("flashcard-cloze")})}catch(l){console.error("Error rendering markdown in flashcard:",l),e.textContent=n}}};W();var qr=class{constructor(e){this.component=e}flipCard(){let e=!this.component.isCardFlipped();this.component.setCardFlipped(e);let t=document.querySelector(".flashcard");t&&(e?t.classList.add("is-flipped"):t.classList.remove("is-flipped")),this.component.saveState()}nextCard(){let e=this.component.getCards();if(e.length===0)return;let t=this.component.getCurrentIndex()+1;t>=e.length&&(t=0),this.component.setCurrentIndex(t),this.component.setCardFlipped(!1),this.component.saveState(),this.component.getRenderer().render()}rateCard(e){let t=this.component.getCards(),A=this.component.getCurrentIndex();if(t.length===0||A>=t.length)return;let i=t[A];if(i){if(this.component.getFsrsManager().trackStudyProgress(i.id,e),t.splice(A,1),t.length===0){let n=this.component.getCurrentGroupName(),l=m("No cards due for review");if(n){let c=this.component.getFsrsManager().getCardGroups().find(d=>d.name===n);c&&(l=m("Group completed: ")+c.name+m(". Add more cards in Settings, but remember: more cards = more reviews."))}else l=m("All flashcards completed for today!");this.component.setGroupCompletionMessage(n,l),this.component.updateProgress(),this.component.getRenderer().render();return}A>=t.length&&this.component.setCurrentIndex(0),this.component.setCardFlipped(!1),this.component.saveState(),this.component.updateProgress(),this.component.getRenderer().render()}}refreshCardList(){let e=this.component.getCurrentGroupName(),t=this.component.getFsrsManager(),A=this.component.getCards(),i=this.component.getCurrentGroupName();if(A.length>0&&i&&i!==e){let y=this.component.getCards(),F=this.component.getCurrentIndex(),Q=y.length>0&&F<y.length?y[F].id:void 0,U={currentIndex:F,isFlipped:this.component.isCardFlipped(),currentCardId:Q},b=t.getUIState();b.groupProgress||(b.groupProgress={}),b.groupProgress[i]=U,t.updateUIState(b)}let n=t.getCardGroups().find(y=>y.name===e);if(!n){console.error(`\u672A\u627E\u5230\u540D\u79F0\u4E3A ${e} \u7684\u5206\u7EC4`);return}let l=t.getCardsByGroupId(n.id),c=t.fsrsService,d=l.filter(y=>!!(y.reviews===0&&y.lastReview===0||c.isDue(y)));if(d.length===0){let y=m("No cards due for review");e?y=m("Group completed: ")+n.name+m(". Add more cards in Settings, but remember: more cards = more reviews."):y=m("All flashcards completed for today!"),this.component.setGroupCompletionMessage(e,y),this.component.setCards([]),this.component.updateProgress();let F=t.getUIState();F.groupProgress||(F.groupProgress={}),F.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:null,completionMessage:y},t.updateUIState(F),this.component.getRenderer().render(),this.component.saveState();return}let g=d,p=this.component.getGroupProgress(e),C=t.getUIState();if(C.groupProgress||(C.groupProgress={}),C.groupProgress[e]?C.groupProgress[e].completionMessage=void 0:C.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0},t.updateUIState(C),this.component.setCards(g),g.length>0)if(p){let y=0;if(p.currentCardId){let F=g.findIndex(Q=>Q.id===p.currentCardId);F!==-1?y=F:y=Math.min(p.currentIndex,g.length-1)}else y=Math.min(p.currentIndex,g.length-1);this.component.setCurrentIndex(y),this.component.setCardFlipped(p.isFlipped)}else this.component.setCurrentIndex(0),this.component.setCardFlipped(!1);else{let y=m("No cards due for review");if(e){let F=t.getCardGroups().find(Q=>Q.name===e);F&&(y=m("Group completed: ")+F.name+m(". Add more cards in Settings, but remember: more cards = more reviews."))}else y=m("All flashcards completed for today!");this.component.setGroupCompletionMessage(e,y)}this.component.saveState()}};var xi=require("obsidian");W();var zr=class{constructor(e){this.component=e}showCreateGroupModal(){this.showEditGroupModal()}showEditGroupModal(e){var we,Pe,li;let{app:t}=this.component.getApp(),A=document.createElement("div");A.className="flashcard-modal-overlay",document.body.appendChild(A);let i=document.createElement("div");i.className="flashcard-modal-container",A.appendChild(i);let n=document.createElement("div");n.className="flashcard-modal-content",i.appendChild(n);let l=document.createElement("div");l.className="flashcard-modal-header",n.appendChild(l);let c=document.createElement("h3");c.textContent=e?m("Edit group"):m("Create group"),l.appendChild(c);let d=document.createElement("div");d.className="flashcard-group-form",n.appendChild(d);let g=e?e.name:"",p=document.createElement("input");p.type="text",p.className="flashcard-modal-input",p.placeholder=m("Enter name"),p.value=g,d.appendChild(p),p.addEventListener("input",Ce=>{g=Ce.target.value});let C=e?e.filter:"",y=document.createElement("textarea");y.className="flashcard-modal-input",y.placeholder=m(`Support format: 
Folder: folder1, folder1/folder2
Note: [[note1]], [[note2]]`),y.value=C,d.appendChild(y),y.addEventListener("input",Ce=>{C=Ce.target.value});let F=e&&e.isReversed||!1,Q=document.createElement("div");Q.className="flashcard-modal-option",d.appendChild(Q);let U=document.createElement("input");U.type="checkbox",U.className="flashcard-modal-checkbox",U.checked=F,Q.appendChild(U);let b=document.createElement("label");b.textContent=m("Reverse cards (use comments as questions)"),b.className="flashcard-modal-label",Q.appendChild(b),U.addEventListener("change",Ce=>{F=Ce.target.checked});let k=document.createElement("div");k.className="flashcard-modal-settings",d.appendChild(k);let Ae=document.createElement("div");Ae.className="flashcard-modal-settings-header",k.appendChild(Ae);let N=document.createElement("h4");N.textContent=m("Learning settings"),N.className="settings-title",Ae.appendChild(N);let G=e?((we=e.settings)==null?void 0:we.useGlobalSettings)!==!1:!0,V=document.createElement("div");V.className="flashcard-modal-option use-global-option",Ae.appendChild(V);let z=document.createElement("input");z.type="checkbox",z.className="flashcard-modal-checkbox",z.id="use-global-settings",z.checked=G,V.appendChild(z);let oe=document.createElement("label");oe.textContent=m("Use global settings"),oe.className="flashcard-modal-label",oe.htmlFor="use-global-settings",V.appendChild(oe),z.addEventListener("change",Ce=>{G=Ce.target.checked,st()});let Oe=e&&((Pe=e.settings)==null?void 0:Pe.newCardsPerDay)||20,Te=document.createElement("div");Te.className="flashcard-modal-option slider-option",k.appendChild(Te);let qe=document.createElement("label");qe.textContent=m("New cards per day: "),qe.className="flashcard-modal-label",Te.appendChild(qe);let se=document.createElement("div");se.className="slider-with-value",Te.appendChild(se);let ie=document.createElement("input");ie.className="flashcard-modal-slider",ie.type="range",ie.min="5",ie.max="100",ie.step="5",ie.value=String(Oe);let Ne=parseInt(ie.value);Ne<5?ie.value="5":Ne%5!==0&&(ie.value=(Math.round(Ne/5)*5).toString()),se.appendChild(ie);let Be=document.createElement("span");Be.className="slider-value",Be.textContent=ie.value,se.appendChild(Be),ie.addEventListener("input",()=>{Oe=parseInt(ie.value),Be.textContent=ie.value});let We={setDisabled:Ce=>{ie.disabled=Ce,Te.classList.toggle("disabled",Ce)}},ze=e&&((li=e.settings)==null?void 0:li.reviewsPerDay)||100,Xe=document.createElement("div");Xe.className="flashcard-modal-option slider-option",k.appendChild(Xe);let Tt=document.createElement("label");Tt.textContent=m("Reviews per day: "),Tt.className="flashcard-modal-label",Xe.appendChild(Tt);let Jt=document.createElement("div");Jt.className="slider-with-value",Xe.appendChild(Jt);let He=document.createElement("input");He.className="flashcard-modal-slider",He.type="range",He.min="10",He.max="500",He.step="10",He.value=String(ze);let $t=parseInt(He.value);$t<10?He.value="10":$t%10!==0&&(He.value=(Math.round($t/10)*10).toString()),Jt.appendChild(He);let Yt=document.createElement("span");Yt.className="slider-value",Yt.textContent=He.value,Jt.appendChild(Yt),He.addEventListener("input",()=>{ze=parseInt(He.value),Yt.textContent=He.value});let Qe={setDisabled:Ce=>{He.disabled=Ce,Xe.classList.toggle("disabled",Ce)}},st=()=>{G?(We.setDisabled(!0),Qe.setDisabled(!0)):(We.setDisabled(!1),Qe.setDisabled(!1))};st();let de=document.createElement("div");de.className="button-container",n.appendChild(de);let Le=document.createElement("button");Le.className="flashcard-cancel-btn",Le.textContent=m("Cancel"),de.appendChild(Le);let Me=document.createElement("button");Me.className="flashcard-save-group-btn",Me.textContent=e?m("Save"):m("Create"),de.appendChild(Me),Me.addEventListener("click",async()=>{if(!g){new xi.Notice(m("Group name cannot be empty"));return}let Ce=this.component.getFsrsManager();if(e){let Bt=e.name;try{await Ce.updateCardGroup(e.id,{name:g,filter:C,isReversed:F,settings:{useGlobalSettings:G,newCardsPerDay:G?void 0:Oe,reviewsPerDay:G?void 0:ze},lastUpdated:Date.now()});let Se=Ce.storage;Se&&Se.uiState&&(Se.uiState.groupCompletionMessages&&Se.uiState.groupCompletionMessages[Bt]!==void 0&&(Se.uiState.groupCompletionMessages[g]=Se.uiState.groupCompletionMessages[Bt],delete Se.uiState.groupCompletionMessages[Bt]),Se.uiState.groupProgress&&Se.uiState.groupProgress[Bt]&&(Se.uiState.groupProgress[g]=Se.uiState.groupProgress[Bt],delete Se.uiState.groupProgress[Bt]),Se.uiState.currentGroupName===Bt&&(Se.uiState.currentGroupName=g),await Ce.saveStoragePublic()),this.component.getCurrentGroupName()===Bt&&this.component.setCurrentGroupName(g),this.component.refreshCardList(),this.component.getRenderer().render(),new xi.Notice(m("Group update successful"))}catch(Se){console.error("Update group failed:",Se),new xi.Notice(m("Update group failed"))}}else await Ce.createCardGroup({name:g,filter:C,isReversed:F,createdTime:Date.now(),sortOrder:Ce.getCardGroups().length,settings:{useGlobalSettings:G,newCardsPerDay:G?void 0:Oe,reviewsPerDay:G?void 0:ze}}),new xi.Notice(m("Group created")),this.component.refreshCardList(),this.component.getRenderer().render();document.body.removeChild(A),e&&this.component.getRenderer().render()});let Ze=Ce=>{Ce.key==="Escape"&&(document.body.removeChild(A),document.removeEventListener("keydown",Ze))};document.addEventListener("keydown",Ze),Le.addEventListener("click",()=>{document.body.removeChild(A),e&&this.component.getRenderer().render()})}};W();var Xl=require("obsidian"),Zr=class{constructor(e){this.component=e}getGroupProgress(){let e=this.component.getCurrentGroupId(),t=[];e?t=this.component.getFsrsManager().getCardsByGroupId(e):t=(()=>{let d=this.component.getFsrsManager(),g=d.getCardGroups(),p=[],C=new Set;return g.forEach(y=>{d.getCardsByGroupId(y.id).forEach(Q=>{C.has(Q.id)||(C.add(Q.id),p.push(Q))})}),p})();let i=t.filter(d=>this.component.getFsrsManager().fsrsService.isDue(d)).length,n=t.filter(d=>d.reviews===0).length,l=t.filter(d=>d.reviews>0).length,c=this.calculateRetention(t);return{due:i,newCards:n,learned:l,retention:c}}calculateRetention(e){let t=e.filter(i=>i.reviews>0);return t.length===0?1:t.reduce((i,n)=>i+n.retrievability,0)/t.length}updateProgress(){let e=this.component.getProgressContainer();if(!e)return;e.empty();let t=this.getGroupProgress(),A=e.createEl("div",{cls:"flashcard-progress-text"});A.createSpan({text:this.component.getCurrentGroupName()||m("Groups"),cls:"group-name"}),A.createSpan({text:"|",cls:"separator"}),[{label:m("Due"),value:t.due},{label:m("New"),value:t.newCards},{label:m("Learned"),value:t.learned},{label:m("Retention"),value:`${(t.retention*100).toFixed(1)}%`}].forEach((b,k)=>{k>0&&A.createSpan({text:"|",cls:"separator"});let Ae=A.createEl("div",{cls:"stat"});if(Ae.createSpan({text:b.label+": "}),Ae.createSpan({text:b.value.toString(),cls:"stat-value"}),b.label===m("Retention")){let N=Ae.createSpan({cls:"help-icon"});(0,Xl.setIcon)(N,"help-circle"),N.setAttribute("aria-label",m(`Retention = (Total Reviews - Forget Count) / Total Reviews
This metric reflects your learning effectiveness, higher means better memory retention`))}});let l=e.createEl("div",{cls:"flashcard-progress-bar-container"}).createEl("div",{cls:"flashcard-progress-bar"}),c=t.due+t.newCards,d=this.component.getCards().length,g=c>0?Math.round((c-d)/c*100):100;if(l.style.width=`${g}%`,this.component.getCurrentGroupName()){let b=this.component.getFsrsManager().getCardGroups().find(k=>k.id===this.component.getCurrentGroupName());if(b){let k=e.createEl("div",{cls:"flashcard-group-name-container"});k.createEl("div",{cls:"flashcard-group-name",text:b.name}),b.filter&&k.createEl("div",{cls:"flashcard-group-filter",text:m("Filter")+": "+b.filter})}}let p=e.createEl("div",{cls:"flashcard-index-container"}),C=this.component.getCurrentGroupId(),y=this.component.getCards().length,F=this.component.getFsrsManager(),U=(C?F.getCardsForStudy(C):[]).length;if(U>0||y>0){let b=Math.max(U,y),k=b-y+1;y>0?p.textContent=`${k}/${b}`:p.textContent=`${b}/${b}`}else p.textContent="0/0"}saveState(){let e=this.component.getCurrentGroupName(),t=this.component.getFsrsManager().getUIState();t.currentGroupName=e,t.currentIndex=this.component.getCurrentIndex(),t.isFlipped=this.component.isCardFlipped(),t.completionMessage=this.component.getCompletionMessage(),t.groupProgress||(t.groupProgress={}),t.groupProgress[e]={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()},t.groupCompletionMessages||(t.groupCompletionMessages={}),t.groupCompletionMessages[e]=this.component.getGroupCompletionMessage(e),this.component.getFsrsManager().updateUIState(t)}};var jr=class{constructor(e){this.component=e}addPagePreview(e,t){if(!t)return;let A;e.addEventListener("mouseenter",i=>{A=setTimeout(()=>{let n=i.target;this.component.getApp().workspace.trigger("hover-link",{event:i,source:"hi-note",hoverParent:n,targetEl:n,linktext:t})},300)}),e.addEventListener("mouseleave",()=>{A&&clearTimeout(A)})}};var VA=class extends Jl.Component{constructor(t,A){super();this.progressContainer=null;this.currentIndex=0;this.isFlipped=!1;this.cards=[];this.isActive=!1;this.currentCard=null;this.currentGroupName="";this.currentGroupId="";this.completionMessage=null;this.groupProgress={};this.ratingButtons=[{label:m("Again"),rating:le.AGAIN,key:"1",ratingText:"again"},{label:m("Hard"),rating:le.HARD,key:"2",ratingText:"hard"},{label:m("Good"),rating:le.GOOD,key:"3",ratingText:"good"},{label:m("Easy"),rating:le.EASY,key:"4",ratingText:"easy"}];this.container=t,this.app=A.app,this.fsrsManager=A.fsrsManager,this.renderer=new Yr(this),this.operations=new qr(this),this.groupManager=new zr(this),this.progressManager=new Zr(this),this.utils=new jr(this),this.groupProgress={};let i=this.fsrsManager.getUIState()||{};if(this.currentGroupName=i.currentGroupName||"",this.currentGroupName){let n=this.fsrsManager.getCardGroups().find(l=>l.name===this.currentGroupName);n?this.currentGroupId=n.id:this.currentGroupId=""}else this.currentGroupId="";this.completionMessage=i.completionMessage||null,i.groupProgress&&(this.groupProgress={...i.groupProgress}),this.currentGroupName&&this.groupProgress[this.currentGroupName]?(this.currentIndex=this.groupProgress[this.currentGroupName].currentIndex||0,this.isFlipped=this.groupProgress[this.currentGroupName].isFlipped||!1):(this.currentIndex=0,this.isFlipped=!1),(!i||!i.groupProgress||typeof i.groupProgress!="object")&&(this.groupProgress={}),i&&"groupProgress"in i&&i.groupProgress&&typeof i.groupProgress=="object"?this.groupProgress={...i.groupProgress}:this.groupProgress={}}setLicenseManager(t){this.licenseManager=t}setCards(t){this.cards=t}cleanup(){}async activate(){if(this.isActive=!0,this.licenseManager){let t=await this.licenseManager.isActivated(),A=t?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(t&&A){this.operations.refreshCardList(),this.renderer.render();return}}this.renderer.renderActivation()}renderActivation(){this.renderer.renderActivation()}deactivate(){this.isActive=!1,this.container.empty(),this.container.removeClass("flashcard-mode")}destroy(){this.container.removeClass("flashcard-mode"),this.container.empty()}getContainer(){return this.container}getIsActive(){return this.isActive}getApp(){return this.app}getFsrsManager(){return this.fsrsManager}getLicenseManager(){return this.licenseManager}getCards(){return this.cards}getCurrentIndex(){return this.currentIndex}setCurrentIndex(t){this.currentIndex=t}isCardFlipped(){return this.isFlipped}setCardFlipped(t){this.isFlipped=t}getCurrentGroupName(){return this.currentGroupName}setCurrentGroupName(t){if(this.currentGroupName=t,t){let A=this.fsrsManager.getCardGroups().find(i=>i.name===t);A?this.currentGroupId=A.id:this.currentGroupId=""}else this.currentGroupId=""}getCurrentGroupId(){return this.currentGroupId}setCurrentGroupId(t){if(this.currentGroupId=t,t){let A=this.fsrsManager.getCardGroups().find(i=>i.id===t);this.currentGroupName=A?A.name:""}else this.currentGroupName=""}getCompletionMessage(){return this.completionMessage}setCompletionMessage(t){this.completionMessage=t}getGroupCompletionMessage(t){return this.groupProgress[t]&&this.groupProgress[t].completionMessage||null}setGroupCompletionMessage(t,A){if(this.groupProgress[t]||(this.groupProgress[t]={currentIndex:0,isFlipped:!1,completionMessage:null}),this.groupProgress[t].completionMessage=A,this.fsrsManager){let i=this.fsrsManager.getUIState();i.groupProgress||(i.groupProgress={}),i.groupProgress[t]||(i.groupProgress[t]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0}),i.groupProgress[t].completionMessage=A,A&&(i.groupProgress[t].isFlipped=!1,i.groupProgress[t].currentCardId=void 0),this.fsrsManager.updateUIState(i)}}getGroupProgress(t){let A=t||this.currentGroupName;return this.groupProgress[A]||null}isComponentActive(){return this.isActive}getProgressContainer(){return this.progressContainer}setProgressContainer(t){this.progressContainer=t}getRatingButtons(){return this.ratingButtons}flipCard(){this.operations.flipCard()}nextCard(){this.operations.nextCard()}rateCard(t){this.operations.rateCard(t)}refreshCardList(){this.operations.refreshCardList()}saveState(){let t=this.getCurrentGroupName(),A=this.fsrsManager.getUIState();if(A.currentGroupName=t,A.completionMessage=this.completionMessage,A.groupProgress||(A.groupProgress={}),t){let i=this.cards.length>0&&this.currentIndex<this.cards.length?this.cards[this.currentIndex].id:void 0,n=this.getGroupCompletionMessage(t);A.groupProgress[t]?(A.groupProgress[t].currentIndex=this.currentIndex,A.groupProgress[t].isFlipped=this.isFlipped,A.groupProgress[t].currentCardId=i,A.groupProgress[t].completionMessage=n):A.groupProgress[t]={currentIndex:this.currentIndex,isFlipped:this.isFlipped,currentCardId:i,completionMessage:n}}this.fsrsManager.updateUIState(A)}updateProgress(){this.progressManager.updateProgress()}getRenderer(){return this.renderer}getOperations(){return this.operations}getGroupManager(){return this.groupManager}getProgressManager(){return this.progressManager}getUtils(){return this.utils}};var Li=require("obsidian");W();var Ti=class extends Li.Component{constructor(t,A,i,n=window.app,l=!1){super();this.highlight=A;this.onHighlightClick=i;this.app=n;this.isInMainView=l;this.render(t).catch(c=>{console.error("Error rendering highlight content:",c)})}async render(t){this.container=t.createEl("div",{cls:"highlight-content"}),await this.renderText()}async renderText(){this.textContainer=this.container.createEl("div",{cls:"highlight-text-container"});let t=this.textContainer.createEl("div",{cls:"highlight-text-decorator"});this.highlight.backgroundColor&&(t.style.backgroundColor=this.highlight.backgroundColor);let i=this.textContainer.createEl("div",{cls:"highlight-text"}).createEl("div",{cls:`highlight-text-content ${this.highlight.isVirtual?"virtual-highlight":""} markdown-rendered`}),n=this.highlight.text||"";try{await Li.MarkdownRenderer.render(this.app,n,i,this.highlight.filePath||"",new Li.Component),i.querySelectorAll("ul, ol").forEach(c=>{c.addClass("highlight-markdown-list")}),await this.activateInternalLinks(i,this.highlight.filePath||"")}catch(l){console.error("Error rendering markdown in highlight:",l);let c=n.split(`
`);c.forEach((d,g)=>{let p=i.createEl("p",{text:d,cls:"highlight-text-line"});g<c.length-1&&p.addClass("highlight-text-line-spacing")})}!this.highlight.isGlobalSearch&&!this.isInMainView?(i.setAttribute("aria-label",m("Jump to highlight")),i.addEventListener("mousedown",async l=>{l.target.closest("a")||(l.preventDefault(),l.stopPropagation(),await this.onHighlightClick(this.highlight))})):(i.addClass("global-search-highlight"),i.removeAttribute("aria-label"),i.style.cursor="default")}async activateInternalLinks(t,A){t.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,A)&&this.app.workspace.openLinkText(c,A,!1)}),l.addEventListener("mouseenter",d=>{this.app.workspace.trigger("hover-link",{event:d,source:"hi-note",hoverParent:t,targetEl:l,linktext:c,sourcePath:A})}))}),t.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}getContainer(){return this.container}};Ti.dragPreview=null;var es=require("obsidian");W();var Pi=class extends es.Component{constructor(t,A,i){super();this.highlight=A;this.onCommentEdit=i;this.app=window.app,this.render(t)}render(t){if((this.highlight.comments||[]).length===0)return;let i=t.createEl("div",{cls:"hi-notes-section"});this.container=i.createEl("div",{cls:"hi-notes-list"}),this.renderComments().catch(n=>{console.error("Error rendering comments:",n)})}async renderComments(){let t=this.highlight.comments||[];for(t.sort((A,i)=>i.updatedAt-A.updatedAt);this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(let A of t){let i=this.container.createEl("div",{cls:"hi-note",attr:{"data-comment-id":A.id}}),n=i.createEl("div",{cls:"hi-note-content-wrapper"}),l=n.createEl("div",{cls:"hi-note-content markdown-rendered"}),c=A.content;try{await es.MarkdownRenderer.renderMarkdown(c,l,this.highlight.filePath||"",this),l.querySelectorAll("ul, ol").forEach(p=>{p.addClass("comment-markdown-list")}),await this.activateInternalLinks(l,this.highlight.filePath||"")}catch(g){console.error("Error rendering markdown in comment:",g),l.textContent=c}l.addEventListener("dblclick",g=>{g.target.closest("a")||(g.stopPropagation(),g.preventDefault(),this.onCommentEdit(A))}),l.addEventListener("click",g=>{g.target.closest("a")||g.stopPropagation()}),requestAnimationFrame(()=>{this.checkAndAddToggleButton(n,l,A)});let d=i.createEl("div",{cls:"hi-note-footer"});d.createEl("div",{text:new Date(A.updatedAt).toLocaleString(),cls:"hi-note-time"}),d.createEl("span",{text:"Double click to edit",cls:"hi-note-edit-hint"}),d.createEl("div",{cls:"hi-note-actions"})}}checkAndAddToggleButton(t,A,i){if(A.scrollHeight>240){t.addClass("has-collapsible-content"),t.addClass("collapsed");let c=t.createEl("div",{cls:"content-fade-out"}),d=t.createEl("div",{cls:"toggle-content-btn"}),g=d.createEl("span",{text:m("Expand")});d.addEventListener("click",p=>{p.stopPropagation(),t.hasClass("collapsed")?(t.removeClass("collapsed"),t.addClass("expanded"),g.textContent=m("Collapse")):(t.addClass("collapsed"),t.removeClass("expanded"),g.textContent=m("Expand"))})}}async activateInternalLinks(t,A){t.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,A)&&this.app.workspace.openLinkText(c,A,!1)}),l.addEventListener("mouseenter",d=>{this.app.workspace.trigger("hover-link",{event:d,source:"hi-note",hoverParent:t,targetEl:l,linktext:c,sourcePath:A})}))}),t.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}};W();var ts=class{constructor(e,t,A){this.parent=e;this.highlight=t;this.onClick=A;this.render()}render(){this.container=this.parent.createEl("div",{cls:"unfocused-comment-input"}),this.container.createEl("div",{cls:"unfocused-input-area",attr:{placeholder:m("Add comment...")}}).addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.onClick()})}remove(){this.container.remove()}hide(){this.container.style.display="none"}};var fe=require("obsidian");var vA=class vA{static start(e,t,A={}){var d;let{showIcon:i=!0,maxLength:n=30}=A;this.clear(),this.instance=document.createElement("div"),this.instance.className="highlight-dragging";let l=document.createElement("div");l.className="highlight-dragging-content";let c=t.length>n?t.slice(0,n)+"...":t;l.textContent=c,this.instance.appendChild(l),document.body.appendChild(this.instance),this.updatePosition(e.clientX,e.clientY),(d=e.dataTransfer)==null||d.setDragImage(this.dragImage,0,0),document.addEventListener("dragover",this.handleDragOver)}static updatePosition(e,t){this.instance&&this.instance.setAttribute("style",`left: ${e+10}px; top: ${t+10}px;`)}static clear(){this.instance&&(this.instance.remove(),this.instance=null),document.removeEventListener("dragover",this.handleDragOver)}};vA.instance=null,vA.dragImage=new Image,vA.dragImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",vA.handleDragOver=e=>{e.preventDefault(),vA.updatePosition(e.clientX,e.clientY)};var Di=vA;W();var $l=require("obsidian"),Ri=class{constructor(e,t){this.highlight=e;this.plugin=t}generateSync(){var t,A,i,n;let e=[];if(this.highlight.isVirtual){let l=((A=(t=this.highlight.filePath)==null?void 0:t.split("/").pop())==null?void 0:A.replace(".md",""))||"File";e.push(`> [!note] [[${l}]]`),e.push("> ")}else{e.push("> [!quote] HiNote");let l=!1;if(this.highlight.blockId){let c=this.highlight.filePath;if(!c){let d=this.plugin.app.workspace.getActiveFile();d&&(c=d.path)}if(c){let d=(i=c.split("/").pop())==null?void 0:i.replace(".md","");if(d){let g=`> ![[${d}#^${this.highlight.blockId}]]`;e.push(g),e.push("> "),l=!0}}}else if(this.highlight.filePath&&typeof this.highlight.position=="number"){let c=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(c instanceof $l.TFile){let d=this.plugin.app.metadataCache.getFileCache(c);if(d!=null&&d.sections){let g=this.highlight.position,p=d.sections.find(C=>C.position.start.offset<=g&&C.position.end.offset>=g);if(p!=null&&p.id){let C=(n=this.highlight.filePath.split("/").pop())==null?void 0:n.replace(".md","");if(C){let y=`> ![[${C}#^${p.id}]]`;e.push(y),e.push("> "),l=!0}}}}}!l&&this.highlight.text&&(e.push(`> ${this.highlight.text}`),e.push("> "))}if(this.highlight.comments&&this.highlight.comments.length>0)for(let l of this.highlight.comments)e.push(...this.formatComment(l,!1));return e.join(`
`)}async generate(){return this.generateSync()}formatComment(e,t){let A=[],i=t?">":">>";if(!t){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";A.push(`>> [!note]+ ${l}`)}let n=e.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return A.push(n),A.push(">"),A}};var Nt=require("obsidian");pt();pt();var Ki=class{constructor(){this.factories=new Map;this.instances=new Map}register(e){let t=e.getProviderType();this.factories.set(t,e)}registerAll(e){e.forEach(t=>this.register(t))}getService(e,t){if(this.instances.has(e)){let n=this.instances.get(e);if(n.isConfigured())return n}let A=this.factories.get(e);if(!A)throw xe.notConfigured(e,`Provider ${e} not registered`);let i=A.create(t);return this.instances.set(e,i),i}isRegistered(e){return this.factories.has(e)}clearCache(e){e?this.instances.delete(e):this.instances.clear()}getRegisteredProviders(){return Array.from(this.factories.keys())}getActiveServices(){return Array.from(this.instances.keys())}};pt();pt();var ki=class extends ot{constructor(e,t="gpt-4o",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:4096};super(i)}getDefaultBaseUrl(){return"https://api.openai.com/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,temperature:this.temperature,max_tokens:this.maxTokens}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Invalid response format from OpenAI API");return e.choices[0].message.content}getProviderType(){return"openai"}async listModels(){return[{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-o1",name:"GPT-o1"},{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"}]}};is();rs();ss();ns();var $A=require("obsidian"),yA=class{constructor(e="http://localhost:11434"){this.retryAttempts=3;this.retryDelay=1e3;!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),this.baseUrl=e.replace(/\/$/,"")}async listModels(){try{await this.ensureConnection();let e=await this.makeRequest({endpoint:"/api/tags",method:"GET"});if(!e||!e.models)throw new Error("Invalid API response format");return e.models.map(t=>t.name)}catch(e){throw this.handleError(e)}}async generateCompletion(e,t){try{await this.ensureConnection();let A=await this.makeRequest({endpoint:"/api/generate",method:"POST",body:JSON.stringify({model:e,prompt:t,stream:!1})});if(!A||!A.response)throw new Error("Invalid API response format");return A.response}catch(A){throw this.handleError(A)}}async pullModel(e){try{new $A.Notice(`Downloading model ${e}...`);let t=await this.makeRequest({endpoint:"/api/pull",method:"POST",body:JSON.stringify({name:e})});if(!t.ok)throw new Error(`Failed to download model: ${t.status}`);new $A.Notice(`Model ${e} downloaded successfully`)}catch(t){throw new Error(`Failed to download model: ${t.message}`)}}async chat(e,t){var A;try{await this.ensureConnection();let i=await this.makeRequest({endpoint:"/api/chat",method:"POST",body:JSON.stringify({model:e,messages:t,stream:!1})});if(!i||!((A=i.message)!=null&&A.content))throw new Error("Invalid API response format");return i.message.content}catch(i){throw this.handleError(i)}}async ensureConnection(){if(!this.baseUrl)throw new Error("Ollama service not configured. Please set the host in settings.");if(!await this.testConnection())throw new Error("Unable to connect to Ollama service. Please ensure the service is running.")}async testConnection(){if(!this.baseUrl)return!1;try{let e=await this.makeRequest({endpoint:"/api/version",method:"GET"});return!!(e!=null&&e.version)}catch(e){return!1}}async makeRequest(e){let t=null;for(let A=1;A<=this.retryAttempts;A++)try{let i=new URL(e.endpoint,this.baseUrl).toString(),n=await(0,$A.requestUrl)({url:i,method:e.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:e.body,throw:!1});if(n.status===200)try{return n.text?JSON.parse(n.text):{}}catch(c){throw new Error("Invalid JSON response from server")}let l=`HTTP error! status: ${n.status}`;try{let c=JSON.parse(n.text);c.error&&(l=c.error)}catch(c){n.text&&(l=n.text)}throw new Error(l)}catch(i){if(t=i,A<this.retryAttempts){await this.delay(this.retryDelay*A);continue}break}throw t}handleError(e){return e.message.includes("ECONNREFUSED")?(new $A.Notice("Ollama service is not running. Please start the service."),new Error("Unable to connect to Ollama service. Please ensure the service is running.")):e instanceof TypeError&&e.message.includes("Invalid URL")?new Error(`Invalid Ollama service URL: ${this.baseUrl}`):e}delay(e){return new Promise(t=>setTimeout(t,e))}};as();var Oi=class{getProviderType(){return"openai"}supports(e){return e==="openai"}create(e){var t;if(!((t=e.openai)!=null&&t.apiKey))throw xe.notConfigured("openai","API key not configured");return new ki(e.openai.apiKey,e.openai.model||"gpt-4o",e.openai.baseUrl)}},Ni=class{getProviderType(){return"anthropic"}supports(e){return e==="anthropic"}create(e){var t;if(!((t=e.anthropic)!=null&&t.apiKey))throw xe.notConfigured("anthropic","API key not configured");return new _A(e.anthropic.apiKey,e.anthropic.apiAddress,e.anthropic.model)}},Gi=class{getProviderType(){return"gemini"}supports(e){return e==="gemini"}create(e){var t;if(!((t=e.gemini)!=null&&t.apiKey))throw xe.notConfigured("gemini","API key not configured");return new WA(e.gemini.apiKey,e.gemini.model||"gemini-2.5-flash",e.gemini.baseUrl)}},Vi=class{getProviderType(){return"deepseek"}supports(e){return e==="deepseek"}create(e){var t;if(!((t=e.deepseek)!=null&&t.apiKey))throw xe.notConfigured("deepseek","API key not configured");return new XA(e.deepseek.apiKey,e.deepseek.model||"deepseek-chat",e.deepseek.baseUrl)}},_i=class{getProviderType(){return"siliconflow"}supports(e){return e==="siliconflow"}create(e){var t;if(!((t=e.siliconflow)!=null&&t.apiKey))throw xe.notConfigured("siliconflow","API key not configured");return new JA(e)}},Wi=class{getProviderType(){return"ollama"}supports(e){return e==="ollama"}create(e){var t;if(!((t=e.ollama)!=null&&t.host))throw xe.notConfigured("ollama","Host not configured");return new ya(e.ollama.host,e.ollama.model||"")}},Xi=class{getProviderType(){return"custom"}supports(e){return e==="custom"}create(e){var t,A,i;if(!((t=e.custom)!=null&&t.apiKey)||!((A=e.custom)!=null&&A.baseUrl)||!((i=e.custom)!=null&&i.model))throw xe.notConfigured("custom","API key, base URL, or model not configured");return new YA(e.custom.apiKey,e.custom.baseUrl,e.custom.model,e.custom.headers,e.custom.detectedApiType)}},ya=class{constructor(e,t){this.service=new yA(e),this.model=t}async chat(e){if(!this.model)throw xe.notConfigured("ollama","Model not configured");return await this.service.chat(this.model,e)}async generateResponse(e){if(!this.model)throw xe.notConfigured("ollama","Model not configured");return await this.service.generateCompletion(this.model,e)}async testConnection(){return await this.service.testConnection()}updateModel(e){this.model=e}async listModels(){return(await this.service.listModels()).map(t=>({id:t,name:t}))}getProviderType(){return"ollama"}isConfigured(){return!!this.model}};var Ot=class{constructor(e){this.settings=e,this.registry=new Ki,this.currentProvider=this.parseProvider(e.provider),this.registerAllServices()}registerAllServices(){this.registry.register(new Oi),this.registry.register(new Ni),this.registry.register(new Gi),this.registry.register(new Vi),this.registry.register(new _i),this.registry.register(new Wi),this.registry.register(new Xi)}getCurrentService(){return this.registry.getService(this.currentProvider,this.settings)}async generateResponse(e,t,A){let i=this.processPrompt(e,t,A);return await this.getCurrentService().generateResponse(i)}async chat(e){return await this.getCurrentService().chat(e)}async testConnection(e){let t=e||this.currentProvider;try{return await this.registry.getService(t,this.settings).testConnection()}catch(A){return!1}}updateModel(e,t){switch(this.registry.clearCache(e),e){case"openai":this.settings.openai&&(this.settings.openai.model=t);break;case"anthropic":this.settings.anthropic&&(this.settings.anthropic.model=t);break;case"gemini":this.settings.gemini&&(this.settings.gemini.model=t);break;case"deepseek":this.settings.deepseek&&(this.settings.deepseek.model=t);break;case"siliconflow":this.settings.siliconflow&&(this.settings.siliconflow.model=t);break;case"ollama":this.settings.ollama&&(this.settings.ollama.model=t);break;case"custom":this.settings.custom&&(this.settings.custom.model=t);break}}async listModels(e){let t=e||this.currentProvider;try{return await this.registry.getService(t,this.settings).listModels()}catch(A){return console.error(`Failed to list models for ${t}:`,A),[]}}switchProvider(e){this.currentProvider=e,this.settings.provider=e}getCurrentProvider(){return this.currentProvider}getRegisteredProviders(){return this.registry.getRegisteredProviders()}processPrompt(e,t,A){let i=e,n=e.includes("{{highlight}}"),l=e.includes("{{comment}}");return n&&(i=i.replace(/\{\{highlight\}\}/g,t)),l&&A&&(i=i.replace(/\{\{comment\}\}/g,A)),!n&&t&&(i=`${i}

${t}`),i}parseProvider(e){return{openai:"openai",anthropic:"anthropic",gemini:"gemini",deepseek:"deepseek",siliconflow:"siliconflow",ollama:"ollama",custom:"custom"}[e]||"openai"}updateSettings(e){this.settings=e,this.currentProvider=this.parseProvider(e.provider),this.registry.clearCache()}};pt();As();var St=require("obsidian");W();var te=class{static async testConnection(e,t){let A=new St.Notice(`\u23F3 ${m("Testing")} ${t} ${m("connection")}...`,0);try{let i=await e.testConnection();return A.hide(),i?new St.Notice(`\u2713 ${t} ${m("connection successful!")}`,3e3):new St.Notice(`\u2717 ${t} ${m("connection failed. Please check your configuration.")}`,5e3),i}catch(i){A.hide();let n=this.getErrorMessage(i);return new St.Notice(`\u2717 ${t} ${m("test failed")}: ${n}`,5e3),console.error(`${t} connection test error:`,i),!1}}static checkApiKey(e,t){return!e||e.trim()===""?(new St.Notice(`\u26A0\uFE0F ${m("Please enter your")} ${t} ${m("API Key first.")}`,4e3),!1):!0}static checkHost(e,t){return!e||e.trim()===""?(new St.Notice(`\u26A0\uFE0F ${m("Please enter your")} ${t} ${m("host address first.")}`,4e3),!1):!0}static getErrorMessage(e){let t=(e==null?void 0:e.message)||String(e);return t.includes("401")||t.includes("Unauthorized")?m("Invalid API Key"):t.includes("403")||t.includes("Forbidden")?m("Access denied"):t.includes("429")||t.includes("rate limit")?m("Rate limit exceeded"):t.includes("timeout")||t.includes("ETIMEDOUT")?m("Connection timeout"):t.includes("ECONNREFUSED")||t.includes("ENOTFOUND")?m("Service unavailable"):t.includes("404")||t.includes("Not Found")?m("Service not found"):t.includes("500")||t.includes("Internal Server Error")?m("Server error"):t.length>100?t.substring(0,100)+"...":t}static showSuccess(e){new St.Notice(`\u2713 ${e}`,3e3)}static showError(e){new St.Notice(`\u2717 ${e}`,5e3)}static showWarning(e){new St.Notice(`\u26A0\uFE0F ${e}`,4e3)}};pt();is();rs();ss();ns();as();W();var os=class{constructor(e,t,A,i){var c;this.plugin=A,this.container=e,this.contentProvider=t,this.options={...i},this.initButton();let n=(c=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:c.view,l=n instanceof lt?n:null;l!=null&&l.registerAIButton&&l.registerAIButton(this)}destroy(){var A;document.removeEventListener("click",this.boundClickHandler);let e=(A=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:A.view,t=e instanceof lt?e:null;t!=null&&t.unregisterAIButton&&t.unregisterAIButton(this)}initButton(){let e=this.container.createEl("div",{cls:"highlight-ai-container"});this.options.position&&e.addClass(`highlight-ai-container-${this.options.position}`);let t=e.createEl("div",{cls:this.options.buttonClass,attr:{"aria-label":this.options.buttonLabel}});(0,Nt.setIcon)(t,this.options.buttonIcon),t.addEventListener("click",A=>{A.stopPropagation(),this.toggleDropdown()}),this.aiButton=t}toggleDropdown(){let e=new Nt.Menu,t=Object.entries(this.plugin.settings.ai.prompts||{});t.length>0?t.forEach(([i])=>{e.addItem(n=>n.setTitle(i).onClick(async()=>{await this.handleAIAnalysis(i)}))}):e.addItem(i=>i.setTitle(m("Please add Prompt in the settings first")).setDisabled(!0));let A=this.aiButton.getBoundingClientRect();e.showAtPosition({x:A.left-92,y:A.bottom+8})}async handleAIAnalysis(e){try{this.setLoading(!0);let t=new Ot(this.plugin.settings.ai),A=this.plugin.settings.ai.prompts[e];if(!A)throw new Error(m(`Not found named "${e}" Prompt`));let i=this.contentProvider.getText(),n=this.contentProvider.getComments(),l=await t.generateResponse(A,i,n);await this.options.onResponse(l),new Nt.Notice(m("AI comments added"))}catch(t){new Nt.Notice(m(`AI comments failed: ${t.message}`))}finally{this.setLoading(!1)}}setLoading(e){e?(this.aiButton.addClass("loading"),(0,Nt.setIcon)(this.aiButton,"loader")):(this.aiButton.removeClass("loading"),(0,Nt.setIcon)(this.aiButton,this.options.buttonIcon||"bot-message-square"))}getButtonElement(){return this.aiButton}};var Fa=require("obsidian"),oA=class{constructor(e){this.STORAGE_KEY="flashcard-license";this.VAULT_ID_KEY="vault-id";this.API_URL="https://hi-note-license-server-production.up.railway.app";this.FEATURES=["flashcard"];this.VERIFICATION_INTERVAL_DAYS=7;this.licenseToken=null;this.plugin=e}async generateVaultId(){try{let e=await this.plugin.loadData()||{};if(e[this.VAULT_ID_KEY])return e[this.VAULT_ID_KEY];let t=this.plugin.app.vault.adapter,A=this.plugin.app.vault.getName();t&&"basePath"in t&&(A=t.basePath+"/"+A);let i=navigator.platform||"",n=[A,i].join("|"),c=new TextEncoder().encode(n),d=await crypto.subtle.digest("SHA-256",c),p=Array.from(new Uint8Array(d)).map(C=>C.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(p),p}catch(e){let t=this.plugin.app.vault.getName(),i=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",i),c=Array.from(new Uint8Array(n)).map(d=>d.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(c),c}}async saveVaultId(e){let t=await this.plugin.loadData()||{};await this.plugin.saveData({...t,[this.VAULT_ID_KEY]:e})}async activateLicense(e){try{let t=await this.generateVaultId(),A=`${this.API_URL}/api/verify`,l=(await(0,Fa.requestUrl)({url:A,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({licenseKey:e,deviceId:t})})).json;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{key:e,token:l.token,features:l.features,vaultId:t,lastVerified:Date.now()}}),this.licenseToken=l.token,!0}return!1}catch(t){let A=t instanceof Error?t.message:"Unknown error";return!1}}async isFeatureEnabled(e){var i;let t=await this.plugin.loadData(),A=t==null?void 0:t[this.STORAGE_KEY];return((i=A==null?void 0:A.features)==null?void 0:i.includes(e))||!1}async isActivated(){try{let e=await this.plugin.loadData(),t=e==null?void 0:e[this.STORAGE_KEY];return t!=null&&t.token?this.shouldVerifyLicense(t.lastVerified)?this.verifyWithServer(t):(this.licenseToken||(this.licenseToken=t.token),!0):!1}catch(e){return!1}}shouldVerifyLicense(e){return e?(Date.now()-e)/(1e3*60*60*24)>=this.VERIFICATION_INTERVAL_DAYS:!0}async verifyWithServer(e){try{let t=await this.generateVaultId(),A=e.vaultId,i=A&&A!==t,l=(await(0,Fa.requestUrl)({url:`${this.API_URL}/api/verify`,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`},body:JSON.stringify({licenseKey:e.key,deviceId:t,isDeviceChanged:i})})).json;if(!l)return!!this.licenseToken;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{...e,token:l.token||e.token,vaultId:t,lastVerified:Date.now()}}),this.licenseToken=l.token||e.token,!0}return!1}catch(t){return!!this.licenseToken}}};W();var Ji=class{constructor(e,t,A){this.selectionManager=null;this.onHighlightClick=null;this.onCommentAdd=null;this.onCommentEdit=null;this.onExport=null;this.onAIResponse=null;this.currentFile=null;this.isDraggedToMainView=!1;this.highlightsWithFlashcards=new Set;this.currentBatch=0;this.container=e,this.plugin=t,this.searchInput=A}setCallbacks(e){e.onHighlightClick&&(this.onHighlightClick=e.onHighlightClick),e.onCommentAdd&&(this.onCommentAdd=e.onCommentAdd),e.onCommentEdit&&(this.onCommentEdit=e.onCommentEdit),e.onExport&&(this.onExport=e.onExport),e.onAIResponse&&(this.onAIResponse=e.onAIResponse)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView),e.highlightsWithFlashcards!==void 0&&(this.highlightsWithFlashcards=e.highlightsWithFlashcards),e.currentBatch!==void 0&&(this.currentBatch=e.currentBatch)}renderHighlights(e,t=!1,A){if(A&&(this.selectionManager=A),t||(typeof Ie.clearAllInstances=="function"&&Ie.clearAllInstances(),this.container.empty(),this.currentBatch=0,this.selectionManager&&this.selectionManager.clearSelection()),e.length===0){this.renderEmptyState();return}this.selectionManager&&!t&&this.selectionManager.initialize();let i=this.container.querySelector(".highlight-list");i||(i=this.container.createEl("div",{cls:"highlight-list"})),e.forEach(n=>{this.renderHighlightCard(i,n)})}renderHighlightCard(e,t){var n;this.currentFile&&!t.filePath&&(t.filePath=this.currentFile.path);let A=new Ie(e,t,this.plugin,{onHighlightClick:async l=>{this.onHighlightClick&&await this.onHighlightClick(l)},onCommentAdd:l=>{this.onCommentAdd&&this.onCommentAdd(A.getElement(),l)},onExport:l=>{this.onExport&&this.onExport(l)},onCommentEdit:(l,c)=>{this.onCommentEdit&&this.onCommentEdit(A.getElement(),l,c)},onAIResponse:async l=>{this.onAIResponse&&await this.onAIResponse(t,l)}},this.isDraggedToMainView,this.currentFile===null?t.fileName:this.currentFile.basename,(n=this.selectionManager)!=null?n:void 0);t.id&&this.highlightsWithFlashcards.has(t.id)&&setTimeout(()=>{t.id&&Ie.updateCardUIByHighlightId(t.id)},0);let i=A.getElement();if(this.isDraggedToMainView){i.classList.add("in-main-view");let l=i.querySelector(".highlight-text-content");l&&l.removeAttribute("title")}else i.classList.remove("in-main-view")}renderEmptyState(){let e=this.searchInput&&this.searchInput.value.trim()!=="";this.container.createEl("div",{cls:"highlight-empty-state",text:e?m("No matching highlights found for your search."):m("The current document has no highlighted content.")})}clear(){typeof Ie.clearAllInstances=="function"&&Ie.clearAllInstances(),this.container.empty()}getCurrentBatch(){return this.currentBatch}setCurrentBatch(e){this.currentBatch=e}};var ls=require("obsidian");W();var $i=class{constructor(e){this.highlightManager=e;this.addCommentButton=null}createFileCommentButton(e,t){return this.addCommentButton=e.createEl("div",{cls:"highlight-icon-button"}),(0,ls.setIcon)(this.addCommentButton,"message-square-plus"),this.addCommentButton.setAttribute("aria-label",m("Add File Comment")),this.addCommentButton.addEventListener("click",async()=>{await this.handleAddFileComment(t)}),this.addCommentButton}async handleAddFileComment(e){let t=e.getCurrentFile();if(!t){new ls.Notice(m("Please open a file first."));return}let A=Date.now(),n={id:`file-comment-${A}`,text:m("File Comment"),filePath:t.path,isVirtual:!0,position:0,paragraphOffset:0,blockId:`virtual-${A}`,createdAt:A,updatedAt:A,comments:[]};await this.highlightManager.addHighlight(t,n),e.onVirtualHighlightCreated(n),setTimeout(()=>{let l=e.getHighlightContainer(),c=l.querySelector(".highlight-card");c&&(e.onShowCommentInput(c,n),l.scrollTo({top:0,behavior:"smooth"}))},100)}async filterVirtualHighlights(e,t){let A=await this.highlightManager.getFileHighlights(e),i=new Set;t.forEach(c=>{c.id&&i.add(c.id)});let l=A.filter(c=>c.isVirtual&&c.comments&&c.comments.length>0&&c.id&&!i.has(c.id)).filter(c=>!t.some(d=>d.text===c.text));return l.forEach(c=>{c.id&&i.add(c.id)}),l}destroy(){this.addCommentButton&&(this.addCommentButton.remove(),this.addCommentButton=null)}};var mt=require("obsidian");W();var Yi=class{constructor(e){this.plugin=e}checkHasFlashcard(e){let t=this.plugin.fsrsManager;if(!t||!e)return!1;let A=t.findCardsBySourceId(e,"highlight");return A&&A.length>0}async createFlashcard(e,t,A=!1){try{let i=this.plugin.fsrsManager;if(!i)return A||new mt.Notice(m("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316")),!1;if(!e.id){console.warn("\u9AD8\u4EAE\u7F3A\u5C11 ID\uFF0C\u6B63\u5728\u751F\u6210...");let g=(await Promise.resolve().then(()=>(FA(),tc))).IdGenerator;e.id=g.generateHighlightId(e.filePath||"",e.position||0,e.text)}if(e.filePath){let g=this.plugin.app.vault.getAbstractFileByPath(e.filePath);if(g instanceof mt.TFile){let p={id:e.id,text:e.text,position:e.position||0,paragraphOffset:e.paragraphOffset,blockId:e.blockId,comments:e.comments||[],createdAt:e.createdAt||Date.now(),updatedAt:e.updatedAt||Date.now(),filePath:e.filePath,fileName:e.fileName,fileIcon:e.fileIcon,backgroundColor:e.backgroundColor,originalLength:e.originalLength,isVirtual:e.isVirtual,isCloze:e.isCloze};await this.plugin.highlightManager.addHighlight(g,p)}}let n=e.text,l="",c=[];if(e.filePath){let g=t||e.filePath.split("/").pop()||e.filePath;c.push(`From: [[${g}]]`)}return e.comments&&e.comments.length>0&&c.push(e.comments.map(g=>g.content||"").join(`
`)),l=c.length>0?c.join(`

`):m("Add answer"),i.addCard(n,l,e.filePath||t,e.id,"highlight")?(this.plugin.eventManager.emitFlashcardChanged(),A||new mt.Notice(m("Flashcard created successfully!")),!0):(A||new mt.Notice(m("Failed to create flashcard, please check highlight content")),!1)}catch(i){return console.error("\u521B\u5EFA\u95EA\u5361\u65F6\u51FA\u9519:",i),A||new mt.Notice(m(`Failed to create flashcard: ${i.message}`)),!1}}async deleteFlashcard(e,t=!1){try{let A=this.plugin.fsrsManager;if(!A)return t||new mt.Notice(m("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316")),{success:!1,shouldDeleteHighlight:!1};if(A.deleteCardsBySourceId(e.id||"","highlight")>0){A.cleanupInvalidCardReferences();let l=!(e.comments&&e.comments.length>0);return t||(l?new mt.Notice(m("Flashcard and highlight deleted")):new mt.Notice(m("Flashcard deleted, highlight and comments preserved"))),t||this.plugin.eventManager.emitFlashcardChanged(),{success:!0,shouldDeleteHighlight:l}}else return t||new mt.Notice(m("Flashcard not found")),{success:!1,shouldDeleteHighlight:!1}}catch(A){return console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",A),t||new mt.Notice(m(`Failed to delete flashcard: ${A.message}`)),{success:!1,shouldDeleteHighlight:!1}}}};var EA=require("obsidian");var qi=class{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static removeHighlightFormat(e,t,A){let i=this.escapeRegExp(t),n=e,l=!1,c=new RegExp(`==\\s*(${i})\\s*==`,"g"),d=n.replace(c,t);if(d!==n&&(n=d,l=!0),!l){let g=new RegExp(`<mark[^>]*>(${i})</mark>`,"g"),p=n.replace(g,t);p!==n&&(n=p,l=!0)}if(!l){let g=new RegExp(`<span[^>]*>(${i})</span>`,"g"),p=n.replace(g,t);p!==n&&(n=p,l=!0)}if(!l&&A)try{let g=new RegExp(A,"g"),p=n.replace(g,(C,...y)=>{for(let F of y)if(typeof F=="string"&&F.includes(t))return t;return C});p!==n&&(n=p,l=!0)}catch(g){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",g)}return n}static removeHighlightFormatInRange(e,t,A,i,n){let l=Math.max(0,A-100),c=Math.min(e.length,i+100),d=e.substring(l,c),g=this.removeHighlightFormat(d,t,n);return g!==d?e.substring(0,l)+g+e.substring(c):e}static getCommonHighlightPatterns(e){let t=this.escapeRegExp(e);return[new RegExp(`==\\s*(${t})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${t})</mark>`,"g"),new RegExp(`<span[^>]*>(${t})</span>`,"g")]}};W();var zi=class{constructor(e){this.plugin=e}async deleteHighlight(e,t=!1,A=!1){try{if(!t&&!confirm(m("Delete this highlight and all its data, including Comments and HiCards? Can't undo.")))return!1;if(e.filePath){await this.removeHighlightFromFile(e);let i=this.plugin.app.vault.getAbstractFileByPath(e.filePath);i instanceof EA.TFile&&await this.plugin.highlightManager.removeHighlight(i,e),this.plugin.eventManager.emitHighlightDelete(e.filePath,e.text||"",e.id||"")}return A||new EA.Notice(m("Highlight deleted successfully")),!0}catch(i){return console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",i),A||new EA.Notice(m(`Failed to delete highlight: ${i.message}`)),!1}}async removeHighlightFromFile(e){var g;if(!e.filePath)return;let t=this.plugin.app.vault.getAbstractFileByPath(e.filePath);if(!(t instanceof EA.TFile))return;let A=await this.plugin.app.vault.read(t),i=e.text,n=null,l=this.plugin.app.workspace.getLeavesOfType("markdown");for(let p of l){let C=p.view;if(C.getViewType()==="markdown"){let y=C;if(y.file&&y.file.path===t.path&&y.editor){n=y.editor;break}}}let c=(g=this.plugin.settings)==null?void 0:g.customHighlightRegex,d;if(typeof e.position=="number"){let p=e.position+(e.originalLength||i.length);d=qi.removeHighlightFormatInRange(A,i,e.position,p,c)}else d=qi.removeHighlightFormat(A,i,c);n?n.setValue(d):await this.plugin.app.vault.modify(t,d)}async deleteHighlightCompletely(e){try{if(e.filePath){let t=this.plugin.app.vault.getAbstractFileByPath(e.filePath);t instanceof EA.TFile&&(await this.plugin.highlightManager.removeHighlight(t,e),this.plugin.eventManager.emitHighlightDelete(e.filePath,e.text||"",e.id||""))}}catch(t){throw console.error("\u5B8C\u5168\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",t),t}}};var cs=require("obsidian"),IA=class{static updateCardIcons(e,t){let A=e.querySelectorAll(".highlight-card-icon"),i=t?this.ICONS.FLASHCARD:this.ICONS.FILE;A.forEach(n=>{(0,cs.setIcon)(n,i),t?n.addClass("has-flashcard"):n.removeClass("has-flashcard")})}static setFileIcon(e,t){let A=t?this.ICONS.FLASHCARD:this.ICONS.FILE;(0,cs.setIcon)(e,A),t?e.addClass("has-flashcard"):e.removeClass("has-flashcard")}static setHighlightIcon(e,t){let A=t?this.ICONS.FLASHCARD:this.ICONS.HIGHLIGHT;(0,cs.setIcon)(e,A),t?e.addClass("has-flashcard"):e.removeClass("has-flashcard")}static getIconName(e){switch(e){case"flashcard":return this.ICONS.FLASHCARD;case"file":return this.ICONS.FILE;case"highlight":return this.ICONS.HIGHLIGHT;case"message":return this.ICONS.MESSAGE;default:return this.ICONS.FILE}}};IA.ICONS={FLASHCARD:"book-heart",FILE:"file-text",HIGHLIGHT:"highlighter",MESSAGE:"message-circle"};var pe=class pe{constructor(e,t,A,i,n=!1,l,c){this.container=e;this.highlight=t;this.plugin=A;this.options=i;this.isInMainView=n;this.selectionManager=c;this.isEditing=!1;this.aiButtonInstance=null;this.moreActionsDropdown=null;this.unfocusedInput=null;this.hasFlashcard=!1;this.isShowingRealInput=!1;var d;this.fileName=l,this.highlight=t,this.plugin=A,this.options=i,this.fileName=(d=this.highlight.filePath)==null?void 0:d.split("/").pop(),this.flashcardManager=new Yi(A),this.deletionManager=new zi(A),pe.cardInstances.add(this),this.setupCommentInputEventListeners(),this.render()}static clearAllInstances(){pe.cardInstances.forEach(e=>{typeof e.destroy=="function"&&e.destroy()}),pe.cardInstances.clear()}static findCardInstanceByHighlightId(e){for(let t of pe.cardInstances)if(t.highlight.id&&t.highlight.id===e)return t;return null}static updateCardUIByHighlightId(e){let t=pe.findCardInstanceByHighlightId(e);t&&t.updateIconsAfterCardCreation()}static clearAllUnfocusedInputs(){pe.cardInstances.forEach(e=>{e.unfocusedInput&&(e.unfocusedInput.remove(),e.unfocusedInput=null)})}setupCommentInputEventListeners(){let e=A=>{var i;((i=A.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!0,this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null))},t=A=>{var i;((i=A.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!1)};document.addEventListener("comment-input-shown",e),document.addEventListener("comment-input-closed",t),this.plugin.register(()=>{document.removeEventListener("comment-input-shown",e),document.removeEventListener("comment-input-closed",t)})}render(){this.card=this.container.createEl("div",{cls:`highlight-card ${this.highlight.isVirtual?"virtual-highlight-card":""}`,attr:{"data-highlight":JSON.stringify(this.highlight)}}),this.card.addEventListener("click",c=>{if(this.isEditing||this.isShowingRealInput)return;let d=c.target;d.closest(".hi-note-input")||d.closest(".hi-note-actions-hint")||this.selectCard(c)});let e=this.card.createEl("div",{cls:"highlight-card-title-bar"}),t=e.createEl("div",{cls:"highlight-card-title-left"}),A=e.createEl("div",{cls:"highlight-card-title-right"});if((this.isInMainView||this.highlight.isGlobalSearch)&&this.fileName){let c=t.createEl("div",{cls:"highlight-card-icon",attr:{"aria-label":m("Open (DoubleClick)")}});this.checkHasFlashcard()?((0,fe.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,fe.setIcon)(c,"file-text"),c.addEventListener("dblclick",async C=>{C.stopPropagation();let y=this.highlight.filePath||this.fileName;if(!y)return;let F=this.plugin.app.vault.getAbstractFileByPath(y);if(!F||!(F instanceof fe.TFile))return;let Q=this.plugin.app.workspace.getLeavesOfType("markdown"),U=this.plugin.app.workspace.activeLeaf,b=Q.find(k=>k!==U);if(b||(b=this.plugin.app.workspace.getLeaf("split","vertical")),await b.openFile(F),this.highlight.position!==void 0){let k=b.view;if(k.getViewType()==="markdown"){let Ae=k.getViewType()==="markdown"?k.editor:null;if(Ae){let N=Ae.offsetToPos(this.highlight.position);Ae.setCursor(N),Ae.scrollIntoView({from:N,to:N},!0)}}}});let g=this.fileName?this.fileName.replace(/\.md$/,""):"",p=t.createEl("span",{text:g,cls:"highlight-card-title-text"});this.setupDragFunctionality(t),this.addPagePreview(p,this.highlight.filePath||this.fileName)}else{let c=t.createEl("div",{cls:"highlight-card-icon"});if(this.checkHasFlashcard()?((0,fe.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,fe.setIcon)(c,"highlighter"),this.highlight.filePath&&typeof this.highlight.position=="number"){let g=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(g instanceof fe.TFile&&!this.highlight.isGlobalSearch){let p=this.plugin.app.workspace.getLeavesOfType("markdown").find(C=>{let y=C.view;return y instanceof fe.MarkdownView&&y.file&&y.file.path===g.path});if(p){let C=p.view;if(C.editor){let F=C.editor.offsetToPos(this.highlight.position).line+1;t.createEl("div",{cls:"highlight-line-number-badge"}).createEl("span",{text:`L${F}`,cls:"highlight-line-number"})}}}}this.setupDragFunctionality(t)}this.aiButtonInstance=new os(A,{getText:()=>this.highlight.text,getComments:()=>(this.highlight.comments||[]).map(c=>c.content||"").join(`
`)},this.plugin,{onResponse:async c=>{await this.options.onAIResponse(c)},buttonClass:"highlight-title-btn highlight-ai-btn",buttonIcon:"sparkles",buttonLabel:m("AI comment"),position:"titlebar"});let n=A.createEl("div",{cls:"highlight-more-actions-container"}).createEl("div",{cls:"highlight-title-btn highlight-more-btn",attr:{"aria-label":m("More")}});(0,fe.setIcon)(n,"ellipsis-vertical"),n.addEventListener("click",c=>{c.stopPropagation(),this.toggleMoreActionsDropdown(n)}),this.isInMainView&&this.fileName&&this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof fe.TFile&&this.generateDragContent().catch(d=>{console.error("[HighlightCard] Error pre-generating block ID:",d)});let l=this.card.createEl("div",{cls:"highlight-content"});new Ti(l,this.highlight,this.options.onHighlightClick,this.plugin.app,this.isInMainView),new Pi(this.card,this.highlight,c=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,c)})}showUnfocusedCommentInput(){if(this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.isEditing||this.isShowingRealInput)return;let e=this.card.querySelector(".highlight-content");e&&(this.unfocusedInput=new ts(e,this.highlight,()=>{this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}))}static findCardInstanceByElement(e){for(let t of pe.cardInstances)if(t.card===e||t.card.contains(e))return t;return null}showCommentInput(){pe.clearAllUnfocusedInputs(),this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}selectCard(e){if(pe.clearAllUnfocusedInputs(),!this.selectionManager){console.error("[HighlightCard] SelectionManager \u672A\u4F20\u5165\uFF0C\u65E0\u6CD5\u8FDB\u884C\u9009\u62E9\u64CD\u4F5C");return}e&&e.shiftKey?this.selectionManager.isCardSelected(this.card)?this.selectionManager.unselectCard(this.card):this.selectionManager.selectCard(this.card,this.highlight):(this.selectionManager.clearSelection(),this.selectionManager.selectCard(this.card,this.highlight),this.showUnfocusedCommentInput())}getElement(){return this.card}addPagePreview(e,t){if(!t)return;let A=this.plugin.app.vault.getAbstractFileByPath(t);if(!(A instanceof fe.TFile))return;let i;e.addEventListener("mouseenter",n=>{i=setTimeout(async()=>{let l=n.target;this.plugin.app.workspace.trigger("hover-link",{event:n,source:"hi-note",hoverParent:l,targetEl:l,linktext:A.path})},300)}),e.addEventListener("mouseleave",()=>{i&&clearTimeout(i)})}update(e){this.highlight=e,this.isEditing=!1,this.card.empty(),this.render()}generateDragContentSync(){return new Ri(this.highlight,this.plugin).generateSync()}async generateDragContent(){return new Ri(this.highlight,this.plugin).generate()}setupDragFunctionality(e){e.setAttribute("draggable","true"),this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof fe.TFile&&this.generateDragContent().catch(A=>{console.error("[HighlightCard] Error pre-generating block ID:",A)}),e.addEventListener("dragstart",async t=>{var A,i;try{if(!this.highlight||!this.highlight.text)throw new Error("Invalid highlight data");let n;try{let c=new Promise((d,g)=>{setTimeout(()=>g(new Error("Block ID generation timeout")),300)});n=await Promise.race([this.generateDragContent(),c])}catch(c){console.debug("[HighlightCard] Using sync fallback for drag content:",c),n=this.generateDragContentSync()}(A=t.dataTransfer)==null||A.setData("text/plain",n);let l=JSON.stringify(this.highlight);(i=t.dataTransfer)==null||i.setData("application/highlight",l),e.addClass("dragging"),Di.start(t,this.highlight.text)}catch(n){console.error("[HighlightCard] Error during drag start:",n),t.preventDefault(),t.stopPropagation()}}),e.addEventListener("dragend",()=>{e.removeClass("dragging"),Di.clear()})}copyHighlightContent(){try{let e=`> [!quote] HiNote
`;if(e+=`> ${this.highlight.text}`,this.highlight.filePath){let t=this.fileName||this.highlight.filePath.split("/").pop()||this.highlight.filePath;e+=`
> 
`,e+=`> From: [[${t}]]`}e+=`

`,navigator.clipboard.writeText(e).then(()=>{new fe.Notice("Copied")}).catch(t=>{console.error("\u590D\u5236\u5185\u5BB9\u5931\u8D25:",t),new fe.Notice("Failed to copy content")})}catch(e){console.error("\u590D\u5236\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519:",e),new fe.Notice("Failed to copy content")}}handleExportAsImage(){this.options.onExport(this.highlight)}toggleMoreActionsDropdown(e){let t=new fe.Menu;this.hasFlashcard=this.checkHasFlashcard(),t.addItem(i=>i.setTitle(this.hasFlashcard?m("Delete HiCard"):m("Create HiCard")).onClick(()=>this.handleCreateHiCard())),t.addItem(i=>i.setTitle(m("Copy Highlight")).onClick(()=>this.copyHighlightContent())),t.addItem(i=>i.setTitle(m("Export as Image")).onClick(()=>this.handleExportAsImage())),t.addItem(i=>i.setTitle(m("Delete")).onClick(()=>this.handleDeleteHighlight()));let A=e.getBoundingClientRect();t.showAtPosition({x:A.left-100,y:A.bottom+8})}hasVisibleMoreDropdown(){return pe.visibleDropdowns.size>0}static addVisibleDropdown(e){pe.isGlobalListenerAdded||(document.addEventListener("click",pe.handleDocumentClick,!0),pe.isGlobalListenerAdded=!0),pe.visibleDropdowns.add(e)}static removeVisibleDropdown(e){pe.visibleDropdowns.delete(e)}checkHasFlashcard(){return this.flashcardManager.checkHasFlashcard(this.highlight.id||"")}async handleCreateHiCard(){try{let e=new oA(this.plugin),t=await e.isActivated(),A=t?await e.isFeatureEnabled("flashcard"):!1;if(!t||!A){new fe.Notice(m("Only HiNote Pro"));return}if(!this.plugin.fsrsManager){new fe.Notice(m("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}let n=this.checkHasFlashcard();this.hasFlashcard=n,n?await this.handleDeleteHiCard():await this.handleCreateNewHiCard()}catch(e){console.error("\u5904\u7406\u95EA\u5361\u64CD\u4F5C\u65F6\u51FA\u9519:",e),new fe.Notice(m(`\u64CD\u4F5C\u5931\u8D25: ${e.message}`))}}async deleteHiCardForHighlight(e=!1){let t=await this.flashcardManager.deleteFlashcard(this.highlight,e);return t.success&&(this.hasFlashcard=!1,this.updateIconsAfterCardDeletion(),t.shouldDeleteHighlight&&!e&&await this.deletionManager.deleteHighlightCompletely(this.highlight)),t.success}async handleDeleteHiCard(e=!1){await this.deleteHiCardForHighlight(e)}async deleteHighlightCompletely(){await this.deletionManager.deleteHighlightCompletely(this.highlight)}async createHiCardForHighlight(e=!1){let t=await this.flashcardManager.createFlashcard(this.highlight,this.fileName,e);return t&&(this.hasFlashcard=!0,this.updateIconsAfterCardCreation()),t}async handleCreateNewHiCard(e=!1){await this.createHiCardForHighlight(e)}updateIconsAfterCardDeletion(){IA.updateCardIcons(this.card,!1)}updateIconsAfterCardCreation(){IA.updateCardIcons(this.card,!0)}updateCreateHiCardButtonText(){let e=this.card.querySelector(".create-hicard-btn");e&&(e.textContent=this.hasFlashcard?m("Delete HiCard"):m("Create HiCard"))}async handleDeleteHighlight(e=!1,t=!1){try{this.hasFlashcard&&await this.handleDeleteHiCard(!0),await this.deletionManager.deleteHighlight(this.highlight,e,t)&&(this.card.remove(),pe.cardInstances.delete(this))}catch(A){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",A),new fe.Notice(m(`\u5220\u9664\u9AD8\u4EAE\u5931\u8D25: ${A.message}`))}}updateComments(e){this.highlight=e,this.isEditing=!1;let t=this.card.querySelector(".hi-notes-section");t&&t.remove(),this.highlight.comments&&this.highlight.comments.length>0&&new Pi(this.card,this.highlight,A=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,A)})}destroy(){this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.moreActionsDropdown&&(this.moreActionsDropdown.remove(),this.moreActionsDropdown=null),pe.cardInstances.delete(this)}};window.HighlightCard={findCardInstanceByHighlightId:pe.findCardInstanceByHighlightId},pe.cardInstances=new Set,pe.visibleDropdowns=new Set,pe.isGlobalListenerAdded=!1,pe.handleDocumentClick=e=>{for(let t of pe.visibleDropdowns){let A=t.closest(".highlight-card");A&&!A.contains(e.target)&&!t.contains(e.target)&&(t.classList.add("hi-note-hidden"),pe.visibleDropdowns.delete(t))}};var Ie=pe;var hs=require("obsidian"),ds=class{constructor(e){this.app=e}async jumpToHighlight(e,t){let A=await this.openOrActivateFile(t);A&&await this.locateAndHighlightText(A,e.text,e.position)}async openOrActivateFile(e){let A=this.app.workspace.getLeavesOfType("markdown").find(i=>{var l;return((l=i.view.file)==null?void 0:l.path)===e});if(!A)try{let i=this.app.vault.getAbstractFileByPath(e);if(!i)return new hs.Notice("\u672A\u627E\u5230\u6587\u4EF6"),null;A=await this.app.workspace.getLeaf("tab"),await A.openFile(i)}catch(i){return new hs.Notice("\u6253\u5F00\u6587\u4EF6\u5931\u8D25"),null}return await this.app.workspace.setActiveLeaf(A,{focus:!1}),A}async locateAndHighlightText(e,t,A){await new Promise(U=>setTimeout(U,300));let i=e.view,n=i.editor,l=n.getValue(),c=-1,d=[],g=t,p=0,C=-1;for(;(C=l.indexOf(t,p))!==-1;)d.push(C),p=C+1;if(A!==void 0&&A>=0){if(l.substring(A,A+t.length)===t)c=A;else if(d.length>0){let U=d[0],b=Math.abs(A-U);for(let k of d){let Ae=Math.abs(A-k);Ae<b&&(b=Ae,U=k)}c=U}}if(c===-1)if(d.length>0)c=d[0];else{new hs.Notice("\u672A\u627E\u5230\u9AD8\u4EAE\u5185\u5BB9");return}let y=n.offsetToPos(c),F=n.offsetToPos(c+g.length);i.getMode()==="preview"?e.setEphemeralState({line:y.line,startLoc:{line:y.line,col:y.ch},endLoc:{line:F.line,col:F.ch},scroll:y.line}):(n.setSelection(y,F),n.scrollIntoView({from:y,to:F},!0),this.app.workspace.setActiveLeaf(e,{focus:!0}))}};var Ac=require("obsidian");W();var qA=require("obsidian");var gs=class{static shouldExclude(e,t){if(!t||t.trim().length===0)return!1;let A=t.split(",").map(l=>l.trim()).filter(l=>l.length>0),i=e.path,n=e.basename;return A.some(l=>{if(l=l.trim(),!l)return!1;if(l.startsWith("[[")&&l.endsWith("]]")){let g=l.slice(2,-2);return n===g}if(l.startsWith("*.")){let g=l.slice(2);return e.extension===g||i.endsWith(g)}let c=l.replace(/^\/+/,""),d=i.replace(/^\/+/,"");return d.startsWith(c+"/")||d===c})}};var Gt=class Gt{constructor(e){this.app=e}getOrCreateBlockId(e,t){let A=e.getLine(t),i=A.match(Gt.BLOCK_ID_REGEX);if(i)return i[1];let n="";for(let c=0;c<7;c++)n+=Gt.BLOCK_ID_CHARS.charAt(Math.floor(Math.random()*Gt.BLOCK_ID_CHARS.length));let l=A.trimEnd();return e.setLine(t,`${l} ^${n}`),n}extractBlockId(e){let t=e.match(Gt.BLOCK_ID_REGEX);return t?t[1]:void 0}getParagraphBlockId(e,t){let A=this.app.metadataCache.getFileCache(e);if(!(A!=null&&A.sections))return;let i=A.sections.find(n=>n.position.start.offset<=t&&n.position.end.offset>=t);return i!=null&&i.id?`${e.path}#^${i.id}`:void 0}async createParagraphBlockId(e,t,A){let i=this.getParagraphBlockId(e,t);if(i)return i;let n=this.app.workspace.getLeaf();await n.openFile(e,{active:!1});let c=n.view.editor,g=c.offsetToPos(t).line,p=this.app.metadataCache.getFileCache(e);if(p!=null&&p.sections){let y=A||t,F=p.sections.find(Q=>Q.position.start.offset<=y&&Q.position.end.offset>=y);F&&(g=c.offsetToPos(F.position.end.offset).line,console.debug(`[BlockIdService] \u627E\u5230\u5305\u542B\u9AD8\u4EAE\u7684\u6BB5\u843D\uFF0C\u7ED3\u675F\u884C: ${g}`))}let C=this.getOrCreateBlockId(c,g);return await this.app.vault.modify(e,c.getValue()),`${e.path}#^${C}`}hasValidBlockId(e){return Gt.BLOCK_ID_REGEX.test(e)}};Gt.BLOCK_ID_REGEX=/\^([a-zA-Z0-9-]+)$/,Gt.BLOCK_ID_CHARS="abcdefghijklmnopqrstuvwxyz0123456789";var us=Gt;var Ve=class Ve{constructor(e){this.app=e;this.contentCache=new Map;this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0};this.isIndexing=!1;let t=e.plugins,A=t&&t.plugins?t.plugins["hi-note"]:void 0;this.settings=A==null?void 0:A.settings,this.blockIdService=new us(e)}async initialize(){this.registerFileEventHandlers();let t=this.app.isMobile?1e4:3e3;setTimeout(()=>{this.buildFileIndex()},t)}destroy(){this.unregisterFileEventHandlers(),this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0},this.contentCache.clear()}registerFileEventHandlers(){this.fileCreateEventRef=this.app.vault.on("create",e=>{e instanceof qA.TFile&&e.extension==="md"&&this.updateFileInIndex(e)}),this.fileModifyEventRef=this.app.vault.on("modify",e=>{e instanceof qA.TFile&&e.extension==="md"&&(this.contentCache.delete(e.path),this.updateFileInIndex(e))}),this.fileDeleteEventRef=this.app.vault.on("delete",e=>{e instanceof qA.TFile&&e.extension==="md"&&(this.contentCache.delete(e.path),this.removeFileFromIndex(e.path))}),this.fileRenameEventRef=this.app.vault.on("rename",(e,t)=>{e instanceof qA.TFile&&e.extension==="md"&&(this.contentCache.delete(t),this.removeFileFromIndex(t),this.updateFileInIndex(e))})}unregisterFileEventHandlers(){this.app.vault.offref(this.fileCreateEventRef),this.app.vault.offref(this.fileModifyEventRef),this.app.vault.offref(this.fileDeleteEventRef),this.app.vault.offref(this.fileRenameEventRef)}shouldProcessFile(e){var t;return!gs.shouldExclude(e,((t=this.settings)==null?void 0:t.excludePatterns)||"")}extractHighlights(e,t){var i;let A=[];if(this.settings.useCustomPattern&&((i=this.settings.regexRules)==null?void 0:i.length)>0)for(let n of this.settings.regexRules.filter(l=>l.enabled))try{let l=new RegExp(n.pattern,"g");this.processRegexMatches(e,l,A,t,n.color)}catch(l){}else this.processRegexMatches(e,Ve.DEFAULT_HIGHLIGHT_PATTERN,A,t,"#ffeb3b");return A.sort((n,l)=>{var c,d;return((c=n.position)!=null?c:0)-((d=l.position)!=null?d:0)})}processRegexMatches(e,t,A,i,n){let l=[];if(i){let g=this.app.metadataCache.getFileCache(i);g!=null&&g.sections&&(l=g.sections.filter(C=>["code","codeblock","fenced_code","pre"].includes(C.type)).map(C=>[C.position.start.offset,C.position.end.offset]))}function c(g,p,C){return C.some(([y,F])=>Math.max(g,y)<Math.min(p,F))}let d;for(;(d=t.exec(e))!==null;){let g=d,p=g[0],C=g.index,y=C+p.length;if(c(C,y,l))continue;if(p.startsWith("==")&&p.endsWith("==")){let b=C>0?e.charAt(C-1):"",k=y<e.length?e.charAt(y):"";if(b==="="||k==="=")continue}let F=g.slice(1).find(b=>b!==void 0);F||(F=p);let Q=null;if(p.includes("style=")&&(Q=this.extractColorFromElement(p)),!A.some(b=>typeof b.position=="number"&&Math.abs(b.position-g.index)<Ve.DUPLICATE_POSITION_THRESHOLD&&b.text===F)&&F){let b=/\{\{([^{}]+)\}\}/.test(F),k={text:F,position:g.index,backgroundColor:Q||n,isCloze:b,filePath:i.path,originalLength:p.length};A.push(k)}}}getParagraphOffset(e,t){let A=e.substring(0,t),i=A.split(/\n\s*\n/);return A.length-i[i.length-1].length}async getFilesWithHighlights(){let e=this.app.vault.getMarkdownFiles(),t=[],A=0;for(let i of e){if(!this.shouldProcessFile(i))continue;let n=await this.getCachedFileContent(i),l=this.extractHighlights(n,i);l.length>0&&(t.push(i),A+=l.length)}return t}async getAllHighlights(){let e=this.app.vault.getMarkdownFiles(),t=[];for(let A of e){if(!this.shouldProcessFile(A))continue;let i=await this.getCachedFileContent(A),n=this.extractHighlights(i,A);n.length>0&&t.push({file:A,highlights:n})}return t}async buildFileIndex(){if(this.isIndexing)return;this.isIndexing=!0;let e=Date.now();try{let t=await this.getAllHighlights(),A=new Map,i=new Map;for(let{file:n,highlights:l}of t){let c=l.map(g=>({...g,fileName:n.basename,filePath:n.path}));i.set(n.path,c);let d=this.extractKeywordsFromHighlights(l);this.addKeywordsToIndex(d,n.path,A)}this.fileIndex={wordToFiles:A,fileToHighlights:i,lastUpdated:Date.now()}}catch(t){}finally{this.isIndexing=!1}}tokenizeText(e){return e?e.toLowerCase().split(/\s+/).filter(A=>A.length>=Ve.MIN_WORD_LENGTH).map(A=>A.replace(/[.,;:!?()\[\]{}'"`~]/g,"")).filter(A=>A.length>=Ve.MIN_WORD_LENGTH):[]}isIndexExpired(){return this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>Ve.INDEX_EXPIRY_TIME}getAllHighlightsFromCache(){return this.fileIndex.lastUpdated===0&&!this.isIndexing&&this.buildFileIndex(),!this.isIndexExpired()&&this.fileIndex.fileToHighlights.size>0?this.getAllHighlightsFromIndex():null}getAllHighlightsFromIndex(){let e=[];for(let t of this.fileIndex.fileToHighlights.values())e.push(...t);return e}extractKeywordsFromHighlights(e){var A;let t=new Set;for(let i of e)if(this.tokenizeText(i.text).forEach(l=>t.add(l)),(A=i.comments)!=null&&A.length)for(let l of i.comments)this.tokenizeText(l.content).forEach(d=>t.add(d));return t}addKeywordsToIndex(e,t,A){for(let i of e)A.has(i)||A.set(i,new Set),A.get(i).add(t)}removeFileFromIndex(e){if(!this.isIndexExpired())try{if(this.fileIndex.fileToHighlights.has(e)){for(let[t,A]of this.fileIndex.wordToFiles.entries())A.delete(e),A.size===0&&this.fileIndex.wordToFiles.delete(t);this.fileIndex.fileToHighlights.delete(e)}}catch(t){}}async updateFileInIndex(e){if(!this.isIndexing){if(this.fileIndex.lastUpdated===0&&(this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:Date.now()}),this.isIndexExpired()){this.buildFileIndex();return}try{if(this.removeFileFromIndex(e.path),this.shouldProcessFile(e)){let t=await this.app.vault.read(e),A=this.extractHighlights(t,e);if(A.length>0){let i=A.map(l=>({...l,fileName:e.basename,filePath:e.path}));this.fileIndex.fileToHighlights.set(e.path,i);let n=this.extractKeywordsFromHighlights(A);this.addKeywordsToIndex(n,e.path,this.fileIndex.wordToFiles)}}}catch(t){}}}async searchHighlightsFromIndex(e){var l;if((this.isIndexExpired()||this.fileIndex.fileToHighlights.size===0)&&await this.buildFileIndex(),!e.trim())return this.getAllHighlightsFromIndex();let t=this.tokenizeText(e);if(t.length===0)return this.getAllHighlightsFromIndex();let A=[];for(let c of t){let d=new Set;for(let[g,p]of this.fileIndex.wordToFiles.entries())if(g.includes(c))for(let C of p)d.add(C);A.push(d)}let i;if(A.length>0){i=A[0];for(let c=1;c<A.length;c++)i=new Set([...i].filter(d=>A[c].has(d)))}else i=new Set;let n=[];for(let c of i){let d=this.fileIndex.fileToHighlights.get(c)||[];for(let g of d){let p=g.text.toLowerCase(),C=((l=g.comments)==null?void 0:l.map(F=>F.content.toLowerCase()))||[];t.every(F=>p.includes(F)||C.some(Q=>Q.includes(F)))&&n.push(g)}}return n}async createBlockIdForHighlight(e,t,A){try{let i=this.blockIdService.getParagraphBlockId(e,t);if(i)return i;let n=A?t+A:t;return await this.blockIdService.createParagraphBlockId(e,t,n)}catch(i){throw i}}async batchRemoveHighlightMarks(e){let t=0,A=0,i=new Map;for(let n of e)i.has(n.filePath)||i.set(n.filePath,[]),i.get(n.filePath).push(n);for(let[n,l]of i)try{let c=this.app.vault.getAbstractFileByPath(n);if(!c||!(c instanceof qA.TFile)){A+=l.length;continue}let d=[...l].sort((p,C)=>{var Q,U;let y=(Q=p.position)!=null?Q:1/0;return((U=C.position)!=null?U:1/0)-y}),g=await this.app.vault.read(c);for(let p of d)try{g=this.removeHighlightMarkFromContent(g,p),t++}catch(C){A++}await this.app.vault.modify(c,g)}catch(c){A+=l.length}return{success:t,failed:A}}removeHighlightMarkFromContent(e,t){let A=this.escapeRegExp(t.text);if(typeof t.position=="number"){let n=t.position,l=t.text,c=[`==${l}==`,`== ${l} ==`,`<mark>${l}</mark>`,`<span class="highlight">${l}</span>`];for(let d of c){let g=Math.max(0,n-Ve.POSITION_SEARCH_OFFSET_BEFORE),p=Math.min(e.length,n+l.length+Ve.POSITION_SEARCH_OFFSET_AFTER),C=e.substring(g,p);if(C.includes(d)){let y=e.substring(0,g),F=e.substring(p),Q=C.replace(d,l);return y+Q+F}}}let i=[new RegExp(`==\\s*(${A})\\s*==`),new RegExp(`<mark[^>]*>(${A})</mark>`),new RegExp(`<span[^>]*class="highlight"[^>]*>(${A})</span>`)];for(let n of i)if(n.test(e))return e.replace(n,t.text);return e}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}extractColorFromElement(e){let t=e.match(/style=["']([^"']*)["']/);if(!t)return null;let A=t[1].match(/background(?:-color)?:\s*((?:rgba?\(.*?\)|#[0-9a-fA-F]{3,8}|var\(--[^)]+\)))/);return A?A[1]:null}async getCachedFileContent(e){let t=this.contentCache.get(e.path);if(t&&t.mtime===e.stat.mtime)return t.content;let A=await this.app.vault.read(e);return this.contentCache.set(e.path,{content:A,mtime:e.stat.mtime}),A}findMatchingHighlight(e,t,A){let i=A.getCachedHighlights(e.path)||[];if(!i||i.length===0)return null;let n=i.find(l=>l.text!==t.text?!1:typeof l.position=="number"&&typeof t.position=="number"?Math.abs(l.position-t.position)<10:!1);return n||t.position!==void 0&&(n=i.find(l=>typeof l.position=="number"&&Math.abs(l.position-t.position)<50),n)?n:null}mergeHighlightsWithComments(e,t,A){if(t.length===0)return e.map(p=>this.createHighlightInfo(p,A));let i=new Map,n=new Map,l=new Map;for(let p of t)if(p.id&&i.set(p.id,p),p.text&&(n.has(p.text)||n.set(p.text,[]),n.get(p.text).push(p)),p.position!==void 0){let C=Math.floor(p.position/50);l.has(C)||l.set(C,[]),l.get(C).push(p)}let c=new Set,d=e.map(p=>{if(p.id&&i.has(p.id)){let C=i.get(p.id);if(C.id&&!c.has(C.id))return c.add(C.id),this.createMergedHighlight(p,C,A)}if(p.text&&n.has(p.text)){let C=n.get(p.text);for(let y of C)if(y.id&&!c.has(y.id)&&p.position!==void 0&&y.position!==void 0&&Math.abs(y.position-p.position)<100)return c.add(y.id),this.createMergedHighlight(p,y,A)}if(p.position!==void 0){let C=Math.floor(p.position/50);for(let y=C-1;y<=C+1;y++)if(l.has(y)){let F=l.get(y);for(let Q of F)if(Q.id&&!c.has(Q.id)&&Q.position!==void 0&&Math.abs(Q.position-p.position)<50)return c.add(Q.id),this.createMergedHighlight(p,Q,A)}}return this.createHighlightInfo(p,A)});return[...t.filter(p=>p.id&&p.isVirtual&&p.comments&&p.comments.length>0&&!c.has(p.id)).map(p=>this.createHighlightInfo(p,A)),...d]}createMergedHighlight(e,t,A){return{...e,id:t.id,comments:t.comments||[],createdAt:t.createdAt,updatedAt:t.updatedAt,fileName:A.basename,filePath:A.path,fileIcon:"file-text"}}createHighlightInfo(e,t){return{...e,comments:e.comments||[],fileName:t.basename,filePath:t.path,fileIcon:"file-text",position:e.position||0}}};Ve.INDEX_EXPIRY_TIME=36e5,Ve.INDEX_BUILD_DELAY=3e3,Ve.DUPLICATE_POSITION_THRESHOLD=10,Ve.MIN_WORD_LENGTH=2,Ve.POSITION_SEARCH_OFFSET_BEFORE=10,Ve.POSITION_SEARCH_OFFSET_AFTER=50,Ve.DEFAULT_HIGHLIGHT_PATTERN=/==([^=\n](?:[^=\n]|=[^=\n])*?[^=\n])==|<mark[^>]*>([\s\S]*?)<\/mark>|<span[^>]*>([\s\S]*?)<\/span>/g;var zA=Ve;FA();var ps=class{constructor(e,t){this.app=e;this.highlightRepository=t;this.highlightService=new zA(e)}getPluginInstance(){let e=this.app.plugins;return e&&e.plugins?e.plugins["hi-note"]:void 0}async createExportFile(e,t,A){let i=e;A&&(this.app.vault.getAbstractFileByPath(A)||await this.app.vault.createFolder(A),i=`${A}/${e}`);try{return await this.app.vault.create(`${i}.md`,t)}catch(n){throw n.message&&n.message.includes("already exists")?new Error(m("Export file already exists. Please try again in a moment.")):new Error(m("Failed to create export file: ")+n.message)}}async exportHighlightsAsMarkdown(e){var d,g,p,C;if(!e||e.length===0)throw new Error(m("No highlights to export."));let t=this.getPluginInstance(),A={};for(let y of e)y.filePath&&(A[y.filePath]||(A[y.filePath]=[]),A[y.filePath].push(y));let i=[];for(let y in A){let F=this.app.vault.getAbstractFileByPath(y);if(!(F instanceof Ac.TFile))continue;i.push(`## ${F.basename}`),i.push("");let Q=A[y],U=(g=(d=t==null?void 0:t.settings)==null?void 0:d.export)==null?void 0:g.exportTemplate;if(U&&U.trim()!==""){let b=await this.generateContentFromTemplate(F,Q,U);b.trim()!==""&&i.push(b)}else{let b=await this.generateDefaultContent(F,Q);i.push(b)}}let n=i.join(`
`),l=((C=(p=t==null?void 0:t.settings)==null?void 0:p.export)==null?void 0:C.exportPath)||"",c=`Selected Highlights ${window.moment().format("YYYYMMDDHHmmss")}`;return await this.createExportFile(c,n,l)}async exportHighlightsToNote(e){var c,d;let t=await this.getFileHighlights(e);if(!t||t.length===0)throw new Error(m("No highlights found in the current file."));let A=await this.generateExportContent(e,t),i=this.getPluginInstance(),n=((d=(c=i==null?void 0:i.settings)==null?void 0:c.export)==null?void 0:d.exportPath)||"",l=`${e.basename} - HiNote ${window.moment().format("YYYYMMDDHHmmss")}`;return await this.createExportFile(l,A,n)}async getFileHighlights(e){let t=await this.app.vault.read(e),A=this.highlightService.extractHighlights(t,e),i=this.highlightRepository.getCachedHighlights(e.path)||[],n=i.filter(d=>d.isVirtual&&d.comments&&d.comments.length>0),l=i.filter(d=>!d.isVirtual),c=A.map(d=>{var p,C,y,F;let g=l.find(Q=>{let U=Q.text===d.text;return U&&typeof Q.position=="number"&&typeof d.position=="number"?Math.abs(Q.position-d.position)<1e3:U});return g?{...g,position:(p=d.position)!=null?p:0,paragraphOffset:(C=d.paragraphOffset)!=null?C:0}:{...d,id:d.id||it.generateHighlightId(e.path,d.position||0,d.text),position:(y=d.position)!=null?y:0,paragraphOffset:(F=d.paragraphOffset)!=null?F:0,comments:[],createdAt:Date.now(),updatedAt:Date.now()}});return[...n,...c]}async generateExportContent(e,t){var n,l;let A=this.getPluginInstance(),i=(l=(n=A==null?void 0:A.settings)==null?void 0:n.export)==null?void 0:l.exportTemplate;return i&&i.trim()!==""?this.generateContentFromTemplate(e,t,i):this.generateDefaultContent(e,t)}async generateContentFromTemplate(e,t,A){let i=[];for(let n of t){let l=await this.generateStructuredContent(n,e,A);i.push(...l),i.push("")}return i.join(`
`)}replaceVariables(e,t){let A=e;for(let[i,n]of Object.entries(t))A=A.replace(new RegExp(`{{${i}}}`,"g"),n||"");return A}formatComment(e,t=!1){let A=[],i=t?">":">>";if(!t){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";A.push(`>> [!note]+ ${l}`)}let n=e.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return A.push(n),A.push(">"),A}async generateStructuredContent(e,t,A){let i=[];if(e.isVirtual)i.push(`> [!note] [[${t.basename}]]`),i.push("> ");else if(A&&(A.includes("{{highlightText}}")||A.includes("{{highlightBlockRef}}"))){let n=this.extractHighlightTemplate(A),l="";if(typeof e.position=="number"&&A.includes("{{highlightBlockRef}}"))try{let d=e.originalLength||e.text.length;l=await this.highlightService.createBlockIdForHighlight(t,e.position,d)||""}catch(d){console.error("[ExportService] Error creating block ID:",d)}let c=this.replaceVariables(n,{sourceFile:t.basename,highlightText:e.text||"",highlightBlockRef:l,highlightType:"HiNote",commentContent:"",commentDate:""});i.push(...c.split(`
`))}else i.push("> [!quote] HiNote"),i.push(`> ${e.text||""}`),i.push("> ");if(e.comments&&e.comments.length>0)for(let n of e.comments)i.push(...this.formatComment(n,e.isVirtual));return i}extractHighlightTemplate(e){let t=e,A=/\n>>\s*\[!note\]\+[\s\S]*?(?=\n>\s*$|\n\s*$|$)/g;return t=t.replace(A,""),t=t.replace(/\{\{commentContent\}\}/g,""),t=t.replace(/\{\{commentDate\}\}/g,""),t=t.replace(/\n{3,}/g,`

`),t=t.replace(/\n>\s*\n\s*$/g,`
`),t.trim()}async generateDefaultContent(e,t){return this.generateContentFromTemplate(e,t,`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`)}};W();W();var ms=class{constructor(e,t){this.searchHintsEventHandlers=null;this.searchInput=e,this.searchContainer=t}showSearchPrefixHints(){let e=document.querySelector(".search-prefix-hints");e&&e.remove();let t=document.body.createDiv({cls:"search-prefix-hints show"});[{prefix:"all:",description:m("search-prefix-all")},{prefix:"path:",description:m("search-prefix-path")},{prefix:"hicard:",description:m("search-prefix-hicard")},{prefix:"comment:",description:m("search-prefix-comment")}].forEach(({prefix:c,description:d})=>{let g=t.createDiv({cls:"search-prefix-hint-item"});g.createSpan({cls:"search-prefix-tag",text:c}),g.createSpan({cls:"search-prefix-description",text:d}),g.addEventListener("click",()=>{this.searchInput.value=c+" ",this.searchInput.focus(),t.remove();let p=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(p)})}),this.positionSearchHints(t);let i=()=>{this.searchInput.value.trim()===""?document.body.contains(t)||(document.body.appendChild(t),this.positionSearchHints(t)):t&&document.body.contains(t)&&t.remove()};this.searchInput.addEventListener("input",i);let n=c=>{t&&!t.contains(c.target)&&c.target!==this.searchInput&&(t.remove(),document.removeEventListener("click",n))},l=()=>{setTimeout(()=>{(!document.activeElement||document.activeElement!==this.searchInput&&!t.contains(document.activeElement))&&t.remove()},200)};this.searchInput.addEventListener("blur",l),setTimeout(()=>{document.addEventListener("click",n)},10),this.searchHintsEventHandlers={input:i,blur:l,click:n}}positionSearchHints(e){let t=this.searchInput.getBoundingClientRect();e.addClass("search-hints-container"),e.style.top=t.bottom+4+"px",e.style.left=t.left+"px",e.style.width=t.width+"px"}destroy(){let e=document.querySelector(".search-prefix-hints");e&&e.remove(),this.searchHintsEventHandlers&&(this.searchInput.removeEventListener("input",this.searchHintsEventHandlers.input),this.searchInput.removeEventListener("blur",this.searchHintsEventHandlers.blur),document.removeEventListener("click",this.searchHintsEventHandlers.click),this.searchHintsEventHandlers=null)}};var fs=class{constructor(e){this.plugin=e}parseSearchInput(e){let t=e.toLowerCase().trim(),A=t.startsWith("all:"),i=t.startsWith("hicard:"),n=t.startsWith("comment:"),l=t.startsWith("path:"),c="",d=t;return A?(c="all",d=t.substring(4).trim()):i?(c="hicard",d=t.substring(7).trim()):n?(c="comment",d=t.substring(8).trim()):l&&(c="path",d=t.substring(5).trim()),{searchTerm:d,searchType:c}}filterHighlights(e,t,A="",i){return A==="path"?this.filterByPath(e,t):A==="hicard"?this.filterByFlashcard(e,t,i):A==="comment"?this.filterByComment(e,t,i):this.filterByGeneral(e,t,i)}filterByPath(e,t){return e.forEach(A=>{if(A.filePath&&!A.fileName){let i=A.filePath.split("/");A.fileName=i[i.length-1]}}),!t||t.trim()===""?e.filter(A=>!!A.filePath):e.filter(A=>A.filePath?A.filePath.toLowerCase().includes(t.toLowerCase()):!1)}filterByFlashcard(e,t,A){let i=this.plugin.fsrsManager;return i?e.filter(n=>(n.id?i.findCardsBySourceId(n.id,"highlight").length>0:!1)?t?this.matchesSearchTerm(n,t,A):!0:!1):[]}filterByComment(e,t,A){return e.filter(i=>i.comments&&i.comments.length>0?t?this.matchesSearchTerm(i,t,A):!0:!1)}filterByGeneral(e,t,A){return e.filter(i=>this.matchesSearchTerm(i,t,A))}matchesSearchTerm(e,t,A){var n,l;let i=t.toLowerCase();return!!(e.text.toLowerCase().includes(i)||(n=e.comments)!=null&&n.some(c=>c.content.toLowerCase().includes(i))||A===null&&((l=e.fileName)!=null&&l.toLowerCase().includes(i)))}};var Bs=class{constructor(e,t,A,i){this.searchDebounceTimer=null;this.isSearching=!1;this.localSearchDebounceTime=200;this.globalSearchDebounceTime=500;this.handleSearchInputWithDebounce=e=>{this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null);let t=this.searchInput.value.toLowerCase().trim(),A=t.startsWith("all:"),i=A?this.globalSearchDebounceTime:this.localSearchDebounceTime;A&&t.length>4&&this.showSearchLoadingIndicator(),this.searchDebounceTimer=window.setTimeout(async()=>{await this.performSearch(),this.searchDebounceTimer=null},i)};this.plugin=e,this.searchInput=t,this.searchLoadingIndicator=A,this.uiHelper=new ms(t,i),this.searchService=new fs(e)}setCallbacks(e,t,A){this.onSearchCallback=e,this.getHighlightsCallback=t,this.getCurrentFileCallback=A}initialize(){this.searchInput.addEventListener("focus",()=>{this.uiHelper.showSearchPrefixHints()}),this.searchInput.addEventListener("input",this.handleSearchInputWithDebounce)}destroy(){this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null),this.uiHelper.destroy()}async performSearch(){try{let e=this.searchInput.value.trim(),{searchTerm:t,searchType:A}=this.searchService.parseSearchInput(e);this.onSearchCallback&&await this.onSearchCallback(t,A)}catch(e){console.error("[\u641C\u7D22 UI \u7BA1\u7406\u5668] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",e)}finally{this.hideSearchLoadingIndicator()}}filterHighlightsByTerm(e,t=""){let A=this.getHighlightsCallback(),i=this.getCurrentFileCallback();return this.searchService.filterHighlights(A,e,t,i)}showSearchLoadingIndicator(){this.isSearching||(this.isSearching=!0,this.searchLoadingIndicator.style.display="flex")}hideSearchLoadingIndicator(){this.isSearching&&(this.isSearching=!1,this.searchLoadingIndicator.style.display="none")}getSearchValue(){return this.searchInput.value.trim()}hasSearchTerm(){return this.searchInput.value.trim()!==""}};var Cs=class{constructor(e){this.selectedCards=new Map;this.isSelectionMode=!1;this.selectionBox=null;this.selectionStartX=0;this.selectionStartY=0;this.mouseMoveThreshold=5;this.mouseMoved=!1;this.onSelectionChangeCallback=null;this.handleSelectionStart=e=>{e.target.closest(".highlight-card")||e.target.closest(".flashcard-mode")||e.target.closest(".flashcard-add-group")||e.target.closest(".flashcard-group-action")||(this.selectionStartX=e.clientX,this.selectionStartY=e.clientY,this.mouseMoved=!1,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))};this.handleMouseMove=e=>{let t=e.clientX-this.selectionStartX,A=e.clientY-this.selectionStartY;Math.sqrt(t*t+A*A)>=this.mouseMoveThreshold&&(this.mouseMoved=!0,document.removeEventListener("mousemove",this.handleMouseMove),this.startSelection(e))};this.handleMouseUp=e=>{this.cleanupMouseEvents(),this.mouseMoved||this.clearSelection()};this.handleSelectionMove=e=>{if(!this.isSelectionMode||!this.selectionBox)return;let t=e.clientX-this.selectionStartX,A=e.clientY-this.selectionStartY;t<0?(this.selectionBox.style.left=`${e.clientX}px`,this.selectionBox.style.width=`${-t}px`):this.selectionBox.style.width=`${t}px`,A<0?(this.selectionBox.style.top=`${e.clientY}px`,this.selectionBox.style.height=`${-A}px`):this.selectionBox.style.height=`${A}px`,this.selectCardsInBox()};this.handleSelectionEnd=e=>{this.isSelectionMode&&(this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.isSelectionMode=!1,this.cleanupSelectionEvents(),this.updateSelectedHighlights())};this.highlightContainer=e}setOnSelectionChange(e){this.onSelectionChangeCallback=e}initialize(){this.setupSelectionBox()}clearSelection(){this.selectedCards.forEach((e,t)=>{t.removeClass("selected")}),this.selectedCards.clear(),this.isSelectionMode=!1,this.notifySelectionChange()}updateSelectedHighlights(){this.selectedCards.clear(),Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected")).forEach(t=>{let A=t.getAttribute("data-highlight");if(A)try{let i=JSON.parse(A);this.selectedCards.set(t,i)}catch(i){console.error("Error parsing highlight data:",i)}}),this.notifySelectionChange()}getSelectedHighlights(){let e=new Set;return this.selectedCards.forEach(t=>{e.add(t)}),e}getSelectedCount(){return this.selectedCards.size}selectCard(e,t){this.selectedCards.set(e,t),e.addClass("selected"),this.notifySelectionChange()}unselectCard(e){this.selectedCards.has(e)&&(e.removeClass("selected"),this.selectedCards.delete(e),this.notifySelectionChange())}isCardSelected(e){return this.selectedCards.has(e)}isInSelectionMode(){return this.isSelectionMode}setupSelectionBox(){this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.cleanupMouseEvents(),this.cleanupSelectionEvents(),this.highlightContainer.addEventListener("mousedown",this.handleSelectionStart)}startSelection(e){this.cleanupMouseEvents(),this.selectedCards.size>0&&this.clearSelection(),this.selectionBox=document.createElement("div"),this.selectionBox.className="selection-box",this.selectionBox.style.left=`${this.selectionStartX}px`,this.selectionBox.style.top=`${this.selectionStartY}px`,document.body.appendChild(this.selectionBox),this.isSelectionMode=!0,document.addEventListener("mousemove",this.handleSelectionMove),document.addEventListener("mouseup",this.handleSelectionEnd)}selectCardsInBox(){if(!this.selectionBox)return;let e=this.selectionBox.getBoundingClientRect();this.highlightContainer.querySelectorAll(".highlight-card").forEach(A=>{let i=A.getBoundingClientRect();!(e.right<i.left||e.left>i.right||e.bottom<i.top||e.top>i.bottom)?A.addClass("selected"):document.querySelector(".multi-select-mode")||A.removeClass("selected")})}notifySelectionChange(){this.onSelectionChangeCallback&&this.onSelectionChangeCallback(this.selectedCards.size)}cleanupMouseEvents(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)}cleanupSelectionEvents(){document.removeEventListener("mousemove",this.handleSelectionMove),document.removeEventListener("mouseup",this.handleSelectionEnd)}destroy(){this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.clearSelection(),this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.cleanupMouseEvents(),this.cleanupSelectionEvents()}};var ae=require("obsidian");W();var ws=class{constructor(e,t,A,i,n){this.multiSelectActionsContainer=null;this.plugin=e,this.exportService=t,this.licenseManager=A,this.highlightService=i,this.containerEl=n}setCallbacks(e,t,A){this.getSelectedHighlightsCallback=e,this.onClearSelectionCallback=t,this.onRefreshViewCallback=A}async showMultiSelectActions(e){if(e<=1){this.hideMultiSelectActions();return}this.hideMultiSelectActions(),this.multiSelectActionsContainer||(this.multiSelectActionsContainer=this.containerEl.createEl("div",{cls:"multi-select-actions"})),this.multiSelectActionsContainer.show(),this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.createEl("div",{cls:"selected-count",text:`selected ${e}`}),this.createExportButton(),await this.createFlashcardButtons(),this.createDeleteButton()}hideMultiSelectActions(){this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.hide())}createExportButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",m("Export")),(0,ae.setIcon)(e,"file-input"),e.addEventListener("click",()=>{this.exportSelectedHighlights()})}async createFlashcardButtons(){if(!this.multiSelectActionsContainer)return;let e=this.plugin.fsrsManager;if(!e){this.createDefaultFlashcardButton();return}let t=this.getSelectedHighlightsCallback(),A=0;for(let i of t)if(i.id){let n=e.findCardsBySourceId(i.id,"highlight");n&&n.length>0&&A++}A===0?this.createFlashcardCreateButton():A===t.size?this.createFlashcardDeleteButton():this.createFlashcardManageButton()}createDefaultFlashcardButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",m("Create HiCard")),(0,ae.setIcon)(e,"book-plus"),e.addEventListener("click",()=>{new ae.Notice(m("HiCard function is not initialized, please enable FSRS function"))})}createFlashcardCreateButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",m("Create HiCard")),(0,ae.setIcon)(e,"book-plus"),this.licenseManager.isActivated().then(t=>{t?this.licenseManager.isFeatureEnabled("flashcard").then(A=>{A||(e.addClass("disabled-button"),e.setAttribute("aria-label",m("Only HiNote Pro")))}):(e.addClass("disabled-button"),e.setAttribute("aria-label",m("Only HiNote Pro")))}),e.addEventListener("click",async()=>{if(e.hasClass("disabled-button")){new ae.Notice(m("Only HiNote Pro"));return}await this.createMissingFlashcards()})}createFlashcardDeleteButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button delete-flashcard-button"});e.setAttribute("aria-label",m("Delete HiCard")),(0,ae.setIcon)(e,"book-x"),e.addEventListener("click",()=>{this.deleteFlashcardsFromSelected()})}createFlashcardManageButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",m("Manage HiCard")),(0,ae.setIcon)(e,"book-heart"),e.addEventListener("click",t=>{this.showFlashcardManageMenu(t)})}createDeleteButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",m("Delete")),(0,ae.setIcon)(e,"trash"),e.addEventListener("click",()=>{this.deleteSelectedHighlights()})}async exportSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ae.Notice(m("Please select highlights to export"));return}try{let t=Array.from(e),A=await this.exportService.exportHighlightsAsMarkdown(t);new ae.Notice(m("Successfully exported selected highlights to: ")+A.path),this.onClearSelectionCallback()}catch(t){console.error("Failed to export highlights:",t),new ae.Notice(m("Failed to export highlights: ")+(t instanceof Error?t.message:String(t)))}}async createMissingFlashcards(){let e=await this.licenseManager.isActivated(),t=e?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(!e||!t){new ae.Notice(m("Only HiNote Pro"));return}let A=this.plugin.fsrsManager;if(!A){new ae.Notice(m("HiCard function is not initialized, please enable FSRS function"));return}let i=this.getSelectedHighlightsCallback(),n=0,l=0;for(let c of i)try{if(c.id){let d=A.findCardsBySourceId(c.id,"highlight");if(d&&d.length>0)continue;let g=Ie.findCardInstanceByHighlightId(c.id),p=!1,C=null;if(g)p=await g.createHiCardForHighlight(!0);else{let y=document.createElement("div");C=new Ie(y,c,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1);try{p=await C.createHiCardForHighlight(!0)}finally{C.destroy()}}p?n++:l++}}catch(d){l++,console.error("Create HiCard failed:",d)}n>0&&this.plugin.eventManager.emitFlashcardChanged(),this.showResultNotice(n,l,"create"),this.onClearSelectionCallback(),await this.onRefreshViewCallback()}deleteFlashcardsFromSelected(){let e=new ae.Modal(this.plugin.app);e.titleEl.setText(m("Confirm delete HiCard")),e.contentEl.createEl("p",{text:m("Are you sure you want to delete the HiCards of the selected highlights? This action cannot be undone.")});let t=e.contentEl.createEl("div",{cls:"modal-button-container"});t.createEl("button",{text:m("Cancel")}).addEventListener("click",()=>e.close()),t.createEl("button",{cls:"mod-warning",text:m("Delete")}).addEventListener("click",async()=>{e.close(),await this.deleteExistingFlashcards()}),e.open()}async deleteExistingFlashcards(){let e=this.plugin.fsrsManager;if(!e){new ae.Notice(m("HiCard function is not initialized, please enable FSRS function"));return}let t=this.getSelectedHighlightsCallback(),A=0,i=0;for(let n of t)try{if(n.id){let l=e.findCardsBySourceId(n.id,"highlight");if(!l||l.length===0)continue;let c=Ie.findCardInstanceByHighlightId(n.id),d=!1,g=null;if(c)d=await c.deleteHiCardForHighlight(!0);else{let p=document.createElement("div");g=new Ie(p,n,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1);try{d=await g.deleteHiCardForHighlight(!0)}finally{g.destroy()}}d?A++:i++}}catch(l){i++,console.error("Failed to delete HiCard:",l)}A>0&&this.plugin.eventManager.emitFlashcardChanged(),this.showResultNotice(A,i,"delete"),this.onClearSelectionCallback(),await this.onRefreshViewCallback()}deleteSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ae.Notice(m("No highlights selected"));return}let t=new ae.Modal(this.plugin.app);t.titleEl.setText(m("Confirm delete highlights")),t.contentEl.createEl("p",{text:m(`Are you sure you want to delete ${e.size} highlights and all their data, including Comments and HiCards? This action cannot be undone.`)});let A=t.contentEl.createEl("div",{cls:"modal-button-container"});A.createEl("button",{text:m("Cancel")}).addEventListener("click",()=>t.close()),A.createEl("button",{cls:"mod-warning",text:m("Delete")}).addEventListener("click",async()=>{t.close(),await this.performDeleteSelectedHighlights()}),t.open()}async performDeleteSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ae.Notice(m("No highlights selected"));return}let t=Array.from(e),A=0,i=0,n=0;try{let d=this.plugin.fsrsManager;if(d){for(let C of t)if(C.id)try{d.deleteCardsBySourceId(C.id,"highlight")}catch(y){console.error("[BatchDelete] \u5220\u9664\u95EA\u5361\u5931\u8D25:",C.id,y)}}let g=t.filter(C=>C.filePath&&C.text).map(C=>({text:C.text,position:C.position,filePath:C.filePath,originalLength:C.originalLength}));if(g.length>0){let C=await this.highlightService.batchRemoveHighlightMarks(g);A=C.success,i=C.failed}let p=this.plugin.highlightManager;if(p){let C=new Map;for(let y of t)y.filePath&&y.id&&(C.has(y.filePath)||C.set(y.filePath,[]),C.get(y.filePath).push(y));for(let[y,F]of C)try{let Q=this.plugin.app.vault.getAbstractFileByPath(y);if(Q instanceof ae.TFile)for(let U of F)try{await p.removeHighlight(Q,U)}catch(b){console.error("[BatchDelete] \u4ECE HighlightManager \u5220\u9664\u5931\u8D25:",U.id,b),n++}}catch(Q){console.error("[BatchDelete] \u5904\u7406\u6587\u4EF6\u5931\u8D25:",y,Q),n+=F.length}}for(let C of t)if(C.id)try{let y=Ie.findCardInstanceByHighlightId(C.id);if(y){let F=y.card;F&&F.remove(),y.destroy()}}catch(y){console.error("[BatchDelete] \u6E05\u7406\u5361\u7247\u5B9E\u4F8B\u5931\u8D25:",C.id,y)}if(A>0)for(let C of t)C.filePath&&C.id&&this.plugin.eventManager.emitHighlightDelete(C.filePath,C.text||"",C.id)}catch(d){console.error("[BatchDelete] \u6279\u91CF\u5220\u9664\u8FC7\u7A0B\u51FA\u9519:",d),i=t.length}this.onClearSelectionCallback();let l=A,c=i+n;if(l>0&&c===0)new ae.Notice(m(`\u6210\u529F\u5220\u9664 ${l} \u4E2A\u9AD8\u4EAE`));else if(l>0&&c>0){let d=m(`\u6210\u529F\u5220\u9664 ${l} \u4E2A\u9AD8\u4EAE`);i>0&&(d+=m(`\uFF0C${i} \u4E2A\u6587\u4EF6\u6807\u8BB0\u5220\u9664\u5931\u8D25`)),n>0&&(d+=m(`\uFF0C${n} \u4E2A\u6570\u636E\u5220\u9664\u5931\u8D25`)),new ae.Notice(d)}else c>0&&new ae.Notice(m("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25"))}showFlashcardManageMenu(e){let{Menu:t}=require("obsidian"),A=new t;A.addItem(n=>{n.setTitle(m("Create missing HiCard")).setIcon("plus-circle").onClick(async()=>{await this.createMissingFlashcards()})}),A.addItem(n=>{n.setTitle(m("Delete existing HiCards")).setIcon("trash").onClick(()=>{this.deleteFlashcardsFromSelected()})});let i=e.currentTarget;if(i){let n=i.getBoundingClientRect();A.showAtPosition({x:n.left-85,y:n.top-60})}else A.showAtMouseEvent(e)}showResultNotice(e,t,A){let i=A==="create"?"created":"deleted";e>0&&t===0?new ae.Notice(m(`Successfully ${i} ${e} HiCard`)):e>0&&t>0?new ae.Notice(m(`Successfully ${i} ${e} HiCard, ${t} failed`)):e===0&&t===0?new ae.Notice(m(`No HiCard to ${A}`)):new ae.Notice(m(`Failed to ${A} HiCard! Please check the selected highlight content`))}destroy(){this.hideMultiSelectActions(),this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.remove(),this.multiSelectActionsContainer=null)}};var ZA=require("obsidian");W();var vs=class{constructor(e,t,A,i){this.onFileSelect=null;this.onFlashcardModeToggle=null;this.onAllHighlightsSelect=null;this.onRefreshView=null;this.currentFile=null;this.isFlashcardMode=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isDraggedToMainView=!1;this.cachedFiles=null;this.cachedFileCounts=null;this.cacheTimestamp=0;this.CACHE_EXPIRY=6e4;this.container=e,this.plugin=t,this.highlightService=A,this.licenseManager=i}setCallbacks(e){e.onFileSelect&&(this.onFileSelect=e.onFileSelect),e.onFlashcardModeToggle&&(this.onFlashcardModeToggle=e.onFlashcardModeToggle),e.onAllHighlightsSelect&&(this.onAllHighlightsSelect=e.onAllHighlightsSelect),e.onRefreshView&&(this.onRefreshView=e.onRefreshView)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.isFlashcardMode!==void 0&&(this.isFlashcardMode=e.isFlashcardMode),e.isMobileView!==void 0&&(this.isMobileView=e.isMobileView),e.isSmallScreen!==void 0&&(this.isSmallScreen=e.isSmallScreen),e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView)}async updateFileList(e=!1){if(e&&this.invalidateCache(),this.container.children.length>0&&!e){this.updateFileListSelection();return}await this.createFileList()}async createFileList(){this.container.empty();let t=this.container.createEl("div",{cls:"highlight-file-list-header"}).createEl("div",{text:"HiNote",cls:"highlight-file-list-title"});t.style.cursor="pointer",t.addEventListener("click",async()=>{await this.updateFileList(!0),this.onRefreshView&&await this.onRefreshView()});let A=this.container.createEl("div",{cls:"highlight-file-list"});await this.createAllHighlightsItem(A),await this.createFlashcardItem(A),A.createEl("div",{cls:"highlight-file-list-separator"});let i=await this.getFilesWithHighlights();for(let n of i)await this.createFileItem(A,n)}async createAllHighlightsItem(e){let t=e.createEl("div",{cls:`highlight-file-item highlight-file-item-all ${this.currentFile===null&&!this.isFlashcardMode?"is-active":""}`}),A=t.createEl("div",{cls:"highlight-file-item-left"}),i=A.createEl("span",{cls:"highlight-file-item-icon"});(0,ZA.setIcon)(i,"square-library"),A.createEl("span",{text:m("All Highlight"),cls:"highlight-file-item-name"});let n=await this.getTotalHighlightsCount();t.createEl("span",{text:`${n}`,cls:"highlight-file-item-count"}),t.addEventListener("click",async()=>{this.onAllHighlightsSelect&&this.onAllHighlightsSelect()})}async createFlashcardItem(e){let t=e.createEl("div",{cls:`highlight-file-item highlight-file-item-flashcard ${this.isFlashcardMode?"is-active":""}`}),A=t.createEl("div",{cls:"highlight-file-item-left"}),i=A.createEl("span",{cls:"highlight-file-item-icon"});(0,ZA.setIcon)(i,"book-heart"),A.createEl("span",{text:m("HiCard"),cls:"highlight-file-item-name"});let n=t.createEl("span",{cls:"highlight-file-item-count"}),l=()=>{let c=this.plugin.fsrsManager.getTotalCardsCount();n.textContent=`${c}`};l(),this.plugin.eventManager.on("flashcard:changed",()=>{l()}),t.addEventListener("click",async()=>{this.onFlashcardModeToggle&&this.onFlashcardModeToggle(!0)})}async createFileItem(e,t){var d;let A=e.createEl("div",{cls:`highlight-file-item ${((d=this.currentFile)==null?void 0:d.path)===t.path?"is-active":""}`});A.setAttribute("data-path",t.path);let i=A.createEl("div",{cls:"highlight-file-item-left"}),n=i.createEl("span",{cls:"highlight-file-item-icon",attr:{"aria-label":m("Open (DoubleClick)")}});(0,ZA.setIcon)(n,"file-text"),n.addEventListener("dblclick",async g=>{g.stopPropagation(),await this.getPreferredLeaf().openFile(t)});let l=i.createEl("span",{text:t.basename,cls:"highlight-file-item-name"});this.addPagePreview(l,t);let c=await this.getFileHighlightsCount(t);A.createEl("span",{text:`${c}`,cls:"highlight-file-item-count"}),A.addEventListener("click",async()=>{this.onFileSelect&&this.onFileSelect(t)})}updateFileListSelection(){let e=this.container.querySelector(".highlight-file-item-all");e&&e.classList.toggle("is-active",this.currentFile===null&&!this.isFlashcardMode);let t=this.container.querySelector(".highlight-file-item-flashcard");t&&t.classList.toggle("is-active",this.isFlashcardMode),this.container.querySelectorAll(".highlight-file-item:not(.highlight-file-item-all):not(.highlight-file-item-flashcard)").forEach(i=>{var l;let n=((l=this.currentFile)==null?void 0:l.path)===i.getAttribute("data-path");i.classList.toggle("is-active",n)})}invalidateCache(){this.cachedFiles=null,this.cachedFileCounts=null,this.cacheTimestamp=0}async getFilesWithHighlights(){let e=Date.now();if(this.cachedFiles&&e-this.cacheTimestamp<this.CACHE_EXPIRY)return this.cachedFiles;let t=this.highlightService.getAllHighlightsFromCache();if(t&&t.length>0){let i=new Set,n=new Map;for(let c of t)c.filePath&&(i.add(c.filePath),n.set(c.filePath,(n.get(c.filePath)||0)+1));let l=[];for(let c of i){let d=this.plugin.app.vault.getAbstractFileByPath(c);d instanceof ZA.TFile&&l.push(d)}return this.cachedFiles=l,this.cachedFileCounts=n,this.cacheTimestamp=e,l}let A=await this.getFilesWithHighlightsLegacy();return this.cachedFiles=A,this.cacheTimestamp=e,A}async getFilesWithHighlightsLegacy(){let t=this.plugin.app.vault.getMarkdownFiles().filter(n=>this.highlightService.shouldProcessFile(n)),A=[],i=new Map;for(let n of t){let l=await this.plugin.app.vault.read(n),c=this.highlightService.extractHighlights(l,n);c.length>0&&(A.push(n),i.set(n.path,c.length))}return this.cachedFileCounts=i,A}async getFileHighlightsCount(e){if(this.cachedFileCounts&&this.cachedFileCounts.has(e.path))return this.cachedFileCounts.get(e.path);let t=await this.plugin.app.vault.read(e),A=this.highlightService.extractHighlights(t,e).length;return this.cachedFileCounts||(this.cachedFileCounts=new Map),this.cachedFileCounts.set(e.path,A),A}getTotalHighlightsCount(){let e=this.highlightService.getAllHighlightsFromCache();if(e)return e.length;if(this.cachedFileCounts){let t=0;for(let A of this.cachedFileCounts.values())t+=A;return t}return 0}addPagePreview(e,t){let A;e.addEventListener("mouseenter",i=>{A=setTimeout(async()=>{let n=i.target;this.plugin.app.workspace.trigger("hover-link",{event:i,source:"hi-note",hoverParent:n,targetEl:n,linktext:t.path})},300)}),e.addEventListener("mouseleave",()=>{A&&clearTimeout(A)})}getPreferredLeaf(){let e=this.plugin.app.workspace.getLeavesOfType("markdown");if(this.isDraggedToMainView){let t=e.find(A=>A!==this.plugin.app.workspace.activeLeaf);if(t)return t}return this.plugin.app.workspace.getLeaf("split","vertical")}destroy(){this.container.empty(),this.onFileSelect=null,this.onFlashcardModeToggle=null,this.onAllHighlightsSelect=null,this.onRefreshView=null}};var ys=class{constructor(e,t,A){this.app=e,this.highlightService=t,this.highlightRepository=A}async loadFileHighlights(e){if(!this.highlightService.shouldProcessFile(e))return[];let t=await this.app.vault.read(e),A=this.highlightService.extractHighlights(t,e),i=await this.highlightRepository.getFileHighlights(e.path);return this.mergeHighlightsWithComments(A,i,e)}async loadAllHighlights(e="",t=""){let A=[];if(t==="path"){let i=await this.highlightService.getAllHighlights();for(let{file:n,highlights:l}of i){if(e&&!n.path.toLowerCase().includes(e.toLowerCase()))continue;let c=await this.highlightRepository.getFileHighlights(n.path),d=this.mergeHighlightsWithComments(l,c,n);A.push(...d)}}else{let i=await this.highlightService.getAllHighlights();for(let{file:n,highlights:l}of i){let c=await this.highlightRepository.getFileHighlights(n.path),d=this.mergeHighlightsWithComments(l,c,n);if(e){let g=d.filter(p=>{var C;return p.text.toLowerCase().includes(e.toLowerCase())||((C=p.comments)==null?void 0:C.some(y=>y.content.toLowerCase().includes(e.toLowerCase())))});A.push(...g)}else A.push(...d)}}return A}mergeHighlightsWithComments(e,t,A){return this.highlightService.mergeHighlightsWithComments(e,t,A)}markAsGlobalSearch(e,t=!0){return e.map(A=>({...A,isGlobalSearch:t}))}markAsCanvasSource(e,t){return e.map(A=>({...A,isFromCanvas:!0,isGlobalSearch:!0,canvasSource:t.path}))}};var Es=require("obsidian");FA();W();var Fs=class{constructor(e,t,A){this.onRefreshView=null;this.onHighlightsUpdate=null;this.onCardUpdate=null;this.currentFile=null;this.highlights=[];this.app=e,this.plugin=t,this.highlightManager=A}setCallbacks(e){e.onRefreshView&&(this.onRefreshView=e.onRefreshView),e.onHighlightsUpdate&&(this.onHighlightsUpdate=e.onHighlightsUpdate),e.onCardUpdate&&(this.onCardUpdate=e.onCardUpdate)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.highlights!==void 0&&(this.highlights=e.highlights)}async addComment(e,t){var n;let A=await this.getFileForHighlight(e);if(!A){new Es.Notice(m("No corresponding file found."));return}e.id||(e.id=it.generateHighlightId(((n=this.currentFile)==null?void 0:n.path)||"",e.position||0,e.text)),e.comments||(e.comments=[]);let i={id:it.generateCommentId(),content:t,createdAt:Date.now(),updatedAt:Date.now()};e.comments.push(i),e.updatedAt=Date.now(),await this.highlightManager.addHighlight(A,e),this.dispatchCommentUpdateEvent(e),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}async updateComment(e,t,A){let i=await this.getFileForHighlight(e);if(!i||!e.comments)return;let n=e.comments.find(l=>l.id===t);if(n){let l=n.content;n.content=A,n.updatedAt=Date.now(),e.updatedAt=Date.now(),await this.highlightManager.addHighlight(i,e),this.dispatchCommentUpdateEvent(e),e.id&&this.plugin.eventManager.emitCommentUpdate(i.path,l,A,e.id),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}}async deleteComment(e,t){let A=await this.getFileForHighlight(e);if(!(!A||!e.comments)){if(e.comments=e.comments.filter(i=>i.id!==t),e.updatedAt=Date.now(),e.comments.length===0){let i=e.id?this.checkHasFlashcard(e.id):!1;e.isVirtual||!i?(await this.highlightManager.removeHighlight(A,e),this.highlights=this.highlights.filter(n=>n.id&&e.id?n.id!==e.id:!(n.position===e.position&&n.text===e.text)),this.onHighlightsUpdate&&this.onHighlightsUpdate(this.highlights)):await this.highlightManager.addHighlight(A,e)}else await this.highlightManager.addHighlight(A,e);this.dispatchCommentUpdateEvent(e),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}}async deleteVirtualHighlight(e){if(!e.isVirtual||e.comments&&e.comments.length>0)return;let t=await this.getFileForHighlight(e);t&&(await this.highlightManager.removeHighlight(t,e),this.highlights=this.highlights.filter(A=>A.id&&e.id?A.id!==e.id:!(A.position===e.position&&A.text===e.text)),this.onHighlightsUpdate&&this.onHighlightsUpdate(this.highlights),this.onRefreshView&&await this.onRefreshView())}async getFileForHighlight(e){if(this.currentFile)return this.currentFile;if(e.filePath){let t=this.app.vault.getAbstractFileByPath(e.filePath);if(t instanceof Es.TFile)return t}if(e.fileName){let A=this.app.vault.getFiles().find(i=>i.basename===e.fileName||i.name===e.fileName);if(A)return A}return null}checkHasFlashcard(e){let t=this.plugin.fsrsManager;if(!t||!e)return!1;let A=t.findCardsBySourceId(e,"highlight");return A&&A.length>0}dispatchCommentUpdateEvent(e){window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:e.text,comments:e.comments}}))}};W();var Vt=require("obsidian");var Is=class{constructor(e,t,A,i,n){this.card=e;this.highlight=t;this.existingComment=A;this.plugin=i;this.options=n;this.cancelEdit=()=>{};this.isProcessing=!1;this.isAIProcessing=!1;this.originalContent="";this.commentEl=null;this.boundHandleOutsideClick=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundHandleOutsideClick),this.notifyInputShown()}show(){this.existingComment?this.showEditMode():this.showCreateMode()}showEditMode(){var n;let e=this.card.querySelector(`[data-comment-id="${this.existingComment.id}"]`);if(!e)return;this.commentEl=e,e.addClass("editing");let t=e.querySelector(".hi-note-content");if(!t)return;let A=((n=this.existingComment)==null?void 0:n.content)||"";this.textarea=document.createElement("textarea"),this.textarea.value=A,this.textarea.className="hi-note-input",this.textarea.style.minHeight=`${t.offsetHeight}px`,this.textarea.addEventListener("input",()=>{this.autoResizeTextarea()}),this.textarea.addEventListener("click",l=>{l.stopPropagation()}),t.replaceWith(this.textarea);let i=e.querySelector(".hi-note-footer");i&&i.addClass("hi-note-hidden"),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",l=>{l.stopPropagation()}),this.setupActionHint(),this.options.onDelete&&this.actionHint.createEl("div",{cls:"hi-note-delete-link",text:m("Delete comment")}).addEventListener("click",async c=>{var d,g;if(c.stopPropagation(),!this.isProcessing){this.isProcessing=!0,document.removeEventListener("click",this.boundHandleOutsideClick);try{await((g=(d=this.options).onDelete)==null?void 0:g.call(d)),setTimeout(()=>{this.destroySafe()},0)}catch(p){console.error("\u5220\u9664\u8BC4\u8BBA\u5931\u8D25:",p),document.addEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1}}}),this.setupKeyboardEvents(t,i||void 0),setTimeout(()=>{this.textarea.focus(),this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length)},50)}showCreateMode(){let e=document.createElement("div");e.className="hi-note-input",this.textarea=e.createEl("textarea"),this.textarea.addEventListener("input",()=>{this.autoResizeTextarea()}),e.addEventListener("click",i=>{i.stopPropagation()});let t=this.card.querySelector(".hi-notes-section");t||(t=this.card.createEl("div",{cls:"hi-notes-section"}),t.createEl("div",{cls:"hi-notes-list"}));let A=t.querySelector(".hi-notes-list");A&&A.insertBefore(e,A.firstChild),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",i=>{i.stopPropagation()}),this.setupActionHint(),this.setupKeyboardEvents(),setTimeout(()=>{this.textarea.focus()},50)}setupKeyboardEvents(e,t){let A=this.existingComment?{contentEl:e,footer:t}:null;this.cancelEdit=()=>{this.cancel(A)},this.textarea.onkeydown=async i=>{if(i.key==="Tab"){i.preventDefault(),await this.handleInlineAI();return}if(i.key==="Enter"){if(Vt.Platform.isMobile)return;if(i.shiftKey||(i.preventDefault(),this.isProcessing))return;let n=this.textarea.value.trim();if(!n)return;this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(n),this.destroy()}catch(l){this.textarea.disabled=!1,this.isProcessing=!1}}}}autoResizeTextarea(){this.textarea&&requestAnimationFrame(()=>{if(!this.textarea)return;let e=window.pageYOffset||document.documentElement.scrollTop;this.textarea.style.height="auto";let t=this.textarea.scrollHeight;this.textarea.style.height=`${t}px`,window.scrollTo(0,e)})}handleOutsideClick(e){if(!this.textarea||this.isProcessing)return;let t=e.target;if(!this.textarea.contains(t)&&!t.closest(".hi-note-actions-hint")){e.preventDefault(),e.stopPropagation(),this.isProcessing=!0;let i=this.textarea.value.trim();i?(this.textarea.disabled=!0,this.options.onSave(i).then(()=>{this.destroy()}).catch(()=>{this.textarea.disabled=!1,this.isProcessing=!1})):this.cancel()}}async handleInlineAI(){var t;let e=this.textarea.value.trim();if(!e){new Vt.Notice(m("Please enter AI instruction"));return}if(!this.isAIProcessing){this.originalContent=e;try{this.setAILoading(!0);let A=this.highlight.text||"",n=await new Ot(this.plugin.settings.ai).generateResponse(e,A,((t=this.existingComment)==null?void 0:t.content)||"");this.textarea.value=n,this.autoResizeTextarea(),new Vt.Notice(m("AI response generated"))}catch(A){console.error("AI\u5185\u8054\u751F\u6210\u5931\u8D25:",A),this.textarea.value=this.originalContent,new Vt.Notice(m(`AI generation failed: ${A.message}`))}finally{this.setAILoading(!1)}}}setAILoading(e){if(this.isAIProcessing=e,e){if(this.textarea.disabled=!0,this.textarea.style.opacity="0.6",this.actionHint){let t=this.actionHint.querySelector(".hi-note-delete-link");if(t&&(t.style.visibility="hidden"),!this.actionHint.querySelector(".ai-loading-hint")){let n=this.actionHint.createEl("span",{cls:"ai-loading-hint"}).createEl("span",{cls:"ai-loading-icon"});(0,Vt.setIcon)(n,"loader")}}}else if(this.textarea.disabled=!1,this.textarea.style.opacity="1",this.actionHint){let t=this.actionHint.querySelector(".ai-loading-hint");t&&t.remove();let A=this.actionHint.querySelector(".hi-note-delete-link");A&&(A.style.visibility="")}}cancel(e){var t;if(this.notifyInputClosed(),this.existingComment&&(e!=null&&e.contentEl)&&(e!=null&&e.footer))this.textarea.replaceWith(e.contentEl),this.actionHint.remove(),e.footer.removeClass("hi-note-hidden");else{let A=this.textarea.closest(".hi-note-input");A&&A.remove(),this.card.querySelector(".hi-note")||(t=this.card.querySelector(".hi-notes-section"))==null||t.remove()}document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.options.onCancel()}destroy(){this.notifyInputClosed(),document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea&&this.textarea.parentElement&&this.textarea.remove(),this.actionHint&&this.actionHint.parentElement&&this.actionHint.remove(),this.commentEl&&(this.commentEl.removeClass("editing"),this.commentEl=null)}destroySafe(){try{this.notifyInputClosed(),document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea&&this.textarea.isConnected&&this.textarea.parentElement&&this.textarea.remove(),this.actionHint&&this.actionHint.isConnected&&this.actionHint.parentElement&&this.actionHint.remove(),this.commentEl&&this.commentEl.isConnected&&(this.commentEl.removeClass("editing"),this.commentEl=null)}catch(e){console.error("[CommentInput] \u5B89\u5168\u9500\u6BC1\u65F6\u51FA\u9519:",e)}}setupActionHint(){Vt.Platform.isMobile?this.actionHint.createEl("button",{cls:"hi-note-save-button",text:m("Submit")}).addEventListener("click",async t=>{t.stopPropagation(),await this.handleSave()}):this.actionHint.createEl("span",{cls:"hi-note-hint",text:m("Tab AI, Shift + Enter Wrap, Enter Save")})}async handleSave(){if(this.isProcessing)return;let e=this.textarea.value.trim();if(e){this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(e),this.destroy()}catch(t){this.isProcessing=!1,this.textarea.disabled=!1}}}notifyInputShown(){let e=new CustomEvent("comment-input-shown",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(e)}notifyInputClosed(){let e=new CustomEvent("comment-input-closed",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(e)}};var Hs=class{constructor(e){this.onCommentSave=null;this.onCommentDelete=null;this.onCommentCancel=null;this.onViewUpdate=null;this.plugin=e}setCallbacks(e){e.onCommentSave&&(this.onCommentSave=e.onCommentSave),e.onCommentDelete&&(this.onCommentDelete=e.onCommentDelete),e.onCommentCancel&&(this.onCommentCancel=e.onCommentCancel),e.onViewUpdate&&(this.onViewUpdate=e.onViewUpdate)}showCommentInput(e,t,A){this.currentEditingHighlightId=t.id,new Is(e,t,A,this.plugin,{onSave:async i=>{this.onCommentSave&&await this.onCommentSave(t,i,A),this.onViewUpdate&&await this.onViewUpdate()},onDelete:A?async()=>{this.onCommentDelete&&await this.onCommentDelete(t,A.id)}:void 0,onCancel:async()=>{this.onCommentCancel&&await this.onCommentCancel(t)}}).show()}getCurrentEditingHighlightId(){return this.currentEditingHighlightId}clearEditingState(){this.currentEditingHighlightId=void 0}};var ic=require("obsidian"),Qs=class{constructor(e,t,A,i){this.onCreateFloatingButton=null;this.onRemoveFloatingButton=null;this.onUpdateFileList=null;this.isDraggedToMainView=!1;this.isFlashcardMode=!1;this.isShowingFileList=!0;this.isMobileView=!1;this.isSmallScreen=!1;this.containerEl=e,this.fileListContainer=t,this.mainContentContainer=A,this.searchContainer=i}setCallbacks(e){e.onCreateFloatingButton&&(this.onCreateFloatingButton=e.onCreateFloatingButton),e.onRemoveFloatingButton&&(this.onRemoveFloatingButton=e.onRemoveFloatingButton),e.onUpdateFileList&&(this.onUpdateFileList=e.onUpdateFileList)}updateState(e){e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView),e.isFlashcardMode!==void 0&&(this.isFlashcardMode=e.isFlashcardMode),e.isShowingFileList!==void 0&&(this.isShowingFileList=e.isShowingFileList),e.isMobileView!==void 0&&(this.isMobileView=e.isMobileView),e.isSmallScreen!==void 0&&(this.isSmallScreen=e.isSmallScreen)}async updateViewLayout(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen(),this.fileListContainer.removeClass("highlight-display-block"),this.fileListContainer.removeClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none");let e=this.containerEl.children[1];this.isDraggedToMainView?e.addClass("is-in-main-view"):e.removeClass("is-in-main-view"),this.isSmallScreen?e.addClass("is-small-screen"):e.removeClass("is-small-screen"),this.isDraggedToMainView?(this.isMobileView&&this.isSmallScreen?this.applySmallScreenLayout():this.applyLargeScreenLayout(),this.onCreateFloatingButton&&this.onCreateFloatingButton(),this.onUpdateFileList&&("requestIdleCallback"in window?requestIdleCallback(async()=>{this.onUpdateFileList&&await this.onUpdateFileList(!0)}):setTimeout(async()=>{this.onUpdateFileList&&await this.onUpdateFileList(!0)},50))):this.applySidebarLayout()}applySmallScreenLayout(){this.isShowingFileList?(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.addClass("highlight-display-none"),this.fileListContainer.addClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width"))}applyLargeScreenLayout(){this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width")}applySidebarLayout(){if(this.fileListContainer.addClass("highlight-display-none"),this.onRemoveFloatingButton&&this.onRemoveFloatingButton(),!this.isFlashcardMode){this.searchContainer.removeClass("highlight-display-none");let e=this.searchContainer.querySelector(".highlight-search-icons");e&&e.removeClass("highlight-display-none")}}checkIfMobile(){return ic.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}getDeviceInfo(){return{isMobile:this.isMobileView,isSmallScreen:this.isSmallScreen,isDraggedToMainView:this.isDraggedToMainView}}};var Ss=class{constructor(e,t){this.onPositionChange=null;this.isDraggedToMainView=!1;this.app=e,this.leaf=t}setCallbacks(e){e.onPositionChange&&(this.onPositionChange=e.onPositionChange)}updateState(e){e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView)}async checkViewPosition(e){let t=this.app.workspace.rootSplit;if(!t)return;let A=this.isViewInMainArea(this.leaf,t);this.isDraggedToMainView!==A&&(this.isDraggedToMainView=A,this.onPositionChange&&await this.onPositionChange(A,e))}isViewInMainArea(e,t){return t&&t.children?t.children.some(A=>A===e?!0:this.isViewInMainArea(e,A)):!1}isDraggedToMain(){return this.isDraggedToMainView}};var rc=require("obsidian"),Us=class{constructor(e,t,A){this.onShowLoading=null;this.onHideLoading=null;this.onShowError=null;this.onShowEmpty=null;this.app=e,this.canvasService=t,this.highlightDataService=A}setCallbacks(e){e.onShowLoading&&(this.onShowLoading=e.onShowLoading),e.onHideLoading&&(this.onHideLoading=e.onHideLoading),e.onShowError&&(this.onShowError=e.onShowError),e.onShowEmpty&&(this.onShowEmpty=e.onShowEmpty)}async processCanvasFile(e){this.onShowLoading&&this.onShowLoading();try{let t=await this.canvasService.parseCanvasFile(e);if(t.length===0)return this.onShowEmpty&&this.onShowEmpty("There are no file nodes in the current Canvas."),[];let A=[];for(let i of t){let n=this.app.vault.getAbstractFileByPath(i);if(n instanceof rc.TFile){let c=(await this.highlightDataService.loadFileHighlights(n)).map(d=>({...d,fileName:n.basename,filePath:n.path,fileIcon:"file-text"}));A.push(...c)}}return this.markAsCanvasHighlights(A,e)}catch(t){return console.error("\u5904\u7406 Canvas \u6587\u4EF6\u5931\u8D25:",t),this.onShowError&&this.onShowError("\u5904\u7406 Canvas \u6587\u4EF6\u65F6\u51FA\u9519"),[]}finally{this.onHideLoading&&this.onHideLoading()}}markAsCanvasHighlights(e,t){return e.map(A=>({...A,isFromCanvas:!0,canvasSource:t.path,isGlobalSearch:!0}))}};var Ea=require("obsidian"),Ms=class{constructor(e,t,A){this.app=e,this.highlightService=t,this.highlightRepository=A}async updateAllHighlights(e="",t=""){return t==="path"?await this.loadHighlightsByPath(e):e?await this.searchHighlightsFromIndex(e):await this.loadAllHighlights()}async loadHighlightsByPath(e){let t=this.highlightService.getAllHighlightsFromCache();if(t)return this.filterCachedHighlightsByPath(t,e);let A=await this.highlightService.getAllHighlights(),i=[];for(let{file:n,highlights:l}of A){if(e&&!n.path.toLowerCase().includes(e.toLowerCase()))continue;let c=await this.highlightRepository.getFileHighlights(n.path),d=this.processFileHighlights(l,c,n);i.push(...d);let g=this.getVirtualHighlights(c,n);i.push(...g)}return this.sortHighlights(i)}async filterCachedHighlightsByPath(e,t){let A=[],i=new Map;for(let n of e){let l=n.filePath||"";t&&!l.toLowerCase().includes(t.toLowerCase())||(i.has(l)||i.set(l,[]),i.get(l).push(n))}for(let[n,l]of i.entries()){let c=this.app.vault.getAbstractFileByPath(n);if(!(c instanceof Ea.TFile))continue;let d=await this.highlightRepository.getFileHighlights(c.path),g=this.processFileHighlights(l,d,c);A.push(...g);let p=this.getVirtualHighlights(d,c);A.push(...p)}return this.sortHighlights(A)}async searchHighlightsFromIndex(e){return(await this.highlightService.searchHighlightsFromIndex(e)).map(A=>({...A,comments:A.comments||[],fileName:A.fileName||this.extractFileNameFromPath(A.filePath),filePath:A.filePath||"",fileIcon:"file-text"}))}async loadAllHighlights(){let e=this.highlightService.getAllHighlightsFromCache();if(e)return this.processCachedHighlights(e);let t=await this.highlightService.getAllHighlights(),A=[];for(let{file:i,highlights:n}of t){let l=await this.highlightRepository.getFileHighlights(i.path),c=this.processFileHighlights(n,l,i);A.push(...c);let d=this.getVirtualHighlights(l,i);A.push(...d)}return this.sortHighlights(A)}async processCachedHighlights(e){let t=[],A=new Map;for(let i of e){let n=i.filePath||"";A.has(n)||A.set(n,[]),A.get(n).push(i)}for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!(l instanceof Ea.TFile))continue;let c=await this.highlightRepository.getFileHighlights(l.path),d=this.processFileHighlights(n,c,l);t.push(...d);let g=this.getVirtualHighlights(c,l);t.push(...g)}return this.sortHighlights(t)}processFileHighlights(e,t,A){return this.highlightService.mergeHighlightsWithComments(e,t,A)}getVirtualHighlights(e,t){return[]}extractFileNameFromPath(e){var t;return e&&((t=e.split("/").pop())==null?void 0:t.replace(".md",""))||""}sortHighlights(e){return e.sort((t,A)=>{let i=t.filePath||"",n=A.filePath||"";if(i!==n)return i.localeCompare(n);if(t.isVirtual&&!A.isVirtual)return-1;if(!t.isVirtual&&A.isVirtual)return 1;if(t.position!==void 0&&A.position!==void 0&&t.position!==A.position)return t.position-A.position;if(t.createdAt!==void 0&&A.createdAt!==void 0&&t.createdAt!==A.createdAt)return t.createdAt-A.createdAt;let l=t.id||"",c=A.id||"";return l.localeCompare(c)})}};var HA=require("obsidian");W();var bs=class{constructor(e,t){this.app=e;this.exportService=t;this.exportButton=null}createExportButton(e,t){return this.exportButton=e.createEl("div",{cls:"highlight-icon-button"}),(0,HA.setIcon)(this.exportButton,"file-symlink"),this.exportButton.setAttribute("aria-label",m("Export as notes")),this.exportButton.addEventListener("click",async()=>{await this.handleExportClick(t())}),this.exportButton}async handleExportClick(e){if(!e){new HA.Notice(m("Please open a file first."));return}try{let t=await this.exportService.exportHighlightsToNote(e);new HA.Notice(m("Successfully exported highlights to: ")+t.path),await this.app.workspace.getLeaf().openFile(t)}catch(t){new HA.Notice(m("Failed to export highlights: ")+t.message)}}async exportHighlightAsImage(e){try{let t=(await Promise.resolve().then(()=>kl(Qa()))).default,{ExportPreviewModal:A}=await Promise.resolve().then(()=>(cc(),lc));new A(this.app,e,t).open()}catch(t){console.error("[ExportManager] Error exporting as image:",t),new HA.Notice(m("Export failed: Failed to load necessary components."))}}destroy(){this.exportButton&&(this.exportButton.remove(),this.exportButton=null)}};var hc=require("obsidian"),xs=class{constructor(e){this.highlightContainer=e;this.currentBatch=0;this.isLoading=!1;this.BATCH_SIZE=20;this.observer=null;this.sentinel=null;this.loadingIndicator=null}setLoadingIndicator(e){this.loadingIndicator=e}reset(){this.currentBatch=0,this.isLoading=!1,this.cleanup()}getCurrentBatch(){return this.currentBatch}setCurrentBatch(e){this.currentBatch=e}async loadMoreHighlights(e,t){if(!this.isLoading){this.isLoading=!0,this.showLoading();try{let A=this.currentBatch*this.BATCH_SIZE,i=e.slice(A,A+this.BATCH_SIZE);if(i.length===0){this.hideLoading(),this.loadingIndicator&&this.loadingIndicator.remove();return}await t(i,!0),this.currentBatch++}catch(A){console.error("[InfiniteScrollManager] Error loading highlights:",A),new hc.Notice("\u52A0\u8F7D\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519")}finally{this.isLoading=!1,this.hideLoading()}}}async loadUntilScrollable(e,t){let i=0;for(;i<10;){let{scrollHeight:n,clientHeight:l}=this.highlightContainer;if(n>l||this.currentBatch*this.BATCH_SIZE>=e.length)break;await this.loadMoreHighlights(e,t),i++,await new Promise(d=>setTimeout(d,50))}}setupInfiniteScroll(e,t){this.cleanup(),this.sentinel=this.highlightContainer.createEl("div",{cls:"scroll-sentinel"}),this.sentinel.style.height="1px",this.sentinel.style.width="100%",this.observer=new IntersectionObserver(async A=>{A[0].isIntersecting&&!this.isLoading&&await this.loadMoreHighlights(e,t)},{root:this.highlightContainer,rootMargin:"300px",threshold:0}),this.observer.observe(this.sentinel)}showLoading(){this.loadingIndicator&&(this.loadingIndicator.addClass("highlight-display-block"),this.loadingIndicator.removeClass("highlight-display-none"))}hideLoading(){this.loadingIndicator&&(this.loadingIndicator.removeClass("highlight-display-block"),this.loadingIndicator.addClass("highlight-display-none"))}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.sentinel&&(this.sentinel.remove(),this.sentinel=null)}destroy(){this.cleanup(),this.loadingIndicator=null}};var Ts=class{constructor(e,t){this.app=e;this.plugin=t;this.flashcardComponent=null;this.isFlashcardMode=!1;this.highlightsWithFlashcards=new Set}isInFlashcardMode(){return this.isFlashcardMode}setFlashcardMode(e){this.isFlashcardMode=e}getFlashcardComponent(){return this.flashcardComponent}createFlashcardComponent(e){return this.flashcardComponent&&this.destroyFlashcardComponent(),this.flashcardComponent=new VA(e,this.plugin),this.isFlashcardMode=!0,this.flashcardComponent}destroyFlashcardComponent(){this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.isFlashcardMode=!1}exitFlashcardMode(){this.destroyFlashcardComponent()}updateFlashcardMarkers(e){if(this.highlightsWithFlashcards.clear(),!this.plugin||!this.plugin.fsrsManager)return;let t=this.plugin.fsrsManager;for(let A of e)if(A.id){let i=t.findCardsBySourceId(A.id,"highlight");i&&i.length>0&&this.highlightsWithFlashcards.add(A.id)}}getFlashcardMarkers(){return this.highlightsWithFlashcards}hasFlashcard(e){return this.highlightsWithFlashcards.has(e)}handleBackButton(){if(!this.isFlashcardMode||!this.flashcardComponent)return!1;let e=this.flashcardComponent.getRenderer();return e&&!e.isShowingSidebar()?(e.showSidebar(),!0):!1}destroy(){this.destroyFlashcardComponent(),this.highlightsWithFlashcards.clear()}};var dc=require("obsidian"),Ls=class{constructor(){this.isMobileView=!1;this.isSmallScreen=!1;this.resizeObserver=null;this.onDeviceChangeCallback=null;this.updateDeviceInfo()}setOnDeviceChange(e){this.onDeviceChangeCallback=e}startWatching(e){this.resizeObserver=new ResizeObserver(()=>{let t=this.isMobileView,A=this.isSmallScreen;this.updateDeviceInfo(),(t!==this.isMobileView||A!==this.isSmallScreen)&&this.onDeviceChangeCallback&&this.onDeviceChangeCallback(this.getDeviceInfo())}),this.resizeObserver.observe(e)}stopWatching(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}updateDeviceInfo(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen()}checkIfMobile(){return dc.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}getDeviceInfo(){return{isMobile:this.isMobileView,isSmallScreen:this.isSmallScreen,isDesktop:!this.isMobileView,isLargeScreen:!this.isSmallScreen}}isMobile(){return this.isMobileView}isSmall(){return this.isSmallScreen}isDesktop(){return!this.isMobileView}isLarge(){return!this.isSmallScreen}destroy(){this.stopWatching(),this.onDeviceChangeCallback=null}};var gc=require("obsidian");W();var Ps=class{initializeUI(e){e.empty(),e.addClass("comment-view-container");let t=e.createEl("div",{cls:"highlight-main-container"}),A=t.createEl("div",{cls:"highlight-file-list-container"}),i=t.createEl("div",{cls:"highlight-content-container"}),n=this.createBackButton(i),l=n.querySelector(".highlight-back-button"),c=i.createEl("div",{cls:"highlight-search-container"}),d=this.createSearchInput(c),g=this.createSearchLoadingIndicator(c),p=c.createEl("div",{cls:"highlight-search-icons"}),C=i.createEl("div",{cls:"highlight-container"}),y=this.createLoadingIndicator();return{mainContainer:t,fileListContainer:A,mainContentContainer:i,backButtonContainer:n,backButton:l,searchContainer:c,searchInput:d,searchLoadingIndicator:g,iconButtonsContainer:p,highlightContainer:C,loadingIndicator:y}}createBackButton(e){let t=e.createEl("div",{cls:"highlight-back-button-container"}),A=t.createEl("div",{cls:"highlight-back-button"});return(0,gc.setIcon)(A,"arrow-left"),A.createEl("span",{text:m("BACK"),cls:"highlight-back-button-text"}),t}createSearchInput(e){let t=e.createEl("input",{cls:"highlight-search-input",attr:{type:"text",placeholder:m("Search...")}});return t.addEventListener("focus",()=>{e.addClass("focused")}),t.addEventListener("blur",()=>{e.removeClass("focused")}),t}createSearchLoadingIndicator(e){let t=e.createEl("div",{cls:"highlight-search-loading"});return t.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="loading-spinner"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>',t.style.display="none",t}createLoadingIndicator(){let e=createEl("div",{cls:"highlight-loading-indicator",text:m("Loading...")});return e.addClass("highlight-display-none"),e}setupMultiSelectListener(e,t){e.addEventListener("highlight-multi-select",A=>{t()})}};var uc=require("obsidian");var Ds=class{constructor(e,t){this.app=e;this.component=t;this.callbacks={};this.eventRefs=[];this.customEventHandlers=new Map}setCallbacks(e){this.callbacks={...this.callbacks,...e}}registerAllEvents(e,t){this.registerFileOpenEvent(e,t),this.registerFileModifyEvent(e,t),this.registerFileCreateEvent(),this.registerFileDeleteEvent(),this.registerLayoutChangeEvent(),this.registerCommentInputEvent()}registerFileOpenEvent(e,t){let A=this.app.workspace.on("file-open",i=>{var n,l,c;if(i&&!t()){let d=this.app.workspace.activeLeaf,g=((l=(n=d==null?void 0:d.getViewState())==null?void 0:n.state)==null?void 0:l.file)!==i.path&&((c=d==null?void 0:d.view)==null?void 0:c.getViewType())==="canvas";this.callbacks.onFileOpen&&this.callbacks.onFileOpen(i,g)}});this.component.registerEvent(A),this.eventRefs.push(A)}registerFileModifyEvent(e,t){let A=this.app.vault.on("modify",i=>{var l,c,d;let n=e();if(i===n&&!t()&&i instanceof uc.TFile){let g=this.app.workspace.activeLeaf,p=((c=(l=g==null?void 0:g.getViewState())==null?void 0:l.state)==null?void 0:c.file)!==i.path&&((d=g==null?void 0:g.view)==null?void 0:d.getViewType())==="canvas";this.callbacks.onFileModify&&this.callbacks.onFileModify(i,p)}});this.component.registerEvent(A),this.eventRefs.push(A)}registerFileCreateEvent(){let e=this.app.vault.on("create",()=>{this.callbacks.onFileCreate&&this.callbacks.onFileCreate()});this.component.registerEvent(e),this.eventRefs.push(e)}registerFileDeleteEvent(){let e=this.app.vault.on("delete",()=>{this.callbacks.onFileDelete&&this.callbacks.onFileDelete()});this.component.registerEvent(e),this.eventRefs.push(e)}registerLayoutChangeEvent(){let e=this.app.workspace.on("layout-change",()=>{this.callbacks.onLayoutChange&&this.callbacks.onLayoutChange()});this.component.registerEvent(e),this.eventRefs.push(e)}registerCommentInputEvent(){let e=t=>{let{highlightId:A,text:i}=t.detail;this.callbacks.onCommentInput&&this.callbacks.onCommentInput(A,i)};window.addEventListener("open-comment-input",e),this.customEventHandlers.set("open-comment-input",e),this.component.register(()=>{window.removeEventListener("open-comment-input",e)})}registerKeyboardEvents(e){let t=i=>{i.key==="Shift"&&e.addClass("multi-select-mode")},A=i=>{i.key==="Shift"&&e.removeClass("multi-select-mode")};this.component.registerDomEvent(document,"keydown",t),this.component.registerDomEvent(document,"keyup",A)}handleCommentInputDisplay(e,t,A,i){setTimeout(()=>{A.querySelectorAll(".highlight-card").forEach(l=>{l.removeClass("selected")});let n=Ie.findCardInstanceByHighlightId(e);if(!n){let l=Array.from(A.querySelectorAll(".highlight-card")).find(c=>{var g;return((g=c.querySelector(".highlight-text-content"))==null?void 0:g.textContent)===t});l&&(l.addClass("selected"),n=Ie.findCardInstanceByElement(l),l.scrollIntoView({behavior:"smooth"}))}n&&n.showCommentInput()},100)}destroy(){this.customEventHandlers.forEach((e,t)=>{window.removeEventListener(t,e)}),this.customEventHandlers.clear(),this.eventRefs=[],this.callbacks={}}};var Rs=class{configureSearchUIManager(e,t){e.setCallbacks(t.onSearch,t.getHighlights,t.getCurrentFile)}configureSelectionManager(e,t){e.setOnSelectionChange(A=>{t&&t.showMultiSelectActions(A)})}configureBatchOperationsHandler(e,t){e.setCallbacks(t.getSelectedHighlights,t.clearSelection,t.refreshView)}configureFileListManager(e,t){}configureHighlightRenderManager(e,t){}configureCommentService(e,t){e.setCallbacks({onRefreshView:t.onRefreshView,onHighlightsUpdate:t.onHighlightsUpdate,onCardUpdate:t.onCardUpdate})}configureCommentInputManager(e,t){e.setCallbacks({onCommentSave:t.onCommentSave,onCommentDelete:t.onCommentDelete,onCommentCancel:t.onCommentCancel,onViewUpdate:t.onViewUpdate})}configureLayoutManager(e,t){e.setCallbacks(t)}configureViewPositionDetector(e,t){e.setCallbacks(t)}configureCanvasProcessor(e,t){e.setCallbacks(t)}};var ft="hinote-view",ji=class ji extends er.ItemView{constructor(t,A,i){super(t);this.searchUIManager=null;this.selectionManager=null;this.batchOperationsHandler=null;this.fileListManager=null;this.highlightRenderManager=null;this.highlightDataService=null;this.commentService=null;this.commentInputManager=null;this.layoutManager=null;this.viewPositionDetector=null;this.canvasProcessor=null;this.globalHighlightService=null;this.exportManager=null;this.virtualHighlightManager=null;this.infiniteScrollManager=null;this.flashcardViewManager=null;this.deviceManager=null;this.uiInitializer=null;this.eventCoordinator=null;this.callbackConfigurator=null;this.currentFile=null;this.highlights=[];this.highlightsWithFlashcards=new Set;this.isFlashcardMode=!1;this.isDraggedToMainView=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isShowingFileList=!0;this.currentEditingHighlightId=null;this.flashcardComponent=null;this.aiButtons=[];this.highlightManager=A,this.highlightRepository=i;let n=this.app.plugins;if(n&&n.plugins&&n.plugins["hi-note"])this.plugin=n.plugins["hi-note"];else throw new Error("Hi-Note plugin not found");this.locationService=new ds(this.app),this.exportService=new ps(this.app,this.highlightRepository),this.highlightService=this.plugin.highlightService,this.licenseManager=new oA(this.plugin),this.canvasService=this.plugin.canvasService,this.deviceManager=new Ls,this.uiInitializer=new Ps,this.eventCoordinator=new Ds(this.app,this),this.callbackConfigurator=new Rs,this.exportManager=new bs(this.app,this.exportService),this.virtualHighlightManager=new $i(this.highlightManager),this.flashcardViewManager=new Ts(this.app,this.plugin),this.eventCoordinator.setCallbacks({onFileOpen:(l,c)=>{this.currentFile=l,this.updateHighlights(c)},onFileModify:(l,c)=>{this.fileListManager&&this.fileListManager.invalidateCache(),this.updateHighlights(c)},onFileCreate:()=>{this.fileListManager&&this.fileListManager.invalidateCache()},onFileDelete:()=>{this.fileListManager&&this.fileListManager.invalidateCache()},onLayoutChange:()=>{this.checkViewPosition()},onCommentInput:(l,c)=>{this.eventCoordinator.handleCommentInputDisplay(l,c,this.highlightContainer,(d,g)=>this.showCommentInput(d,g))}}),this.eventCoordinator.registerAllEvents(()=>this.currentFile,()=>this.isDraggedToMainView)}getViewType(){return ft}getDisplayText(){return"HiNote"}getIcon(){return"highlighter"}async onOpen(){let t=this.containerEl.children[1];t.addEventListener("highlight-multi-select",c=>{this.selectionManager&&this.selectionManager.updateSelectedHighlights()});let A=this.uiInitializer.initializeUI(t);this.fileListContainer=A.fileListContainer,this.mainContentContainer=A.mainContentContainer,this.searchContainer=A.searchContainer,this.searchInput=A.searchInput,this.searchLoadingIndicator=A.searchLoadingIndicator,this.highlightContainer=A.highlightContainer,this.loadingIndicator=A.loadingIndicator,A.backButton.addEventListener("click",()=>{if(this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView){if(this.isFlashcardMode&&this.flashcardComponent){let c=this.flashcardComponent.getRenderer();if(c&&!c.isShowingSidebar()){c.showSidebar();return}}this.isShowingFileList=!0,this.updateViewLayout()}}),this.virtualHighlightManager&&this.virtualHighlightManager.createFileCommentButton(A.iconButtonsContainer,{getCurrentFile:()=>this.currentFile,getHighlights:()=>this.highlights,onVirtualHighlightCreated:c=>{this.highlights.unshift(c),this.renderHighlights(this.highlights)},onShowCommentInput:(c,d)=>this.showCommentInput(c,d),getHighlightContainer:()=>this.highlightContainer}),this.exportManager&&this.exportManager.createExportButton(A.iconButtonsContainer,()=>this.currentFile),this.searchUIManager=new Bs(this.plugin,this.searchInput,this.searchLoadingIndicator,this.searchContainer),this.callbackConfigurator&&this.callbackConfigurator.configureSearchUIManager(this.searchUIManager,{onSearch:async(c,d)=>{await this.handleSearch(c,d)},getHighlights:()=>this.highlights,getCurrentFile:()=>this.currentFile}),this.searchUIManager.initialize(),this.selectionManager=new Cs(this.highlightContainer),this.selectionManager.initialize(),this.registerDomEvent(document,"click",c=>{if(this.selectionManager&&!this.selectionManager.isInSelectionMode()){if(this.selectionManager.getSelectedCount()<=1)return;let g=c.target;!g.closest(".multi-select-actions")&&!g.closest(".highlight-card.selected")&&!g.closest(".highlight-container")&&this.selectionManager.clearSelection()}}),this.batchOperationsHandler=new ws(this.plugin,this.exportService,this.licenseManager,this.highlightService,this.containerEl),this.callbackConfigurator&&(this.callbackConfigurator.configureSelectionManager(this.selectionManager,this.batchOperationsHandler),this.callbackConfigurator.configureBatchOperationsHandler(this.batchOperationsHandler,{getSelectedHighlights:()=>this.selectionManager.getSelectedHighlights(),clearSelection:()=>this.selectionManager.clearSelection(),refreshView:async()=>await this.refreshView()})),this.fileListManager=new vs(this.fileListContainer,this.plugin,this.highlightService,this.licenseManager),this.fileListManager.setCallbacks({onFileSelect:async c=>{this.currentFile=c,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.highlightContainer.empty(),this.highlightContainer.removeClass("flashcard-mode"),this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let d=this.searchContainer.querySelector(".highlight-search-icons");d&&d.removeClass("highlight-display-none"),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateHighlights()},onFlashcardModeToggle:async c=>{this.currentFile=null,this.isFlashcardMode=c,this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.addClass("highlight-display-none"),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new VA(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.flashcardComponent.activate()},onAllHighlightsSelect:async()=>{this.currentFile=null,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.highlightContainer.empty(),this.highlightContainer.removeClass("flashcard-mode"),this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let c=this.searchContainer.querySelector(".highlight-search-icons");c&&c.addClass("highlight-display-none"),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateAllHighlights()},onRefreshView:async()=>{this.isFlashcardMode?this.flashcardComponent&&await this.flashcardComponent.activate():this.currentFile===null?await this.updateAllHighlights():await this.updateHighlights()}}),this.highlightRenderManager=new Ji(this.highlightContainer,this.plugin,this.searchInput),this.highlightRenderManager.setCallbacks({onHighlightClick:async c=>await this.jumpToHighlight(c),onCommentAdd:(c,d)=>this.showCommentInput(c,d),onCommentEdit:(c,d,g)=>this.showCommentInput(c,d,g),onExport:c=>this.exportHighlightAsImage(c),onAIResponse:async(c,d)=>{this.commentService&&(this.commentService.updateState({currentFile:this.currentFile,highlights:this.highlights}),await this.commentService.addComment(c,d)),await this.updateHighlights()}}),this.highlightDataService=new ys(this.app,this.highlightService,this.highlightRepository),this.commentService=new Fs(this.app,this.plugin,this.highlightManager),this.commentInputManager=new Hs(this.plugin),this.callbackConfigurator&&(this.callbackConfigurator.configureCommentService(this.commentService,{onRefreshView:async()=>await this.refreshView(),onHighlightsUpdate:c=>{this.highlights=c},onCardUpdate:c=>{let d=this.highlights.findIndex(p=>p.id===c.id);d!==-1&&(this.highlights[d]=c);let g=Ie.findCardInstanceByHighlightId(c.id||"");g&&g.updateComments(c)}}),this.callbackConfigurator.configureCommentInputManager(this.commentInputManager,{onCommentSave:async(c,d,g)=>{this.commentService&&(this.commentService.updateState({currentFile:this.currentFile,highlights:this.highlights}),g?await this.commentService.updateComment(c,g.id,d):await this.commentService.addComment(c,d))},onCommentDelete:async(c,d)=>{this.commentService&&(this.commentService.updateState({currentFile:this.currentFile,highlights:this.highlights}),await this.commentService.deleteComment(c,d))},onCommentCancel:async c=>{c.isVirtual&&(!c.comments||c.comments.length===0)&&this.commentService&&(this.commentService.updateState({currentFile:this.currentFile,highlights:this.highlights}),await this.commentService.deleteVirtualHighlight(c))},onViewUpdate:async()=>await this.updateHighlights()})),this.layoutManager=new Qs(this.containerEl,this.fileListContainer,this.mainContentContainer,this.searchContainer),this.callbackConfigurator&&this.callbackConfigurator.configureLayoutManager(this.layoutManager,{onCreateFloatingButton:()=>{},onRemoveFloatingButton:()=>{},onUpdateFileList:async c=>{this.fileListManager&&(this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode,isMobileView:this.isMobileView,isSmallScreen:this.isSmallScreen,isDraggedToMainView:this.isDraggedToMainView}),await this.fileListManager.updateFileList(c))}}),this.viewPositionDetector=new Ss(this.app,this.leaf),this.globalHighlightService=new Ms(this.app,this.highlightService,this.highlightRepository),this.canvasProcessor=new Us(this.app,this.canvasService,this.highlightDataService),this.callbackConfigurator&&this.callbackConfigurator.configureCanvasProcessor(this.canvasProcessor,{onShowLoading:()=>{this.highlightContainer.empty(),this.loadingIndicator&&(this.highlightContainer.appendChild(this.loadingIndicator),this.loadingIndicator.removeClass("highlight-display-none"))},onHideLoading:()=>{this.loadingIndicator&&this.loadingIndicator.addClass("highlight-display-none")},onShowError:c=>{this.highlightContainer.empty(),this.highlightContainer.createDiv({cls:"error-message",text:c})},onShowEmpty:c=>{this.highlightContainer.empty(),this.highlightContainer.createDiv({cls:"no-highlights-message",text:c})}}),this.viewPositionDetector.setCallbacks({onPositionChange:async(c,d)=>{if(this.isDraggedToMainView=c,c){let g=this.deviceManager.getDeviceInfo();g.isMobile&&g.isSmallScreen&&(this.isShowingFileList=!0);let p=this.app.workspace.getActiveFile();p?(this.currentFile=p,await this.updateHighlights()):(this.currentFile=null,await this.updateAllHighlights()),this.fileListManager&&(this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode}),this.fileListManager.updateFileListSelection())}else{this.isFlashcardMode&&(this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.fileListManager&&(this.fileListManager.updateState({currentFile:this.currentFile,isFlashcardMode:this.isFlashcardMode}),this.fileListManager.updateFileListSelection()));let g=this.app.workspace.getActiveFile();g?d?(this.currentFile=g,this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),setTimeout(()=>{this.updateHighlights()},ji.CANVAS_UPDATE_DELAY)):(this.currentFile=g,this.updateHighlights()):(this.highlights=[],this.renderHighlights([]))}if(this.layoutManager&&(this.layoutManager.updateState({isDraggedToMainView:this.isDraggedToMainView,isFlashcardMode:this.isFlashcardMode,isShowingFileList:this.isShowingFileList}),await this.layoutManager.updateViewLayout()),this.searchInput&&this.searchInput.value.trim()!==""){let g=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(g)}}}),this.eventCoordinator&&this.eventCoordinator.registerKeyboardEvents(this.highlightContainer),this.infiniteScrollManager||(this.infiniteScrollManager=new xs(this.highlightContainer),this.infiniteScrollManager.setLoadingIndicator(this.loadingIndicator));let i=this.app.workspace.getActiveFile();i&&(this.currentFile=i,await this.updateHighlights()),this.updateViewLayout(),this.highlightContainer.empty();let n=this.searchInput.value.toLowerCase().trim(),l=this.highlights.filter(c=>{var d,g;return!!(c.text.toLowerCase().includes(n)||(d=c.comments)!=null&&d.some(p=>p.content.toLowerCase().includes(n))||this.currentFile===null&&((g=c.fileName)!=null&&g.toLowerCase().includes(n)))});this.renderHighlights(l)}renderHighlights(t,A=!1){var i,n;this.highlightRenderManager&&this.flashcardViewManager&&(this.highlightRenderManager.updateState({currentFile:this.currentFile,isDraggedToMainView:this.isDraggedToMainView,highlightsWithFlashcards:this.flashcardViewManager.getFlashcardMarkers(),currentBatch:((i=this.infiniteScrollManager)==null?void 0:i.getCurrentBatch())||0}),this.highlightRenderManager.renderHighlights(t,A,(n=this.selectionManager)!=null?n:void 0),this.infiniteScrollManager&&this.infiniteScrollManager.setCurrentBatch(this.highlightRenderManager.getCurrentBatch()))}async jumpToHighlight(t){if(!this.isDraggedToMainView&&!t.isGlobalSearch){if(!this.currentFile){new er.Notice(m("No corresponding file found."));return}await this.locationService.jumpToHighlight(t,this.currentFile.path)}}async exportHighlightAsImage(t){this.exportManager&&await this.exportManager.exportHighlightAsImage(t)}async showCommentInput(t,A,i){this.commentInputManager&&this.commentInputManager.showCommentInput(t,A,i)}async checkViewPosition(){if(this.viewPositionDetector){let t=this.isInAllHighlightsView();await this.viewPositionDetector.checkViewPosition(t)}}async updateViewLayout(){if(this.layoutManager){this.layoutManager.updateState({isDraggedToMainView:this.isDraggedToMainView,isFlashcardMode:this.isFlashcardMode,isShowingFileList:this.isShowingFileList}),await this.layoutManager.updateViewLayout();let t=this.deviceManager.getDeviceInfo();this.isMobileView=t.isMobile,this.isSmallScreen=t.isSmallScreen}}async updateAllHighlights(t="",A=""){this.infiniteScrollManager&&this.infiniteScrollManager.reset(),this.highlights=[],this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);try{this.globalHighlightService&&(this.highlights=await this.globalHighlightService.updateAllHighlights(t,A)),await this.loadMoreHighlights(),await this.loadUntilScrollable(),this.setupInfiniteScroll()}catch(i){console.error("[CommentView] Error in updateAllHighlights:",i),new er.Notice(m("Error loading all highlights")),this.highlightContainer.empty(),this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:m("Error loading highlights. Please try again.")})}finally{this.loadingIndicator.removeClass("highlight-display-block")}}async loadMoreHighlights(){this.infiniteScrollManager&&await this.infiniteScrollManager.loadMoreHighlights(this.highlights,async(t,A)=>await this.renderHighlights(t,A))}async loadUntilScrollable(){this.infiniteScrollManager&&await this.infiniteScrollManager.loadUntilScrollable(this.highlights,async(t,A)=>await this.renderHighlights(t,A))}setupInfiniteScroll(){this.infiniteScrollManager&&this.infiniteScrollManager.setupInfiniteScroll(this.highlights,async(t,A)=>await this.renderHighlights(t,A))}onunload(){this.searchUIManager&&(this.searchUIManager.destroy(),this.searchUIManager=null),this.selectionManager&&(this.selectionManager.destroy(),this.selectionManager=null),this.batchOperationsHandler&&(this.batchOperationsHandler.destroy(),this.batchOperationsHandler=null),this.fileListManager&&(this.fileListManager.destroy(),this.fileListManager=null),this.highlightRenderManager&&(this.highlightRenderManager.clear(),this.highlightRenderManager=null),this.highlightDataService&&(this.highlightDataService=null),this.commentService&&(this.commentService=null),this.commentInputManager&&(this.commentInputManager.clearEditingState(),this.commentInputManager=null),this.layoutManager&&(this.layoutManager=null),this.viewPositionDetector&&(this.viewPositionDetector=null),this.canvasProcessor&&(this.canvasProcessor=null),this.globalHighlightService&&(this.globalHighlightService=null)}updateAIDropdowns(){this.aiButtons.forEach(t=>{}),this.app.workspace.trigger("comment-view:update-ai-dropdowns")}registerAIButton(t){this.aiButtons.push(t)}unregisterAIButton(t){let A=this.aiButtons.indexOf(t);A!==-1&&this.aiButtons.splice(A,1)}isInAllHighlightsView(){return this.currentFile===null}async handleSearch(t,A){try{if(this.highlights.some(n=>n.isGlobalSearch)&&A!=="all"&&A!=="path"&&this.currentFile){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),await this.updateHighlights(),this.highlights.forEach(l=>{l.isGlobalSearch=!1});let n=this.searchUIManager.filterHighlightsByTerm(t,A);this.renderHighlights(n);return}if((A==="all"||A==="path")&&this.currentFile!==null){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);let n=this.currentFile;try{this.currentFile=null,await this.updateAllHighlights(t,A),this.highlights.forEach(l=>{l.isGlobalSearch=!0}),this.renderHighlights(this.highlights)}finally{this.currentFile=n}}else{this.highlights.forEach(l=>{l.isGlobalSearch=!1});let n=this.searchUIManager.filterHighlightsByTerm(t,A);this.renderHighlights(n)}}catch(i){console.error("[\u9AD8\u4EAE\u641C\u7D22] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",i)}}async refreshView(){this.isInAllHighlightsView()?await this.updateAllHighlights():await this.updateHighlights()}async updateHighlights(t=!1){if(this.isInAllHighlightsView()){await this.updateAllHighlights();return}if(!this.currentFile){this.renderHighlights([]);return}if(this.currentFile.extension==="canvas"){await this.handleCanvasFile(this.currentFile);return}if(this.highlightDataService?this.highlights=await this.highlightDataService.loadFileHighlights(this.currentFile):this.highlights=[],this.virtualHighlightManager&&this.currentFile){let A=await this.virtualHighlightManager.filterVirtualHighlights(this.currentFile,this.highlights);this.highlights.unshift(...A)}if(t&&this.currentFile&&this.highlights.forEach(A=>{var i;A.isFromCanvas=!0,A.isGlobalSearch=!0,A.fileName=(i=this.currentFile)==null?void 0:i.name}),this.flashcardViewManager&&this.flashcardViewManager.updateFlashcardMarkers(this.highlights),this.searchInput&&this.searchInput.value.trim()!==""&&this.searchUIManager){let A=this.searchInput.value.toLowerCase().trim(),i=this.searchUIManager.filterHighlightsByTerm(A,"");this.renderHighlights(i)}else this.renderHighlights(this.highlights)}async handleCanvasFile(t){this.canvasProcessor&&(this.highlights=await this.canvasProcessor.processCanvasFile(t),this.renderHighlights(this.highlights))}};ji.CANVAS_UPDATE_DELAY=10,ji.COMMENT_INPUT_DELAY=100;var lt=ji;var fc=require("obsidian");var rt=require("obsidian");W();var lA=require("obsidian");W();var Ks=class{constructor(e,t){this.containerEl=e,this.plugin=t,this.rules=t.settings.regexRules||[],this.rulesContainer=e.createDiv({cls:"regex-rules-container"}),this.display()}display(){this.rulesContainer.empty();let e=this.rulesContainer.createDiv({cls:"regex-rule-warning"});e.innerHTML=m("Use regex with caution. If there are capture groups (), the first capture group will be used as the highlight text; if there are no capture groups, the entire match will be used."),this.rules.length===0?this.rulesContainer.createDiv().setText(m('No custom regex rules. Click "+" to add a new rule.')):this.rules.forEach((i,n)=>{this.createRuleItem(i,n)});let t=this.rulesContainer.createDiv({cls:"regex-rule-add"});t.createSpan({cls:"regex-rule-add-text"}).setText(m("Add new rule")),t.addEventListener("click",()=>{let i={id:`rule-${Date.now()}`,name:"",pattern:"",color:"#ffeb3b",enabled:!0};this.rules.push(i),this.saveRules(),this.display()})}createRuleItem(e,t){let A=this.rulesContainer.createDiv({cls:"regex-rule-item"}),i=new lA.TextComponent(A);i.setPlaceholder(m("Rule name")),i.setValue(e.name),i.onChange(p=>{e.name=p,this.saveRules()});let n=new lA.TextComponent(A);n.setPlaceholder(m("Regular expression with capture groups")),n.setValue(e.pattern),n.onChange(p=>{e.pattern=p,this.saveRules()});let l=A.createDiv(),c=new lA.TextComponent(l);c.setPlaceholder("#ffeb3b"),c.setValue(e.color),c.inputEl.addClass("color-input"),c.onChange(p=>{let C=p.trim();C&&(C.startsWith("#")||C.startsWith("rgb")||C.startsWith("rgba"))&&(e.color=C,this.saveRules())});let d=A.createDiv({cls:"regex-rule-delete"});(0,lA.setIcon)(d,"trash-2"),d.setAttr("aria-label",m("Delete rule")),d.addEventListener("click",()=>{this.rules.splice(t,1),this.saveRules(),this.display()});let g=new lA.ToggleComponent(A);g.setValue(e.enabled),g.onChange(p=>{e.enabled=p,this.saveRules()}),g.toggleEl.addClass("regex-rule-toggle")}async saveRules(){this.plugin.settings.regexRules=this.rules,await this.plugin.saveSettings()}};var ks=class{constructor(e,t){this.plugin=e,this.containerEl=t}async updateOrphanedDataCount(e){try{let t=e.querySelector(".orphaned-data-count, .no-orphaned-data");t&&t.remove();let A=await this.plugin.highlightManager.checkOrphanedDataCount(),i=document.createElement("div");A.orphanedHighlights>0?(i.className="orphaned-data-count",i.textContent=`Found ${A.orphanedHighlights} orphaned highlights in ${A.affectedFiles} files.`):(i.className="no-orphaned-data",i.textContent="No orphaned data found."),e.appendChild(i)}catch(t){console.error("[HiNote] Error updating orphaned data count:",t)}}display(){let e=this.containerEl.createEl("div",{cls:"general-settings-container"});new rt.Setting(e).setName(m("Export Path")).setDesc(m("Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.")).addText(d=>d.setPlaceholder("Example: folder 1/folder 2").setValue(this.plugin.settings.export.exportPath||"").onChange(async g=>{g=g.replace(/^\/+/,""),g=g.replace(/\/+$/,""),this.plugin.settings.export.exportPath=g,await this.plugin.saveSettings()})),new rt.Setting(e).setName(m("Exclusions")).setDesc(m("Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md")).addTextArea(d=>{d.setPlaceholder("folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md").setValue(this.plugin.settings.excludePatterns||"").onChange(async g=>{let p=g.split(",").map(C=>C.trim()).filter(C=>C.length>0);this.plugin.settings.excludePatterns=g,await this.plugin.saveSettings()}),d.inputEl.rows=4,d.inputEl.cols=40}),new rt.Setting(e).setName(m("Export template")).setDesc(m("Customize the format of exported highlights and comments using variables. Available variables: {{highlightText}}, {{highlightBlockRef}}, {{commentContent}}, {{commentDate}}. Leave empty to use default template.")).addTextArea(d=>{d.setPlaceholder(`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`).setValue(this.plugin.settings.export.exportTemplate||"").onChange(async p=>{this.plugin.settings.export.exportTemplate=p,await this.plugin.saveSettings()}),d.inputEl.rows=5,d.inputEl.cols=40}),new rt.Setting(e).setName(m("Show Comment Widget")).setDesc(m("Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.")).addToggle(d=>{var g;return d.setValue((g=this.plugin.settings.showCommentWidget)!=null?g:!0).onChange(async p=>{this.plugin.settings.showCommentWidget=p,await this.plugin.saveSettings(),this.plugin.highlightDecorator&&this.plugin.highlightDecorator.refreshDecorations()})}),new rt.Setting(e).setName(m("Custom text extraction")).setHeading(),new rt.Setting(e).setName(m("Use custom rules")).setDesc(m("Enable to use custom regex rules to extract highlight text.")).addToggle(d=>d.setValue(this.plugin.settings.useCustomPattern).onChange(async g=>{this.plugin.settings.useCustomPattern=g,await this.plugin.saveSettings()}));let t=e.createDiv({cls:"regex-editor-container"});new Ks(t,this.plugin),new rt.Setting(e).setName(m("Data management")).setHeading();let A=new rt.Setting(e).setName(m("Clean orphaned data")).setDesc(m("Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.")),i=0,n=0,l=!1,c=A.addButton(d=>{d.setButtonText(m("Check")),d.onClick(async()=>{d.setButtonText(m("Checking...")),d.setDisabled(!0);try{let g=await this.plugin.highlightManager.checkOrphanedDataCount();i=g.orphanedHighlights,n=g.affectedFiles,l=!0;let p=A.descEl,C=p.querySelector(".orphaned-data-count, .no-orphaned-data");C&&C.remove();let y=document.createElement("div");i>0?(y.className="orphaned-data-count",y.textContent=`Found ${i} orphaned highlights in ${n} files.`,d.setButtonText(m("Clean data")),d.setDisabled(!1),d.onClick(async()=>{d.setButtonText(m("Cleaning...")),d.setDisabled(!0);try{let F=await this.plugin.highlightManager.cleanOrphanedData();F.removedHighlights>0?new rt.Notice(`Cleaned ${F.removedHighlights} orphaned highlights from ${F.affectedFiles} files.`):new rt.Notice("No orphaned data found."),d.setButtonText(m("Check")),l=!1,y&&y.parentElement&&y.parentElement.removeChild(y)}catch(F){console.error("[HiNote] Error cleaning orphaned data:",F),new rt.Notice("Error cleaning orphaned data. Check console for details."),d.setButtonText(m("Check"))}finally{d.setDisabled(!1)}})):(y.className="no-orphaned-data",y.textContent="No orphaned data found.",d.setButtonText(m("Check")),d.setDisabled(!1)),p.appendChild(y)}catch(g){console.error("[HiNote] Error checking orphaned data:",g),new rt.Notice("Error checking orphaned data. Check console for details."),d.setButtonText(m("Check")),d.setDisabled(!1)}})})}};var mc=require("obsidian");W();var ct=require("obsidian");var pc=require("obsidian");W();var _e=class{constructor(e,t){this.plugin=e,this.containerEl=t}createModelDropdown(e,t,A){new pc.Setting(e).setName(m("Model")).setDesc(m("Select the AI model to use")).addDropdown(i=>{let n=Object.fromEntries(t.map(l=>[l.id,l.name]));return i.addOptions(n).setValue(this.plugin.settings.ai.model||A.id).onChange(async l=>{this.plugin.settings.ai.model=l,await this.plugin.saveSettings()})})}};W();var tr=[{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-o1",name:"GPT-o1"},{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"}],Os=class extends _e{constructor(t,A){super(t,A);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={apiKey:"",model:tr[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let t=this.plugin.settings.ai.openai,A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=tr.find(n=>n.id===t.model);A=i||tr[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveModelState(){let t=this.plugin.settings.ai.openai,A=this.modelState.selectedModel;t.model=A.id,t.isCustomModel=!!A.isCustom,t.apiKey=this.modelState.apiKey||"",A.isCustom&&A.id&&(t.lastCustomModel=A.id),await this.plugin.saveSettings()}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new ct.Setting(A).setName(m("OpenAI service")).setHeading(),new ct.Setting(A).setName(m("API Key")).setDesc(m("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async p=>{this.modelState.apiKey=p,await this.saveModelState()})).addButton(g=>g.setButtonText(m("Check")).onClick(async()=>{if(te.checkApiKey(this.modelState.apiKey,"OpenAI")){g.setDisabled(!0),g.setButtonText(m("Checking..."));try{(await this.fetchAvailableModels(this.modelState.apiKey)).length>0?te.showSuccess(`OpenAI ${m("API Key is valid!")}`):te.showWarning(m("No models available. Please check your API Key."))}catch(p){te.showError(`OpenAI ${m("test failed")}: ${p.message||"Unknown error"}`)}finally{g.setDisabled(!1),g.setButtonText(m("Check"))}}}));let i=new ct.Setting(A).setName(m("Model")).setDesc(m("Select a model or enter a custom one.")).addDropdown(g=>{tr.forEach(C=>{g.addOption(C.id,C.name)}),g.addOption("custom",m("Custom Model"));let p=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(p),this.modelSelectEl=g.selectEl,g.onChange(async C=>{if(C==="custom")await this.showCustomModelInput();else{let y=tr.find(F=>F.id===C);if(y){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.openai;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=y,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let n=i.settingEl.querySelector(".setting-item-control");n&&(n.addClass("openai-dropdown-container"),n.insertBefore(this.customModelContainer,n.firstChild));let c=new ct.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async p=>{let C=p.trim();if(C){if(!/^[a-zA-Z0-9-_.]+$/.test(C)){new ct.Notice(m("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:C,name:C,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new ct.Setting(A).setName(m("Provider URL")).setDesc(m("Leave it blank, unless you are using a proxy.")).addText(g=>{var p;return g.setPlaceholder("https://api.openai.com/v1").setValue(((p=this.plugin.settings.ai.openai)==null?void 0:p.apiAddress)||"").onChange(async C=>{this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={}),this.plugin.settings.ai.openai.apiAddress=C,await this.plugin.saveSettings()})})}async validateModel(t,A,i){try{let n=await(0,ct.requestUrl)({url:`${i}/models/${A}`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(n.status!==200){let c=await n.json.catch(()=>null);return new ct.Notice(m("Custom model unavailable. Please check the model ID and your access permissions.")),!1}let l=await(0,ct.requestUrl)({url:`${i}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:A,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(l.status!==200){let c=await l.json.catch(()=>null);return!1}return!0}catch(n){return!1}}async fetchAvailableModels(t){var A;try{let i=((A=this.plugin.settings.ai.openai)==null?void 0:A.apiAddress)||"https://api.openai.com/v1";if(this.modelState.selectedModel.isCustom){let l=this.modelState.selectedModel.id;if(!await this.validateModel(t,l,i))throw new Error(`Custom model not available: ${l}`);return[this.modelState.selectedModel]}let n=await(0,ct.requestUrl)({url:`${i}/models`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return n.status===200?n.json.data.map(d=>({id:d.id,name:d.id})):[]}catch(i){throw i}}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let t=this.plugin.settings.ai.openai;if(!this.modelState.selectedModel.isCustom){let i=t.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},t.model=i,t.isCustomModel=!0,await this.plugin.saveSettings();let n=this.customModelContainer.querySelector("input");n&&(n.value=i)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var cA=require("obsidian");W();var Ar=[{id:"claude-opus-4-1-20250805",name:"Claude Opus 4.1"},{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude Sonnet 3.7"},{id:"claude-3-5-haiku-20241022",name:"Claude Haiku 3.5"},{id:"claude-3-haiku-20240307",name:"Claude Haiku 3"}],Ns=class extends _e{constructor(t,A){super(t,A);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={apiKey:"",model:Ar[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let t=this.plugin.settings.ai.anthropic,A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=Ar.find(n=>n.id===t.model);A=i||Ar[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveModelState(){let t=this.plugin.settings.ai.anthropic,A=this.modelState.selectedModel;t.model=A.id,t.isCustomModel=!!A.isCustom,t.apiKey=this.modelState.apiKey||"",A.isCustom&&A.id&&(t.lastCustomModel=A.id),await this.plugin.saveSettings()}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new cA.Setting(A).setName(m("Anthropic service")).setHeading(),new cA.Setting(A).setName(m("API Key")).setDesc(m("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-ant-...").setValue(this.modelState.apiKey).onChange(async p=>{this.modelState.apiKey=p,await this.saveModelState()})).addButton(g=>g.setButtonText(m("Check")).onClick(async()=>{var p;if(te.checkApiKey(this.modelState.apiKey,"Anthropic")){g.setDisabled(!0),g.setButtonText(m("Checking..."));try{let C=((p=this.plugin.settings.ai.anthropic)==null?void 0:p.apiAddress)||"https://api.anthropic.com",y=this.modelState.selectedModel.id,{AnthropicService:F}=await Promise.resolve().then(()=>(is(),ql)),Q=new F(this.modelState.apiKey,C,y);await te.testConnection(Q,"Anthropic")}catch(C){te.showError(`Anthropic ${m("test failed")}: ${C.message||"Unknown error"}`)}finally{g.setDisabled(!1),g.setButtonText(m("Check"))}}}));let i=new cA.Setting(A).setName(m("Model")).setDesc(m("Select a model or enter a custom one.")).addDropdown(g=>{Ar.forEach(C=>{g.addOption(C.id,C.name)}),g.addOption("custom",m("Custom Model"));let p=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(p),this.modelSelectEl=g.selectEl,g.onChange(async C=>{if(C==="custom")await this.showCustomModelInput();else{let y=Ar.find(F=>F.id===C);if(y){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.anthropic;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=y,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let n=i.settingEl.querySelector(".setting-item-control");n&&(n.addClass("openai-dropdown-container"),n.insertBefore(this.customModelContainer,n.firstChild));let c=new cA.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async p=>{let C=p.trim();if(C){if(!/^[a-zA-Z0-9-_.]+$/.test(C)){new cA.Notice(m("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:C,name:C,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new cA.Setting(A).setName(m("Provider URL")).setDesc(m("Leave it blank, unless you are using a proxy.")).addText(g=>{var p;return g.setPlaceholder("https://api.anthropic.com").setValue(((p=this.plugin.settings.ai.anthropic)==null?void 0:p.apiAddress)||"").onChange(async C=>{this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={}),this.plugin.settings.ai.anthropic.apiAddress=C,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let t=this.plugin.settings.ai.anthropic;if(!this.modelState.selectedModel.isCustom){let i=t.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},t.model=i,t.isCustomModel=!0,await this.plugin.saveSettings();let n=this.customModelContainer.querySelector("input");n&&(n.value=i)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var QA=require("obsidian");W();var jA=[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}],ei=[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash (Legacy)"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro (Legacy)"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash (Legacy)"}],_t=[{id:"deepseek-ai/DeepSeek-V3",name:"DeepSeek V3",isCustom:!1},{id:"Qwen/Qwen2.5-7B-Instruct",name:"Qwen2.5 7B",isCustom:!1},{id:"Qwen/Qwen2.5-14B-Instruct",name:"Qwen2.5 14B",isCustom:!1},{id:"Pro/Qwen/Qwen2-7B-Instruct",name:"Qwen2 7B",isCustom:!1},{id:"Pro/THUDM/glm-4-9b-chat",name:"GLM-4 9B",isCustom:!1},{id:"google/gemma-2-9b-it",name:"Gemma2 9B",isCustom:!1}],Wt={excludePatterns:"",useCustomPattern:!1,regexRules:[{id:"default-md",name:"Default Highlight",pattern:"==([^=\\n](?:[^=\\n]|=[^=\\n])*?[^=\\n])==",color:"#ffeb3b",enabled:!0},{id:"default-mark",name:"Mark format",pattern:"<mark[^>]*>([\\s\\S]*?)</mark>",color:"#ffeb3b",enabled:!0},{id:"default-span",name:"Span format",pattern:"<span[^>]*>([\\s\\S]*?)</span>",color:"#ffeb3b",enabled:!0}],ai:{provider:"ollama",ollama:{host:"http://localhost:11434",model:""},gemini:{apiKey:"",model:"gemini-pro",baseUrl:"",isCustomModel:!1},openai:{apiKey:"",model:"gpt-4o",baseUrl:""},anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""},deepseek:{apiKey:"",model:"deepseek-chat",baseUrl:""},siliconflow:{apiKey:"",model:_t[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""},prompts:{"\u{1F914} Key Insight":"{{highlight}}.Please reinterpret the above content from a fresh perspective and summarize its core idea within 200 characters."}},export:{exportPath:""},contextOptions:{strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},showCommentWidget:!0};var Gs=class extends _e{constructor(t,A){super(t,A);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={apiKey:"",model:jA[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let t=this.plugin.settings.ai.deepseek,A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=jA.find(n=>n.id===t.model);A=i||jA[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveModelState(){let t=this.plugin.settings.ai.deepseek,A=this.modelState.selectedModel;t.model=A.id,t.isCustomModel=!!A.isCustom,t.apiKey=this.modelState.apiKey||"",t.apiAddress=t.apiAddress||"",A.isCustom&&A.id&&(t.lastCustomModel=A.id),await this.plugin.saveSettings()}async validateApiKey(t){var A;try{let i="https://api.deepseek.com",n=(A=this.plugin.settings.ai.deepseek)==null?void 0:A.apiAddress,l=n&&n.trim()?n:i,c=this.modelState.selectedModel.id,{DeepseekService:d}=await Promise.resolve().then(()=>(ss(),Zl)),g=new d(t,c,l);return await te.testConnection(g,"Deepseek")}catch(i){return te.showError(`Deepseek ${m("test failed")}: ${i.message||"Unknown error"}`),!1}}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new QA.Setting(A).setName(m("Deepseek service")).setHeading(),new QA.Setting(A).setName(m("API Key")).setDesc(m("Please enter your API Key.")).addText(l=>l.setPlaceholder("dsk-...").setValue(this.modelState.apiKey).onChange(async c=>{this.modelState.apiKey=c,await this.saveModelState()})).addButton(l=>l.setButtonText(m("Check")).onClick(async()=>{if(te.checkApiKey(this.modelState.apiKey,"Deepseek")){l.setDisabled(!0),l.setButtonText(m("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{l.setDisabled(!1),l.setButtonText(m("Check"))}}}));let i=new QA.Setting(A).setName(m("Model")).setDesc(m("Select a model or enter a custom one.")).addDropdown(l=>{jA.forEach(d=>{l.addOption(d.id,d.name)}),l.addOption("custom",m("Custom Model"));let c=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return l.setValue(c),this.modelSelectEl=l.selectEl,l.onChange(async d=>{if(d==="custom")await this.showCustomModelInput();else{let g=jA.find(p=>p.id===d);if(g){if(this.modelState.selectedModel.isCustom){let p=this.plugin.settings.ai.deepseek;p.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=g,await this.saveModelState(),await this.hideCustomModelInput()}}}),l});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let n=i.settingEl.querySelector(".setting-item-control");n&&(n.addClass("openai-dropdown-container"),n.insertBefore(this.customModelContainer,n.firstChild)),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new QA.Setting(A).setName(m("Provider URL")).setDesc(m("Leave it blank, unless you are using a proxy.")).addText(l=>{var c;return l.setPlaceholder("https://api.deepseek.com/v1").setValue(((c=this.plugin.settings.ai.deepseek)==null?void 0:c.apiAddress)||"").onChange(async d=>{this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={}),this.plugin.settings.ai.deepseek.apiAddress=d,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(!this.customModelContainer)return;this.customModelContainer.addClass("visible"),this.customModelContainer.empty();let t=document.createElement("input");t.type="text",t.className="custom-model-input",t.placeholder="model-id",t.value=this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"",t.addEventListener("input",async()=>{let A=t.value.trim();if(A){if(!/^[a-zA-Z0-9-_.]+$/.test(A)){new QA.Notice(m("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),t.value=this.modelState.selectedModel.id;return}this.modelState.selectedModel={id:A,name:A,isCustom:!0},await this.saveModelState()}}),this.customModelContainer.appendChild(t)}hideCustomModelInput(){this.customModelContainer&&(this.customModelContainer.removeClass("visible"),this.customModelContainer.empty())}};var hA=require("obsidian");W();var Vs=class extends _e{constructor(t,A){super(t,A);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={apiKey:"",model:ei[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let t=this.plugin.settings.ai.gemini,A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=ei.find(n=>n.id===t.model);A=i||ei[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveModelState(){let t=this.plugin.settings.ai.gemini,A=this.modelState.selectedModel;t.model=A.id,t.isCustomModel=!!A.isCustom,t.apiKey=this.modelState.apiKey||"",t.baseUrl=t.baseUrl||"",A.isCustom&&A.id&&(t.lastCustomModel=A.id),await this.plugin.saveSettings()}async validateApiKey(t){var A;try{let i="https://generativelanguage.googleapis.com",n=(A=this.plugin.settings.ai.gemini)==null?void 0:A.baseUrl,l=n&&n.trim()?n:i,c=this.modelState.selectedModel.id,{GeminiService:d}=await Promise.resolve().then(()=>(rs(),zl)),g=new d(t,c,l);return await te.testConnection(g,"Gemini")}catch(i){return te.showError(`Gemini ${m("test failed")}: ${i.message||"Unknown error"}`),!1}}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new hA.Setting(A).setName(m("Gemini service")).setHeading(),new hA.Setting(A).setName(m("API Key")).setDesc(m("Please enter your API Key.")).addText(g=>g.setPlaceholder("Enter your API key").setValue(this.modelState.apiKey).onChange(async p=>{this.modelState.apiKey=p,await this.saveModelState()})).addButton(g=>g.setButtonText(m("Check")).onClick(async()=>{if(te.checkApiKey(this.modelState.apiKey,"Gemini")){g.setDisabled(!0),g.setButtonText(m("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{g.setDisabled(!1),g.setButtonText(m("Check"))}}}));let i=new hA.Setting(A).setName(m("Model")).setDesc(m("Select a model or enter a custom one.")).addDropdown(g=>{ei.forEach(C=>{g.addOption(C.id,C.name)}),g.addOption("custom",m("Custom Model"));let p=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(p),this.modelSelectEl=g.selectEl,g.onChange(async C=>{if(C==="custom")await this.showCustomModelInput();else{let y=ei.find(F=>F.id===C);if(y){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.gemini;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=y,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=i.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let n=i.settingEl.querySelector(".setting-item-control");n&&(n.addClass("openai-dropdown-container"),n.insertBefore(this.customModelContainer,n.firstChild));let c=new hA.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async p=>{let C=p.trim();if(C){if(!/^[a-zA-Z0-9-_.]+$/.test(C)){new hA.Notice(m("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:C,name:C,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new hA.Setting(A).setName(m("Provider URL")).setDesc(m("Leave it blank, unless you are using a proxy.")).addText(g=>{var y;let p="https://generativelanguage.googleapis.com",C=(y=this.plugin.settings.ai.gemini)==null?void 0:y.baseUrl;return g.setPlaceholder(p).setValue(C||"").onChange(async F=>{this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={}),this.plugin.settings.ai.gemini.baseUrl=F||"",await this.plugin.saveSettings()}),g})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let t=this.plugin.settings.ai.gemini;if(!this.modelState.selectedModel.isCustom){let i=t.lastCustomModel||"";this.modelState.selectedModel={id:i,name:i,isCustom:!0},t.model=i,t.isCustomModel=!0,await this.plugin.saveSettings();let n=this.customModelContainer.querySelector("input");n&&(n.value=i)}}}async hideCustomModelInput(){if(this.customModelContainer){this.customModelContainer.removeClass("visible");let t=this.plugin.settings.ai.gemini,A=this.modelState.selectedModel;if(A.isCustom&&A.id){t.lastCustomModel=A.id;let i=this.customModelContainer.querySelector("input");i&&(i.value=A.id)}t.isCustomModel=!1,await this.plugin.saveSettings()}}};var _s=require("obsidian");W();var Ws=class extends _e{async display(e){var l,c,d;let t=e.createEl("div",{cls:"ai-service-settings"});new _s.Setting(t).setName(m("Ollama service")).setHeading();let A="http://localhost:11434";(l=this.plugin.settings.ai.ollama)!=null&&l.host||(this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=A,await this.plugin.saveSettings());let i=new _s.Setting(t).setName(m("Server URL")).setDesc(m("Ollama server URL (default: http://localhost:11434)")).addText(g=>{var p;return g.setPlaceholder(A).setValue(((p=this.plugin.settings.ai.ollama)==null?void 0:p.host)||A).onChange(async C=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=C||A,await this.plugin.saveSettings()}),g}),n;i.addButton(g=>(n=g.buttonEl,g.setButtonText(m("Check")).onClick(async()=>{var y;let p=((y=this.plugin.settings.ai.ollama)==null?void 0:y.host)||A;n.disabled=!0;let C=n.textContent;n.textContent=m("Checking...");try{let Q=await new yA(p).listModels();Q&&Q.length>0?te.showSuccess(`Ollama ${m("connection successful!")}`):te.showWarning(m("No models found. Please download models using ollama"))}catch(F){te.showError(`Ollama ${m("test failed")}: ${F.message||"Unknown error"}`)}finally{n.disabled=!1,n.textContent=C}}))),(d=(c=this.plugin.settings.ai.ollama)==null?void 0:c.availableModels)!=null&&d.length&&this.displayOllamaModelDropdown(t,this.plugin.settings.ai.ollama.availableModels)}displayOllamaModelDropdown(e,t){let A=e.querySelector(".model-setting");A&&A.remove(),new _s.Setting(e).setName(m("Model")).setDesc(m("Select a Ollama model.")).addDropdown(n=>{var g;let l=Object.fromEntries(t.map(p=>[p,p])),c=(g=this.plugin.settings.ai.ollama)==null?void 0:g.model,d=t.includes(c)?c:t[0];return n.addOptions(l).setValue(d).onChange(async p=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.model=p,await this.plugin.saveSettings()})}).settingEl.addClass("model-setting")}};var Ut=require("obsidian");W();var Xs=class extends _e{constructor(t,A){super(t,A);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.siliconflow||(this.plugin.settings.ai.siliconflow={apiKey:"",model:_t[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let t=this.plugin.settings.ai.siliconflow,A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=_t.find(n=>n.id===t.model);A=i||_t[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveModelState(){let t=this.plugin.settings.ai.siliconflow,A=this.modelState.selectedModel;t.model=A.id,t.isCustomModel=!!A.isCustom,t.apiKey=this.modelState.apiKey||"",A.isCustom&&A.id&&(t.lastCustomModel=A.id),await this.plugin.saveSettings()}async validateApiKey(t){var A;try{let i="https://api.siliconflow.cn/v1",n=(A=this.plugin.settings.ai.siliconflow)==null?void 0:A.baseUrl,l=n&&n.trim()?n:i,c=this.modelState.selectedModel.id,d=`${l}/chat/completions`,g=await(0,Ut.requestUrl)({url:d,method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:c,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(!g.status||g.status<200||g.status>=300){let p=g.json||null;return{isValid:!1,message:m("API Key \u65E0\u6548\u6216\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u4F60\u7684 API Key \u548C\u6A21\u578B ID \u662F\u5426\u6B63\u786E\u3002")}}return{isValid:!0,message:m("API Key and model available.")}}catch(i){return{isValid:!1,message:m("API Key \u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\u3002")}}}async showCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.addClass("visible")}async hideCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.removeClass("visible")}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new Ut.Setting(A).setName(m("SiliconFlow service")).setHeading();let i=new Ut.Setting(A).setName(m("API key")).setDesc(m("Please enter your API Key.")).addText(p=>p.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async C=>{this.modelState.apiKey=C,await this.saveModelState()})).addButton(p=>p.setButtonText(m("Check")).onClick(async()=>{if(te.checkApiKey(this.modelState.apiKey,"SiliconFlow")){p.setDisabled(!0),p.setButtonText(m("Checking..."));try{let{SiliconFlowService:C}=await Promise.resolve().then(()=>(ns(),jl)),y=new C(this.plugin.settings.ai);await te.testConnection(y,"SiliconFlow")}catch(C){te.showError(`SiliconFlow ${m("test failed")}: ${C.message||"Unknown error"}`)}finally{p.setDisabled(!1),p.setButtonText(m("Check"))}}})),n=new Ut.Setting(A).setName(m("Model")).setDesc(m("Select a model or enter a custom one.")).addDropdown(p=>{_t.forEach(y=>{p.addOption(y.id,y.name)}),p.addOption("custom","Custom Model");let C=this.modelState.selectedModel;return p.setValue(C.isCustom?"custom":C.id),this.modelSelectEl=p.selectEl,p.onChange(async y=>{var F;if(y==="custom"){let Q=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.lastCustomModel;this.modelState.selectedModel={id:Q||"",name:Q||"",isCustom:!0},await this.saveModelState(),await this.showCustomModelInput()}else{let Q=_t.find(U=>U.id===y);Q&&(this.modelState.selectedModel.isCustom&&this.plugin.settings.ai.siliconflow&&(this.plugin.settings.ai.siliconflow.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()),this.modelState.selectedModel=Q,await this.saveModelState(),await this.hideCustomModelInput())}}),p});this.customModelContainer=n.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let l=n.settingEl.querySelector(".setting-item-control");l&&(l.addClass("openai-dropdown-container"),l.insertBefore(this.customModelContainer,l.firstChild));let d=new Ut.Setting(this.customModelContainer).addText(p=>p.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async C=>{let y=C.trim();if(y){if(!/^[a-zA-Z0-9-_./]+$/.test(y)){new Ut.Notice("Model ID can only contain letters, numbers, underscores, dots and hyphens."),p.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:y,name:y,isCustom:!0},await this.saveModelState()}})).settingEl;d.addClass("openai-setting-no-border");let g=d.querySelector(".setting-item-control");g&&g.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new Ut.Setting(A).setName(m("Provider URL")).setDesc(m("Leave it blank, unless you are using a proxy.")).addText(p=>{var F;let C="https://api.siliconflow.cn/v1",y=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.baseUrl;return p.setPlaceholder(C).setValue(y||"").onChange(async Q=>{this.plugin.settings.ai.siliconflow?this.plugin.settings.ai.siliconflow.baseUrl=Q||"":this.plugin.settings.ai.siliconflow={apiKey:this.modelState.apiKey||"",model:this.modelState.selectedModel.id,baseUrl:Q||"",isCustomModel:!!this.modelState.selectedModel.isCustom,lastCustomModel:this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:void 0},await this.plugin.saveSettings()}),p})}};var Mt=require("obsidian");W();var Js=class extends _e{constructor(t,A){super(t,A);this.detectedApiType=null}display(t){var l,c;let A=t.createEl("div",{cls:"ai-service-settings"});new Mt.Setting(A).setName(m("Custom AI Service")).setHeading();let i=A.createEl("div",{cls:"setting-item-description custom-ai-description"});if(i.createEl("p",{text:m("Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.")}),i.createEl("p",{text:m("The API type will be automatically detected based on your URL.")}),new Mt.Setting(A).setName(m("Service Name")).setDesc(m("Give your custom AI service a name")).addText(d=>{var g;return d.setPlaceholder(m("e.g., My AI Service")).setValue(((g=this.plugin.settings.ai.custom)==null?void 0:g.name)||"").onChange(async p=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.name=p,await this.plugin.saveSettings()})}),new Mt.Setting(A).setName(m("API Endpoint URL")).setDesc(m("The base URL of your AI service API")).addText(d=>{var g;return d.setPlaceholder("https://api.example.com/v1").setValue(((g=this.plugin.settings.ai.custom)==null?void 0:g.baseUrl)||"").onChange(async p=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.baseUrl=p,this.plugin.settings.ai.custom.detectedApiType=void 0,this.detectedApiType=null,await this.plugin.saveSettings()})}),new Mt.Setting(A).setName(m("API Key")).setDesc(m("Your API key for authentication")).addText(d=>{var g;return d.setPlaceholder("sk-...").setValue(((g=this.plugin.settings.ai.custom)==null?void 0:g.apiKey)||"").onChange(async p=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.apiKey=p,await this.plugin.saveSettings()}),d.inputEl.type="password",d}).addButton(d=>d.setButtonText(m("Check")).onClick(async()=>{var g,p,C,y;if(!((g=this.plugin.settings.ai.custom)!=null&&g.apiKey)||!((p=this.plugin.settings.ai.custom)!=null&&p.baseUrl)||!((C=this.plugin.settings.ai.custom)!=null&&C.model)){te.showWarning(m("Please fill in all required fields first"));return}d.setDisabled(!0),d.setButtonText(m("Testing..."));try{if(await this.testConnection()){let Q=(y=this.plugin.settings.ai.custom)==null?void 0:y.detectedApiType;if(Q){this.detectedApiType=Q;let U={openai:"OpenAI",anthropic:"Anthropic",gemini:"Gemini"};te.showSuccess(`Custom AI ${m("connection successful!")} (${m("Detected API type")}: ${U[Q]})`);let b=A.querySelector(".custom-ai-info");if(!b)b=A.createEl("div",{cls:"setting-item-description custom-ai-info"}),b.createEl("strong",{text:m("Detected API Type: ")}),b.createEl("span",{text:U[Q]||Q});else{let k=b.querySelector("span");k&&(k.textContent=U[Q]||Q)}}else te.showSuccess(`Custom AI ${m("connection successful!")}`)}else te.showError(`Custom AI ${m("connection failed. Please check your settings.")}`)}catch(F){te.showError(`Custom AI ${m("test failed")}: ${F.message}`)}finally{d.setDisabled(!1),d.setButtonText(m("Check"))}})),new Mt.Setting(A).setName(m("Model")).setDesc(m("The model identifier to use")).addText(d=>{var g;return d.setPlaceholder("gpt-4, claude-3-opus, gemini-pro, etc.").setValue(((g=this.plugin.settings.ai.custom)==null?void 0:g.model)||"").onChange(async p=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.model=p,await this.plugin.saveSettings()})}),(l=this.plugin.settings.ai.custom)!=null&&l.detectedApiType||this.detectedApiType){let d=((c=this.plugin.settings.ai.custom)==null?void 0:c.detectedApiType)||this.detectedApiType,g={openai:"OpenAI",anthropic:"Anthropic",gemini:"Gemini"},p=A.createEl("div",{cls:"setting-item-description custom-ai-info"});p.createEl("strong",{text:m("Detected API Type: ")}),p.createEl("span",{text:g[d]||d})}let n=new Mt.Setting(A).setName(m("Advanced Options")).setDesc(m("Optional custom headers (JSON format)"));n.descEl.createEl("br"),n.descEl.createEl("small",{text:m('Example: {"X-Custom-Header": "value"}')}),n.addTextArea(d=>{var g;return d.setPlaceholder("{}").setValue((g=this.plugin.settings.ai.custom)!=null&&g.headers?JSON.stringify(this.plugin.settings.ai.custom.headers,null,2):"").onChange(async p=>{if(!p.trim()){this.plugin.settings.ai.custom&&(this.plugin.settings.ai.custom.headers=void 0,await this.plugin.saveSettings());return}try{let C=JSON.parse(p);if(typeof C!="object"||Array.isArray(C)){new Mt.Notice(m("Invalid JSON format. Headers must be an object."));return}this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.headers=C,await this.plugin.saveSettings()}catch(C){new Mt.Notice(m("Invalid JSON format"))}}),d.inputEl.rows=4,d.inputEl.style.fontFamily="monospace",d})}async testConnection(){try{let{CustomAIService:t}=await Promise.resolve().then(()=>(as(),ec)),A=this.plugin.settings.ai.custom;if(!A)return!1;let i=new t(A.apiKey,A.baseUrl,A.model,A.headers,A.detectedApiType),n=await i.testConnection();if(n){let l=i.getDetectedAPIType();l&&A&&(A.detectedApiType=l,await this.plugin.saveSettings())}return n}catch(t){return console.error("Test connection error:",t),!1}}};var ti=require("obsidian"),$s=require("obsidian");W();var Ys=class{constructor(e,t){this.plugin=e,this.containerEl=t}display(){let e=this.containerEl.createEl("div",{cls:"prompt-settings-container"}),t=e.createEl("div",{cls:"prompt-settings-header setting-item-heading"});t.createEl("h4",{text:m("Prompt settings"),cls:"prompt-settings-title"});let A=t.createEl("button",{cls:"prompt-add-btn",attr:{"aria-label":m("Add prompt")}});(0,$s.setIcon)(A,"plus"),A.onclick=()=>{if(e.querySelector(".new-prompt-section"))return;let i=e.querySelector(".prompt-list");i&&this.createNewPromptForm(e,i)},this.displayPromptList(e)}createNewPromptForm(e,t){var g;let A=e.createEl("div",{cls:"new-prompt-section"});(g=t.parentElement)==null||g.insertBefore(A,t);let i=A.createEl("input",{cls:"prompt-name-input",attr:{placeholder:m("Input Prompt Name"),type:"text"}}),n=new ti.TextAreaComponent(A);n.setPlaceholder(m(`Input Prompt Content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`)).setValue(""),n.inputEl.addClass("prompt-textarea");let l=A.createEl("div",{cls:"prompt-buttons"}),c=l.createEl("button",{cls:"prompt-save-btn",text:m("Save")});c.onclick=async()=>{var y;let p=i.value,C=n.getValue();if(p&&C){this.plugin.settings.ai.prompts||(this.plugin.settings.ai.prompts={}),this.plugin.settings.ai.prompts[p]=C,await this.plugin.saveSettings(),A.remove(),this.displayPromptList(e),new ti.Notice(m("Prompt added"));let F=(y=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:y.view;F&&F.updateAIDropdowns()}};let d=l.createEl("button",{cls:"prompt-cancel-btn",text:m("Cancel")});d.onclick=()=>{A.remove()}}displayPromptList(e){let t=e.querySelector(".prompt-list");t&&t.remove();let A=e.createEl("div",{cls:"prompt-list"}),i=this.plugin.settings.ai.prompts||{};for(let[n,l]of Object.entries(i)){let c=A.createEl("div",{cls:"prompt-item"}),d=c.createEl("div",{cls:"prompt-display-mode"}),g=d.createEl("div",{cls:"prompt-info"});g.createEl("div",{cls:"prompt-name",text:n});let p=l.replace(/\n/g," ");g.createEl("div",{cls:"prompt-content-preview",text:p});let y=d.createEl("div",{cls:"prompt-buttons"}).createEl("button",{cls:"prompt-edit-btn",attr:{"aria-label":m("Edit")}});(0,$s.setIcon)(y,"square-pen");let F=c.createEl("div",{cls:"prompt-edit-mode hi-note-hidden"}),Q=F.createEl("input",{cls:"prompt-name-input",attr:{value:n,type:"text"}}),U=new ti.TextAreaComponent(F);U.setValue(l),U.inputEl.classList.add("prompt-content-input"),U.inputEl.addClass("prompt-textarea");let b=F.createEl("div",{cls:"prompt-edit-buttons"}),k=b.createEl("button",{cls:"prompt-save-btn",text:m("Save")}),Ae=b.createEl("button",{cls:"prompt-cancel-btn",text:m("Cancel")}),N=b.createEl("button",{cls:"prompt-delete-btn",attr:{"aria-label":m("Delete")}});(0,$s.setIcon)(N,"trash-2"),y.onclick=()=>{d.addClass("hi-note-hidden"),F.removeClass("hi-note-hidden")},N.onclick=async()=>{var V;delete this.plugin.settings.ai.prompts[n],await this.plugin.saveSettings(),c.remove();let G=(V=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:V.view;G&&G.updateAIDropdowns()},k.onclick=async()=>{var z;let G=Q.value,V=U.getValue();if(G&&V){G!==n&&delete this.plugin.settings.ai.prompts[n],this.plugin.settings.ai.prompts[G]=V,await this.plugin.saveSettings(),this.displayPromptList(e),new ti.Notice(m("Prompt updated"));let oe=(z=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:z.view;oe&&oe.updateAIDropdowns()}},Ae.onclick=()=>{d.removeClass("hi-note-hidden"),F.addClass("hi-note-hidden")}}}};var qs=class{constructor(e,t){this.plugin=e,this.containerEl=t}display(){switch(new mc.Setting(this.containerEl).setName("AI service").setDesc(m("Select the AI service provider")).addDropdown(e=>{let t={openai:"OpenAI",gemini:"Gemini",anthropic:"Anthropic",deepseek:"Deepseek",siliconflow:"SiliconFlow",ollama:"Ollama (Local)",custom:m("Custom AI Service")};return e.addOptions(t).setValue(this.plugin.settings.ai.provider).onChange(async A=>{this.plugin.settings.ai.provider=A,await this.plugin.saveSettings(),this.containerEl.empty(),this.display()})}),this.plugin.settings.ai.provider){case"openai":new Os(this.plugin,this.containerEl).display(this.containerEl);break;case"gemini":new Vs(this.plugin,this.containerEl).display(this.containerEl);break;case"anthropic":new Ns(this.plugin,this.containerEl).display(this.containerEl);break;case"ollama":new Ws(this.plugin,this.containerEl).display(this.containerEl);break;case"deepseek":new Gs(this.plugin,this.containerEl).display(this.containerEl);break;case"siliconflow":new Xs(this.plugin,this.containerEl).display(this.containerEl);break;case"custom":new Js(this.plugin,this.containerEl).display(this.containerEl);break}new Ys(this.plugin,this.containerEl).display()}};var ke=require("obsidian");W();var ir=class{constructor(e,t){this.plugin=e,this.containerEl=t,this.fsrsService=e.fsrsManager.fsrsService}display(){let e=this.containerEl.createEl("div",{cls:"flashcard-settings-container"});new ke.Setting(e).setName(m("Flashcard learning")).setHeading(),new ke.Setting(e).setName(m("New cards per day")).setDesc(m("Maximum number of new cards to learn each day")).addSlider(n=>{var d;let l=this.fsrsService.getParameters();n.setLimits(1,200,1).setValue(l.newCardsPerDay).setDynamicTooltip().onChange(async g=>{let p=this.fsrsService.getParameters();p.newCardsPerDay=g,this.fsrsService.setParameters(p),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.newCardsPerDay)});(d=n.sliderEl.parentElement)==null||d.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=String(n.getValue())})}),new ke.Setting(e).setName(m("Reviews per day")).setDesc(m("Maximum number of cards to review each day")).addSlider(n=>{var d;let l=this.fsrsService.getParameters();n.setLimits(10,500,10).setValue(l.reviewsPerDay).setDynamicTooltip().onChange(async g=>{let p=this.fsrsService.getParameters();p.reviewsPerDay=g,this.fsrsService.setParameters(p),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.reviewsPerDay)});(d=n.sliderEl.parentElement)==null||d.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=String(n.getValue())})}),new ke.Setting(e).setName(m("Target retention")).setDesc(m("Target memory retention rate (0.8 = 80%)")).addSlider(n=>{var d;let l=this.fsrsService.getParameters();n.setLimits(.7,.95,.01).setValue(l.request_retention).setDynamicTooltip().onChange(async g=>{let p=this.fsrsService.getParameters();p.request_retention=g,this.fsrsService.setParameters(p),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:`${Math.round(l.request_retention*100)}%`});(d=n.sliderEl.parentElement)==null||d.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=`${Math.round(n.getValue()*100)}%`})}),new ke.Setting(e).setName(m("Maximum interval")).setDesc(m("Maximum interval in days between reviews")).addText(n=>{let l=this.fsrsService.getParameters();n.setValue(l.maximum_interval.toString()).setPlaceholder("365").onChange(async g=>{let p=parseInt(g);if(!isNaN(p)&&p>0){let C=this.fsrsService.getParameters();C.maximum_interval=p,this.fsrsService.setParameters(C),await this.plugin.saveSettings()}});let c=n.inputEl;c.type="number",c.min="1",c.style.width="80px";let d=createEl("span",{text:` ${m("days")}`,cls:"setting-item-suffix"});c.after(d)}),new ke.Setting(e).setName(m("Reset daily stats")).setDesc(m("Reset today's learning statistics")).addButton(n=>n.setButtonText(m("Reset")).onClick(async()=>{let l=new Date;l.setHours(0,0,0,0);let c=this.plugin.fsrsManager.storage.dailyStats,d=c.findIndex(g=>g.date===l.getTime());d>=0?(c.splice(d,1),await this.plugin.fsrsManager.saveStorage(),new ke.Notice(m("Daily statistics have been reset"))):new ke.Notice(m("No statistics to reset for today"))})),new ke.Setting(e).setName(m("Advanced")).setHeading(),e.createEl("p",{text:m("These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm."),cls:"setting-item-description"}),new ke.Setting(e).setName(m("Reset algorithm parameters")).setDesc(m("Reset the FSRS algorithm parameters to default values")).addButton(n=>n.setButtonText(m("Reset to default")).onClick(async()=>{this.fsrsService.resetParameters(),await this.plugin.saveSettings();let l=this.fsrsService.getParameters(),c=this.containerEl.querySelector(".setting-item:nth-child(4) .slider"),d=this.containerEl.querySelector(".setting-item:nth-child(4) .slider-value");c&&d&&(c.value=String(l.request_retention),d.textContent=`${Math.round(l.request_retention*100)}%`);let g=this.containerEl.querySelector('.setting-item:nth-child(5) input[type="number"]');g&&(g.value=String(l.maximum_interval));let p=this.containerEl.querySelector(".setting-item:nth-child(2) .slider"),C=this.containerEl.querySelector(".setting-item:nth-child(2) .slider-value");p&&C&&(p.value=String(l.newCardsPerDay),C.textContent=String(l.newCardsPerDay));let y=this.containerEl.querySelector(".setting-item:nth-child(3) .slider"),F=this.containerEl.querySelector(".setting-item:nth-child(3) .slider-value");y&&F&&(y.value=String(l.reviewsPerDay),F.textContent=String(l.reviewsPerDay));let Q=this.containerEl.querySelector(".fsrs-weights-textarea");Q&&(Q.value=JSON.stringify(l.w)),new ke.Notice(m("FSRS parameters have been reset to default values"))}));let t=e.createEl("div",{cls:"fsrs-params-container"});t.createEl("p",{text:m("FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation."),cls:"setting-item-description"});let A=this.fsrsService.getParameters(),i=JSON.stringify(A.w);new ke.Setting(t).setName(m("FSRS parameters")).setDesc(m("Edit the 21 FSRS algorithm weights. Format: JSON array of numbers.")).addTextArea(n=>{n.setValue(i).setPlaceholder("[0.4872, 1.4003, ...]").onChange(async l=>{try{let c=JSON.parse(l);if(Array.isArray(c)&&c.length===21&&c.every(d=>typeof d=="number")){let d=this.fsrsService.getParameters();d.w=c,this.fsrsService.setParameters(d),await this.plugin.saveSettings(),new ke.Notice(m("FSRS weights updated successfully"))}else new ke.Notice(m("Invalid format. Must be an array of 21 numbers."),5e3)}catch(c){new ke.Notice(m("Invalid JSON format. Please check your input."),5e3)}}),n.inputEl.rows=2,n.inputEl.cols=32,n.inputEl.addClass("fsrs-weights-textarea")})}};W();var zs=class extends fc.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,this.DEFAULT_SETTINGS=t.DEFAULT_SETTINGS,this.licenseManager=new oA(this.plugin)}async display(){let{containerEl:e}=this;e.empty();let t=e.createEl("div",{cls:"setting-tabs"}),A=e.createEl("div",{cls:"setting-tab-content"}),i=t.createEl("div",{text:m("General"),cls:"setting-tab-btn active",attr:{role:"button",tabindex:"0"}}),n=t.createEl("div",{text:m("AI service"),cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),l=null,c=A.createEl("div",{cls:"setting-tab-pane active"}),d=A.createEl("div",{cls:"setting-tab-pane"}),g=null,p=(C,y)=>{t.findAll(".setting-tab-btn").forEach(F=>F.removeClass("active")),A.findAll(".setting-tab-pane").forEach(F=>F.removeClass("active")),C.addClass("active"),y.addClass("active")};i.onclick=()=>p(i,c),n.onclick=()=>p(n,d),new ks(this.plugin,c).display(),new qs(this.plugin,d).display(),l=t.createEl("div",{text:"HiCard",cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),g=A.createEl("div",{cls:"setting-tab-pane"}),l.onclick=async()=>{var y;if(p(l,g),g.empty(),await this.licenseManager.isActivated())new ir(this.plugin,g).display();else{let F=g.createEl("div",{cls:"flashcard-activation-container"});F.createEl("div",{cls:"flashcard-activation-header",text:m("Activate HiCard")});let Q=F.createEl("div",{cls:"flashcard-activation-description"});Q.createEl("span",{text:m("Enter your license key to activate HiCard feature.")+" "}),Q.createEl("br"),Q.createEl("span",{text:m("Get your license key from")+" "});let b=(((y=window.moment)==null?void 0:y.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",k=Q.createEl("a",{text:m("HiNote official website"),cls:"external-link",href:b});k.setAttr("target","_blank"),k.setAttr("rel","noopener noreferrer");let Ae=F.createEl("div",{cls:"flashcard-activation-input-container"}),N=Ae.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:m("Enter license key")}),G=Ae.createEl("button",{cls:"flashcard-activation-button",text:m("Activate")}),V=F.createEl("div",{cls:"activation-msg"});G.onclick=async()=>{G.setAttr("disabled","true"),V.textContent=m("Verifying..."),await this.licenseManager.activateLicense(N.value)?(V.textContent=m("Activation successful!"),g.empty(),new ir(this.plugin,g).display()):(V.textContent=m("Activation failed. Please check your license key."),G.removeAttribute("disabled"))}}}}};var Dc=kl(Qa());var wc=require("obsidian");var Bc=require("obsidian");var Zs=class{constructor(e){this.plugin=e;this.aiService=new Ot(this.plugin.settings.ai)}updateModel(e,t){if(this.aiService){let A=e;this.aiService.updateModel(A,t)}}async sendMessage(e,t=[]){try{let A=t.map(n=>({role:n.role,content:n.content}));return A.push({role:"user",content:e}),{content:await this.aiService.chat(A),type:"assistant",timestamp:Date.now()}}catch(A){throw new Bc.Notice("\u83B7\u53D6 AI \u54CD\u5E94\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u914D\u7F6E\u548C\u7F51\u7EDC\u8FDE\u63A5"),A}}async testConnection(){return await this.aiService.testConnection()}};var Cc=require("obsidian"),js=class{constructor(e){this.app=e}async getContextForHighlight(e,t={strategy:"paragraph",includeTitle:!0,maxLength:2e3}){if(!e.filePath)return null;let A=this.app.vault.getAbstractFileByPath(e.filePath);if(!A||!(A instanceof Cc.TFile))return null;let i=await this.app.vault.read(A),n=this.app.metadataCache.getFileCache(A);switch(t.strategy){case"paragraph":return this.getParagraphContext(i,e,A,n,t);case"section":return this.getSectionContext(i,e,A,n,t);case"surrounding":return this.getSurroundingContext(i,e,A,t);case"smart":return this.getSmartContext(i,e,A,n,t);default:return this.getParagraphContext(i,e,A,n,t)}}getParagraphContext(e,t,A,i,n){let l=e.split(`
`),c=t.text,d=-1;for(let U=0;U<l.length;U++)if(l[U].includes(c)){d=U;break}if(d===-1)return this.createContextInfo("","",A,e);let g=d,p=d;for(;g>0&&l[g-1].trim()!=="";)g--;for(;p<l.length-1&&l[p+1].trim()!=="";)p++;let C=l.slice(g,d).join(`
`),y=l.slice(d+1,p+1).join(`
`),F=l.slice(g,p+1).join(`
`),Q=this.findSectionTitle(l,d);return this.createContextInfo(C,y,A,F,Q,n.maxLength)}getSectionContext(e,t,A,i,n){if(!(i!=null&&i.sections))return this.getParagraphContext(e,t,A,i,n);let l=e.split(`
`),c=t.text,d=e.indexOf(c);if(d===-1)return this.createContextInfo("","",A,e);let g=i.sections.find(Q=>Q.position.start.offset<=d&&Q.position.end.offset>=d);if(!g)return this.getParagraphContext(e,t,A,i,n);let p=e.substring(g.position.start.offset,g.position.end.offset),C=e.substring(g.position.start.offset,d),y=e.substring(d+c.length,g.position.end.offset),F=this.findSectionTitle(l,this.getLineFromOffset(e,d));return this.createContextInfo(C,y,A,p,F,n.maxLength)}getSurroundingContext(e,t,A,i){let n=e.split(`
`),l=t.text,c=i.surroundingLines||3,d=-1;for(let U=0;U<n.length;U++)if(n[U].includes(l)){d=U;break}if(d===-1)return this.createContextInfo("","",A,e);let g=Math.max(0,d-c),p=Math.min(n.length-1,d+c),C=n.slice(g,d).join(`
`),y=n.slice(d+1,p+1).join(`
`),F=n.slice(g,p+1).join(`
`),Q=this.findSectionTitle(n,d);return this.createContextInfo(C,y,A,F,Q,i.maxLength)}getSmartContext(e,t,A,i,n){let l=this.getSectionContext(e,t,A,i,n);return l.fullContext.length>(n.maxLength||2e3)?this.getParagraphContext(e,t,A,i,n):l}findSectionTitle(e,t){for(let A=t;A>=0;A--){let i=e[A].trim();if(i.startsWith("#"))return i}}getLineFromOffset(e,t){return e.substring(0,t).split(`
`).length-1}createContextInfo(e,t,A,i,n,l){let c=i;if(l&&i.length>l){let d=Math.floor(l/2),g=i.substring(0,d),p=i.substring(i.length-d);c=`${g}

... [\u5185\u5BB9\u5DF2\u622A\u65AD] ...

${p}`}return{beforeContext:e,afterContext:t,sectionTitle:n,filePath:A.path,fileName:A.name,fullContext:c}}async getContextForMultipleHighlights(e,t={strategy:"paragraph"}){let A=[];for(let i of e){let n=await this.getContextForHighlight(i,t);n&&A.push(n)}return A}};var Ai=class Ai{constructor(){this.chatHistory=[];this.draggedContents=[];this.currentPreviewContainer=null;this.chatModelState={provider:"",model:""}}getChatHistory(){return this.chatHistory}setChatHistory(e){this.chatHistory=e}addToHistory(e){this.chatHistory.push(e)}clearHistory(){this.chatHistory=[]}getDraggedContents(){return this.draggedContents}setDraggedContents(e){this.draggedContents=e}addDraggedContent(e){this.draggedContents.push(e)}removeDraggedContent(e){let t=this.draggedContents.indexOf(e);t>-1&&this.draggedContents.splice(t,1)}clearDraggedContents(){this.draggedContents=[]}getCurrentPreviewContainer(){return this.currentPreviewContainer}setCurrentPreviewContainer(e){this.currentPreviewContainer=e}getModelState(){return this.chatModelState}setModelState(e){this.chatModelState=e}saveState(){Ai.savedState={chatHistory:[...this.chatHistory],draggedContents:[...this.draggedContents],currentPreviewContainer:this.currentPreviewContainer!==null}}static getSavedState(){return Ai.savedState}static clearSavedState(){Ai.savedState=null}restoreState(e){this.chatHistory=e.chatHistory,this.draggedContents=e.draggedContents}};Ai.savedState=null;var rr=Ai;var ba=require("obsidian");W();var en=class{constructor(e,t,A){this.textarea=null;this.app=e,this.plugin=t,this.stateManager=A,this.containerEl=document.createElement("div")}buildChatWindow(e,t,A,i){this.containerEl.addClass("highlight-chat-window");let n=this.buildHeader(e,t,A,i),l=this.buildChatHistory(),c=this.buildInputArea(),d=this.containerEl.createEl("div",{cls:"highlight-chat-resize-handle"});return this.setupResizeHandle(d),this.setupWindowDrag(n,e,t),this.containerEl}buildHeader(e,t,A,i){let n=this.containerEl.createEl("div",{cls:"highlight-chat-header"}),l=n.createEl("div",{cls:"highlight-chat-title"});l.createEl("span",{text:m("Chat")});let c=l.createEl("div",{cls:"highlight-chat-model",text:i()});c.addEventListener("click",C=>{C.stopPropagation(),A(c,C)});let d=n.createEl("div",{cls:"highlight-chat-buttons"}),g=d.createEl("div",{cls:"highlight-chat-clear"});(0,ba.setIcon)(g,"eraser"),g.addEventListener("click",e);let p=d.createEl("div",{cls:"highlight-chat-close"});return(0,ba.setIcon)(p,"x"),p.addEventListener("click",t),n}buildChatHistory(){return this.containerEl.createEl("div",{cls:"highlight-chat-history"})}buildInputArea(){return this.containerEl.createEl("div",{cls:"highlight-chat-input-container"})}setupChatInput(e,t){let A=e.createEl("div",{cls:"highlight-chat-input-wrapper"});this.textarea=A.createEl("textarea",{cls:"highlight-chat-input",attr:{placeholder:m("Input message..."),rows:"1"}});let i=()=>{this.textarea&&(this.textarea.addClass("highlight-chat-input"),this.textarea.style.height=`${Math.min(this.textarea.scrollHeight,150)}px`)};return this.textarea.addEventListener("input",()=>{i()}),this.textarea.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.textarea&&t(this.textarea))}),this.textarea}setupResizeHandle(e){let t=!1,A=0,i=0,n=0,l=0;e.addEventListener("mousedown",g=>{g.preventDefault(),g.stopPropagation(),t=!0,A=g.clientX,i=g.clientY;let p=this.containerEl.getBoundingClientRect();n=p.width,l=p.height,document.addEventListener("mousemove",c),document.addEventListener("mouseup",d),this.containerEl.addClass("resizing")});let c=g=>{if(!t)return;let p=g.clientX-A,C=g.clientY-i,y=Math.max(300,n+p),F=Math.max(300,l+C),Q=Math.min(y,window.innerWidth*.9),U=Math.min(F,window.innerHeight*.9);this.containerEl.style.width=`${Q}px`,this.containerEl.style.height=`${U}px`},d=()=>{t=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d),this.containerEl.removeClass("resizing")}}setupWindowDrag(e,t,A){let i=!1,n,l,c,d;e.addEventListener("mousedown",g=>{g.target.closest(".highlight-chat-clear")||g.target.closest(".highlight-chat-close")||(i=!0,c=g.clientX-this.containerEl.offsetLeft,d=g.clientY-this.containerEl.offsetTop,e.addClass("dragging"))}),document.addEventListener("mousemove",g=>{if(!i)return;g.preventDefault(),n=g.clientX-c,l=g.clientY-d;let p=window.innerWidth-this.containerEl.offsetWidth,C=window.innerHeight-this.containerEl.offsetHeight;n=Math.max(0,Math.min(n,p)),l=Math.max(0,Math.min(l,C)),this.containerEl.addClass("highlight-chat-window"),this.containerEl.style.left=`${n}px`,this.containerEl.style.top=`${l}px`}),document.addEventListener("mouseup",()=>{i=!1,e.removeClass("dragging")})}getContainer(){return this.containerEl}getTextarea(){return this.textarea}getChatHistoryContainer(){return this.containerEl.querySelector(".highlight-chat-history")}};var ii=require("obsidian"),tn=class{constructor(e,t,A,i,n){this.isProcessing=!1;var l,c,d,g,p;this.app=e,this.plugin=t,this.chatService=A,this.contextService=i,this.stateManager=n,this.contextOptions={strategy:((l=this.plugin.settings.contextOptions)==null?void 0:l.strategy)||"smart",includeTitle:(d=(c=this.plugin.settings.contextOptions)==null?void 0:c.includeTitle)!=null?d:!0,maxLength:((g=this.plugin.settings.contextOptions)==null?void 0:g.maxLength)||2e3,surroundingLines:((p=this.plugin.settings.contextOptions)==null?void 0:p.surroundingLines)||3}}addMessage(e,t,A,i=!0){let n=e.createEl("div",{cls:"highlight-chat-message"}),l=n.createEl("div",{cls:"highlight-chat-message-content markdown-rendered"});n.addClass(`highlight-chat-message-${A}`),l.addClass(`highlight-chat-message-content-${A}`),A==="assistant"&&i?this.typeWriter(l,t):this.renderMarkdownContent(l,t),e.scrollTop=e.scrollHeight}async typeWriter(e,t,A=30){let i=0;e.textContent="";let n=e.createEl("span",{cls:"highlight-chat-cursor"}),l=()=>{i<t.length?(e.insertBefore(document.createTextNode(t.charAt(i)),n),i++,setTimeout(l,A)):(n.remove(),this.renderMarkdownContent(e,t))};l()}async renderMarkdownContent(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);try{await ii.MarkdownRenderer.render(this.app,t,e,"",new ii.Component),e.querySelectorAll("ul, ol").forEach(i=>{i.addClass("chat-markdown-list")})}catch(A){console.error("Error rendering markdown in chat:",A),e.textContent=t}}async handleSendMessage(e,t,A,i){let n=e.value.trim();if(!(!n||this.isProcessing))try{this.isProcessing=!0;let l=n,c=n,d=this.stateManager.getDraggedContents();if(d.length>0){let p=d.map(Q=>this.contextService.getContextForHighlight(Q,this.contextOptions)),y=(await Promise.all(p)).map((Q,U)=>{let b=d[U];if(!Q)return`**\u9AD8\u4EAE\u5185\u5BB9 ${U+1}:**
${b.text}`;let k=`**Highlight ${U+1}** (from: ${Q.fileName}):
`;return Q.sectionTitle&&(k+=`**Section:** ${Q.sectionTitle}

`),Q.beforeContext.trim()&&(k+=`**Before:**
${Q.beforeContext.trim()}

`),k+=`**Highlight:**
${b.text}

`,Q.afterContext.trim()&&(k+=`**After:**
${Q.afterContext.trim()}`),k}).join(`

---

`);this.stateManager.addToHistory({role:"user",content:`\u4EE5\u4E0B\u662F\u9700\u8981\u5206\u6790\u7684\u5185\u5BB9\uFF08\u5305\u542B\u4E0A\u4E0B\u6587\uFF09\uFF1A

${y}`}),l=n,c=`\u7528\u6237\u63D0\u793A\uFF1A${n}`;let F=A();if(F){let Q=F.closest(".highlight-chat-message-preview");Q&&Q.addClass("sent"),i(null),this.stateManager.clearDraggedContents()}}this.stateManager.addToHistory({role:"user",content:c}),requestAnimationFrame(()=>{e.value="",e.addClass("highlight-chat-input"),e.dispatchEvent(new Event("input"))}),this.addMessage(t,n,"user",!0);let g=await this.chatService.sendMessage(l,this.stateManager.getChatHistory());this.stateManager.addToHistory({role:"assistant",content:g.content}),this.addMessage(t,g.content,"assistant",!0)}catch(l){console.error("\u53D1\u9001\u6D88\u606F\u65F6\u51FA\u9519:",l),new ii.Notice("Failed to send message, please try again")}finally{this.isProcessing=!1}}clearChat(e,t){this.stateManager.clearHistory(),this.stateManager.clearDraggedContents();let A=this.stateManager.getCurrentPreviewContainer();if(A){let i=A.closest(".highlight-chat-message-preview");i&&i.remove(),this.stateManager.setCurrentPreviewContainer(null)}for(;e.firstChild;)e.removeChild(e.firstChild);t&&(t.value="",t.addClass("highlight-chat-input"))}getContextOptions(){return this.contextOptions}setContextOptions(e){this.contextOptions=e}async saveContextOptions(){this.plugin.settings.contextOptions||(this.plugin.settings.contextOptions={}),this.plugin.settings.contextOptions.strategy=this.contextOptions.strategy,this.plugin.settings.contextOptions.includeTitle=this.contextOptions.includeTitle,this.plugin.settings.contextOptions.maxLength=this.contextOptions.maxLength,this.plugin.settings.contextOptions.surroundingLines=this.contextOptions.surroundingLines,await this.plugin.saveSettings()}};var xa=require("obsidian");W();var An=class{constructor(e,t){this.stateManager=e,this.onPreviewClick=t}setupDragHandlers(e){e.addEventListener("dragenter",t=>{t.preventDefault(),e.addClass("drag-over")}),e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),e.addClass("drag-over");let A=e.getBoundingClientRect(),i=e.scrollTop,n=A.height;e.addClass("highlight-chat-history-drag-guide"),e.style.setProperty("--drag-guide-top",`${i+12}px`),e.style.setProperty("--drag-guide-height",`${n-24}px`);let l=document.querySelector(".highlight-dragging");l&&(l.addClass("highlight-chat-preview"),l.style.left=`${t.clientX+10}px`,l.style.top=`${t.clientY+10}px`)}),e.addEventListener("dragleave",t=>{e.contains(t.relatedTarget)||e.removeClass("drag-over")}),e.addEventListener("drop",async t=>{var i;t.preventDefault(),e.removeClass("drag-over");let A=(i=t.dataTransfer)==null?void 0:i.getData("application/highlight");if(A)try{let n=JSON.parse(A);if(!n.text)return;this.stateManager.getDraggedContents().some(c=>c.text===n.text)||(this.stateManager.addDraggedContent(n),this.showDraggedPreviewsInChat(e))}catch(n){console.error("Error parsing highlight data:",n)}})}showDraggedPreviewsInChat(e){let t=this.stateManager.getCurrentPreviewContainer();if(!t){let d=e.createEl("div",{cls:"highlight-chat-message highlight-chat-message-preview"}).createEl("div",{cls:"highlight-chat-previews"}),g=d.createEl("div",{cls:"highlight-chat-preview-header"}),p=g.createEl("div",{cls:"highlight-chat-preview-header-left"});p.createEl("span",{cls:"highlight-chat-preview-count",text:String(this.stateManager.getDraggedContents().length)}),p.createSpan({text:m("highlighted notes")});let y=g.createEl("div",{cls:"highlight-chat-preview-header-right"}).createEl("div",{cls:"highlight-chat-preview-btn",attr:{title:"Preview"}});(0,xa.setIcon)(y,"eye"),y.addEventListener("click",()=>{this.onPreviewClick()});let F=d.createEl("div",{cls:"highlight-chat-preview-cards"});t=F,this.stateManager.setCurrentPreviewContainer(F)}let A=this.stateManager.getDraggedContents(),i=t.createEl("div",{cls:"highlight-chat-preview-card"}),n=A[A.length-1];i.createEl("div",{cls:"highlight-chat-preview-content",text:n.text});let l=i.createEl("div",{cls:"highlight-chat-preview-delete"});(0,xa.setIcon)(l,"x"),l.addEventListener("click",()=>{if(this.stateManager.removeDraggedContent(n),i.remove(),this.stateManager.getDraggedContents().length===0){let c=t==null?void 0:t.closest(".highlight-chat-message-preview");c&&(c.remove(),this.stateManager.setCurrentPreviewContainer(null))}else this.updatePreviewCount()}),this.updatePreviewCount(),e.scrollTop=e.scrollHeight}updatePreviewCount(){let e=this.stateManager.getCurrentPreviewContainer();if(e){let t=e.closest(".highlight-chat-message-preview"),A=t==null?void 0:t.querySelector(".highlight-chat-preview-count");A&&(A.textContent=String(this.stateManager.getDraggedContents().length),this.stateManager.getDraggedContents().length===0&&t&&(t.remove(),this.stateManager.setCurrentPreviewContainer(null)))}}rebuildPreviewCards(e){let t=this.stateManager.getDraggedContents();t.length>0&&t.forEach(()=>{this.showDraggedPreviewsInChat(e)})}};var bt=require("obsidian"),rn=class{constructor(e,t,A,i,n){this.app=e,this.plugin=t,this.contextService=A,this.stateManager=i,this.messageHandler=n}async showContextPreviewWithSettings(){if(this.stateManager.getDraggedContents().length===0){new bt.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}let e=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-modal"}),t=e.createEl("div",{cls:"highlight-chat-context-overlay"}),A=e.createEl("div",{cls:"highlight-chat-context-content"}),i=A.createEl("div",{cls:"highlight-chat-context-header"});i.createEl("h3",{text:"Context Preview & Settings"});let n=i.createEl("div",{cls:"highlight-chat-context-close"});(0,bt.setIcon)(n,"x");let l=A.createEl("div",{cls:"highlight-chat-context-body"}),c,d=()=>{clearTimeout(c),c=setTimeout(()=>{Ae()},300)},g=l.createEl("div",{cls:"highlight-chat-context-settings-panel"});this.createSettingsPanel(g,d);let p=l.createEl("div",{cls:"highlight-chat-context-preview-panel"});p.createEl("div",{cls:"highlight-chat-context-preview-panel-header"}).createEl("h4",{text:"Preview Content (Auto-update)"});let y=p.createEl("div",{cls:"highlight-chat-context-preview-content"}),F=A.createEl("div",{cls:"highlight-chat-context-footer"}),Q=F.createEl("div",{cls:"highlight-chat-context-stats"}),U=F.createEl("div",{cls:"highlight-chat-context-buttons"}),b=U.createEl("button",{cls:"highlight-chat-context-cancel",text:"Cancel"}),k=U.createEl("button",{cls:"highlight-chat-context-confirm",text:"Apply"}),Ae=async()=>{try{y.empty(),y.createEl("div",{cls:"highlight-chat-context-loading",text:"Generating preview..."});let V=await this.generateContextPreview();y.empty(),await this.renderMarkdownContent(y,V.content),Q.textContent=`Characters: ${V.content.length} | Highlights: ${this.stateManager.getDraggedContents().length}`}catch(V){y.empty(),y.createEl("div",{cls:"highlight-chat-context-error",text:"Preview generation failed"})}},N=()=>{e.remove()};n.addEventListener("click",N),b.addEventListener("click",N),t.addEventListener("click",N),k.addEventListener("click",()=>{N(),new bt.Notice("Context settings applied")});let G=V=>{V.key==="Escape"&&(N(),document.removeEventListener("keydown",G))};document.addEventListener("keydown",G),await Ae()}createSettingsPanel(e,t){let A=this.messageHandler.getContextOptions(),i=e.createEl("div",{cls:"highlight-chat-settings-section"});i.createEl("h5",{text:"Context Strategy"});let n=i.createEl("select",{cls:"highlight-chat-settings-select"});[{value:"smart",label:"Smart Context - Auto-select best strategy"},{value:"paragraph",label:"Paragraph Context - Get complete paragraphs"},{value:"section",label:"Section Context - Get entire sections"},{value:"surrounding",label:"Surrounding Lines - Specify before/after lines"}].forEach(N=>{let G=n.createEl("option",{value:N.value,text:N.label});N.value===A.strategy&&(G.selected=!0)}),n.addEventListener("change",async()=>{A.strategy=n.value,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),this.updateSurroundingLinesVisibility(e),t()});let c=e.createEl("div",{cls:"highlight-chat-settings-section"});c.createEl("h5",{text:"Context Length"});let d=c.createEl("div",{cls:"highlight-chat-settings-slider-container"}),g=d.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"500",max:"5000",step:"500",value:String(A.maxLength||2e3)}}),p=d.createEl("span",{cls:"highlight-chat-settings-value",text:`${A.maxLength||2e3} chars`});g.addEventListener("input",async()=>{let N=parseInt(g.value);A.maxLength=N,p.textContent=`${N} chars`,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()});let C=e.createEl("div",{cls:"highlight-chat-settings-section highlight-chat-surrounding-section"});C.createEl("h5",{text:"Surrounding Lines"});let y=C.createEl("div",{cls:"highlight-chat-settings-slider-container"}),F=y.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"1",max:"10",step:"1",value:String(A.surroundingLines||3)}}),Q=y.createEl("span",{cls:"highlight-chat-settings-value",text:`${A.surroundingLines||3} lines`});F.addEventListener("input",async()=>{let N=parseInt(F.value);A.surroundingLines=N,Q.textContent=`${N} lines`,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()});let U=e.createEl("div",{cls:"highlight-chat-settings-section"});U.createEl("h5",{text:"Other Options"});let b=U.createEl("label",{cls:"highlight-chat-settings-checkbox"}),k=b.createEl("input",{type:"checkbox"});k.checked=A.includeTitle||!1,b.createSpan({text:" Include section titles"}),k.addEventListener("change",async()=>{A.includeTitle=k.checked,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()}),this.updateSurroundingLinesVisibility(e),e.createEl("button",{cls:"highlight-chat-settings-reset",text:"Reset to defaults"}).addEventListener("click",async()=>{let N={strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3};this.messageHandler.setContextOptions(N),n.value="smart",g.value="2000",p.textContent="2000 chars",F.value="3",Q.textContent="3 lines",k.checked=!0,await this.messageHandler.saveContextOptions(),this.updateSurroundingLinesVisibility(e),new bt.Notice("Reset to default settings"),t()})}updateSurroundingLinesVisibility(e){let t=e.querySelector(".highlight-chat-surrounding-section"),A=this.messageHandler.getContextOptions();t&&(A.strategy==="surrounding"?t.style.display="block":t.style.display="none")}async generateContextPreview(){let e=this.messageHandler.getContextOptions(),t=this.stateManager.getDraggedContents(),A=t.map(l=>this.contextService.getContextForHighlight(l,e));return{content:(await Promise.all(A)).map((l,c)=>{let d=t[c];if(!l)return`**Highlight ${c+1}:**
${d.text}`;let g=`**Highlight ${c+1}** (from: ${l.fileName}):
`;return l.sectionTitle&&(g+=`**Section:** ${l.sectionTitle}

`),l.beforeContext.trim()&&(g+=`**Before:**
${l.beforeContext.trim()}

`),g+=`**Highlight:**
${d.text}

`,l.afterContext.trim()&&(g+=`**After:**
${l.afterContext.trim()}`),g}).join(`

---

`)}}async renderMarkdownContent(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);try{await bt.MarkdownRenderer.render(this.app,t,e,"",new bt.Component),e.querySelectorAll("ul, ol").forEach(i=>{i.addClass("chat-markdown-list")})}catch(A){console.error("Error rendering markdown:",A),e.textContent=t}}};var dA=require("obsidian");W();var sn=class{constructor(e,t,A){this.plugin=e,this.chatService=t,this.stateManager=A}createModelMenuItem(e,t,A,i,n){e.addItem(l=>{l.setTitle(t.name).setChecked(n).onClick(async()=>{this.stateManager.setModelState({provider:A,model:t.id}),this.chatService.updateModel(A,t.id),i.textContent=this.getCurrentModelName()})})}addCustomModelIfExists(e,t,A,i,n){if(n&&i){e.addSeparator();let l=this.stateManager.getModelState();e.addItem(c=>{c.setTitle(i).setChecked(l.model===i).onClick(async()=>{this.stateManager.setModelState({provider:t,model:i}),this.chatService.updateModel(t,i),A.textContent=this.getCurrentModelName()})})}}handleApiError(e){new dA.Notice(m(`Unable to get ${e} model list, please check API Key and network connection.`))}getCurrentModelName(){var i,n,l,c,d,g,p,C,y,F,Q,U;let e=this.plugin.settings.ai,t=this.stateManager.getModelState();switch(t.provider||e.provider){case"openai":return t.model||((i=e.openai)==null?void 0:i.model)||"GPT-4";case"anthropic":return t.model||((n=e.anthropic)==null?void 0:n.model)||"Claude-3";case"ollama":return t.model||((l=e.ollama)==null?void 0:l.model)||"Ollama";case"gemini":return t.model||((c=e.gemini)==null?void 0:c.model)||"Gemini Pro";case"deepseek":return t.model||((d=e.deepseek)==null?void 0:d.model)||"Deepseek Chat";case"siliconflow":return(g=e.siliconflow)!=null&&g.isCustomModel&&((p=e.siliconflow)!=null&&p.model)?e.siliconflow.model:t.model?t.model:((C=e.siliconflow)==null?void 0:C.model)||"SiliconFlow";case"custom":return(y=e.custom)!=null&&y.name&&((F=e.custom)!=null&&F.model)?`${e.custom.name} (${e.custom.model})`:t.model||((Q=e.custom)==null?void 0:Q.model)||((U=e.custom)==null?void 0:U.name)||"Custom AI";default:return"Unknown model"}}async showModelSelector(e,t){let A=new dA.Menu;switch(this.plugin.settings.ai.provider){case"siliconflow":await this.buildSiliconFlowMenu(A,e);break;case"openai":await this.buildOpenAIMenu(A,e);break;case"anthropic":this.buildAnthropicMenu(A,e);break;case"ollama":await this.buildOllamaMenu(A,e);break;case"gemini":await this.buildGeminiMenu(A,e);break;case"deepseek":await this.buildDeepseekMenu(A,e);break;case"custom":this.buildCustomMenu(A,e);break;default:new dA.Notice(m("Unknown AI provider"));break}let n=e.getBoundingClientRect();A.showAtPosition({x:n.left,y:n.bottom})}async buildSiliconFlowMenu(e,t){var A,i;try{let n=this.plugin.settings.ai,l=_t,c=this.stateManager.getModelState();if(l.forEach(d=>{e.addItem(g=>{var C,y;let p=!((C=n.siliconflow)!=null&&C.isCustomModel)&&(c.model===d.id||((y=n.siliconflow)==null?void 0:y.model)===d.id);g.setTitle(d.name).setChecked(p).onClick(async()=>{n.siliconflow?(n.siliconflow.model=d.id,n.siliconflow.isCustomModel=!1):n.siliconflow={model:d.id,isCustomModel:!1},this.stateManager.setModelState({provider:"siliconflow",model:d.id}),this.chatService.updateModel("siliconflow",d.id),await this.plugin.saveSettings(),t.textContent=d.name})})}),(A=n.siliconflow)!=null&&A.isCustomModel&&((i=n.siliconflow)!=null&&i.model)){e.addSeparator();let d=n.siliconflow.model;e.addItem(g=>{var C,y;let p=((C=n.siliconflow)==null?void 0:C.isCustomModel)&&(c.model===d||((y=n.siliconflow)==null?void 0:y.model)===d);g.setTitle(d).setChecked(p).onClick(async()=>{n.siliconflow?(n.siliconflow.model=d,n.siliconflow.isCustomModel=!0):n.siliconflow={model:d,isCustomModel:!0},this.stateManager.setModelState({provider:"siliconflow",model:d}),this.chatService.updateModel("siliconflow",d),await this.plugin.saveSettings(),t.textContent=d})})}}catch(n){new dA.Notice(m("Unable to get SiliconFlow model list, please check API Key and network connection."))}}async buildOpenAIMenu(e,t){try{let A=await this.chatService.aiService.listModels("openai"),i=this.stateManager.getModelState(),n=A.filter(c=>!c.isCustom),l=A.filter(c=>c.isCustom);n.forEach(c=>{this.createModelMenuItem(e,c,"openai",t,i.model===c.id)}),l.length>0&&(e.addSeparator(),l.forEach(c=>{this.createModelMenuItem(e,c,"openai",t,i.model===c.id)}))}catch(A){this.handleApiError("OpenAI")}}buildAnthropicMenu(e,t){let A=this.plugin.settings.ai;["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"].forEach(n=>{e.addItem(l=>{var c;l.setTitle(n).setChecked(((c=A.anthropic)==null?void 0:c.model)===n).onClick(async()=>{A.anthropic||(A.anthropic={apiKey:"",model:n}),A.anthropic.model=n,await this.plugin.saveSettings(),t.textContent=this.getCurrentModelName()})})})}async buildOllamaMenu(e,t){try{let A=this.plugin.settings.ai;(await this.chatService.aiService.listModels("ollama")).forEach(n=>{var l;this.createModelMenuItem(e,n,"ollama",t,((l=A.ollama)==null?void 0:l.model)===n.id)})}catch(A){new dA.Notice(m("Unable to access the Ollama model, please check the service."))}}async buildGeminiMenu(e,t){var A,i;try{let n=this.plugin.settings.ai;(await this.chatService.aiService.listModels("gemini")).forEach(c=>{var d;this.createModelMenuItem(e,c,"gemini",t,((d=n.gemini)==null?void 0:d.model)===c.id)}),this.addCustomModelIfExists(e,"gemini",t,(A=n.gemini)==null?void 0:A.model,(i=n.gemini)==null?void 0:i.isCustomModel)}catch(n){this.handleApiError("Gemini")}}async buildDeepseekMenu(e,t){var A,i;try{let n=this.plugin.settings.ai;(await this.chatService.aiService.listModels("deepseek")).forEach(c=>{var d;this.createModelMenuItem(e,c,"deepseek",t,((d=n.deepseek)==null?void 0:d.model)===c.id)}),this.addCustomModelIfExists(e,"deepseek",t,(A=n.deepseek)==null?void 0:A.model,(i=n.deepseek)==null?void 0:i.isCustomModel)}catch(n){this.handleApiError("Deepseek")}}buildCustomMenu(e,t){let A=this.plugin.settings.ai,i=this.stateManager.getModelState();if(!A.custom){new dA.Notice(m("Custom AI service not configured"));return}let n=A.custom.name||"Custom AI",l=A.custom.model||"No model configured";e.addItem(c=>{c.setTitle(`${n}: ${l}`).setChecked(!0).onClick(async()=>{t.textContent=this.getCurrentModelName()})}),A.custom.isCustomModel&&A.custom.lastCustomModel&&(e.addSeparator(),e.addItem(c=>{var d;c.setTitle(`Last: ${(d=A.custom)==null?void 0:d.lastCustomModel}`).onClick(async()=>{A.custom&&A.custom.lastCustomModel&&(A.custom.model=A.custom.lastCustomModel,await this.plugin.saveSettings(),t.textContent=this.getCurrentModelName())})})),e.addSeparator(),e.addItem(c=>{c.setTitle(m("Configure in settings")).setDisabled(!0)})}};var xt=class xt extends wc.Component{constructor(t,A){super();this.textarea=null;if(xt.instance)return xt.instance;this.app=t,this.plugin=A,this.chatService=new Zs(this.plugin),this.contextService=new js(t),this.stateManager=new rr,this.uiBuilder=new en(t,A,this.stateManager),this.messageHandler=new tn(t,A,this.chatService,this.contextService,this.stateManager),this.dragHandler=new An(this.stateManager,()=>this.contextHandler.showContextPreviewWithSettings()),this.contextHandler=new rn(t,A,this.contextService,this.stateManager,this.messageHandler),this.modelSelector=new sn(A,this.chatService,this.stateManager),this.containerEl=this.uiBuilder.buildChatWindow(()=>this.clearChat(),()=>this.close(),(l,c)=>this.modelSelector.showModelSelector(l,c),()=>this.modelSelector.getCurrentModelName());let i=this.containerEl.querySelector(".highlight-chat-input-container");i&&(this.textarea=this.uiBuilder.setupChatInput(i,l=>this.handleSendMessage(l)));let n=this.uiBuilder.getChatHistoryContainer();n&&this.dragHandler.setupDragHandlers(n),this.restoreSavedState(),xt.instance=this}show(){document.body.contains(this.containerEl)?this.containerEl.removeClass("highlight-chat-hidden"):(this.containerEl.addClass("highlight-chat-window"),this.containerEl.addClass("highlight-chat-window-position"),document.body.appendChild(this.containerEl)),document.querySelectorAll(".highlight-floating-button").forEach(t=>{t.style.display="none"}),requestAnimationFrame(()=>{var t;(t=this.textarea)==null||t.focus()})}close(){this.containerEl.addClass("highlight-chat-hidden"),document.querySelectorAll(".highlight-floating-button").forEach(t=>{t.style.display=""})}clearChat(){let t=this.uiBuilder.getChatHistoryContainer();t&&this.textarea&&this.messageHandler.clearChat(t,this.textarea)}async handleSendMessage(t){let A=this.uiBuilder.getChatHistoryContainer();A&&await this.messageHandler.handleSendMessage(t,A,()=>this.stateManager.getCurrentPreviewContainer(),i=>this.stateManager.setCurrentPreviewContainer(i))}restoreSavedState(){let t=rr.getSavedState();if(!t)return;this.stateManager.restoreState(t);let A=this.uiBuilder.getChatHistoryContainer();if(A){for(;A.firstChild;)A.removeChild(A.firstChild);if(this.stateManager.getChatHistory().forEach(i=>{this.messageHandler.addMessage(A,i.content,i.role,!1)}),this.stateManager.getDraggedContents().length>0&&this.dragHandler.rebuildPreviewCards(A),t.currentPreviewContainer){let i=A.querySelector(".highlight-chat-preview-cards");this.stateManager.setCurrentPreviewContainer(i)}}}static getInstance(t,A){return xt.instance||(xt.instance=new xt(t,A)),xt.instance}saveState(){this.stateManager.saveState()}};xt.instance=null;var SA=xt;var nn=class{constructor(e){this.app=e}async openCommentPanelInSidebar(){let{workspace:e}=this.app,t=e.getLeavesOfType(ft);if(t.length){let i=t[0],n=i.view;if(n&&n instanceof lt&&n.isDraggedToMainView){e.detachLeavesOfType(ft);let l=e.getRightLeaf(!1);if(l){await l.setViewState({type:ft,active:!0});let c=l.view;c&&c instanceof lt&&(c.isDraggedToMainView=!1,c.updateViewLayout(),c.updateHighlights())}}else e.revealLeaf(i);return}let A=e.getRightLeaf(!1);if(A){await A.setViewState({type:ft,active:!0});let i=A.view;i&&i instanceof lt&&(i.isDraggedToMainView=!1,i.updateViewLayout())}}async openCommentPanelInMainWindow(){let{workspace:e}=this.app,t=e.getLeavesOfType(ft);if(t.length){let i=t[0];e.setActiveLeaf(i,{focus:!0}),e.detachLeavesOfType(ft);let n=e.getLeaf("tab");await n.setViewState({type:ft,active:!0});let l=n.view;l&&l instanceof lt&&this.updateViewToMainMode(l);return}let A=e.getLeaf("tab");A&&(await A.setViewState({type:ft,active:!0}),setTimeout(()=>{let i=A.view;i&&i instanceof lt&&this.updateViewToMainMode(i)},100))}updateViewToMainMode(e){e.isDraggedToMainView=!0,e.fileListManager&&e.fileListManager.invalidateCache(),e.updateViewLayout(),e.updateHighlights()}};W();async function qp(B,e,t){await t(),await e.openCommentPanelInSidebar()}function vc(B,e,t){B.addCommand({id:"open-comment-window",name:m("Open in right sidebar"),callback:()=>qp(B,e,t)})}W();async function zp(B,e,t){await t(),await e.openCommentPanelInMainWindow()}function yc(B,e,t){B.addCommand({id:"open-comment-main-window",name:m("Open in main window"),callback:()=>zp(B,e,t)})}W();async function Zp(B,e){await e(),SA.getInstance(B.app,B).show()}function Fc(B,e){B.addCommand({id:"open-chat-window",name:m("Open AI chat window"),callback:()=>Zp(B,e)})}function Ec(B,e,t){vc(B,e,t),yc(B,e,t),Fc(B,t)}function Ic(B){return new nn(B.app)}var UA=require("@codemirror/view"),Ta=require("obsidian");var Hc=require("@codemirror/view"),ri=require("obsidian"),Xt=class Xt extends Hc.WidgetType{constructor(t,A,i){super();this.plugin=t;this.highlight=A;this.onClick=i;this.resizeListener=null;this.app=this.plugin.app,this.comments=this.highlight.comments||[]}eq(t){var c,d,g,p;if(!(t instanceof Xt))return!1;let A=typeof this.highlight.position=="number"&&typeof t.highlight.position=="number"&&Math.abs(this.highlight.position-t.highlight.position)<Xt.POSITION_MATCH_THRESHOLD,i=this.highlight.text===t.highlight.text,n=((d=(c=this.highlight.comments)==null?void 0:c.length)!=null?d:0)===((p=(g=t.highlight.comments)==null?void 0:g.length)!=null?p:0);return(i||A)&&n}get estimatedHeight(){return 0}get lineBreaks(){return 0}toDOM(){let t=document.createElement("span");return t.addClass("hi-note-widget"),this.highlight.id&&t.setAttribute("data-highlight-id",this.highlight.id),this.createButton(t),t}createButton(t){let A=this.comments.length>0,i=t.createEl("button",{cls:`hi-note-button clickable-icon ${A?"":"hi-note-button-hidden"}`}),n=this.createIconContainer(i),l=this.createTooltip(t);this.setupEventListeners(t,i,l)}createIconContainer(t){let A=t.createEl("span",{cls:"hi-note-icon-container"});return(0,ri.setIcon)(A,"message-circle"),this.comments.length>0&&A.createEl("span",{cls:"hi-note-count",text:this.comments.length.toString()}),A}createTooltip(t){let A=document.createElement("div");A.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),this.highlight.id&&A.setAttribute("data-highlight-id",this.highlight.id);let i=A.createEl("div",{cls:"hi-note-tooltip-list"});return this.renderTooltipContent(i,A),document.body.appendChild(A),{tooltip:A,updateTooltipPosition:()=>{let l=t.getBoundingClientRect();A.style.position="fixed",A.style.top=`${l.bottom+4}px`,A.style.left=`${l.right-A.offsetWidth}px`}}}renderTooltipContent(t,A){this.comments.length!==0&&(this.comments.slice(0,Xt.MAX_TOOLTIP_COMMENTS).forEach(i=>{let n=t.createEl("div",{cls:"hi-note-tooltip-item"}),l=n.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(l,i.content),n.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(i.createdAt).toLocaleString()})}),this.comments.length>Xt.MAX_TOOLTIP_COMMENTS&&A.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${this.comments.length-Xt.MAX_TOOLTIP_COMMENTS} \u6761\u8BC4\u8BBA...`}))}setupEventListeners(t,A,i){let{tooltip:n,updateTooltipPosition:l}=i;this.comments.length>0?(A.removeClass("hi-note-button-hidden"),A.addEventListener("mouseenter",()=>{n.removeClass("hi-note-tooltip-hidden"),l()}),A.addEventListener("mouseleave",()=>{n.addClass("hi-note-tooltip-hidden")})):(A.addClass("hi-note-button-hidden"),t.addEventListener("mouseenter",()=>{A.removeClass("hi-note-button-hidden")}),t.addEventListener("mouseleave",()=>{A.addClass("hi-note-button-hidden")})),A.addEventListener("click",async c=>{c.preventDefault(),c.stopPropagation(),n.addClass("hi-note-tooltip-hidden"),await this.onClick()}),this.resizeListener=l,window.addEventListener("resize",this.resizeListener)}async renderMarkdownContent(t,A){try{await ri.MarkdownRenderer.render(this.app,A,t,"",new ri.Component),t.querySelectorAll("ul, ol").forEach(n=>{n.addClass("tooltip-markdown-list")})}catch(i){console.error("Error rendering markdown in tooltip:",i),t.textContent=A}}destroy(t){if(this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null),this.highlight.id){let A=document.querySelector(`.hi-note-tooltip[data-highlight-id="${this.highlight.id}"]`);A&&A.remove()}t.remove()}updateDOM(t){return!1}ignoreEvent(){return!0}};Xt.POSITION_MATCH_THRESHOLD=30,Xt.MAX_TOOLTIP_COMMENTS=3;var an=Xt;var si=class{static findMatch(e,t){if(!t||t.length===0)return null;let A=this.exactMatch(e,t);return A||(A=this.positionMatch(e,t),A)?A:null}static exactMatch(e,t){return t.find(A=>A.text===e.text&&(typeof A.position!="number"||typeof e.position!="number"||Math.abs(A.position-e.position)<10))||null}static positionMatch(e,t){return typeof e.position!="number"?null:t.find(A=>typeof A.position=="number"&&Math.abs(A.position-e.position)<30)||null}static findExactMatch(e,t){return t.find(A=>A.text===e.text&&(typeof A.position!="number"||typeof e.position!="number"||Math.abs(A.position-e.position)<10))||null}};var Sc=require("obsidian");var on=require("obsidian"),Qc=require("obsidian"),wt=class{static createButton(e,t){let A=e.createEl("button",{cls:`hi-note-button clickable-icon ${t?"":"hi-note-button-hidden"}`}),i=A.createEl("span",{cls:"hi-note-icon-container"});return(0,Qc.setIcon)(i,"message-circle"),A}static addCommentCount(e,t){t>0&&e.createEl("span",{cls:"hi-note-count",text:t.toString()})}static createTooltip(e,t){let A=document.createElement("div");A.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),t.id&&A.setAttribute("data-highlight-id",t.id);let i=A.createEl("div",{cls:"hi-note-tooltip-list"});return this.renderTooltipContent(e,i,A,t.comments||[]),document.body.appendChild(A),A}static renderTooltipContent(e,t,A,i){i.length!==0&&(i.slice(0,this.MAX_TOOLTIP_COMMENTS).forEach(n=>{let l=t.createEl("div",{cls:"hi-note-tooltip-item"}),c=l.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(e,c,n.content),l.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(n.createdAt).toLocaleString()})}),i.length>this.MAX_TOOLTIP_COMMENTS&&A.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${i.length-this.MAX_TOOLTIP_COMMENTS} \u6761\u8BC4\u8BBA...`}))}static renderMarkdownContent(e,t,A){on.MarkdownRenderer.render(e,A,t,"",new on.Component).catch(i=>{console.error("Error rendering markdown in tooltip:",i),t.textContent=A})}static updateTooltipPosition(e,t){let A=e.getBoundingClientRect();t.style.top=`${A.bottom+4}px`,t.style.left=`${A.right-t.offsetWidth}px`}static setupTooltipEvents(e,t,A){e.addEventListener("mouseenter",()=>{A.removeClass("hi-note-tooltip-hidden"),this.updateTooltipPosition(t,A)}),e.addEventListener("mouseleave",()=>{A.addClass("hi-note-tooltip-hidden")})}static async openCommentPanel(e,t){let A=e.workspace,i=A.getLeavesOfType("hinote-view");if(i.length)A.revealLeaf(i[0]),await new Promise(l=>setTimeout(l,50));else{let l=A.getRightLeaf(!1);l&&(await l.setViewState({type:"hinote-view",active:!0}),await new Promise(c=>setTimeout(c,200)))}let n=new CustomEvent("open-comment-input",{detail:{highlightId:t.id,text:t.text}});window.dispatchEvent(n)}static setupClickEvent(e,t,A){e.addEventListener("click",async i=>{i.preventDefault(),i.stopPropagation(),t.addClass("hi-note-tooltip-hidden"),await A()})}static createCleanupObserver(e,t){let A=new MutationObserver(i=>{i.forEach(n=>{n.removedNodes.forEach(l=>{l===e&&(t.remove(),A.disconnect())})})});return e.parentElement&&A.observe(e.parentElement,{childList:!0}),A}};wt.MAX_TOOLTIP_COMMENTS=3;var ln=class{constructor(e,t,A){this.plugin=e;this.highlightRepository=t;this.highlightService=A}async processPreview(e,t){let A=this.plugin.app.vault.getAbstractFileByPath(t.sourcePath);if(!(A instanceof Sc.TFile)||!this.highlightService.shouldProcessFile(A))return;let i=e.querySelectorAll("mark, span.highlight");if(i.length===0)return;let n=await this.plugin.app.vault.cachedRead(A),l=this.highlightService.extractHighlights(n,A);if(l.length===0)return;let c=this.enrichHighlightsWithComments(l,A,n);c.length!==0&&i.forEach(d=>{if(d.hasAttribute("data-hi-note-processed"))return;let g=d.textContent;if(!g)return;let p=this.findMatchingHighlight(g,d,e,t,c);p&&(d.setAttribute("data-hi-note-processed","true"),this.renderPreviewWidget(d,p))})}enrichHighlightsWithComments(e,t,A){return e.map(i=>{let n={...i,id:i.id||`highlight-${Date.now()}-${i.position}`,comments:i.comments||[],position:i.position,paragraphOffset:i.paragraphOffset||0,blockId:i.blockId,paragraphId:i.paragraphId||`p-${i.paragraphOffset||0}`,createdAt:i.createdAt||Date.now(),updatedAt:i.updatedAt||Date.now(),text:i.text},l=null,c=[];if(n.blockId){let d=this.highlightRepository.findHighlightsByBlockId(t,n.blockId);if(d&&d.length>0){let g=si.findMatch(n,d);g&&(l=g,c=g.comments||[])}}else{let g=(this.highlightRepository.getCachedHighlights(t.path)||[]).filter(p=>p.text===n.text?typeof p.position=="number"&&typeof n.position=="number"?Math.abs(p.position-n.position)<1e3:!0:typeof p.position=="number"&&typeof n.position=="number"?Math.abs(p.position-n.position)<30:!1);g&&g.length>0&&(l=g[0],c=(l==null?void 0:l.comments)||[])}return{...n,id:(l==null?void 0:l.id)||n.id,comments:c}}).filter(i=>i.comments&&i.comments.length>0).map(i=>{let n=A.substring(0,i.position).split(`
`).length-1;return{...i,line:n}})}findMatchingHighlight(e,t,A,i,n){let l=t.parentElement;for(;l&&!this.isBlockElement(l)&&l!==A;)l=l.parentElement;let c=null;if(l&&(c=i.getSectionInfo(l)),c){let d=c;return n.find(g=>g.text===e&&g.line>=d.lineStart&&g.line<=d.lineEnd)||null}else return n.find(d=>d.text===e)||null}isBlockElement(e){let t=e.tagName.toLowerCase();return["p","h1","h2","h3","h4","h5","h6","li","div","blockquote","pre","td","th"].includes(t)}renderPreviewWidget(e,t){let A=e.createSpan({cls:"hi-note-widget hi-note-preview-widget"}),i=!!(t.comments&&t.comments.length>0),n=wt.createButton(A,i),l=n.querySelector(".hi-note-icon-container");if(i&&t.comments){wt.addCommentCount(l,t.comments.length);let c=wt.createTooltip(this.plugin.app,t);wt.setupTooltipEvents(n,A,c),wt.setupClickEvent(n,c,()=>wt.openCommentPanel(this.plugin.app,t)),wt.createCleanupObserver(A,c)}}};var cn=class{constructor(e,t){this.plugin=e,this.highlightRepository=t,this.highlightService=e.highlightService,this.previewRenderer=new ln(this.plugin,this.highlightRepository,this.highlightService)}refreshDecorations(){let e=this.getActiveMarkdownView();if(!(e!=null&&e.editor))return;let t=e.editor.cm;t&&t.dispatch({changes:[],effects:[]})}getActiveMarkdownView(){return this.plugin.app.workspace.getActiveViewOfType(Ta.MarkdownView)}enable(){let e=this.plugin,t=this.highlightRepository,A=this.highlightService;this.plugin.registerMarkdownPostProcessor((n,l)=>{this.previewRenderer.processPreview(n,l)}),this.plugin.registerEvent(this.plugin.eventManager.on("comment:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("comment:delete",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:delete",()=>{this.refreshDecorations()}));let i=UA.ViewPlugin.fromClass(class{constructor(n){this.plugin=e,this.highlightRepository=t,this.highlightService=A,this.decorations=this.buildDecorations(n)}createHiNoteFromHighlight(n){return{...n,id:n.id||`highlight-${Date.now()}-${n.position}`,comments:n.comments||[],position:n.position,paragraphOffset:n.paragraphOffset||0,blockId:n.blockId,paragraphId:n.paragraphId||`p-${n.paragraphOffset||0}`,createdAt:n.createdAt||Date.now(),updatedAt:n.updatedAt||Date.now(),text:n.text}}handleTextChanges(n,l,c){l.text!==c.text&&e.eventManager&&e.eventManager.emitHighlightUpdate(n.path,l.text,c.text)}getCommentsForHighlight(n,l,c=!0){let d=[];if(l.blockId){let g=this.highlightRepository.findHighlightsByBlockId(n,l.blockId);if(g&&g.length>0){let p=si.findMatch(l,g);p&&(d=p.comments||[],c&&p.text!==l.text&&this.handleTextChanges(n,p,l))}}else{let g=this.highlightRepository.getCachedHighlights(n.path);if(!g||g.length===0)return d;let p=g.filter(C=>!C||!C.text?!1:C.text===l.text?typeof C.position=="number"&&typeof l.position=="number"?Math.abs(C.position-l.position)<1e3:!0:typeof C.position=="number"&&typeof l.position=="number"?Math.abs(C.position-l.position)<30:!1);if(p&&p.length>0){let C=p[0];d=C.comments||[],c&&C.text!==l.text&&this.handleTextChanges(n,C,l)}}return d}update(n){(n.docChanged||n.viewportChanged||n.transactions.length>0)&&(this.decorations=this.buildDecorations(n.view))}buildDecorations(n){var C;let l=[],d=n.state.doc.toString(),g=this.plugin.app.workspace.getActiveViewOfType(Ta.MarkdownView);if(!g||!g.file)return UA.Decoration.none;if(!this.highlightService.shouldProcessFile(g.file))return UA.Decoration.none;let p=this.highlightService.extractHighlights(d,g.file);for(let y of p){if(y.position===void 0)continue;let F=this.createHiNoteFromHighlight(y);if(g.file){let U=this.getCommentsForHighlight(g.file,F,!0);F.comments=U}let Q=y.position+((C=y.originalLength)!=null?C:y.text.length+4);if(this.plugin.settings.showCommentWidget!==!1){let U=this.createCommentWidget(F,[F]);l.push(U.range(Q))}}return UA.Decoration.set(l.sort((y,F)=>y.from-F.from))}createCommentWidget(n,l){return UA.Decoration.widget({widget:new an(this.plugin,n,()=>this.openCommentPanel(n)),side:2,stopEvent:c=>c.type==="mousedown"||c.type==="mouseup"})}async openCommentPanel(n){let l=this.plugin.app.workspace,c=l.getLeavesOfType("hinote-view");if(c.length)l.revealLeaf(c[0]),await new Promise(g=>setTimeout(g,50));else{let g=l.getRightLeaf(!1);g&&(await g.setViewState({type:"hinote-view",active:!0}),await new Promise(p=>setTimeout(p,200)))}let d=new CustomEvent("open-comment-input",{detail:{highlightId:n.id,text:n.text}});window.dispatchEvent(d)}},{decorations:n=>n.decorations});this.highlightPlugin=i,this.plugin.registerEditorExtension([i])}disable(){if(this.highlightPlugin){let e=this.getActiveMarkdownView();e!=null&&e.editor&&e.editor.refresh()}document.querySelectorAll(".hi-note-widget").forEach(e=>e.remove())}};var q=(B=>(B[B.New=0]="New",B[B.Learning=1]="Learning",B[B.Review=2]="Review",B[B.Relearning=3]="Relearning",B))(q||{}),x=(B=>(B[B.Manual=0]="Manual",B[B.Again=1]="Again",B[B.Hard=2]="Hard",B[B.Good=3]="Good",B[B.Easy=4]="Easy",B))(x||{}),Y=class B{static card(e){return{...e,state:B.state(e.state),due:B.time(e.due),last_review:e.last_review?B.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),A=e.slice(1).toLowerCase(),i=x[`${t}${A}`];if(i===void 0)throw new Error(`Invalid rating:[${e}]`);return i}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),A=e.slice(1).toLowerCase(),i=q[`${t}${A}`];if(i===void 0)throw new Error(`Invalid state:[${e}]`);return i}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){let t=Date.parse(e);if(isNaN(t))throw new Error(`Invalid date:[${e}]`);return new Date(t)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:B.time(e.due),rating:B.rating(e.rating),state:B.state(e.state),review:B.time(e.review)}}};Date.prototype.scheduler=function(B,e){return vt(this,B,e)},Date.prototype.diff=function(B,e){return ni(this,B,e)},Date.prototype.format=function(){return jp(this)},Date.prototype.dueFormat=function(B,e,t){return em(this,B,e,t)};function vt(B,e,t){return new Date(t?Y.time(B).getTime()+e*24*60*60*1e3:Y.time(B).getTime()+e*60*1e3)}function ni(B,e,t){if(!B||!e)throw new Error("Invalid date");let A=Y.time(B).getTime()-Y.time(e).getTime(),i=0;switch(t){case"days":i=Math.floor(A/(24*60*60*1e3));break;case"minutes":i=Math.floor(A/(60*1e3));break}return i}function jp(B){let e=Y.time(B),t=e.getFullYear(),A=e.getMonth()+1,i=e.getDate(),n=e.getHours(),l=e.getMinutes(),c=e.getSeconds();return`${t}-${sr(A)}-${sr(i)} ${sr(n)}:${sr(l)}:${sr(c)}`}function sr(B){return B<10?`0${B}`:`${B}`}var La=[60,60,24,31,12],Pa=["second","min","hour","day","month","year"];function em(B,e,t,A=Pa){B=Y.time(B),e=Y.time(e),A.length!==Pa.length&&(A=Pa);let i=B.getTime()-e.getTime(),n;for(i/=1e3,n=0;n<La.length&&!(i<La[n]);n++)i/=La[n];return`${Math.floor(i)}${t?A[n]:""}`}var tm=Object.freeze([x.Again,x.Hard,x.Good,x.Easy]),Am=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function im(B,e,t){let A=1;for(let l of Am)A+=l.factor*Math.max(Math.min(B,l.end)-l.start,0);B=Math.min(B,t);let i=Math.max(2,Math.round(B-A)),n=Math.min(Math.round(B+A),t);return B>e&&(i=Math.max(i,e+1)),i=Math.min(i,n),{min_ivl:i,max_ivl:n}}function $e(B,e,t){return Math.min(Math.max(B,e),t)}function rm(B,e){let t=Date.UTC(B.getUTCFullYear(),B.getUTCMonth(),B.getUTCDate()),A=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((A-t)/864e5)}var sm="5.2.0",nm=.9,am=36500,om=!1,lm=!0,cm=Object.freeze(["1m","10m"]),hm=Object.freeze(["10m"]),gE=`v${sm} using FSRS-6.0`,yt=.001;var hn=100,Uc=.5,dm=.1542,Mc=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,dm]),gm=2,um=B=>[[yt,hn],[yt,hn],[yt,hn],[yt,hn],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,B],[0,B],[0,.8],[.1,.8]],Na=(B,e)=>{let t=gm;if(Math.max(0,e)>1){let A=-(Math.log(B[11])+Math.log(Math.pow(2,B[13])-1)+B[14]*.3)/e;t=$e(+A.toFixed(8),.01,2)}return um(t).map(([A,i],n)=>$e(B[n],A,i))};var Ga=B=>{if(B===void 0)return[...Mc];switch(B.length){case 21:return[...B];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...B,0,Uc];case 17:{let e=[...B];return e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),e.concat([0,0,0,Uc])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Mc]}},dn=B=>{var i,n;let e=Array.isArray(B==null?void 0:B.learning_steps)?B.learning_steps:cm,t=Array.isArray(B==null?void 0:B.relearning_steps)?B.relearning_steps:hm,A=Na(Ga(B==null?void 0:B.w),t.length);return{request_retention:(B==null?void 0:B.request_retention)||nm,maximum_interval:(B==null?void 0:B.maximum_interval)||am,w:A,enable_fuzz:(i=B==null?void 0:B.enable_fuzz)!=null?i:om,enable_short_term:(n=B==null?void 0:B.enable_short_term)!=null?n:lm,learning_steps:e,relearning_steps:t}};function ai(B,e){let t={due:B?Y.time(B):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:q.New,last_review:void 0};return e&&typeof e=="function"?e(t):t}var Da=class{constructor(e){Ee(this,"c");Ee(this,"s0");Ee(this,"s1");Ee(this,"s2");let t=pm();this.c=1,this.s0=t(" "),this.s1=t(" "),this.s2=t(" "),e==null&&(e=+new Date),this.s0-=t(e),this.s0<0&&(this.s0+=1),this.s1-=t(e),this.s1<0&&(this.s1+=1),this.s2-=t(e),this.s2<0&&(this.s2+=1)}next(){let e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function pm(){let B=4022871197;return function(e){e=String(e);for(let t=0;t<e.length;t++){B+=e.charCodeAt(t);let A=.02519603282416938*B;B=A>>>0,A-=B,A*=B,B=A>>>0,A-=B,B+=A*4294967296}return(B>>>0)*23283064365386963e-26}}function mm(B){let e=new Da(B),t=()=>e.next();return t.int32=()=>e.next()*4294967296|0,t.double=()=>t()+(t()*2097152|0)*11102230246251565e-32,t.state=()=>e.state,t.importState=A=>(e.state=A,t),t}var bc=B=>{let e=typeof B=="number"?-B:-B[20],t=Math.exp(Math.pow(e,-1)*Math.log(.9))-1;return{decay:e,factor:+t.toFixed(8)}};function Ra(B,e,t){let{decay:A,factor:i}=bc(B);return+Math.pow(1+i*e/t,A).toFixed(8)}var Ka=class{constructor(e){Ee(this,"param");Ee(this,"intervalModifier");Ee(this,"_seed");Ee(this,"forgetting_curve");this.param=new Proxy(dn(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=Ra.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");let{decay:t,factor:A}=bc(this.param.w);return+((Math.pow(e,1/t)-1)/A).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){let e=this;return{set:function(t,A,i){return A==="request_retention"&&Number.isFinite(i)?e.intervalModifier=e.calculate_interval_modifier(Number(i)):A==="w"&&(i=Na(Ga(i),t.relearning_steps.length),e.forgetting_curve=Ra.bind(this,i),e.intervalModifier=e.calculate_interval_modifier(Number(t.request_retention))),Reflect.set(t,A,i),!0}}}update_parameters(e){let t=dn(e);for(let A in t)if(A in this.param){let i=A;this.param[i]=t[i]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return+(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(e,t){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);let A=mm(this._seed)(),{min_ivl:i,max_ivl:n}=im(e,t,this.param.maximum_interval);return Math.floor(A*(n-i+1)+i)}next_interval(e,t){let A=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(A,t)}linear_damping(e,t){return+(e*(10-t)/9).toFixed(8)}next_difficulty(e,t){let A=-this.param.w[6]*(t-3),i=e+this.linear_damping(A,e);return $e(this.mean_reversion(this.init_difficulty(x.Easy),i),1,10)}mean_reversion(e,t){return+(this.param.w[7]*e+(1-this.param.w[7])*t).toFixed(8)}next_recall_stability(e,t,A,i){let n=x.Hard===i?this.param.w[15]:1,l=x.Easy===i?this.param.w[16]:1;return+$e(t*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(t,-this.param.w[9])*(Math.exp((1-A)*this.param.w[10])-1)*n*l),yt,36500).toFixed(8)}next_forget_stability(e,t,A){return+$e(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(t+1,this.param.w[13])-1)*Math.exp((1-A)*this.param.w[14]),yt,36500).toFixed(8)}next_short_term_stability(e,t){let A=Math.pow(e,-this.param.w[19])*Math.exp(this.param.w[17]*(t-3+this.param.w[18])),i=t>=3?Math.max(A,1):A;return+$e(e*i,yt,36500).toFixed(8)}next_state(e,t,A){let{difficulty:i,stability:n}=e!=null?e:{difficulty:0,stability:0};if(t<0)throw new Error(`Invalid delta_t "${t}"`);if(A<0||A>4)throw new Error(`Invalid grade "${A}"`);if(i===0&&n===0)return{difficulty:$e(this.init_difficulty(A),1,10),stability:this.init_stability(A)};if(A===0)return{difficulty:i,stability:n};if(i<1||n<yt)throw new Error(`Invalid memory state { difficulty: ${i}, stability: ${n} }`);let l=this.forgetting_curve(t,n),c=this.next_recall_stability(i,n,l,A),d=this.next_forget_stability(i,n,l),g=this.next_short_term_stability(n,A),p=c;if(A===1){let[C,y]=[0,0];this.param.enable_short_term&&(C=this.param.w[17],y=this.param.w[18]);let F=n/Math.exp(C*y);p=$e(+F.toFixed(8),yt,d)}return t===0&&this.param.enable_short_term&&(p=g),{difficulty:this.next_difficulty(i,A),stability:p}}};function fm(){let B=this.review_time.getTime(),e=this.current.reps,t=this.current.difficulty*this.current.stability;return`${B}_${e}_${t}`}var Bm=B=>{let e=B.slice(-1),t=parseInt(B.slice(0,-1),10);if(isNaN(t)||!Number.isFinite(t)||t<0)throw new Error(`Invalid step value: ${B}`);switch(e){case"m":return t;case"h":return t*60;case"d":return t*1440;default:throw new Error(`Invalid step unit: ${B}, expected m/h/d`)}},Cm=(B,e,t)=>{let A=e===q.Relearning||e===q.Review?B.relearning_steps:B.learning_steps,i=A.length;if(i===0||t>=i)return{};let n=A[0],l=Bm,c=()=>l(n),d=()=>{if(i===1)return Math.round(l(n)*1.5);let F=A[1];return Math.round((l(n)+l(F))/2)},g=F=>F<0||F>=i?null:A[F],p=F=>l(F),C={},y=g(Math.max(0,t));if(e===q.Review)return C[x.Again]={scheduled_minutes:l(y),next_step:0},C;{C[x.Again]={scheduled_minutes:c(),next_step:0},C[x.Hard]={scheduled_minutes:d(),next_step:t};let F=g(t+1);if(F){let Q=p(F);Q&&(C[x.Good]={scheduled_minutes:Math.round(Q),next_step:t+1})}}return C},mn=(B=>(B.SCHEDULER="Scheduler",B.LEARNING_STEPS="LearningSteps",B.SEED="Seed",B))(mn||{}),gn=class{constructor(e,t,A,i){Ee(this,"last");Ee(this,"current");Ee(this,"review_time");Ee(this,"next",new Map);Ee(this,"algorithm");Ee(this,"strategies");Ee(this,"elapsed_days",0);this.algorithm=A,this.last=Y.card(e),this.current=Y.card(e),this.review_time=Y.time(t),this.strategies=i,this.init()}checkGrade(e){if(!Number.isFinite(e)||e<0||e>4)throw new Error(`Invalid grade "${e}",expected 1-4`)}init(){let{state:e,last_review:t}=this.current,A=0;e!==q.New&&t&&(A=rm(t,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=A,this.current.elapsed_days=A,this.current.reps+=1;let i=fm;if(this.strategies){let n=this.strategies.get(mn.SEED);n&&(i=n)}this.algorithm.seed=i.call(this)}preview(){return{[x.Again]:this.review(x.Again),[x.Hard]:this.review(x.Hard),[x.Good]:this.review(x.Good),[x.Easy]:this.review(x.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let e of tm)yield this.review(e)}review(e){let{state:t}=this.last,A;switch(this.checkGrade(e),t){case q.New:A=this.newState(e);break;case q.Learning:case q.Relearning:A=this.learningState(e);break;case q.Review:A=this.reviewState(e);break}return A}buildLog(e){let{last_review:t,due:A,elapsed_days:i}=this.last;return{rating:e,state:this.current.state,due:t||A,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:i,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}},un=class extends gn{constructor(t,A,i,n){super(t,A,i,n);Ee(this,"learningStepsStrategy");let l=Cm;if(this.strategies){let c=this.strategies.get(mn.LEARNING_STEPS);c&&(l=c)}this.learningStepsStrategy=l}getLearningInfo(t,A){var d,g,p,C;let i=this.algorithm.parameters;t.learning_steps=t.learning_steps||0;let n=this.learningStepsStrategy(i,t.state,this.current.state===q.Learning?t.learning_steps+1:t.learning_steps),l=Math.max(0,(g=(d=n[A])==null?void 0:d.scheduled_minutes)!=null?g:0),c=Math.max(0,(C=(p=n[A])==null?void 0:p.next_step)!=null?C:0);return{scheduled_minutes:l,next_steps:c}}applyLearningSteps(t,A,i){let{scheduled_minutes:n,next_steps:l}=this.getLearningInfo(this.current,A);if(n>0&&n<1440)t.learning_steps=l,t.scheduled_days=0,t.state=i,t.due=vt(this.review_time,Math.round(n),!1);else if(t.state=q.Review,n>=1440)t.learning_steps=l,t.due=vt(this.review_time,Math.round(n),!1),t.scheduled_days=Math.floor(n/1440);else{t.learning_steps=0;let c=this.algorithm.next_interval(t.stability,this.elapsed_days);t.scheduled_days=c,t.due=vt(this.review_time,c,!0)}}newState(t){let A=this.next.get(t);if(A)return A;let i=Y.card(this.current);i.difficulty=$e(this.algorithm.init_difficulty(t),1,10),i.stability=this.algorithm.init_stability(t),this.applyLearningSteps(i,t,q.Learning);let n={card:i,log:this.buildLog(t)};return this.next.set(t,n),n}learningState(t){let A=this.next.get(t);if(A)return A;let{state:i,difficulty:n,stability:l}=this.last,c=Y.card(this.current);c.difficulty=this.algorithm.next_difficulty(n,t),c.stability=this.algorithm.next_short_term_stability(l,t),this.applyLearningSteps(c,t,i);let d={card:c,log:this.buildLog(t)};return this.next.set(t,d),d}reviewState(t){let A=this.next.get(t);if(A)return A;let i=this.elapsed_days,{difficulty:n,stability:l}=this.last,c=this.algorithm.forgetting_curve(i,l),d=Y.card(this.current),g=Y.card(this.current),p=Y.card(this.current),C=Y.card(this.current);this.next_ds(d,g,p,C,n,l,c),this.next_interval(g,p,C,i),this.next_state(g,p,C),this.applyLearningSteps(d,x.Again,q.Relearning),d.lapses+=1;let y={card:d,log:this.buildLog(x.Again)},F={card:g,log:super.buildLog(x.Hard)},Q={card:p,log:super.buildLog(x.Good)},U={card:C,log:super.buildLog(x.Easy)};return this.next.set(x.Again,y),this.next.set(x.Hard,F),this.next.set(x.Good,Q),this.next.set(x.Easy,U),this.next.get(t)}next_ds(t,A,i,n,l,c,d){t.difficulty=this.algorithm.next_difficulty(l,x.Again);let g=c/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),p=this.algorithm.next_forget_stability(l,c,d);t.stability=$e(+g.toFixed(8),yt,p),A.difficulty=this.algorithm.next_difficulty(l,x.Hard),A.stability=this.algorithm.next_recall_stability(l,c,d,x.Hard),i.difficulty=this.algorithm.next_difficulty(l,x.Good),i.stability=this.algorithm.next_recall_stability(l,c,d,x.Good),n.difficulty=this.algorithm.next_difficulty(l,x.Easy),n.stability=this.algorithm.next_recall_stability(l,c,d,x.Easy)}next_interval(t,A,i,n){let l,c;l=this.algorithm.next_interval(t.stability,n),c=this.algorithm.next_interval(A.stability,n),l=Math.min(l,c),c=Math.max(c,l+1);let d=Math.max(this.algorithm.next_interval(i.stability,n),c+1);t.scheduled_days=l,t.due=vt(this.review_time,l,!0),A.scheduled_days=c,A.due=vt(this.review_time,c,!0),i.scheduled_days=d,i.due=vt(this.review_time,d,!0)}next_state(t,A,i){t.state=q.Review,t.learning_steps=0,A.state=q.Review,A.learning_steps=0,i.state=q.Review,i.learning_steps=0}},pn=class extends gn{newState(e){let t=this.next.get(e);if(t)return t;this.current.scheduled_days=0,this.current.elapsed_days=0;let A=Y.card(this.current),i=Y.card(this.current),n=Y.card(this.current),l=Y.card(this.current);return this.init_ds(A,i,n,l),this.next_interval(A,i,n,l,0),this.next_state(A,i,n,l),this.update_next(A,i,n,l),this.next.get(e)}init_ds(e,t,A,i){e.difficulty=$e(this.algorithm.init_difficulty(x.Again),1,10),e.stability=this.algorithm.init_stability(x.Again),t.difficulty=$e(this.algorithm.init_difficulty(x.Hard),1,10),t.stability=this.algorithm.init_stability(x.Hard),A.difficulty=$e(this.algorithm.init_difficulty(x.Good),1,10),A.stability=this.algorithm.init_stability(x.Good),i.difficulty=$e(this.algorithm.init_difficulty(x.Easy),1,10),i.stability=this.algorithm.init_stability(x.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){let t=this.next.get(e);if(t)return t;let A=this.elapsed_days,{difficulty:i,stability:n}=this.last,l=this.algorithm.forgetting_curve(A,n),c=Y.card(this.current),d=Y.card(this.current),g=Y.card(this.current),p=Y.card(this.current);return this.next_ds(c,d,g,p,i,n,l),this.next_interval(c,d,g,p,A),this.next_state(c,d,g,p),c.lapses+=1,this.update_next(c,d,g,p),this.next.get(e)}next_ds(e,t,A,i,n,l,c){e.difficulty=this.algorithm.next_difficulty(n,x.Again);let d=this.algorithm.next_forget_stability(n,l,c);e.stability=$e(l,yt,d),t.difficulty=this.algorithm.next_difficulty(n,x.Hard),t.stability=this.algorithm.next_recall_stability(n,l,c,x.Hard),A.difficulty=this.algorithm.next_difficulty(n,x.Good),A.stability=this.algorithm.next_recall_stability(n,l,c,x.Good),i.difficulty=this.algorithm.next_difficulty(n,x.Easy),i.stability=this.algorithm.next_recall_stability(n,l,c,x.Easy)}next_interval(e,t,A,i,n){let l,c,d,g;l=this.algorithm.next_interval(e.stability,n),c=this.algorithm.next_interval(t.stability,n),d=this.algorithm.next_interval(A.stability,n),g=this.algorithm.next_interval(i.stability,n),l=Math.min(l,c),c=Math.max(c,l+1),d=Math.max(d,c+1),g=Math.max(g,d+1),e.scheduled_days=l,e.due=vt(this.review_time,l,!0),t.scheduled_days=c,t.due=vt(this.review_time,c,!0),A.scheduled_days=d,A.due=vt(this.review_time,d,!0),i.scheduled_days=g,i.due=vt(this.review_time,g,!0)}next_state(e,t,A,i){e.state=q.Review,e.learning_steps=0,t.state=q.Review,t.learning_steps=0,A.state=q.Review,A.learning_steps=0,i.state=q.Review,i.learning_steps=0}update_next(e,t,A,i){let n={card:e,log:this.buildLog(x.Again)},l={card:t,log:super.buildLog(x.Hard)},c={card:A,log:super.buildLog(x.Good)},d={card:i,log:super.buildLog(x.Easy)};this.next.set(x.Again,n),this.next.set(x.Hard,l),this.next.set(x.Good,c),this.next.set(x.Easy,d)}},ka=class{constructor(e){Ee(this,"fsrs");this.fsrs=e}replay(e,t,A){return this.fsrs.next(e,t,A)}handleManualRating(e,t,A,i,n,l,c){if(typeof t>"u")throw new Error("reschedule: state is required for manual rating");let d,g;if(t===q.New)d={rating:x.Manual,state:t,due:c!=null?c:A,stability:e.stability,difficulty:e.difficulty,elapsed_days:i,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:A},g=ai(A),g.last_review=A;else{if(typeof c>"u")throw new Error("reschedule: due is required for manual rating");let p=ni(c,A,"days");d={rating:x.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:i,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:A},g={...e,state:t,due:c,last_review:A,stability:n||e.stability,difficulty:l||e.difficulty,elapsed_days:i,scheduled_days:p,reps:e.reps+1}}return{card:g,log:d}}reschedule(e,t){let A=[],i=ai(e.due);for(let n of t){let l;if(n.review=Y.time(n.review),n.rating===x.Manual){let c=0;i.state!==q.New&&i.last_review&&(c=ni(n.review,i.last_review,"days")),l=this.handleManualRating(i,n.state,n.review,c,n.stability,n.difficulty,n.due?Y.time(n.due):void 0)}else l=this.replay(i,n.review,n.rating);A.push(l),i=l.card}return A}calculateManualRecord(e,t,A,i){if(!A)return null;let{card:n,log:l}=A,c=Y.card(e);return c.due.getTime()===n.due.getTime()?null:(c.scheduled_days=ni(n.due,c.due,"days"),this.handleManualRating(c,n.state,Y.time(t),l.elapsed_days,i?n.stability:void 0,i?n.difficulty:void 0,n.due))}},Oa=class extends Ka{constructor(t){super(t);Ee(this,"strategyHandler",new Map);Ee(this,"Scheduler");let{enable_short_term:A}=this.parameters;this.Scheduler=A?un:pn}params_handler_proxy(){let t=this;return{set:function(A,i,n){return i==="request_retention"&&Number.isFinite(n)?t.intervalModifier=t.calculate_interval_modifier(Number(n)):i==="enable_short_term"?t.Scheduler=n===!0?un:pn:i==="w"&&(n=Na(Ga(n),A.relearning_steps.length),t.forgetting_curve=Ra.bind(this,n),t.intervalModifier=t.calculate_interval_modifier(Number(A.request_retention))),Reflect.set(A,i,n),!0}}}useStrategy(t,A){return this.strategyHandler.set(t,A),this}clearStrategy(t){return t?this.strategyHandler.delete(t):this.strategyHandler.clear(),this}getScheduler(t,A){let i=this.strategyHandler.get(mn.SCHEDULER)||this.Scheduler;return new i(t,A,this,this.strategyHandler)}repeat(t,A,i){let n=this.getScheduler(t,A).preview();return i&&typeof i=="function"?i(n):n}next(t,A,i,n){let l=this.getScheduler(t,A),c=Y.rating(i);if(c===x.Manual)throw new Error("Cannot review a manual rating");let d=l.review(c);return n&&typeof n=="function"?n(d):d}get_retrievability(t,A,i=!0){let n=Y.card(t);A=A?Y.time(A):new Date;let l=n.state!==q.New?Math.max(ni(A,n.last_review,"days"),0):0,c=n.state!==q.New?this.forgetting_curve(l,+n.stability.toFixed(8)):0;return i?`${(c*100).toFixed(2)}%`:c}rollback(t,A,i){let n=Y.card(t),l=Y.review_log(A);if(l.rating===x.Manual)throw new Error("Cannot rollback a manual rating");let c,d,g;switch(l.state){case q.New:c=l.due,d=void 0,g=0;break;case q.Learning:case q.Relearning:case q.Review:c=l.review,d=l.due,g=n.lapses-(l.rating===x.Again&&l.state===q.Review?1:0);break}let p={...n,due:c,stability:l.stability,difficulty:l.difficulty,elapsed_days:l.last_elapsed_days,scheduled_days:l.scheduled_days,reps:Math.max(0,n.reps-1),lapses:Math.max(0,g),learning_steps:l.learning_steps,state:l.state,last_review:d};return i&&typeof i=="function"?i(p):p}forget(t,A,i=!1,n){let l=Y.card(t);A=Y.time(A);let c=l.state===q.New?0:ni(A,l.due,"days"),d={rating:x.Manual,state:l.state,due:l.due,stability:l.stability,difficulty:l.difficulty,elapsed_days:0,last_elapsed_days:l.elapsed_days,scheduled_days:c,learning_steps:l.learning_steps,review:A},g={card:{...l,due:A,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:l.reps,lapses:i?0:l.lapses,learning_steps:0,state:q.New,last_review:l.last_review},log:d};return n&&typeof n=="function"?n(g):g}reschedule(t,A=[],i={}){let{recordLogHandler:n,reviewsOrderBy:l,skipManual:c=!0,now:d=new Date,update_memory_state:g=!1}=i;l&&typeof l=="function"&&A.sort(l),c&&(A=A.filter(U=>U.rating!==x.Manual));let p=new ka(this),C=p.reschedule(i.first_card||ai(),A),y=C.length,F=Y.card(t),Q=p.calculateManualRecord(F,d,y?C[y-1]:void 0,g);return n&&typeof n=="function"?{collections:C.map(n),reschedule_item:Q?n(Q):null}:{collections:C,reschedule_item:Q}}},Va=B=>new Oa(B||{});FA();var fn=class{constructor(e={}){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=Va(this.params)}convertToTsFSRSParams(e){let{request_retention:t=.9,maximum_interval:A=36500,w:i=[]}=e;return dn({request_retention:t,maximum_interval:A,enable_fuzz:!0,enable_short_term:!0,w:e.w||[]})}toTsFSRSCard(e){if(e.lastReview===0)return ai(new Date(e.createdAt));let t=q.New;return e.reviews>0&&(e.lapses>0?t=q.Relearning:t=q.Review),{due:new Date(e.nextReview),stability:e.stability,difficulty:e.difficulty,elapsed_days:e.lastReview?(Date.now()-e.lastReview)/(24*60*60*1e3):0,scheduled_days:e.lastReview?(e.nextReview-e.lastReview)/(24*60*60*1e3):0,reps:e.reviews,lapses:e.lapses,state:t,last_review:e.lastReview?new Date(e.lastReview):void 0,learning_steps:0}}convertRating(e){switch(e){case le.AGAIN:return x.Again;case le.HARD:return x.Hard;case le.GOOD:return x.Good;case le.EASY:return x.Easy;default:return x.Good}}fromTsFSRSCard(e,t){let{card:A,log:i}=t;return{...e,difficulty:A.difficulty,stability:A.stability,retrievability:Math.exp(Math.log(.9)*A.elapsed_days/A.stability),lastReview:i.review.getTime(),nextReview:A.due.getTime(),reviews:A.reps,lapses:A.lapses,reviewHistory:[...e.reviewHistory,{timestamp:i.review.getTime(),rating:this.convertTsFSRSRatingToFSRSRating(i.rating),elapsed:i.elapsed_days}]}}convertTsFSRSRatingToFSRSRating(e){switch(e){case x.Again:return le.AGAIN;case x.Hard:return le.HARD;case x.Good:return le.GOOD;case x.Easy:return le.EASY;default:return le.GOOD}}initializeCard(e,t,A){let i=Date.now(),n=ai(new Date(i));return{id:it.generateCardId(),difficulty:n.difficulty,stability:n.stability,retrievability:1,lastReview:0,nextReview:i,reviews:0,lapses:0,reviewHistory:[],text:e,answer:t,filePath:A,createdAt:i}}reviewCard(e,t){let A=this.toTsFSRSCard(e),i=this.convertRating(t),n=new Date;if(i!==x.Manual){let l=this.fsrsInstance.next(A,n,i);return this.fromTsFSRSCard(e,l)}else return e}getSchedulingCards(e){let t=this.toTsFSRSCard(e),A=new Date,i=this.fsrsInstance.repeat(t,A);return{[le.AGAIN]:this.fromTsFSRSCard(e,i[x.Again]),[le.HARD]:this.fromTsFSRSCard(e,i[x.Hard]),[le.GOOD]:this.fromTsFSRSCard(e,i[x.Good]),[le.EASY]:this.fromTsFSRSCard(e,i[x.Easy])}}isDue(e){return Date.now()>=e.nextReview}getParameters(){return{...this.params}}setParameters(e){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=Va(this.params)}};var Bn=class{constructor(e={}){this.params={...wa,...e},this.adapter=new fn(this.params)}initializeCard(e,t,A){return this.adapter.initializeCard(e,t,A)}reviewCard(e,t){return this.adapter.reviewCard(e,t)}isDue(e){return this.adapter.isDue(e)}getReviewableCards(e){return e.filter(t=>this.isDue(t)).sort((t,A)=>t.nextReview-A.nextReview)}getParameters(){return{...this.params}}setParameters(e){this.params={...this.params,...e},this.adapter.setParameters(this.params)}resetParameters(){this.params={...wa},this.adapter.setParameters(this.params)}getSchedulingCards(e){return this.adapter.getSchedulingCards(e)}};var Cn=class{constructor(e,t){this.plugin=e,this.fsrsService=t}get storage(){return this.plugin.fsrsManager.storage}createCard(e,t,A){try{return this.fsrsService.initializeCard(e,t,A)}catch(i){console.error("\u521B\u5EFA\u5361\u7247\u65F6\u51FA\u9519:",i);try{return this.fsrsService.initializeCard(e,t,A)}catch(n){console.error("\u7B2C\u4E8C\u6B21\u5C1D\u8BD5\u521B\u5EFA\u5361\u7247\u5931\u8D25:",n);let l=new Date;return this.fsrsService.initializeCard(e,t,A)}}}addCard(e,t,A){let i=this.createCard(e,t,A);this.storage.cards||(this.storage.cards={}),this.storage.cards[i.id]=i;try{this.plugin.eventManager.emitFlashcardChanged()}catch(n){console.error("\u4FDD\u5B58\u5361\u7247\u65F6\u51FA\u9519:",n)}return i}getCardsByFile(e){return this.storage.cards?Object.values(this.storage.cards).filter(t=>t.filePath===e):[]}deleteCard(e){try{return!this.storage.cards||!this.storage.cards[e]?!1:(delete this.storage.cards[e],this.plugin.eventManager.emitFlashcardChanged(),!0)}catch(t){return console.error("\u5220\u9664\u5361\u7247\u65F6\u51FA\u9519:",t),!1}}};FA();var nr=class{constructor(e,t){this.plugin=e,this.storage=t}getCardGroups(){return this.storage.cardGroups||[]}getGroupById(e){return this.storage.cardGroups.find(t=>t.id===e)||null}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let A={id:it.generateGroupId(),name:e.name,filter:e.filter,createdTime:e.createdTime||Date.now(),sortOrder:e.sortOrder||this.storage.cardGroups.length,isReversed:e.isReversed||!1,settings:e.settings||{useGlobalSettings:!0},cardIds:[]};this.storage.cardGroups.push(A),e.filter&&e.filter.trim().length>0&&this.updateGroupCardIds(A.id);try{await this.plugin.fsrsManager.saveStoragePublic()}catch(i){console.error("\u4FDD\u5B58\u5206\u7EC4\u6570\u636E\u65F6\u51FA\u9519:",i)}return this.plugin.eventManager.emitFlashcardChanged(),A}async updateCardGroup(e,t){let A=this.storage.cardGroups.findIndex(i=>i.id===e);return A===-1?!1:(this.storage.cardGroups[A]={...this.storage.cardGroups[A],...t},t.filter&&this.updateGroupCardIds(e),this.plugin.eventManager.emitFlashcardChanged(),!0)}async deleteCardGroup(e,t=!1){let A=this.storage.cardGroups.findIndex(c=>c.id===e);if(A===-1)return!1;let i=this.storage.cardGroups[A],n=this.storage.uiState;n.currentGroupId===e&&(n.currentGroupId="",n.currentGroupName="",n.currentIndex=0,n.isFlipped=!1,n.completionMessage=null),n.groupCompletionMessages&&e in n.groupCompletionMessages&&delete n.groupCompletionMessages[e],n.groupProgress&&e in n.groupProgress&&delete n.groupProgress[e];let l=[...i.cardIds||[]];for(let c of l)this.removeCardFromGroup(c,e);return this.storage.cardGroups.splice(A,1),this.plugin.eventManager.emitFlashcardChanged(),!0}addCardToGroup(e,t){let A=this.storage.cardGroups.find(n=>n.id===t);if(!A)return!1;let i=this.storage.cards[e];return i?(A.cardIds||(A.cardIds=[]),i.groupIds||(i.groupIds=[]),A.cardIds.includes(e)||(A.cardIds.push(e),i.groupIds.includes(t)||i.groupIds.push(t)),!0):!1}removeCardFromGroup(e,t){let A=this.storage.cardGroups.find(n=>n.id===t);if(!A||!A.cardIds)return!1;let i=this.storage.cards[e];return i?(A.cardIds=A.cardIds.filter(n=>n!==e),i.groupIds&&(i.groupIds=i.groupIds.filter(n=>n!==t)),!0):!1}getCardsByGroupId(e){let t=this.getGroupById(e);if(!t)return console.error(`[getCardsByGroupId] \u9519\u8BEF: \u672A\u627E\u5230\u5206\u7EC4: ${e}`),[];let A=Object.keys(this.storage.cards||{});if(t.cardIds&&t.cardIds.length>0)return t.cardIds.filter(n=>{let l=!!this.storage.cards[n];return l||console.warn(`[getCardsByGroupId] \u5361\u7247\u4E0D\u5B58\u5728: ${n}`),l}).map(n=>this.storage.cards[n]);if(t.filter&&t.filter.trim().length>0){let i=Object.values(this.storage.cards),n=t.filter.split(",").map(d=>d.trim()).filter(d=>d.length>0),l=/\[\[([^\]]+)\]\]/;return i.filter(d=>{if(!d.filePath)return!1;let g=d.filePath.toLowerCase(),p=g.split("/").pop()||"",C=p.replace(/\.md$/i,"");for(let y of n){let F=y.toLowerCase(),Q=F.match(l);if(Q){let U=Q[1].toLowerCase();if(C===U||p===U)return!0}else if(g.includes(F)||d.text&&d.text.toLowerCase().includes(F)||d.answer&&d.answer.toLowerCase().includes(F))return!0}return!1})}return[]}getGroupProgress(e){if(!this.getGroupById(e))return null;let A=this.getCardsByGroupId(e),i=Date.now();return{due:A.filter(n=>n.nextReview<=i).length,newCards:A.filter(n=>n.lastReview===0).length,learned:A.filter(n=>n.lastReview>0).length,retention:this.calculateGroupRetention(A)}}calculateGroupRetention(e){let t=e.filter(i=>i.lastReview>0);return t.length===0?1:t.reduce((i,n)=>i+n.retrievability,0)/t.length}deleteCardReference(e){for(let t of this.storage.cardGroups)t.cardIds&&(t.cardIds=t.cardIds.filter(A=>A!==e))}getGroupsByCardId(e){let t=this.storage.cards[e];return!t||!t.groupIds?[]:t.groupIds.map(A=>this.storage.cardGroups.find(i=>i.id===A)).filter(A=>A!==void 0)}updateGroupCardIds(e){let t=this.getGroupById(e);if(!t||!t.filter||t.filter.trim().length===0)return!1;let A=Object.values(this.storage.cards||{}),i=t.filter.split(",").map(g=>g.trim()).filter(g=>g.length>0),n=/\[\[([^\]]+)\]\]/,c=A.filter(g=>{if(!g.filePath)return!1;let p=g.filePath.toLowerCase(),C=p.split("/").pop()||"",y=C.replace(/\.md$/i,"");for(let F of i){let Q=F.toLowerCase(),U=Q.match(n);if(U){let b=U[1].toLowerCase();if(y===b||C===b)return!0}else if(p.includes(Q)||g.text&&g.text.toLowerCase().includes(Q)||g.answer&&g.answer.toLowerCase().includes(Q))return!0}return!1}).map(g=>g.id);t.cardIds||(t.cardIds=[]);let d=!1;for(let g of c)t.cardIds.includes(g)||(t.cardIds.push(g),d=!0);return d&&this.plugin.fsrsManager.saveStorageDebounced(),d}};var xc=require("obsidian"),wn=class{constructor(e,t){this.useNewStorage=!1;this.plugin=e,this.fsrsService=new Bn,this.cardFactory=new Cn(e,this.fsrsService),t&&(this.dataManager=t,this.useNewStorage=!0),this.storage={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]},this.saveStorageDebounced=(0,xc.debounce)(this.saveStorage.bind(this),1e3,!0),this.loadStorage().then(A=>{this.storage=A,this.groupRepository=new nr(e,this.storage),this.registerEventListeners()}).catch(A=>{console.error("Loading storage data failed:",A),this.groupRepository=new nr(e,this.storage),this.registerEventListeners()})}async loadStorage(){let e={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]};try{if(this.useNewStorage&&this.dataManager)return await this.dataManager.getFlashcardData()||e;{let t=await this.plugin.loadData();if(!(t!=null&&t.fsrs))return e;let A=Array.isArray(t.fsrs.cardGroups)?t.fsrs.cardGroups:[];return{version:t.fsrs.version||e.version,cards:t.fsrs.cards||{},globalStats:t.fsrs.globalStats||e.globalStats,cardGroups:A,uiState:t.fsrs.uiState||e.uiState,dailyStats:t.fsrs.dailyStats||[]}}}catch(t){return console.error("Loading storage data failed:",t),e}}async saveStorage(){try{if(Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]),this.storage.cards||(this.storage.cards={}),this.useNewStorage&&this.dataManager)await this.dataManager.saveFlashcardData(this.storage);else{let t={...await this.plugin.loadData()||{},fsrs:this.storage};await this.plugin.saveData(t)}}catch(e){throw console.error("Saving data failed:",e),e}}updateGlobalStats(e,t){let A=this.storage.globalStats,i=Date.now(),n=new Date(i).setHours(0,0,0,0);if(A.totalReviews++,A.averageRetention=(A.averageRetention*(A.totalReviews-1)+t)/A.totalReviews,A.lastReviewDate===0)A.streakDays=1;else{let l=new Date(A.lastReviewDate).setHours(0,0,0,0),c=(n-l)/(24*60*60*1e3);c===1?A.streakDays++:c>1&&(A.streakDays=1)}A.lastReviewDate=i}addCard(e,t,A,i,n){let l=this.cardFactory.createCard(e,t,A);return i&&n&&(l.sourceId=i,l.sourceType=n),this.storage.cards[l.id]=l,this.checkAndAddCardToGroups(l),this.saveStorageDebounced(),l}getCardsForStudy(e){if(!e)return console.warn("No group ID specified, returning empty card list"),[];let t=this.groupRepository.getCardsByGroupId(e);if(t.length===0)return[];let A=Date.now(),i=t.filter(F=>F.reviews===0&&F.lastReview===0),n=t.filter(F=>!(F.reviews===0&&F.lastReview===0)&&F.nextReview<=A),l=this.getRemainingNewCardsToday(e),c=this.getRemainingReviewsToday(e),d=this.storage.cardGroups.find(F=>F.id===e),g=20,p=100;if(d&&d.settings)if(!d.settings.useGlobalSettings)g=d.settings.newCardsPerDay!==void 0?d.settings.newCardsPerDay:g,p=d.settings.reviewsPerDay!==void 0?d.settings.reviewsPerDay:p;else{let F=this.fsrsService.getParameters();g=F.newCardsPerDay,p=F.reviewsPerDay}let C=i.slice(0,l),y=n.slice(0,c);return[...C,...y]}trackStudyProgress(e,t){let A=this.storage.cards[e];if(!A)return console.error(`Tracking study progress failed: Card ${e} does not exist`),null;let i=A.lastReview===0,n=this.fsrsService.reviewCard(A,t);return this.storage.cards[e]=n,this.updateGlobalStats(t,n.retrievability),this.updateDailyStats(i,t),A.groupIds&&A.groupIds.length>0&&A.groupIds.forEach(l=>{let c=this.groupRepository.getGroupById(l)}),this.saveStorage(),this.plugin.eventManager.emitFlashcardChanged(),this.storage.cards[e]}getCardPredictions(e){let t=this.storage.cards[e];return t?this.fsrsService.getSchedulingCards(t):null}async generateCardsForGroup(e){return 0}checkAndAddCardToGroups(e){if(!e||!e.id)return 0;let t=this.groupRepository.getCardGroups();if(!t||t.length===0)return 0;let A=0;for(let i of t){if(!i.filter||i.filter.trim().length===0)continue;let n=[e];this.checkCardMatchesGroupFilter(e,i.filter)&&this.addCardToGroup(e.id,i.id)&&A++}return A>0,A}checkCardMatchesGroupFilter(e,t){if(!e||!e.filePath||!t||t.trim().length===0)return!1;let A=t.split(",").map(d=>d.trim()).filter(d=>d.length>0);if(A.length===0)return!1;let i=/\[\[([^\]]+)\]\]/,n=e.filePath.toLowerCase(),l=n.split("/").pop()||"",c=l.replace(/\.md$/i,"");for(let d of A){let g=d.toLowerCase(),p=g.match(i);if(p){let C=p[1].toLowerCase();if(c===C||l===C)return!0}else if(n.includes(g)||e.text&&e.text.toLowerCase().includes(g)||e.answer&&e.answer.toLowerCase().includes(g))return!0}return!1}findCardsBySourceId(e,t){return!this.storage.cards||!e?[]:Object.values(this.storage.cards).filter(A=>A.sourceId===e&&(!t||A.sourceType===t))}deleteCardsBySourceId(e,t){let A=this.findCardsBySourceId(e,t),i=0;for(let n of A){if(n.groupIds)for(let l of n.groupIds)this.removeCardFromGroup(n.id,l);delete this.storage.cards[n.id],i++}return i>0&&this.saveStorageDebounced(),i}updateCardsBySourceId(e,t,A,i){let n=this.findCardsBySourceId(e,t),l=0;for(let c of n)A!==void 0&&(c.text=A),i!==void 0&&(c.answer=i),c.updatedAt=Date.now(),l++;return l>0&&this.saveStorageDebounced(),l}getTotalCardsCount(){let e=this.getCardGroups()||[];if(e.length===0)return 0;if(e.length===1&&e[0].cardIds)return e[0].cardIds.length;let t=new Set;return e.forEach(A=>{A.cardIds&&A.cardIds.forEach(i=>{this.storage.cards[i]&&t.add(i)})}),t.size}getProgress(){let e=this.getAllGroupCards(),t=Date.now();return e.length===0?{due:0,newCards:0,learned:0,retention:this.storage.globalStats.averageRetention}:{due:e.filter(A=>A.nextReview<=t).length,newCards:e.filter(A=>A.lastReview===0).length,learned:e.filter(A=>A.lastReview>0).length,retention:this.storage.globalStats.averageRetention}}getAllGroupCards(){let e=this.groupRepository.getCardGroups();if(!e||e.length===0)return[];let t=new Set,A=[];for(let i of e){let n=this.groupRepository.getCardsByGroupId(i.id);for(let l of n)t.has(l.id)||(t.add(l.id),A.push(l))}return A}getStats(){return{...this.storage.globalStats}}getUIState(){return{...this.storage.uiState}}updateUIState(e){this.storage.uiState={...this.storage.uiState,...e},this.saveStorageDebounced()}deleteCard(e){let t=this.storage.cards[e];if(!t)return!1;if(t.groupIds)for(let A of t.groupIds)this.removeCardFromGroup(e,A);return delete this.storage.cards[e],this.saveStorageDebounced(),this.plugin.eventManager.emitFlashcardChanged(),!0}getCardsByFile(e){return this.cardFactory.getCardsByFile(e)}getPlugin(){return this.plugin}async saveStoragePublic(){return this.saveStorage()}getTodayTimestamp(){let e=new Date;return e.setHours(0,0,0,0),e.getTime()}getTodayStats(){let e=new Date;e.setHours(0,0,0,0);let t=e.getTime(),A=e.toDateString(),i=this.storage.dailyStats.find(n=>new Date(n.date).toDateString()===A);return i||(i={date:t,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(i),this.saveStorageDebounced()),i}updateTodayStats(e){let t=this.getTodayStats();e?t.newCardsLearned++:t.cardsReviewed++,this.saveStorageDebounced()}canLearnNewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return t.newCardsLearned<i.settings.newCardsPerDay}return t.newCardsLearned<A.newCardsPerDay}canReviewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return t.cardsReviewed<i.settings.reviewsPerDay}return t.cardsReviewed<A.reviewsPerDay}getRemainingNewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return Math.max(0,i.settings.newCardsPerDay-t.newCardsLearned)}return Math.max(0,A.newCardsPerDay-t.newCardsLearned)}getRemainingReviewsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return Math.max(0,i.settings.reviewsPerDay-t.cardsReviewed)}return Math.max(0,A.reviewsPerDay-t.cardsReviewed)}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let t=await this.groupRepository.createCardGroup(e),A=await this.generateCardsForGroup(t.id);return this.storage.cardGroups.some(i=>i.id===t.id)||this.storage.cardGroups.push(t),await this.saveStorage(),t}async updateCardGroup(e,t){let A=this.groupRepository.getGroupById(e),i=A==null?void 0:A.filter;if(!await this.groupRepository.updateCardGroup(e,t))return!1;if(t.filter!==void 0&&t.filter!==i){let l=this.groupRepository.getGroupById(e);if(l&&l.cardIds)for(let d of[...l.cardIds])this.removeCardFromGroup(d,e);let c=await this.generateCardsForGroup(e)}return await this.saveStorage(),!0}async deleteCardGroup(e,t=!1){if(!await this.groupRepository.deleteCardGroup(e,!1))return!1;try{return await this.saveStorage(),!0}catch(i){return!1}}getCardsInGroup(e){return e.cardIds&&e.cardIds.length>0?this.getCardsByGroupId(e.id):Object.values(this.storage.cards).filter(A=>{let i=e.filter.split(",").map(g=>g.trim().toLowerCase()),n=A.text.toLowerCase(),l=A.answer.toLowerCase(),c=(A.filePath||"").toLowerCase();return i.some(g=>{if(g.startsWith("#"))return n.includes(g)||l.includes(g);if(g.startsWith("path:")){let p=g.substring(5);return c.includes(p)}return n.includes(g)||l.includes(g)})})}addCardToGroup(e,t){let A=this.groupRepository.addCardToGroup(e,t);return A&&this.saveStorageDebounced(),A}removeCardFromGroup(e,t){let A=this.groupRepository.removeCardFromGroup(e,t);return A&&this.saveStorageDebounced(),A}getGroupProgress(e){return this.groupRepository.getGroupProgress(e)}getCardsByGroupId(e){return this.groupRepository.getCardsByGroupId(e)}getAllCards(){return Object.values(this.storage.cards)}getCardGroups(){return this.groupRepository.getCardGroups()}registerEventListeners(){if(!this.plugin.eventManager){console.error("\u4E8B\u4EF6\u7BA1\u7406\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u6CE8\u518C\u4E8B\u4EF6\u76D1\u542C\u5668");return}this.plugin.eventManager.on("highlight:update",(e,t,A,i)=>{this.handleHighlightUpdate(e,t,A,i)}),this.plugin.eventManager.on("highlight:delete",(e,t,A)=>{this.handleHighlightDelete(e,t,A)}),this.plugin.eventManager.on("comment:update",(e,t,A,i)=>{this.handleCommentUpdate(e,t,A,i)}),this.plugin.eventManager.on("comment:delete",(e,t,A)=>{this.handleCommentDelete(e,t,A)})}handleHighlightUpdate(e,t,A,i){let n=this.updateCardsBySourceId(i,"highlight",A)}handleHighlightDelete(e,t,A){let i=this.deleteCardsBySourceId(A,"highlight")}handleCommentUpdate(e,t,A,i){var g;let n=this.findCardsBySourceId(i,"highlight");if(!n||n.length===0)return;let l=(g=this.plugin.highlightRepository)==null?void 0:g.findHighlightById(i),c=(l==null?void 0:l.comments)||[],d=0;for(let p of n){let C=/\{\{([^{}]+)\}\}/g,y=[],F;for(;(F=C.exec(p.text))!==null;)y.push(F[1]);let Q=[];if(y.length>0&&Q.push(y.join(`
`)),c.length>0){let b=c.map(k=>k.content).filter(k=>k&&k.trim()!=="");b.length>0&&Q.push(b.join(`

`))}let U=Q.length>0?Q.join(`

`):"";U!==p.answer&&(p.answer=U,p.updatedAt=Date.now(),d++)}d>0&&(this.saveStorageDebounced(),this.plugin.eventManager&&this.plugin.eventManager.emitFlashcardChanged())}handleCommentDelete(e,t,A){let i=this.deleteCardsBySourceId(A,"highlight")}checkAndMaintainDailyStats(){this.storage.dailyStats||(this.storage.dailyStats=[]),this.storage.dailyStats.sort((t,A)=>A.date-t.date);let e=new Map;return this.storage.dailyStats.forEach(t=>{let A=new Date(t.date),i=`${A.getFullYear()}-${A.getMonth()+1}-${A.getDate()}`;e.has(i)||e.set(i,t)}),this.storage.dailyStats=Array.from(e.values()),this.storage.dailyStats.sort((t,A)=>A.date-t.date),this.storage.dailyStats.length>84&&(this.storage.dailyStats=this.storage.dailyStats.slice(0,84)),this.storage.dailyStats.length}updateDailyStats(e,t){let A=new Date;A.setHours(0,0,0,0);let i=A.getTime();this.storage.globalStats.lastReviewDate?this.storage.globalStats.lastReviewDate===i||(this.storage.globalStats.lastReviewDate===i-864e5?(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays++):this.storage.globalStats.lastReviewDate<i&&(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1)):(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1);let n=A.toDateString(),l=this.storage.dailyStats.find(c=>new Date(c.date).toDateString()===n);switch(l||(l={date:i,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(l),this.checkAndMaintainDailyStats()),l.reviewCount++,e?(l.newCount++,l.newCardsLearned++):l.cardsReviewed++,t){case le.AGAIN:l.againCount++;break;case le.HARD:l.hardCount++;break;case le.GOOD:l.goodCount++;break;case le.EASY:l.easyCount++;break}this.saveStorageDebounced()}cleanupInvalidCardReferences(){let e=0;if(!this.storage.cardGroups)return e;for(let t of this.storage.cardGroups)if(t.cardIds&&t.cardIds.length>0){let A=t.cardIds.length;t.cardIds=t.cardIds.filter(n=>this.storage.cards&&this.storage.cards[n]);let i=A-t.cardIds.length;i>0&&(e+=i,t.lastUpdated=Date.now())}return e>0&&this.saveStorageDebounced(),e}resetGroupCompletionMessage(e){if(!e)return;let t=this.groupRepository.getGroupById(e);t&&(this.storage.uiState||(this.storage.uiState={currentGroupName:"",completionMessage:null,groupProgress:{}}),this.storage.uiState.groupProgress||(this.storage.uiState.groupProgress={}),this.storage.uiState.groupProgress[t.name]&&(this.storage.uiState.groupProgress[t.name].completionMessage=null,this.saveStorageDebounced()))}};var Tc=require("crypto"),Ye=class{static toSafeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_").replace(/\s+/g,"_").toLowerCase()+".json"}static fromSafeFileName(e){return e.replace(/\.json$/,"").replace(/_/g," ")}static generateHash(e){return(0,Tc.createHash)("md5").update(e).digest("hex")}static isSafePath(e){return!/[\/\\:*?"<>|]/.test(e)}static getHiNoteDir(e){return`${e}/.hinote`}static getHighlightsDir(e){return`${this.getHiNoteDir(e)}/highlights`}static getFlashcardsDir(e){return`${this.getHiNoteDir(e)}/flashcards`}static getMetadataDir(e){return`${this.getHiNoteDir(e)}/metadata`}};var oi=class{static validateHighlightData(e){let t=[];if(!e||typeof e!="object")return t.push("\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t};if((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),e.lastModified&&typeof e.lastModified!="number"&&t.push("lastModified\u5FC5\u987B\u662F\u6570\u5B57"),!e.highlights||typeof e.highlights!="object")return t.push("\u7F3A\u5C11highlights\u5BF9\u8C61"),{valid:!1,errors:t};for(let[A,i]of Object.entries(e.highlights)){let n=this.validateHighlight(A,i);t.push(...n)}return{valid:t.length===0,errors:t}}static validateHighlight(e,t){let A=[];return!t||typeof t!="object"?(A.push(`\u9AD8\u4EAE ${e}: \u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),A):((!t.text||typeof t.text!="string")&&A.push(`\u9AD8\u4EAE ${e}: \u7F3A\u5C11\u6709\u6548\u7684text\u5B57\u6BB5`),typeof t.position!="number"&&A.push(`\u9AD8\u4EAE ${e}: position\u5FC5\u987B\u662F\u6570\u5B57`),typeof t.created!="number"&&A.push(`\u9AD8\u4EAE ${e}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof t.updated!="number"&&A.push(`\u9AD8\u4EAE ${e}: updated\u5FC5\u987B\u662F\u6570\u5B57`),t.backgroundColor&&typeof t.backgroundColor!="string"&&A.push(`\u9AD8\u4EAE ${e}: backgroundColor\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),t.blockId&&typeof t.blockId!="string"&&A.push(`\u9AD8\u4EAE ${e}: blockId\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),t.isCloze&&typeof t.isCloze!="boolean"&&A.push(`\u9AD8\u4EAE ${e}: isCloze\u5FC5\u987B\u662F\u5E03\u5C14\u503C`),t.comments&&(Array.isArray(t.comments)?t.comments.forEach((i,n)=>{let l=this.validateComment(i,`${e}.comments[${n}]`);A.push(...l)}):A.push(`\u9AD8\u4EAE ${e}: comments\u5FC5\u987B\u662F\u6570\u7EC4`)),A)}static validateComment(e,t){let A=[];return!e||typeof e!="object"?(A.push(`${t}: \u8BC4\u8BBA\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),A):((!e.id||typeof e.id!="string")&&A.push(`${t}: \u7F3A\u5C11\u6709\u6548\u7684id\u5B57\u6BB5`),(!e.content||typeof e.content!="string")&&A.push(`${t}: \u7F3A\u5C11\u6709\u6548\u7684content\u5B57\u6BB5`),typeof e.created!="number"&&A.push(`${t}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof e.updated!="number"&&A.push(`${t}: updated\u5FC5\u987B\u662F\u6570\u5B57`),A)}static validateFlashcardData(e){let t=[];return!e||typeof e!="object"?(t.push("\u95EA\u5361\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t}):((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),e.cards&&typeof e.cards!="object"&&t.push("cards\u5FC5\u987B\u662F\u5BF9\u8C61"),e.globalStats&&typeof e.globalStats!="object"&&t.push("globalStats\u5FC5\u987B\u662F\u5BF9\u8C61"),e.cardGroups&&!Array.isArray(e.cardGroups)&&t.push("cardGroups\u5FC5\u987B\u662F\u6570\u7EC4"),{valid:t.length===0,errors:t})}static validateFileMappingData(e){let t=[];return!e||typeof e!="object"?(t.push("\u6620\u5C04\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t}):((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),(!e.mapping||typeof e.mapping!="object")&&t.push("\u7F3A\u5C11mapping\u5BF9\u8C61"),typeof e.lastUpdated!="number"&&t.push("lastUpdated\u5FC5\u987B\u662F\u6570\u5B57"),{valid:t.length===0,errors:t})}static sanitizeHighlight(e){let t={};return e.text&&typeof e.text=="string"&&(t.text=e.text),typeof e.position=="number"&&(t.position=e.position),typeof e.created=="number"?t.created=e.created:typeof e.createdAt=="number"&&(t.created=e.createdAt),typeof e.updated=="number"?t.updated=e.updated:typeof e.updatedAt=="number"&&(t.updated=e.updatedAt),e.backgroundColor&&typeof e.backgroundColor=="string"&&(t.backgroundColor=e.backgroundColor),e.blockId&&typeof e.blockId=="string"&&(t.blockId=e.blockId),typeof e.isCloze=="boolean"&&(t.isCloze=e.isCloze),typeof e.paragraphOffset=="number"&&(t.paragraphOffset=e.paragraphOffset),Array.isArray(e.comments)&&(t.comments=e.comments.filter(A=>A&&typeof A=="object").map(A=>this.sanitizeComment(A)).filter(A=>A.id&&A.content)),t}static sanitizeComment(e){let t={};return e.id&&typeof e.id=="string"&&(t.id=e.id),e.content&&typeof e.content=="string"&&(t.content=e.content),typeof e.created=="number"?t.created=e.created:typeof e.createdAt=="number"&&(t.created=e.createdAt),typeof e.updated=="number"?t.updated=e.updated:typeof e.updatedAt=="number"&&(t.updated=e.updatedAt),t}};var vn=class{constructor(e){this.fileMapping=new Map;this.CURRENT_VERSION="2.0";this.app=e,this.vaultPath=""}async initialize(){await this.ensureDirectoryStructure(),await this.loadFileMapping()}async ensureDirectoryStructure(){let e=[Ye.getHiNoteDir(this.vaultPath),Ye.getHighlightsDir(this.vaultPath),Ye.getFlashcardsDir(this.vaultPath),Ye.getMetadataDir(this.vaultPath)];for(let t of e)try{await this.app.vault.adapter.mkdir(t)}catch(A){}}async loadFileMapping(){let e=`${Ye.getMetadataDir(this.vaultPath)}/file-mapping.json`;try{let t=await this.app.vault.adapter.read(e),A=JSON.parse(t),i=oi.validateFileMappingData(A);if(!i.valid){console.warn("\u6587\u4EF6\u6620\u5C04\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors);return}this.fileMapping=new Map(Object.entries(A.mapping))}catch(t){this.fileMapping=new Map}}async saveFileMapping(){let e=`${Ye.getMetadataDir(this.vaultPath)}/file-mapping.json`,t={version:this.CURRENT_VERSION,mapping:Object.fromEntries(this.fileMapping),lastUpdated:Date.now()};await this.app.vault.adapter.write(e,JSON.stringify(t,null,2))}getStoragePathForFile(e){let t=this.fileMapping.get(e);return t||(t=Ye.toSafeFileName(e),this.fileMapping.set(e,t),this.saveFileMapping().catch(console.error)),`${Ye.getHighlightsDir(this.vaultPath)}/${t}`}async getFileHighlights(e){let t=this.getStoragePathForFile(e);try{let A=await this.app.vault.adapter.read(t),i=JSON.parse(A),n=oi.validateHighlightData(i);return n.valid?Object.entries(i.highlights).map(([l,c])=>this.convertToLegacyFormat(l,c,e)):(console.warn(`\u6587\u4EF6 ${e} \u7684\u9AD8\u4EAE\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:`,n.errors),[])}catch(A){return[]}}async saveFileHighlights(e,t){let A=this.getStoragePathForFile(e),i={};for(let l of t){if(!l.id)continue;let c=this.convertToOptimizedFormat(l);i[l.id]=c}let n={version:this.CURRENT_VERSION,lastModified:Date.now(),highlights:i};await this.app.vault.adapter.write(A,JSON.stringify(n,null,2))}async deleteFileHighlights(e){let t=this.getStoragePathForFile(e);try{await this.app.vault.adapter.remove(t),this.fileMapping.delete(e),await this.saveFileMapping()}catch(A){}}async handleFileRename(e,t){let A=this.getStoragePathForFile(e),i=this.getStoragePathForFile(t);try{let n=await this.app.vault.adapter.read(A);await this.app.vault.adapter.write(i,n),await this.app.vault.adapter.remove(A),this.fileMapping.delete(e),await this.saveFileMapping()}catch(n){}}async getAllHighlightFiles(){let e=Array.from(this.fileMapping.keys());if(e.length===0)try{let t=Ye.getHighlightsDir(this.vaultPath),A=await this.app.vault.adapter.list(t),i=[];for(let n of A.files)if(n.endsWith(".json")){let l=n.replace(/\.json$/,"").replace(t+"/",""),c=Ye.fromSafeFileName(l);i.push(c),this.fileMapping.set(c,l)}return i.length>0&&this.saveFileMapping().catch(n=>console.warn("\u4FDD\u5B58\u6587\u4EF6\u6620\u5C04\u5931\u8D25:",n)),i}catch(t){return console.warn("\u626B\u63CF\u9AD8\u4EAE\u76EE\u5F55\u5931\u8D25:",t),[]}return e}convertToLegacyFormat(e,t,A){var i;return{id:e,text:t.text,position:t.position,createdAt:t.created,updatedAt:t.updated,filePath:A,backgroundColor:t.backgroundColor,blockId:t.blockId,isCloze:t.isCloze||!1,isVirtual:t.isVirtual||!1,paragraphOffset:t.paragraphOffset,comments:((i=t.comments)==null?void 0:i.map(n=>({id:n.id,content:n.content,createdAt:n.created,updatedAt:n.updated})))||[]}}convertToOptimizedFormat(e){var i,n;let t=Date.now(),A={text:e.text,position:e.position,created:(i=e.createdAt)!=null?i:t,updated:(n=e.updatedAt)!=null?n:t};return e.backgroundColor&&(A.backgroundColor=e.backgroundColor),e.blockId&&(A.blockId=e.blockId),e.isCloze&&(A.isCloze=e.isCloze),e.isVirtual&&(A.isVirtual=e.isVirtual),e.paragraphOffset!==void 0&&(A.paragraphOffset=e.paragraphOffset),e.comments&&e.comments.length>0&&(A.comments=e.comments.map(l=>({id:l.id,content:l.content,created:l.createdAt,updated:l.updatedAt}))),A}async getFlashcardData(){let e=`${Ye.getFlashcardsDir(this.vaultPath)}/cards.json`;try{let t=await this.app.vault.adapter.read(e),A=JSON.parse(t),i=oi.validateFlashcardData(A);return i.valid?A:(console.warn("\u95EA\u5361\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors),null)}catch(t){return null}}async saveFlashcardData(e){let t=`${Ye.getFlashcardsDir(this.vaultPath)}/cards.json`;await this.app.vault.adapter.write(t,JSON.stringify(e,null,2))}};var yn=class{constructor(e){this.vault=e}async parseCanvasFile(e){try{let t=await this.vault.read(e),A=JSON.parse(t),i=[];if(A&&A.nodes)for(let n of A.nodes)n.type==="file"&&n.file&&i.push(n.file);return i}catch(t){return console.error("\u89E3\u6790 Canvas \u6587\u4EF6\u5931\u8D25:",t),[]}}};var Lc=require("obsidian"),Fn=class{constructor(e){this.app=e;this.events=new Lc.Events}emitHighlightUpdate(e,t,A,i){this.events.trigger("highlight:update",e,t,A,i)}emitHighlightDelete(e,t,A){this.events.trigger("highlight:delete",e,t,A)}emitCommentUpdate(e,t,A,i){this.events.trigger("comment:update",e,t,A,i)}emitCommentDelete(e,t,A){this.events.trigger("comment:delete",e,t,A)}emitFlashcardChanged(){this.events.trigger("flashcard:changed")}on(e,t){return this.events.on(e,t)}off(e,t){this.events.off(e,t)}};var _a=require("obsidian");FA();var En=class{constructor(e,t,A,i){this.app=e;this.repository=t;this.eventManager=A;this.highlightService=i}async addHighlight(e,t){t.id||(t.id=it.generateHighlightId(e.path,t.position||0,t.text));let A=Date.now();t.createdAt||(t.createdAt=A),t.updatedAt=A;let i=e.path,n=await this.repository.getFileHighlights(i),l=n.findIndex(c=>c.id===t.id);if(l>=0?n[l]=t:n.push(t),await this.repository.saveFileHighlights(i,n),this.eventManager)if(t.comments&&t.comments.length>0){let c=t.comments[t.comments.length-1];this.eventManager.emitCommentUpdate(i,t.text,c.content,t.id)}else this.eventManager.emitHighlightUpdate(i,t.text,t.text,t.id);return t}async removeHighlight(e,t){let A=e.path,i=await this.repository.getFileHighlights(A);if(!i.some(c=>c.id===t.id))return!1;let l=i.filter(c=>c.id!==t.id);if(l.length>0?await this.repository.saveFileHighlights(A,l):await this.repository.deleteFileHighlights(A),this.eventManager&&t.id)if(t.comments&&t.comments.length>0){let c=t.comments[t.comments.length-1];this.eventManager.emitCommentDelete(A,c.content,t.id)}else this.eventManager.emitHighlightDelete(A,t.text,t.id);return!0}async getFileHighlights(e){return e?await this.repository.getFileHighlights(e.path):[]}async findHighlights(e,t){return e?(await this.repository.getFileHighlights(e.path)).filter(i=>i.text===t.text?typeof i.position=="number"&&typeof t.position=="number"?Math.abs(i.position-t.position)<1e3:!0:typeof i.position=="number"&&typeof t.position=="number"?Math.abs(i.position-t.position)<30:!1):[]}async findHighlightsByBlockId(e,t){return this.repository.findHighlightsByBlockId(e,t)}findHighlightById(e){return this.repository.findHighlightById(e)}async checkOrphanedDataCount(){let e=0,t=new Set,A=this.repository.getAllCachedHighlights();for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!l||!(l instanceof _a.TFile)){t.add(i),e+=n.length;continue}try{let c=await this.app.vault.read(l),d=this.highlightService.extractHighlights(c,l),g=new Set(d.map(C=>C.text)),p=!1;for(let C of n)C.isVirtual||g.has(C.text)||(e++,p=!0);p&&t.add(i)}catch(c){}}return{orphanedHighlights:e,affectedFiles:t.size}}async cleanOrphanedData(){let e=0,t=new Set,A=this.repository.getAllCachedHighlights();for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!l||!(l instanceof _a.TFile)){await this.repository.deleteFileHighlights(i),t.add(i),e+=n.length;continue}try{let c=await this.app.vault.read(l),d=this.highlightService.extractHighlights(c,l),g=new Set(d.map(C=>C.text)),p=n.filter(C=>C.isVirtual?!0:g.has(C.text));p.length<n.length&&(e+=n.length-p.length,t.add(i),p.length===0?await this.repository.deleteFileHighlights(i):await this.repository.saveFileHighlights(i,p))}catch(c){}}return{removedHighlights:e,affectedFiles:t.size}}async handleFileRename(e,t){await this.repository.handleFileRename(e,t)}};var In=class{constructor(e){this.cache=new Map;this.dataManager=e}async initialize(){await this.dataManager.initialize(),await this.loadAllHighlightsToCache()}async loadAllHighlightsToCache(){try{let e=await this.dataManager.getAllHighlightFiles();for(let t of e)this.cache.has(t)||this.cache.set(t,[]);for(let t of e)this.loadFileHighlightsAsync(t)}catch(e){console.error("[HighlightRepository] \u52A0\u8F7D\u9AD8\u4EAE\u6587\u4EF6\u5217\u8868\u5931\u8D25:",e)}}async loadFileHighlightsAsync(e){try{let t=await this.dataManager.getFileHighlights(e);t.length>0?this.cache.set(e,t):this.cache.delete(e)}catch(t){console.warn(`[HighlightRepository] \u52A0\u8F7D\u6587\u4EF6 ${e} \u7684\u9AD8\u4EAE\u6570\u636E\u5931\u8D25:`,t)}}async getFileHighlights(e){if(this.cache.has(e))return this.cache.get(e)||[];let t=await this.dataManager.getFileHighlights(e);return this.cache.set(e,t),t}async saveFileHighlights(e,t){this.cache.set(e,t),await this.dataManager.saveFileHighlights(e,t)}async deleteFileHighlights(e){this.cache.delete(e),await this.dataManager.deleteFileHighlights(e)}async handleFileRename(e,t){await this.dataManager.handleFileRename(e,t);let A=this.cache.get(e)||[];A.forEach(i=>{i.filePath=t}),this.cache.set(t,A),this.cache.delete(e)}async getAllHighlightFiles(){return await this.dataManager.getAllHighlightFiles()}getCachedHighlights(e){return this.cache.get(e)||null}invalidateCache(e){this.cache.delete(e)}getAllCachedHighlights(){return new Map(this.cache)}findHighlightById(e){if(!e)return null;for(let t of this.cache.values()){let A=t.find(i=>i.id===e);if(A)return A}return null}findHighlightsByBlockId(e,t){if(!e||!t)return[];let A=e.path;return(this.cache.get(A)||[]).filter(n=>n.blockId===t)}};var Hn=class{constructor(e){this.plugin=e;this.isInitialized=!1;this.initializationPromise=null}async ensureInitialized(){if(!this.isInitialized){if(this.initializationPromise)return this.initializationPromise;this.initializationPromise=this.initialize(),await this.initializationPromise,this.isInitialized=!0}}async initialize(){this.eventManager=new Fn(this.plugin.app),this.dataManager=new vn(this.plugin.app),this.highlightService=new zA(this.plugin.app),this.highlightService.initialize(),this.canvasService=new yn(this.plugin.app.vault),this.highlightRepository=new In(this.dataManager),this.highlightManager=new En(this.plugin.app,this.highlightRepository,this.eventManager,this.highlightService),this.highlightRepository.initialize().catch(e=>{console.error("[HiNote] \u52A0\u8F7D\u9AD8\u4EAE\u6570\u636E\u5931\u8D25:",e)}),this.fsrsManager=new wn(this.plugin,this.dataManager),this.highlightDecorator=new cn(this.plugin,this.highlightRepository),this.highlightDecorator.enable()}async cleanup(){this.highlightDecorator&&this.highlightDecorator.disable(),this.highlightService&&this.highlightService.destroy()}get initialized(){return this.isInitialized}};var Qn=class extends Pc.Plugin{get highlightDecorator(){return this.initManager.highlightDecorator}get fsrsManager(){return this.initManager.fsrsManager}get eventManager(){return this.initManager.eventManager}get highlightService(){return this.initManager.highlightService}get dataManager(){return this.initManager.dataManager}get canvasService(){return this.initManager.canvasService}get highlightRepository(){return this.initManager.highlightRepository}get highlightManager(){return this.initManager.highlightManager}async onload(){let e=await this.loadData();this.settings=Object.assign({},Wt,e),window.html2canvas=Dc.default,this.initManager=new Hn(this),this.windowManager=Ic(this),this.registerView(ft,t=>(this.initManager.ensureInitialized(),new lt(t,this.initManager.highlightManager,this.initManager.highlightRepository))),this.addRibbonIcon("highlighter","HiNote",async()=>{await this.initManager.ensureInitialized(),await this.windowManager.openCommentPanelInSidebar()}),Ec(this,this.windowManager,()=>this.initManager.ensureInitialized()),this.addSettingTab(new zs(this.app,this)),this.registerEvent(this.app.vault.on("rename",async(t,A)=>{this.initManager.initialized&&this.highlightManager&&await this.highlightManager.handleFileRename(A,t.path)}))}async onunload(){this.initManager&&await this.initManager.cleanup(),SA.instance&&SA.instance.close()}async saveSettings(){var t,A;this.settings||(this.settings={...Wt});let e=await this.loadData();e!=null&&e["flashcard-license"]&&(this.settings["flashcard-license"]=e["flashcard-license"]),this.settings.excludePatterns=(t=this.settings.excludePatterns)!=null?t:Wt.excludePatterns,this.settings.useCustomPattern=(A=this.settings.useCustomPattern)!=null?A:Wt.useCustomPattern,(!this.settings.regexRules||!Array.isArray(this.settings.regexRules))&&(this.settings.regexRules=[...Wt.regexRules]),this.settings.ai=this.settings.ai||{...Wt.ai},this.settings.export=this.settings.export||{...Wt.export},this.settings.ai.prompts||(this.settings.ai.prompts={...Wt.ai.prompts}),await this.saveData(this.settings)}};
/*! Bundled license information:

html2canvas/dist/html2canvas.js:
  (*!
   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   *)
  (*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
  
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
  
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** *)
*/

/* nosourcemap */